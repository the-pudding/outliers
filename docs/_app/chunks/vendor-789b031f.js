function Nc(){}function Jv(l,d){for(const y in d)l[y]=d[y];return l}function Qv(l){return l&&typeof l=="object"&&typeof l.then=="function"}function fy(l){return l()}function sg(){return Object.create(null)}function Hc(l){l.forEach(fy)}function e1(l){return typeof l=="function"}function t1(l,d){return l!=l?d==d:l!==d||l&&typeof l=="object"||typeof l=="function"}let Sh;function kS(l,d){return Sh||(Sh=document.createElement("a")),Sh.href=d,l===Sh.href}function i1(l){return Object.keys(l).length===0}function PS(l,d,y,b){if(l){const E=my(l,d,y,b);return l[0](E)}}function my(l,d,y,b){return l[1]&&b?Jv(y.ctx.slice(),l[1](b(d))):y.ctx}function DS(l,d,y,b){if(l[2]&&b){const E=l[2](b(y));if(d.dirty===void 0)return E;if(typeof E=="object"){const C=[],k=Math.max(d.dirty.length,E.length);for(let o=0;o<k;o+=1)C[o]=d.dirty[o]|E[o];return C}return d.dirty|E}return d.dirty}function LS(l,d,y,b,E,C){if(E){const k=my(d,y,b,C);l.p(k,E)}}function RS(l){if(l.ctx.length>32){const d=[],y=l.ctx.length/32;for(let b=0;b<y;b++)d[b]=-1;return d}return-1}function BS(l){return l==null?"":l}let _p=!1;function n1(){_p=!0}function r1(){_p=!1}function o1(l,d,y,b){for(;l<d;){const E=l+(d-l>>1);y(E)<=b?l=E+1:d=E}return l}function s1(l){if(l.hydrate_init)return;l.hydrate_init=!0;let d=l.childNodes;if(l.nodeName==="HEAD"){const O=[];for(let B=0;B<d.length;B++){const $=d[B];$.claim_order!==void 0&&O.push($)}d=O}const y=new Int32Array(d.length+1),b=new Int32Array(d.length);y[0]=-1;let E=0;for(let O=0;O<d.length;O++){const B=d[O].claim_order,$=(E>0&&d[y[E]].claim_order<=B?E+1:o1(1,E,G=>d[y[G]].claim_order,B))-1;b[O]=y[$]+1;const D=$+1;y[D]=O,E=Math.max(D,E)}const C=[],k=[];let o=d.length-1;for(let O=y[E]+1;O!=0;O=b[O-1]){for(C.push(d[O-1]);o>=O;o--)k.push(d[o]);o--}for(;o>=0;o--)k.push(d[o]);C.reverse(),k.sort((O,B)=>O.claim_order-B.claim_order);for(let O=0,B=0;O<k.length;O++){for(;B<C.length&&k[O].claim_order>=C[B].claim_order;)B++;const $=B<C.length?C[B]:null;l.insertBefore(k[O],$)}}function a1(l,d){if(_p){for(s1(l),(l.actual_end_child===void 0||l.actual_end_child!==null&&l.actual_end_child.parentElement!==l)&&(l.actual_end_child=l.firstChild);l.actual_end_child!==null&&l.actual_end_child.claim_order===void 0;)l.actual_end_child=l.actual_end_child.nextSibling;d!==l.actual_end_child?(d.claim_order!==void 0||d.parentNode!==l)&&l.insertBefore(d,l.actual_end_child):l.actual_end_child=d.nextSibling}else(d.parentNode!==l||d.nextSibling!==null)&&l.appendChild(d)}function l1(l,d,y){l.insertBefore(d,y||null)}function c1(l,d,y){_p&&!y?a1(l,d):(d.parentNode!==l||d.nextSibling!=y)&&l.insertBefore(d,y||null)}function qh(l){l.parentNode.removeChild(l)}function FS(l,d){for(let y=0;y<l.length;y+=1)l[y]&&l[y].d(d)}function _y(l){return document.createElement(l)}function u1(l){return document.createElementNS("http://www.w3.org/2000/svg",l)}function Nf(l){return document.createTextNode(l)}function OS(){return Nf(" ")}function NS(){return Nf("")}function US(l,d,y,b){return l.addEventListener(d,y,b),()=>l.removeEventListener(d,y,b)}function VS(l,d,y){y==null?l.removeAttribute(d):l.getAttribute(d)!==y&&l.setAttribute(d,y)}function $S(l,d,y){l.setAttributeNS("http://www.w3.org/1999/xlink",d,y)}function h1(l){return Array.from(l.childNodes)}function gy(l){l.claim_info===void 0&&(l.claim_info={last_index:0,total_claimed:0})}function yy(l,d,y,b,E=!1){gy(l);const C=(()=>{for(let k=l.claim_info.last_index;k<l.length;k++){const o=l[k];if(d(o)){const O=y(o);return O===void 0?l.splice(k,1):l[k]=O,E||(l.claim_info.last_index=k),o}}for(let k=l.claim_info.last_index-1;k>=0;k--){const o=l[k];if(d(o)){const O=y(o);return O===void 0?l.splice(k,1):l[k]=O,E?O===void 0&&l.claim_info.last_index--:l.claim_info.last_index=k,o}}return b()})();return C.claim_order=l.claim_info.total_claimed,l.claim_info.total_claimed+=1,C}function xy(l,d,y,b){return yy(l,E=>E.nodeName===d,E=>{const C=[];for(let k=0;k<E.attributes.length;k++){const o=E.attributes[k];y[o.name]||C.push(o.name)}C.forEach(k=>E.removeAttribute(k))},()=>b(d))}function jS(l,d,y){return xy(l,d,y,_y)}function GS(l,d,y){return xy(l,d,y,u1)}function p1(l,d){return yy(l,y=>y.nodeType===3,y=>{const b=""+d;if(y.data.startsWith(b)){if(y.data.length!==b.length)return y.splitText(b.length)}else y.data=b},()=>Nf(d),!0)}function ZS(l){return p1(l," ")}function ag(l,d,y){for(let b=y;b<l.length;b+=1){const E=l[b];if(E.nodeType===8&&E.textContent.trim()===d)return b}return l.length}function qS(l){const d=ag(l,"HTML_TAG_START",0),y=ag(l,"HTML_TAG_END",d);if(d===y)return new lg;gy(l);const b=l.splice(d,y-d+1);qh(b[0]),qh(b[b.length-1]);const E=b.slice(1,b.length-1);for(const C of E)C.claim_order=l.claim_info.total_claimed,l.claim_info.total_claimed+=1;return new lg(E)}function XS(l,d){d=""+d,l.wholeText!==d&&(l.data=d)}function WS(l,d,y,b){y===null?l.style.removeProperty(d):l.style.setProperty(d,y,b?"important":"")}function HS(l,d,y){l.classList[y?"add":"remove"](d)}function YS(l,d=document.body){return Array.from(d.querySelectorAll(l))}class d1{constructor(){this.e=this.n=null}c(d){this.h(d)}m(d,y,b=null){this.e||(this.e=_y(y.nodeName),this.t=y,this.c(d)),this.i(b)}h(d){this.e.innerHTML=d,this.n=Array.from(this.e.childNodes)}i(d){for(let y=0;y<this.n.length;y+=1)l1(this.t,this.n[y],d)}p(d){this.d(),this.h(d),this.i(this.a)}d(){this.n.forEach(qh)}}class lg extends d1{constructor(d){super();this.e=this.n=null,this.l=d}c(d){this.l?this.n=this.l:super.c(d)}i(d){for(let y=0;y<this.n.length;y+=1)c1(this.t,this.n[y],d)}}let Uc;function fo(l){Uc=l}function Yc(){if(!Uc)throw new Error("Function called outside component initialization");return Uc}function KS(l){Yc().$$.before_update.push(l)}function JS(l){Yc().$$.on_mount.push(l)}function QS(l){Yc().$$.after_update.push(l)}function eA(l,d){Yc().$$.context.set(l,d)}const kc=[],cg=[],Oh=[],ef=[],vy=Promise.resolve();let tf=!1;function by(){tf||(tf=!0,vy.then(Uf))}function tA(){return by(),vy}function nf(l){Oh.push(l)}function iA(l){ef.push(l)}const jd=new Set;let Ah=0;function Uf(){const l=Uc;do{for(;Ah<kc.length;){const d=kc[Ah];Ah++,fo(d),f1(d.$$)}for(fo(null),kc.length=0,Ah=0;cg.length;)cg.pop()();for(let d=0;d<Oh.length;d+=1){const y=Oh[d];jd.has(y)||(jd.add(y),y())}Oh.length=0}while(kc.length);for(;ef.length;)ef.pop()();tf=!1,jd.clear(),fo(l)}function f1(l){if(l.fragment!==null){l.update(),Hc(l.before_update);const d=l.dirty;l.dirty=[-1],l.fragment&&l.fragment.p(l.ctx,d),l.after_update.forEach(nf)}}const Nh=new Set;let Us;function m1(){Us={r:0,c:[],p:Us}}function _1(){Us.r||Hc(Us.c),Us=Us.p}function wy(l,d){l&&l.i&&(Nh.delete(l),l.i(d))}function g1(l,d,y,b){if(l&&l.o){if(Nh.has(l))return;Nh.add(l),Us.c.push(()=>{Nh.delete(l),b&&(y&&l.d(1),b())}),l.o(d)}}function nA(l,d){const y=d.token={};function b(E,C,k,o){if(d.token!==y)return;d.resolved=o;let O=d.ctx;k!==void 0&&(O=O.slice(),O[k]=o);const B=E&&(d.current=E)(O);let $=!1;d.block&&(d.blocks?d.blocks.forEach((D,G)=>{G!==C&&D&&(m1(),g1(D,1,1,()=>{d.blocks[G]===D&&(d.blocks[G]=null)}),_1())}):d.block.d(1),B.c(),wy(B,1),B.m(d.mount(),d.anchor),$=!0),d.block=B,d.blocks&&(d.blocks[C]=B),$&&Uf()}if(Qv(l)){const E=Yc();if(l.then(C=>{fo(E),b(d.then,1,d.value,C),fo(null)},C=>{if(fo(E),b(d.catch,2,d.error,C),fo(null),!d.hasCatch)throw C}),d.current!==d.pending)return b(d.pending,0),!0}else{if(d.current!==d.then)return b(d.then,1,d.value,l),!0;d.resolved=l}}function rA(l,d,y){const b=d.slice(),{resolved:E}=l;l.current===l.then&&(b[l.value]=E),l.current===l.catch&&(b[l.error]=E),l.block.p(b,y)}function oA(l,d){const y={},b={},E={$$scope:1};let C=l.length;for(;C--;){const k=l[C],o=d[C];if(o){for(const O in k)O in o||(b[O]=1);for(const O in o)E[O]||(y[O]=o[O],E[O]=1);l[C]=o}else for(const O in k)E[O]=1}for(const k in b)k in y||(y[k]=void 0);return y}function sA(l){return typeof l=="object"&&l!==null?l:{}}function aA(l,d,y){const b=l.$$.props[d];b!==void 0&&(l.$$.bound[b]=y,y(l.$$.ctx[b]))}function lA(l){l&&l.c()}function cA(l,d){l&&l.l(d)}function y1(l,d,y,b){const{fragment:E,on_mount:C,on_destroy:k,after_update:o}=l.$$;E&&E.m(d,y),b||nf(()=>{const O=C.map(fy).filter(e1);k?k.push(...O):Hc(O),l.$$.on_mount=[]}),o.forEach(nf)}function x1(l,d){const y=l.$$;y.fragment!==null&&(Hc(y.on_destroy),y.fragment&&y.fragment.d(d),y.on_destroy=y.fragment=null,y.ctx=[])}function v1(l,d){l.$$.dirty[0]===-1&&(kc.push(l),by(),l.$$.dirty.fill(0)),l.$$.dirty[d/31|0]|=1<<d%31}function uA(l,d,y,b,E,C,k,o=[-1]){const O=Uc;fo(l);const B=l.$$={fragment:null,ctx:null,props:C,update:Nc,not_equal:E,bound:sg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d.context||(O?O.$$.context:[])),callbacks:sg(),dirty:o,skip_bound:!1,root:d.target||O.$$.root};k&&k(B.root);let $=!1;if(B.ctx=y?y(l,d.props||{},(D,G,...J)=>{const xe=J.length?J[0]:G;return B.ctx&&E(B.ctx[D],B.ctx[D]=xe)&&(!B.skip_bound&&B.bound[D]&&B.bound[D](xe),$&&v1(l,D)),G}):[],B.update(),$=!0,Hc(B.before_update),B.fragment=b?b(B.ctx):!1,d.target){if(d.hydrate){n1();const D=h1(d.target);B.fragment&&B.fragment.l(D),D.forEach(qh)}else B.fragment&&B.fragment.c();d.intro&&wy(l.$$.fragment),y1(l,d.target,d.anchor,d.customElement),r1(),Uf()}fo(O)}class hA{$destroy(){x1(this,1),this.$destroy=Nc}$on(d,y){const b=this.$$.callbacks[d]||(this.$$.callbacks[d]=[]);return b.push(y),()=>{const E=b.indexOf(y);E!==-1&&b.splice(E,1)}}$set(d){this.$$set&&!i1(d)&&(this.$$.skip_bound=!0,this.$$set(d),this.$$.skip_bound=!1)}}const Ya=[];function pA(l,d=Nc){let y;const b=new Set;function E(o){if(t1(l,o)&&(l=o,y)){const O=!Ya.length;for(const B of b)B[1](),Ya.push(B,l);if(O){for(let B=0;B<Ya.length;B+=2)Ya[B][0](Ya[B+1]);Ya.length=0}}}function C(o){E(o(l))}function k(o,O=Nc){const B=[o,O];return b.add(B),b.size===1&&(y=d(E)||Nc),o(l),()=>{b.delete(B),b.size===0&&(y(),y=null)}}return{set:E,update:C,subscribe:k}}var Ty=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Ey={exports:{}};(function(l,d){(function(y,b){l.exports=b()})(Ty,function(){var y,b,E;function C(o,O){if(!y)y=O;else if(!b)b=O;else{var B="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+y+")(sharedChunk); ("+b+")(sharedChunk); self.onerror = null;",$={};y($),E=O($),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(E.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}C(["exports"],function(o){var O="2.8.2",B=$;function $(i,e,n,r){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=r,this.p2x=n,this.p2y=r}$.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},$.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},$.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},$.prototype.solveCurveX=function(i,e){var n,r,a,u,p;for(e===void 0&&(e=1e-6),a=i,p=0;p<8;p++){if(u=this.sampleCurveX(a)-i,Math.abs(u)<e)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=u/f}if((a=i)<(n=0))return n;if(a>(r=1))return r;for(;n<r;){if(u=this.sampleCurveX(a),Math.abs(u-i)<e)return a;i>u?n=a:r=a,a=.5*(r-n)+n}return a},$.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var D=G;function G(i,e){this.x=i,this.y=e}G.prototype={clone:function(){return new G(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(i,e){var n=Math.cos(i),r=Math.sin(i),a=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},G.convert=function(i){return i instanceof G?i:Array.isArray(i)?new G(i[0],i[1]):i};var J=typeof self!="undefined"?self:{};const xe=Math.PI/180,Pe=180/Math.PI;function ve(i){return i*xe}function We(i){return i*Pe}const Xe=[[0,0],[1,0],[1,1],[0,1]];function Ze(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function He(i,e,n,r){const a=new B(i,e,n,r);return function(u){return a.solve(u)}}const je=He(.25,.1,.25,1);function Ge(i,e,n){return Math.min(n,Math.max(e,i))}function Tt(i,e,n){return(n=Ge((n-i)/(e-i),0,1))*n*(3-2*n)}function yt(i,e,n){const r=n-e,a=((i-e)%r+r)%r+e;return a===e?n:a}function xt(i,e,n){if(!i.length)return n(null,[]);let r=i.length;const a=new Array(i.length);let u=null;i.forEach((p,f)=>{e(p,(g,v)=>{g&&(u=g),a[f]=v,--r==0&&n(u,a)})})}function St(i){const e=[];for(const n in i)e.push(i[n]);return e}function Ie(i,...e){for(const n of e)for(const r in n)i[r]=n[r];return i}let rt=1;function Je(){return rt++}function vt(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Be(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function mt(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Pt(i,e){i.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Rt(i,e){return i.indexOf(e,i.length-e.length)!==-1}function It(i,e,n){const r={};for(const a in i)r[a]=e.call(n||this,i[a],a,i);return r}function Di(i,e,n){const r={};for(const a in i)e.call(n||this,i[a],a,i)&&(r[a]=i[a]);return r}function ri(i){return Array.isArray(i)?i.map(ri):typeof i=="object"&&i?It(i,ri):i}const Li={};function Ct(i){Li[i]||(typeof console!="undefined"&&console.warn(i),Li[i]=!0)}function Yt(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Ai(i){let e=0;for(let n,r,a=0,u=i.length,p=u-1;a<u;p=a++)n=i[a],r=i[p],e+=(r.x-n.x)*(n.y+r.y);return e}function Ni(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Bn(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,r,a,u)=>{const p=a||u;return e[r]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let ln,cr,Fn,On,Ot=null;function ur(i){if(Ot==null){const e=i.navigator?i.navigator.userAgent:null;Ot=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ot}function Ws(i){try{const e=J[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const $i={now:()=>Fn!==void 0?Fn:J.performance.now(),setNow(i){Fn=i},restoreNow(){Fn=void 0},frame(i){const e=J.requestAnimationFrame(i);return{cancel:()=>J.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:n,height:r}=i;On||(On=J.document.createElement("canvas"));const a=On.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return(n>On.width||r>On.height)&&(On.width=n,On.height=r),a.clearRect(-e,-e,n+2*e,r+2*e),a.drawImage(i,0,0,n,r),a.getImageData(-e,-e,n+2*e,r+2*e)},resolveURL:i=>(ln||(ln=J.document.createElement("a")),ln.href=i,ln.href),get devicePixelRatio(){return J.devicePixelRatio},get prefersReducedMotion(){return!!J.matchMedia&&(cr==null&&(cr=J.matchMedia("(prefers-reduced-motion: reduce)")),cr.matches)}};let Ur;const $t={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Ur==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ur={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{Ur=i}}return Ur},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},hr={supported:!1,testSupport:function(i){!$r&&cn&&(go?es(i):Vr=i)}};let Vr,cn,$r=!1,go=!1;function es(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,cn),i.isContextLost())return;hr.supported=!0}catch{}i.deleteTexture(e),$r=!0}J.document&&(cn=J.document.createElement("img"),cn.onload=function(){Vr&&es(Vr),Vr=null,go=!0},cn.onerror=function(){$r=!0,Vr=null},cn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const yo="01",jr="NO_ACCESS_TOKEN";function En(i){return i.indexOf("mapbox:")===0}function Gr(i){return $t.API_URL_REGEX.test(i)}const Sn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function An(i){const e=i.match(Sn);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function pr(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function ts(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(J.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Zr{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=ts($t.ACCESS_TOKEN);let r="";return r=n&&n.u?J.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(a,u)=>String.fromCharCode(Number("0x"+u)))):$t.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const e=Ws("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const a=J.localStorage.getItem(n);a&&(this.eventData=JSON.parse(a));const u=J.localStorage.getItem(r);u&&(this.anonId=u)}catch{Ct("Unable to read from LocalStorage")}}saveEventData(){const e=Ws("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{J.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&J.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Ct("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,r,a){if(!$t.EVENTS_URL)return;const u=An($t.EVENTS_URL);u.params.push(`access_token=${a||$t.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:yo,userId:this.anonId},f=n?Ie(p,n):p,g={url:pr(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([f])};this.pendingRequest=ae(g,v=>{this.pendingRequest=null,r(v),this.saveEventData(),this.processRequests(a)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const xo=new class extends Zr{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){$t.EVENTS_URL&&$t.ACCESS_TOKEN&&Array.isArray(i)&&i.some(n=>En(n)||Gr(n))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ts($t.ACCESS_TOKEN),n=e?e.u:$t.ACCESS_TOKEN;let r=n!==this.eventData.tokenU;mt(this.anonId)||(this.anonId=vt(),r=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),p=new Date(a),f=(a-this.eventData.lastSuccess)/864e5;r=r||f>=1||f<-1||u.getDate()!==p.getDate()}else r=!0;r?this.postEvent(a,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=a,this.eventData.tokenU=n)},i):this.processRequests()}},pl=xo.postTurnstileEvent.bind(xo),Hs=new class extends Zr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,n,r){this.skuToken=e,this.errorCb=r,$t.EVENTS_URL&&(n||$t.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(jr)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),mt(this.anonId)||(this.anonId=vt()),this.postEvent(n,{skuToken:this.skuToken},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},i))}},Ys=Hs.postMapLoadEvent.bind(Hs),vo=new class extends Zr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,n,r){if(!$t.API_URL||!$t.SESSION_PATH)return;const a=An($t.API_URL+$t.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${r||$t.ACCESS_TOKEN||""}`);const u={url:pr(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=fe(u,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(r)})}getSessionAPI(i,e,n,r){this.skuToken=e,this.errorCb=r,$t.SESSION_PATH&&$t.API_URL&&(n||$t.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(jr)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},i)}},Ks=vo.getSessionAPI.bind(vo),qr=new Set,Js="mapbox-tiles";let Mn,dr,Xr=500,Wr=50;function bo(){J.caches&&!Mn&&(Mn=J.caches.open(Js))}function is(i){const e=i.indexOf("?");return e<0?i:i.slice(0,e)}let wo=1/0;const K={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(K);class L extends Error{constructor(e,n,r){n===401&&Gr(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const N=Ni()?()=>self.worker&&self.worker.referrer:()=>(J.location.protocol==="blob:"?J.parent:J).location.href,W=function(i,e){if(!(/^file:/.test(n=i.url)||/^file:/.test(N())&&!/^\w+:/.test(n))){if(J.fetch&&J.Request&&J.AbortController&&J.Request.prototype.hasOwnProperty("signal"))return function(r,a){const u=new J.AbortController,p=new J.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:N(),signal:u.signal});let f=!1,g=!1;const v=(T=p.url).indexOf("sku=")>0&&Gr(T);var T;r.type==="json"&&p.headers.set("Accept","application/json");const S=(P,F,V)=>{if(g)return;if(P&&P.message!=="SecurityError"&&Ct(P),F&&V)return M(F);const q=Date.now();J.fetch(p).then(Y=>{if(Y.ok){const oe=v?Y.clone():null;return M(Y,oe,q)}return a(new L(Y.statusText,Y.status,r.url))}).catch(Y=>{Y.code!==20&&a(new Error(Y.message))})},M=(P,F,V)=>{(r.type==="arrayBuffer"?P.arrayBuffer():r.type==="json"?P.json():P.text()).then(q=>{g||(F&&V&&function(Y,oe,le){if(bo(),!Mn)return;const ue={status:oe.status,statusText:oe.statusText,headers:new J.Headers};oe.headers.forEach((Te,Se)=>ue.headers.set(Se,Te));const he=Bn(oe.headers.get("Cache-Control")||"");if(he["no-store"])return;he["max-age"]&&ue.headers.set("Expires",new Date(le+1e3*he["max-age"]).toUTCString());const pe=ue.headers.get("Expires");pe&&(new Date(pe).getTime()-le<42e4||function(Te,Se){if(dr===void 0)try{new Response(new ReadableStream),dr=!0}catch{dr=!1}dr?Se(Te.body):Te.blob().then(Se)}(oe,Te=>{const Se=new J.Response(Te,ue);bo(),Mn&&Mn.then(ze=>ze.put(is(Y.url),Se)).catch(ze=>Ct(ze.message))}))}(p,F,V),f=!0,a(null,q,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(q=>{g||a(new Error(q.message))})};return v?function(P,F){if(bo(),!Mn)return F(null);const V=is(P.url);Mn.then(q=>{q.match(V).then(Y=>{const oe=function(le){if(!le)return!1;const ue=new Date(le.headers.get("Expires")||0),he=Bn(le.headers.get("Cache-Control")||"");return ue>Date.now()&&!he["no-cache"]}(Y);q.delete(V),oe&&q.put(V,Y.clone()),F(null,Y,oe)}).catch(F)}).catch(F)}(p,S):S(null,null),{cancel:()=>{g=!0,f||u.abort()}}}(i,e);if(Ni()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(r,a){const u=new J.XMLHttpRequest;u.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const p in r.headers)u.setRequestHeader(p,r.headers[p]);return r.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=r.credentials==="include",u.onerror=()=>{a(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(r.type==="json")try{p=JSON.parse(u.response)}catch(f){return a(f)}a(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else a(new L(u.statusText,u.status,r.url))},u.send(r.body),{cancel:()=>u.abort()}}(i,e)},ne=function(i,e){return W(Ie(i,{type:"arrayBuffer"}),e)},ae=function(i,e){return W(Ie(i,{method:"POST"}),e)},fe=function(i,e){return W(Ie(i,{method:"GET"}),e)};function de(i){const e=J.document.createElement("a");return e.href=i,e.protocol===J.document.location.protocol&&e.host===J.document.location.host}const ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ge,ke;ge=[],ke=0;const Ye=function(i,e){if(hr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),ke>=$t.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ge.push(u),u}ke++;let n=!1;const r=()=>{if(!n)for(n=!0,ke--;ge.length&&ke<$t.MAX_PARALLEL_IMAGE_REQUESTS;){const u=ge.shift(),{requestParameters:p,callback:f,cancelled:g}=u;g||(u.cancel=Ye(p,f).cancel)}},a=ne(i,(u,p,f,g)=>{r(),u?e(u):p&&(J.createImageBitmap?function(v,T){const S=new J.Blob([new Uint8Array(v)],{type:"image/png"});J.createImageBitmap(S).then(M=>{T(null,M)}).catch(M=>{T(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(v,T)=>e(v,T,f,g)):function(v,T){const S=new J.Image,M=J.URL;S.onload=()=>{T(null,S),M.revokeObjectURL(S.src),S.onload=null,J.requestAnimationFrame(()=>{S.src=ce})},S.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new J.Blob([new Uint8Array(v)],{type:"image/png"});S.src=v.byteLength?M.createObjectURL(P):ce}(p,(v,T)=>e(v,T,f,g)))});return{cancel:()=>{a.cancel(),r()}}};function Le(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function dt(i,e,n){if(n&&n[i]){const r=n[i].indexOf(e);r!==-1&&n[i].splice(r,1)}}class ct{constructor(e,n={}){Ie(this,n),this.type=e}}class ut extends ct{constructor(e,n={}){super("error",Ie({error:e},n))}}class _t{on(e,n){return this._listeners=this._listeners||{},Le(e,n,this._listeners),this}off(e,n){return dt(e,n,this._listeners),dt(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Le(e,n,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,n){typeof e=="string"&&(e=new ct(e,n||{}));const r=e.type;if(this.listens(r)){e.target=this;const a=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const f of a)f.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const f of u)dt(r,f,this._oneTimeListeners),f.call(this,e);const p=this._eventedParent;p&&(Ie(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof ut&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function jt(i,...e){for(const n of e)for(const r in n)i[r]=n[r];return i}function st(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ut(i){if(Array.isArray(i))return i.map(Ut);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Ut(i[n]);return e}return st(i)}class Gt extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Hr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[r,a]of n)this.bindings[r]=a}concat(e){return new Hr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Xn={kind:"null"},qe={kind:"number"},Bt={kind:"string"},zt={kind:"boolean"},Nn={kind:"color"},Yr={kind:"object"},Dt={kind:"value"},Kr={kind:"collator"},To={kind:"formatted"},Ui={kind:"resolvedImage"};function un(i,e){return{kind:"array",itemType:i,N:e}}function si(i){if(i.kind==="array"){const e=si(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const vp=[Xn,qe,Bt,zt,Nn,To,Yr,un(Dt),Ui];function ns(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ns(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of vp)if(!ns(n,e))return null}}return`Expected ${si(i)} but found ${si(e)} instead.`}function Qs(i,e){return e.some(n=>n.kind===i.kind)}function Eo(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function ea(i){var e={exports:{}};return i(e,e.exports),e.exports}var dl=ea(function(i,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(f){return(f=Math.round(f))<0?0:f>255?255:f}function a(f){return r(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function u(f){return(g=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:g>1?1:g;var g}function p(f,g,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?f+(g-f)*v*6:2*v<1?g:3*v<2?f+(g-f)*(2/3-v)*6:f}try{e.parseCSSColor=function(f){var g,v=f.replace(/ /g,"").toLowerCase();if(v in n)return n[v].slice();if(v[0]==="#")return v.length===4?(g=parseInt(v.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:v.length===7&&(g=parseInt(v.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var T=v.indexOf("("),S=v.indexOf(")");if(T!==-1&&S+1===v.length){var M=v.substr(0,T),P=v.substr(T+1,S-(T+1)).split(","),F=1;switch(M){case"rgba":if(P.length!==4)return null;F=u(P.pop());case"rgb":return P.length!==3?null:[a(P[0]),a(P[1]),a(P[2]),F];case"hsla":if(P.length!==4)return null;F=u(P.pop());case"hsl":if(P.length!==3)return null;var V=(parseFloat(P[0])%360+360)%360/360,q=u(P[1]),Y=u(P[2]),oe=Y<=.5?Y*(q+1):Y+q-Y*q,le=2*Y-oe;return[r(255*p(le,oe,V+1/3)),r(255*p(le,oe,V)),r(255*p(le,oe,V-1/3)),F];default:return null}}return null}}catch{}});class Vt{constructor(e,n,r,a=1){this.r=e,this.g=n,this.b=r,this.a=a}static parse(e){if(!e)return;if(e instanceof Vt)return e;if(typeof e!="string")return;const n=dl.parseCSSColor(e);return n?new Vt(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,r,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(r)},${a})`}toArray(){const{r:e,g:n,b:r,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*n/a,255*r/a,a]}}Vt.black=new Vt(0,0,0,1),Vt.white=new Vt(1,1,1,1),Vt.transparent=new Vt(0,0,0,0),Vt.red=new Vt(1,0,0,1),Vt.blue=new Vt(0,0,1,1);class So{constructor(e,n,r){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fl{constructor(e,n,r,a,u){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=r,this.fontStack=a,this.textColor=u}}class wi{constructor(e){this.sections=e}static fromString(e){return new wi([new fl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof wi?e:wi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const r={};n.fontStack&&(r["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(r["font-scale"]=n.scale),n.textColor&&(r["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(r)}return e}}class Yi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Yi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function In(i,e,n,r){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[i,e,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[i,e,n,r]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ta(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Vt||i instanceof So||i instanceof wi||i instanceof Yi)return!0;if(Array.isArray(i)){for(const e of i)if(!ta(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ta(i[e]))return!1;return!0}return!1}function gi(i){if(i===null)return Xn;if(typeof i=="string")return Bt;if(typeof i=="boolean")return zt;if(typeof i=="number")return qe;if(i instanceof Vt)return Nn;if(i instanceof So)return Kr;if(i instanceof wi)return To;if(i instanceof Yi)return Ui;if(Array.isArray(i)){const e=i.length;let n;for(const r of i){const a=gi(r);if(n){if(n===a)continue;n=Dt;break}n=a}return un(n||Dt,e)}return Yr}function Wn(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Vt||i instanceof wi||i instanceof Yi?i.toString():JSON.stringify(i)}class Hn{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ta(e[1]))return n.error("invalid value");const r=e[1];let a=gi(r);const u=n.expectedType;return a.kind!=="array"||a.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(a=u),new Hn(a,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vt?["rgba"].concat(this.value.toArray()):this.value instanceof wi?this.value.serialize():this.value}}class ki{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ml={string:Bt,number:qe,boolean:zt,object:Yr};class Cn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let r,a=1;const u=e[0];if(u==="array"){let f,g;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in ml)||v==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);f=ml[v],a++}else f=Dt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);g=e[2],a++}r=un(f,g)}else r=ml[u];const p=[];for(;a<e.length;a++){const f=n.parse(e[a],a,Dt);if(!f)return null;p.push(f)}return new Cn(r,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const r=this.args[n].evaluate(e);if(!ns(this.type,gi(r)))return r;if(n===this.args.length-1)throw new ki(`Expected value to be of type ${si(this.type)}, but found ${si(gi(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){n.push(r.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&n.push(a)}}return n.concat(this.args.map(r=>r.serialize()))}}class Ao{constructor(e){this.type=To,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return n.error("First argument must be an image or text section.");const a=[];let u=!1;for(let p=1;p<=e.length-1;++p){const f=e[p];if(u&&typeof f=="object"&&!Array.isArray(f)){u=!1;let g=null;if(f["font-scale"]&&(g=n.parse(f["font-scale"],1,qe),!g))return null;let v=null;if(f["text-font"]&&(v=n.parse(f["text-font"],1,un(Bt)),!v))return null;let T=null;if(f["text-color"]&&(T=n.parse(f["text-color"],1,Nn),!T))return null;const S=a[a.length-1];S.scale=g,S.font=v,S.textColor=T}else{const g=n.parse(e[p],1,Dt);if(!g)return null;const v=g.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:g,scale:null,font:null,textColor:null})}}return new Ao(a)}evaluate(e){return new wi(this.sections.map(n=>{const r=n.content.evaluate(e);return gi(r)===Ui?new fl("",r,null,null,null):new fl(Wn(r),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const r={};n.scale&&(r["font-scale"]=n.scale.serialize()),n.font&&(r["text-font"]=n.font.serialize()),n.textColor&&(r["text-color"]=n.textColor.serialize()),e.push(r)}return e}}class Mo{constructor(e){this.type=Ui,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const r=n.parse(e[1],1,Bt);return r?new Mo(r):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),r=Yi.fromString(n);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(n)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const bp={"to-boolean":zt,"to-color":Nn,"to-number":qe,"to-string":Bt};class zn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return n.error("Expected one argument.");const a=bp[r],u=[];for(let p=1;p<e.length;p++){const f=n.parse(e[p],p,Dt);if(!f)return null;u.push(f)}return new zn(a,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let n,r;for(const a of this.args){if(n=a.evaluate(e),r=null,n instanceof Vt)return n;if(typeof n=="string"){const u=e.parseColor(n);if(u)return u}else if(Array.isArray(n)&&(r=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:In(n[0],n[1],n[2],n[3]),!r))return new Vt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ki(r||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const r of this.args){if(n=r.evaluate(e),n===null)return 0;const a=Number(n);if(!isNaN(a))return a}throw new ki(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?wi.fromString(Wn(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Yi.fromString(Wn(this.args[0].evaluate(e))):Wn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ao([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Mo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const wp=["Unknown","Point","LineString","Polygon"];class tu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:r,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*n-e[0])+this.featureDistanceData.bearing[1]*(a*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Vt.parse(e)),n}}class Ki{constructor(e,n,r,a){this.name=e,this.type=n,this._evaluate=r,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const r=e[0],a=Ki.definitions[r];if(!a)return n.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(a)?a[0]:a.type,p=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,f=p.filter(([v])=>!Array.isArray(v)||v.length===e.length-1);let g=null;for(const[v,T]of f){g=new mr(n.registry,n.path,null,n.scope);const S=[];let M=!1;for(let P=1;P<e.length;P++){const F=e[P],V=Array.isArray(v)?v[P-1]:v.type,q=g.parse(F,1+S.length,V);if(!q){M=!0;break}S.push(q)}if(!M)if(Array.isArray(v)&&v.length!==S.length)g.error(`Expected ${v.length} arguments, but found ${S.length} instead.`);else{for(let P=0;P<S.length;P++){const F=Array.isArray(v)?v[P]:v.type,V=S[P];g.concat(P+1).checkSubtype(F,V.type)}if(g.errors.length===0)return new Ki(r,u,T,S)}}if(f.length===1)n.errors.push(...g.errors);else{const v=(f.length?f:p).map(([S])=>{return M=S,Array.isArray(M)?`(${M.map(si).join(", ")})`:`(${si(M.type)}...)`;var M}).join(" | "),T=[];for(let S=1;S<e.length;S++){const M=n.parse(e[S],1+T.length);if(!M)return null;T.push(si(M.type))}n.error(`Expected arguments of type ${v}, but found (${T.join(", ")}) instead.`)}return null}static register(e,n){Ki.definitions=n;for(const r in n)e[r]=Ki}}class ia{constructor(e,n,r){this.type=Kr,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return n.error("Collator options argument must be an object.");const a=n.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,zt);if(!a)return null;const u=n.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,zt);if(!u)return null;let p=null;return r.locale&&(p=n.parse(r.locale,1,Bt),!p)?null:new ia(a,u,p)}evaluate(e){return new So(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const fr=8192;function _l(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function na(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function iu(i,e){const n=(180+i[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(n*a*fr),Math.round(r*a*fr)]}function ra(i,e,n){const r=i[0]-e[0],a=i[1]-e[1],u=i[0]-n[0],p=i[1]-n[1];return r*p-u*a==0&&r*u<=0&&a*p<=0}function gl(i,e){let n=!1;for(let p=0,f=e.length;p<f;p++){const g=e[p];for(let v=0,T=g.length;v<T-1;v++){if(ra(i,g[v],g[v+1]))return!1;(a=g[v])[1]>(r=i)[1]!=(u=g[v+1])[1]>r[1]&&r[0]<(u[0]-a[0])*(r[1]-a[1])/(u[1]-a[1])+a[0]&&(n=!n)}}var r,a,u;return n}function Tp(i,e){for(let n=0;n<e.length;n++)if(gl(i,e[n]))return!0;return!1}function nu(i,e,n,r){const a=r[0]-n[0],u=r[1]-n[1],p=(i[0]-n[0])*u-a*(i[1]-n[1]),f=(e[0]-n[0])*u-a*(e[1]-n[1]);return p>0&&f<0||p<0&&f>0}function Ep(i,e,n){for(const v of n)for(let T=0;T<v.length-1;++T)if((f=[(p=v[T+1])[0]-(u=v[T])[0],p[1]-u[1]])[0]*(g=[(a=e)[0]-(r=i)[0],a[1]-r[1]])[1]-f[1]*g[0]!=0&&nu(r,a,u,p)&&nu(u,p,r,a))return!0;var r,a,u,p,f,g;return!1}function ru(i,e){for(let n=0;n<i.length;++n)if(!gl(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(Ep(i[n],i[n+1],e))return!1;return!0}function Sp(i,e){for(let n=0;n<e.length;n++)if(ru(i,e[n]))return!0;return!1}function oa(i,e,n){const r=[];for(let a=0;a<i.length;a++){const u=[];for(let p=0;p<i[a].length;p++){const f=iu(i[a][p],n);_l(e,f),u.push(f)}r.push(u)}return r}function rs(i,e,n){const r=[];for(let a=0;a<i.length;a++){const u=oa(i[a],e,n);r.push(u)}return r}function ou(i,e,n,r){if(i[0]<n[0]||i[0]>n[2]){const a=.5*r;let u=i[0]-n[0]>a?-r:n[0]-i[0]>a?r:0;u===0&&(u=i[0]-n[2]>a?-r:n[2]-i[0]>a?r:0),i[0]+=u}_l(e,i)}function su(i,e,n,r){const a=Math.pow(2,r.z)*fr,u=[r.x*fr,r.y*fr],p=[];if(!i)return p;for(const f of i)for(const g of f){const v=[g.x+u[0],g.y+u[1]];ou(v,e,n,a),p.push(v)}return p}function au(i,e,n,r){const a=Math.pow(2,r.z)*fr,u=[r.x*fr,r.y*fr],p=[];if(!i)return p;for(const g of i){const v=[];for(const T of g){const S=[T.x+u[0],T.y+u[1]];_l(e,S),v.push(S)}p.push(v)}if(e[2]-e[0]<=a/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const g of p)for(const v of g)ou(v,e,n,a)}var f;return p}class Jr{constructor(e,n){this.type=zt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ta(e[1])){const r=e[1];if(r.type==="FeatureCollection")for(let a=0;a<r.features.length;++a){const u=r.features[a].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Jr(r,r.features[a].geometry)}else if(r.type==="Feature"){const a=r.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Jr(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Jr(r,r)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,r){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(r.type==="Polygon"){const f=oa(r.coordinates,u,p),g=su(n.geometry(),a,u,p);if(!na(a,u))return!1;for(const v of g)if(!gl(v,f))return!1}if(r.type==="MultiPolygon"){const f=rs(r.coordinates,u,p),g=su(n.geometry(),a,u,p);if(!na(a,u))return!1;for(const v of g)if(!Tp(v,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,r){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(r.type==="Polygon"){const f=oa(r.coordinates,u,p),g=au(n.geometry(),a,u,p);if(!na(a,u))return!1;for(const v of g)if(!ru(v,f))return!1}if(r.type==="MultiPolygon"){const f=rs(r.coordinates,u,p),g=au(n.geometry(),a,u,p);if(!na(a,u))return!1;for(const v of g)if(!Sp(v,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ji(i){if(i instanceof Ki&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Jr)return!1;let e=!0;return i.eachChild(n=>{e&&!ji(n)&&(e=!1)}),e}function os(i){if(i instanceof Ki&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!os(n)&&(e=!1)}),e}function ss(i,e){if(i instanceof Ki&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(r=>{n&&!ss(r,e)&&(n=!1)}),n}class Qr{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const r=e[1];return n.scope.has(r)?new Qr(r,n.scope.get(r)):n.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class mr{constructor(e,n=[],r,a=new Hr,u=[]){this.registry=e,this.path=n,this.key=n.map(p=>`[${p}]`).join(""),this.scope=a,this.errors=u,this.expectedType=r}parse(e,n,r,a,u={}){return n?this.concat(n,r,a)._parse(e,u):this._parse(e,u)}_parse(e,n){function r(a,u,p){return p==="assert"?new Cn(u,[a]):p==="coerce"?new zn(u,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=e[0];if(typeof a!="string")return this.error(`Expression name must be a string, but found ${typeof a} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[a];if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,g=p.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(f,g))return null}else p=r(p,f,n.typeAnnotation||"coerce");else p=r(p,f,n.typeAnnotation||"assert")}if(!(p instanceof Hn)&&p.type.kind!=="resolvedImage"&&sa(p)){const f=new tu;try{p=new Hn(p.type,p.evaluate(f))}catch(g){return this.error(g.message),null}}return p}return this.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,r){const a=typeof e=="number"?this.path.concat(e):this.path,u=r?this.scope.concat(r):this.scope;return new mr(this.registry,a,n||null,u,this.errors)}error(e,...n){const r=`${this.key}${n.map(a=>`[${a}]`).join("")}`;this.errors.push(new Gt(r,e))}checkSubtype(e,n){const r=ns(e,n);return r&&this.error(r),r}}function sa(i){if(i instanceof Qr)return sa(i.boundExpression);if(i instanceof Ki&&i.name==="error"||i instanceof ia||i instanceof Jr)return!1;const e=i instanceof zn||i instanceof Cn;let n=!0;return i.eachChild(r=>{n=e?n&&sa(r):n&&r instanceof Hn}),!!n&&ji(i)&&ss(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function as(i,e){const n=i.length-1;let r,a,u=0,p=n,f=0;for(;u<=p;)if(f=Math.floor((u+p)/2),r=i[f],a=i[f+1],r<=e){if(f===n||e<a)return f;u=f+1}else{if(!(r>e))throw new ki("Input is not a number.");p=f-1}return 0}class ls{constructor(e,n,r){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[a,u]of r)this.labels.push(a),this.outputs.push(u)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const r=n.parse(e[1],1,qe);if(!r)return null;const a=[];let u=null;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);for(let p=1;p<e.length;p+=2){const f=p===1?-1/0:e[p],g=e[p+1],v=p,T=p+1;if(typeof f!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(a.length&&a[a.length-1][0]>=f)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const S=n.parse(g,T,u);if(!S)return null;u=u||S.type,a.push([f,S])}return new ls(u,r,a)}evaluate(e){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(e);const a=this.input.evaluate(e);if(a<=n[0])return r[0].evaluate(e);const u=n.length;return a>=n[u-1]?r[u-1].evaluate(e):r[as(n,a)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}function pt(i,e,n){return i*(1-n)+e*n}var aa=Object.freeze({__proto__:null,number:pt,color:function(i,e,n){return new Vt(pt(i.r,e.r,n),pt(i.g,e.g,n),pt(i.b,e.b,n),pt(i.a,e.a,n))},array:function(i,e,n){return i.map((r,a)=>pt(r,e[a],n))}});const lu=.95047,cu=1.08883,yl=4/29,xl=6/29,vl=3*xl*xl,uu=Math.PI/180,hu=180/Math.PI;function la(i){return i>.008856451679035631?Math.pow(i,1/3):i/vl+yl}function _r(i){return i>xl?i*i*i:vl*(i-yl)}function Io(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function bl(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ca(i){const e=bl(i.r),n=bl(i.g),r=bl(i.b),a=la((.4124564*e+.3575761*n+.1804375*r)/lu),u=la((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*u-16,a:500*(a-u),b:200*(u-la((.0193339*e+.119192*n+.9503041*r)/cu)),alpha:i.a}}function wl(i){let e=(i.l+16)/116,n=isNaN(i.a)?e:e+i.a/500,r=isNaN(i.b)?e:e-i.b/200;return e=1*_r(e),n=lu*_r(n),r=cu*_r(r),new Vt(Io(3.2404542*n-1.5371385*e-.4985314*r),Io(-.969266*n+1.8760108*e+.041556*r),Io(.0556434*n-.2040259*e+1.0572252*r),i.alpha)}function Ap(i,e,n){const r=e-i;return i+n*(r>180||r<-180?r-360*Math.round(r/360):r)}const cs={forward:ca,reverse:wl,interpolate:function(i,e,n){return{l:pt(i.l,e.l,n),a:pt(i.a,e.a,n),b:pt(i.b,e.b,n),alpha:pt(i.alpha,e.alpha,n)}}},us={forward:function(i){const{l:e,a:n,b:r}=ca(i),a=Math.atan2(r,n)*hu;return{h:a<0?a+360:a,c:Math.sqrt(n*n+r*r),l:e,alpha:i.a}},reverse:function(i){const e=i.h*uu,n=i.c;return wl({l:i.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:i.alpha})},interpolate:function(i,e,n){return{h:Ap(i.h,e.h,n),c:pt(i.c,e.c,n),l:pt(i.l,e.l,n),alpha:pt(i.alpha,e.alpha,n)}}};var Tl=Object.freeze({__proto__:null,lab:cs,hcl:us});class Ji{constructor(e,n,r,a,u){this.type=e,this.operator=n,this.interpolation=r,this.input=a,this.labels=[],this.outputs=[];for(const[p,f]of u)this.labels.push(p),this.outputs.push(f)}static interpolationFactor(e,n,r,a){let u=0;if(e.name==="exponential")u=ua(n,e.base,r,a);else if(e.name==="linear")u=ua(n,1,r,a);else if(e.name==="cubic-bezier"){const p=e.controlPoints;u=new B(p[0],p[1],p[2],p[3]).solve(ua(n,1,r,a))}return u}static parse(e,n){let[r,a,u,...p]=e;if(!Array.isArray(a)||a.length===0)return n.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const v=a[1];if(typeof v!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:v}}else{if(a[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const v=a.slice(1);if(v.length!==4||v.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(u=n.parse(u,2,qe),!u)return null;const f=[];let g=null;r==="interpolate-hcl"||r==="interpolate-lab"?g=Nn:n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let v=0;v<p.length;v+=2){const T=p[v],S=p[v+1],M=v+3,P=v+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(f.length&&f[f.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const F=n.parse(S,P,g);if(!F)return null;g=g||F.type,f.push([T,F])}return g.kind==="number"||g.kind==="color"||g.kind==="array"&&g.itemType.kind==="number"&&typeof g.N=="number"?new Ji(g,r,a,u,f):n.error(`Type ${si(g)} is not interpolatable.`)}evaluate(e){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(e);const a=this.input.evaluate(e);if(a<=n[0])return r[0].evaluate(e);const u=n.length;if(a>=n[u-1])return r[u-1].evaluate(e);const p=as(n,a),f=Ji.interpolationFactor(this.interpolation,a,n[p],n[p+1]),g=r[p].evaluate(e),v=r[p+1].evaluate(e);return this.operator==="interpolate"?aa[this.type.kind.toLowerCase()](g,v,f):this.operator==="interpolate-hcl"?us.reverse(us.interpolate(us.forward(g),us.forward(v),f)):cs.reverse(cs.interpolate(cs.forward(g),cs.forward(v),f))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)n.push(this.labels[r],this.outputs[r].serialize());return n}}function ua(i,e,n,r){const a=r-n,u=i-n;return a===0?0:e===1?u/a:(Math.pow(e,u)-1)/(Math.pow(e,a)-1)}class hs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let r=null;const a=n.expectedType;a&&a.kind!=="value"&&(r=a);const u=[];for(const f of e.slice(1)){const g=n.parse(f,1+u.length,r,void 0,{typeAnnotation:"omit"});if(!g)return null;r=r||g.type,u.push(g)}const p=a&&u.some(f=>ns(a,f.type));return new hs(p?Dt:r,u)}evaluate(e){let n,r=null,a=0;for(const u of this.args){if(a++,r=u.evaluate(e),r&&r instanceof Yi&&!r.available&&(n||(n=r),r=null,a===this.args.length))return n;if(r!==null)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class ps{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",u);const f=n.parse(e[u+1],u+1);if(!f)return null;r.push([p,f])}const a=n.parse(e[e.length-1],e.length-1,n.expectedType,r);return a?new ps(r,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,r]of this.bindings)e.push(n,r.serialize());return e.push(this.result.serialize()),e}}class El{constructor(e,n,r){this.type=e,this.index=n,this.input=r}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,qe),a=n.parse(e[2],2,un(n.expectedType||Dt));return r&&a?new El(a.type.itemType,r,a):null}evaluate(e){const n=this.index.evaluate(e),r=this.input.evaluate(e);if(n<0)throw new ki(`Array index out of bounds: ${n} < 0.`);if(n>=r.length)throw new ki(`Array index out of bounds: ${n} > ${r.length-1}.`);if(n!==Math.floor(n))throw new ki(`Array index must be an integer, but found ${n} instead.`);return r[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ha{constructor(e,n){this.type=zt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,Dt),a=n.parse(e[2],2,Dt);return r&&a?Qs(r.type,[zt,Bt,qe,Xn,Dt])?new ha(r,a):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${si(r.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(r==null)return!1;if(!Eo(n,["boolean","string","number","null"]))throw new ki(`Expected first argument to be of type boolean, string, number or null, but found ${si(gi(n))} instead.`);if(!Eo(r,["string","array"]))throw new ki(`Expected second argument to be of type array or string, but found ${si(gi(r))} instead.`);return r.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class pa{constructor(e,n,r){this.type=qe,this.needle=e,this.haystack=n,this.fromIndex=r}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,Dt),a=n.parse(e[2],2,Dt);if(!r||!a)return null;if(!Qs(r.type,[zt,Bt,qe,Xn,Dt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${si(r.type)} instead`);if(e.length===4){const u=n.parse(e[3],3,qe);return u?new pa(r,a,u):null}return new pa(r,a)}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Eo(n,["boolean","string","number","null"]))throw new ki(`Expected first argument to be of type boolean, string, number or null, but found ${si(gi(n))} instead.`);if(!Eo(r,["string","array"]))throw new ki(`Expected second argument to be of type array or string, but found ${si(gi(r))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return r.indexOf(n,a)}return r.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class da{constructor(e,n,r,a,u,p){this.inputType=e,this.type=n,this.input=r,this.cases=a,this.outputs=u,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let r,a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const u={},p=[];for(let v=2;v<e.length-1;v+=2){let T=e[v];const S=e[v+1];Array.isArray(T)||(T=[T]);const M=n.concat(v);if(T.length===0)return M.error("Expected at least one branch label.");for(const F of T){if(typeof F!="number"&&typeof F!="string")return M.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return M.error("Numeric branch labels must be integer values.");if(r){if(M.checkSubtype(r,gi(F)))return null}else r=gi(F);if(u[String(F)]!==void 0)return M.error("Branch labels must be unique.");u[String(F)]=p.length}const P=n.parse(S,v,a);if(!P)return null;a=a||P.type,p.push(P)}const f=n.parse(e[1],1,Dt);if(!f)return null;const g=n.parse(e[e.length-1],e.length-1,a);return g?f.type.kind!=="value"&&n.concat(1).checkSubtype(r,f.type)?null:new da(r,a,f,u,p,g):null}evaluate(e){const n=this.input.evaluate(e);return(gi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),r=[],a={};for(const p of n){const f=a[this.cases[p]];f===void 0?(a[this.cases[p]]=r.length,r.push([this.cases[p],[p]])):r[f][1].push(p)}const u=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,f]of r)e.push(f.length===1?u(f[0]):f.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class fa{constructor(e,n,r){this.type=e,this.branches=n,this.otherwise=r}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let r;n.expectedType&&n.expectedType.kind!=="value"&&(r=n.expectedType);const a=[];for(let p=1;p<e.length-1;p+=2){const f=n.parse(e[p],p,zt);if(!f)return null;const g=n.parse(e[p+1],p+1,r);if(!g)return null;a.push([f,g]),r=r||g.type}const u=n.parse(e[e.length-1],e.length-1,r);return u?new fa(r,a,u):null}evaluate(e){for(const[n,r]of this.branches)if(n.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,r]of this.branches)e(n),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class ma{constructor(e,n,r,a){this.type=e,this.input=n,this.beginIndex=r,this.endIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,Dt),a=n.parse(e[2],2,qe);if(!r||!a)return null;if(!Qs(r.type,[un(Dt),Bt,Dt]))return n.error(`Expected first argument to be of type array or string, but found ${si(r.type)} instead`);if(e.length===4){const u=n.parse(e[3],3,qe);return u?new ma(r.type,r,a,u):null}return new ma(r.type,r,a)}evaluate(e){const n=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Eo(n,["string","array"]))throw new ki(`Expected first argument to be of type array or string, but found ${si(gi(n))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return n.slice(r,a)}return n.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function pu(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function du(i,e,n,r){return r.compare(e,n)===0}function Co(i,e,n){const r=i!=="=="&&i!=="!=";return class Sy{constructor(u,p,f){this.type=zt,this.lhs=u,this.rhs=p,this.collator=f,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");const f=u[0];let g=p.parse(u[1],1,Dt);if(!g)return null;if(!pu(f,g.type))return p.concat(1).error(`"${f}" comparisons are not supported for type '${si(g.type)}'.`);let v=p.parse(u[2],2,Dt);if(!v)return null;if(!pu(f,v.type))return p.concat(2).error(`"${f}" comparisons are not supported for type '${si(v.type)}'.`);if(g.type.kind!==v.type.kind&&g.type.kind!=="value"&&v.type.kind!=="value")return p.error(`Cannot compare types '${si(g.type)}' and '${si(v.type)}'.`);r&&(g.type.kind==="value"&&v.type.kind!=="value"?g=new Cn(v.type,[g]):g.type.kind!=="value"&&v.type.kind==="value"&&(v=new Cn(g.type,[v])));let T=null;if(u.length===4){if(g.type.kind!=="string"&&v.type.kind!=="string"&&g.type.kind!=="value"&&v.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(u[3],3,Kr),!T)return null}return new Sy(g,v,T)}evaluate(u){const p=this.lhs.evaluate(u),f=this.rhs.evaluate(u);if(r&&this.hasUntypedArgument){const g=gi(p),v=gi(f);if(g.kind!==v.kind||g.kind!=="string"&&g.kind!=="number")throw new ki(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${v.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const g=gi(p),v=gi(f);if(g.kind!=="string"||v.kind!=="string")return e(u,p,f)}return this.collator?n(u,p,f,this.collator.evaluate(u)):e(u,p,f)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[i];return this.eachChild(p=>{u.push(p.serialize())}),u}}}const Mp=Co("==",function(i,e,n){return e===n},du),Ip=Co("!=",function(i,e,n){return e!==n},function(i,e,n,r){return!du(0,e,n,r)}),fu=Co("<",function(i,e,n){return e<n},function(i,e,n,r){return r.compare(e,n)<0}),Cp=Co(">",function(i,e,n){return e>n},function(i,e,n,r){return r.compare(e,n)>0}),zp=Co("<=",function(i,e,n){return e<=n},function(i,e,n,r){return r.compare(e,n)<=0}),kp=Co(">=",function(i,e,n){return e>=n},function(i,e,n,r){return r.compare(e,n)>=0});class Sl{constructor(e,n,r,a,u){this.type=Bt,this.number=e,this.locale=n,this.currency=r,this.minFractionDigits=a,this.maxFractionDigits=u}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const r=n.parse(e[1],1,qe);if(!r)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return n.error("NumberFormat options argument must be an object.");let u=null;if(a.locale&&(u=n.parse(a.locale,1,Bt),!u))return null;let p=null;if(a.currency&&(p=n.parse(a.currency,1,Bt),!p))return null;let f=null;if(a["min-fraction-digits"]&&(f=n.parse(a["min-fraction-digits"],1,qe),!f))return null;let g=null;return a["max-fraction-digits"]&&(g=n.parse(a["max-fraction-digits"],1,qe),!g)?null:new Sl(r,u,p,f,g)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class _a{constructor(e){this.type=qe,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=n.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${si(r.type)} instead.`):new _a(r):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new ki(`Expected value to be of type string or array, but found ${si(gi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const eo={"==":Mp,"!=":Ip,">":Cp,"<":fu,">=":kp,"<=":zp,array:Cn,at:El,boolean:Cn,case:fa,coalesce:hs,collator:ia,format:Ao,image:Mo,in:ha,"index-of":pa,interpolate:Ji,"interpolate-hcl":Ji,"interpolate-lab":Ji,length:_a,let:ps,literal:Hn,match:da,number:Cn,"number-format":Sl,object:Cn,slice:ma,step:ls,string:Cn,"to-boolean":zn,"to-color":zn,"to-number":zn,"to-string":zn,var:Qr,within:Jr};function Al(i,[e,n,r,a]){e=e.evaluate(i),n=n.evaluate(i),r=r.evaluate(i);const u=a?a.evaluate(i):1,p=In(e,n,r,u);if(p)throw new ki(p);return new Vt(e/255*u,n/255*u,r/255*u,u)}function mu(i,e){return i in e}function Ml(i,e){const n=e[i];return n===void 0?null:n}function gr(i){return{type:i}}function Il(i){return{result:"success",value:i}}function to(i){return{result:"error",value:i}}function zo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function _u(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Cl(i){return!!i.expression&&i.expression.interpolated}function Wt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function io(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function gu(i){return i}function zl(i,e){const n=e.type==="color",r=i.stops&&typeof i.stops[0][0]=="object",a=r||!(r||i.property!==void 0),u=i.type||(Cl(e)?"exponential":"interval");if(n&&((i=jt({},i)).stops&&(i.stops=i.stops.map(v=>[v[0],Vt.parse(v[1])])),i.default=Vt.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Tl[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,f,g;if(u==="exponential")p=kl;else if(u==="interval")p=Dp;else if(u==="categorical"){p=Pp,f=Object.create(null);for(const v of i.stops)f[v[0]]=v[1];g=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=yu}if(r){const v={},T=[];for(let P=0;P<i.stops.length;P++){const F=i.stops[P],V=F[0].zoom;v[V]===void 0&&(v[V]={zoom:V,type:i.type,property:i.property,default:i.default,stops:[]},T.push(V)),v[V].stops.push([F[0].value,F[1]])}const S=[];for(const P of T)S.push([v[P].zoom,zl(v[P],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Ji.interpolationFactor.bind(void 0,M),zoomStops:S.map(P=>P[0]),evaluate:({zoom:P},F)=>kl({stops:S,base:i.base},e,P).evaluate(P,F)}}if(a){const v=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:Ji.interpolationFactor.bind(void 0,v),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>p(i,e,T,f,g)}}return{kind:"source",evaluate(v,T){const S=T&&T.properties?T.properties[i.property]:void 0;return S===void 0?ds(i.default,e.default):p(i,e,S,f,g)}}}function ds(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Pp(i,e,n,r,a){return ds(typeof n===a?r[n]:void 0,i.default,e.default)}function Dp(i,e,n){if(Wt(n)!=="number")return ds(i.default,e.default);const r=i.stops.length;if(r===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[r-1][0])return i.stops[r-1][1];const a=as(i.stops.map(u=>u[0]),n);return i.stops[a][1]}function kl(i,e,n){const r=i.base!==void 0?i.base:1;if(Wt(n)!=="number")return ds(i.default,e.default);const a=i.stops.length;if(a===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[a-1][0])return i.stops[a-1][1];const u=as(i.stops.map(T=>T[0]),n),p=function(T,S,M,P){const F=P-M,V=T-M;return F===0?0:S===1?V/F:(Math.pow(S,V)-1)/(Math.pow(S,F)-1)}(n,r,i.stops[u][0],i.stops[u+1][0]),f=i.stops[u][1],g=i.stops[u+1][1];let v=aa[e.type]||gu;if(i.colorSpace&&i.colorSpace!=="rgb"){const T=Tl[i.colorSpace];v=(S,M)=>T.reverse(T.interpolate(T.forward(S),T.forward(M),p))}return typeof f.evaluate=="function"?{evaluate(...T){const S=f.evaluate.apply(void 0,T),M=g.evaluate.apply(void 0,T);if(S!==void 0&&M!==void 0)return v(S,M,p)}}:v(f,g,p)}function yu(i,e,n){return e.type==="color"?n=Vt.parse(n):e.type==="formatted"?n=wi.fromString(n.toString()):e.type==="resolvedImage"?n=Yi.fromString(n.toString()):Wt(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),ds(n,i.default,e.default)}Ki.register(eo,{error:[{kind:"error"},[Bt],(i,[e])=>{throw new ki(e.evaluate(i))}],typeof:[Bt,[Dt],(i,[e])=>si(gi(e.evaluate(i)))],"to-rgba":[un(qe,4),[Nn],(i,[e])=>e.evaluate(i).toArray()],rgb:[Nn,[qe,qe,qe],Al],rgba:[Nn,[qe,qe,qe,qe],Al],has:{type:zt,overloads:[[[Bt],(i,[e])=>mu(e.evaluate(i),i.properties())],[[Bt,Yr],(i,[e,n])=>mu(e.evaluate(i),n.evaluate(i))]]},get:{type:Dt,overloads:[[[Bt],(i,[e])=>Ml(e.evaluate(i),i.properties())],[[Bt,Yr],(i,[e,n])=>Ml(e.evaluate(i),n.evaluate(i))]]},"feature-state":[Dt,[Bt],(i,[e])=>Ml(e.evaluate(i),i.featureState||{})],properties:[Yr,[],i=>i.properties()],"geometry-type":[Bt,[],i=>i.geometryType()],id:[Dt,[],i=>i.id()],zoom:[qe,[],i=>i.globals.zoom],pitch:[qe,[],i=>i.globals.pitch||0],"distance-from-center":[qe,[],i=>i.distanceFromCenter()],"heatmap-density":[qe,[],i=>i.globals.heatmapDensity||0],"line-progress":[qe,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[qe,[],i=>i.globals.skyRadialProgress||0],accumulated:[Dt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[qe,gr(qe),(i,e)=>{let n=0;for(const r of e)n+=r.evaluate(i);return n}],"*":[qe,gr(qe),(i,e)=>{let n=1;for(const r of e)n*=r.evaluate(i);return n}],"-":{type:qe,overloads:[[[qe,qe],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[qe],(i,[e])=>-e.evaluate(i)]]},"/":[qe,[qe,qe],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[qe,[qe,qe],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[qe,[],()=>Math.LN2],pi:[qe,[],()=>Math.PI],e:[qe,[],()=>Math.E],"^":[qe,[qe,qe],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[qe,[qe],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[qe,[qe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[qe,[qe],(i,[e])=>Math.log(e.evaluate(i))],log2:[qe,[qe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[qe,[qe],(i,[e])=>Math.sin(e.evaluate(i))],cos:[qe,[qe],(i,[e])=>Math.cos(e.evaluate(i))],tan:[qe,[qe],(i,[e])=>Math.tan(e.evaluate(i))],asin:[qe,[qe],(i,[e])=>Math.asin(e.evaluate(i))],acos:[qe,[qe],(i,[e])=>Math.acos(e.evaluate(i))],atan:[qe,[qe],(i,[e])=>Math.atan(e.evaluate(i))],min:[qe,gr(qe),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[qe,gr(qe),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[qe,[qe],(i,[e])=>Math.abs(e.evaluate(i))],round:[qe,[qe],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[qe,[qe],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[qe,[qe],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[zt,[Bt,Dt],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[zt,[Dt],(i,[e])=>i.id()===e.value],"filter-type-==":[zt,[Bt],(i,[e])=>i.geometryType()===e.value],"filter-<":[zt,[Bt,Dt],(i,[e,n])=>{const r=i.properties()[e.value],a=n.value;return typeof r==typeof a&&r<a}],"filter-id-<":[zt,[Dt],(i,[e])=>{const n=i.id(),r=e.value;return typeof n==typeof r&&n<r}],"filter->":[zt,[Bt,Dt],(i,[e,n])=>{const r=i.properties()[e.value],a=n.value;return typeof r==typeof a&&r>a}],"filter-id->":[zt,[Dt],(i,[e])=>{const n=i.id(),r=e.value;return typeof n==typeof r&&n>r}],"filter-<=":[zt,[Bt,Dt],(i,[e,n])=>{const r=i.properties()[e.value],a=n.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[zt,[Dt],(i,[e])=>{const n=i.id(),r=e.value;return typeof n==typeof r&&n<=r}],"filter->=":[zt,[Bt,Dt],(i,[e,n])=>{const r=i.properties()[e.value],a=n.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[zt,[Dt],(i,[e])=>{const n=i.id(),r=e.value;return typeof n==typeof r&&n>=r}],"filter-has":[zt,[Dt],(i,[e])=>e.value in i.properties()],"filter-has-id":[zt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[zt,[un(Bt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[zt,[un(Dt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[zt,[Bt,un(Dt)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[zt,[Bt,un(Dt)],(i,[e,n])=>function(r,a,u,p){for(;u<=p;){const f=u+p>>1;if(a[f]===r)return!0;a[f]>r?p=f-1:u=f+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:zt,overloads:[[[zt,zt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[gr(zt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:zt,overloads:[[[zt,zt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[gr(zt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[zt,[zt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[zt,[Bt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Bt,[Bt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Bt,[Bt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Bt,gr(Dt),(i,e)=>e.map(n=>Wn(n.evaluate(i))).join("")],"resolved-locale":[Bt,[Kr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ga{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new tu,this._defaultValue=n?function(r){return r.type==="color"&&io(r.default)?new Vt(0,0,0,0):r.type==="color"?Vt.parse(r.default)||null:r.default===void 0?null:r.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,r,a,u,p,f,g){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=r,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=g||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,r,a,u,p,f,g){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=r||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=g||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new ki(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console!="undefined"&&console.warn(v.message)),this._defaultValue}}}function ko(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in eo}function fs(i,e){const n=new mr(eo,[],e?function(a){const u={color:Nn,string:Bt,number:qe,enum:Bt,boolean:zt,formatted:To,resolvedImage:Ui};return a.type==="array"?un(u[a.value]||Dt,a.length):u[a.type]}(e):void 0),r=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?Il(new ga(r,e)):to(n.errors)}class Pl{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!os(n.expression)}evaluateWithoutErrorHandling(e,n,r,a,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,a,u,p)}evaluate(e,n,r,a,u,p){return this._styleExpression.evaluate(e,n,r,a,u,p)}}class Dl{constructor(e,n,r,a){this.kind=e,this.zoomStops=r,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!os(n.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,n,r,a,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,a,u,p)}evaluate(e,n,r,a,u,p){return this._styleExpression.evaluate(e,n,r,a,u,p)}interpolationFactor(e,n,r){return this.interpolationType?Ji.interpolationFactor(this.interpolationType,e,n,r):0}}function xu(i,e){if((i=fs(i,e)).result==="error")return i;const n=i.value.expression,r=ji(n);if(!r&&!zo(e))return to([new Gt("","data expressions not supported")]);const a=ss(n,["zoom","pitch","distance-from-center"]);if(!a&&!_u(e))return to([new Gt("","zoom expressions not supported")]);const u=xa(n);return u||a?u instanceof Gt?to([u]):u instanceof Ji&&!Cl(e)?to([new Gt("",'"interpolate" expressions cannot be used with this property')]):Il(u?new Dl(r?"camera":"composite",i.value,u.labels,u instanceof Ji?u.interpolation:void 0):new Pl(r?"constant":"source",i.value)):to([new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ya{constructor(e,n){this._parameters=e,this._specification=n,jt(this,zl(this._parameters,this._specification))}static deserialize(e){return new ya(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function xa(i){let e=null;if(i instanceof ps)e=xa(i.result);else if(i instanceof hs){for(const n of i.args)if(e=xa(n),e)break}else(i instanceof ls||i instanceof Ji)&&i.input instanceof Ki&&i.input.name==="zoom"&&(e=i);return e instanceof Gt||i.eachChild(n=>{const r=xa(n);r instanceof Gt?e=r:!e&&r?e=new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new Gt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Ke{constructor(e,n,r,a){this.message=(e?`${e}: `:"")+r,a&&(this.identifier=a),n!=null&&n.__line__&&(this.line=n.__line__)}}function hn(i){const e=i.key,n=i.value,r=i.valueSpec||{},a=i.objectElementValidators||{},u=i.style,p=i.styleSpec;let f=[];const g=Wt(n);if(g!=="object")return[new Ke(e,n,`object expected, ${g} found`)];for(const v in n){const T=v.split(".")[0],S=r[T]||r["*"];let M;a[T]?M=a[T]:r[T]?M=Mi:a["*"]?M=a["*"]:r["*"]&&(M=Mi),M?f=f.concat(M({key:(e&&`${e}.`)+v,value:n[v],valueSpec:S,style:u,styleSpec:p,object:n,objectKey:v},n)):f.push(new Ke(e,n[v],`unknown property "${v}"`))}for(const v in r)a[v]||r[v].required&&r[v].default===void 0&&n[v]===void 0&&f.push(new Ke(e,n,`missing required property "${v}"`));return f}function ms(i){const e=i.value,n=i.valueSpec,r=i.style,a=i.styleSpec,u=i.key,p=i.arrayElementValidator||Mi;if(Wt(e)!=="array")return[new Ke(u,e,`array expected, ${Wt(e)} found`)];if(n.length&&e.length!==n.length)return[new Ke(u,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Ke(u,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let f={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};a.$version<7&&(f.function=n.function),Wt(n.value)==="object"&&(f=n.value);let g=[];for(let v=0;v<e.length;v++)g=g.concat(p({array:e,arrayIndex:v,value:e[v],valueSpec:f,style:r,styleSpec:a,key:`${u}[${v}]`}));return g}function vu(i){const e=i.key,n=i.value,r=i.valueSpec;let a=Wt(n);if(a==="number"&&n!=n&&(a="NaN"),a!=="number")return[new Ke(e,n,`number expected, ${a} found`)];if("minimum"in r){let u=r.minimum;if(Wt(r.minimum)==="array"&&(u=r.minimum[i.arrayIndex]),n<u)return[new Ke(e,n,`${n} is less than the minimum value ${u}`)]}if("maximum"in r){let u=r.maximum;if(Wt(r.maximum)==="array"&&(u=r.maximum[i.arrayIndex]),n>u)return[new Ke(e,n,`${n} is greater than the maximum value ${u}`)]}return[]}function bu(i){const e=i.valueSpec,n=st(i.value.type);let r,a,u,p={};const f=n!=="categorical"&&i.value.property===void 0,g=!f,v=Wt(i.value.stops)==="array"&&Wt(i.value.stops[0])==="array"&&Wt(i.value.stops[0][0])==="object",T=hn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(n==="identity")return[new Ke(P.key,P.value,'identity function may not have a "stops" property')];let F=[];const V=P.value;return F=F.concat(ms({key:P.key,value:V,valueSpec:P.valueSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:S})),Wt(V)==="array"&&V.length===0&&F.push(new Ke(P.key,V,"array must have at least one stop")),F},default:function(P){return Mi({key:P.key,value:P.value,valueSpec:e,style:P.style,styleSpec:P.styleSpec})}}});return n==="identity"&&f&&T.push(new Ke(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||T.push(new Ke(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!Cl(i.valueSpec)&&T.push(new Ke(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!zo(i.valueSpec)?T.push(new Ke(i.key,i.value,"property functions not supported")):f&&!_u(i.valueSpec)&&T.push(new Ke(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!v||i.value.property!==void 0||T.push(new Ke(i.key,i.value,'"property" property is required')),T;function S(P){let F=[];const V=P.value,q=P.key;if(Wt(V)!=="array")return[new Ke(q,V,`array expected, ${Wt(V)} found`)];if(V.length!==2)return[new Ke(q,V,`array length 2 expected, length ${V.length} found`)];if(v){if(Wt(V[0])!=="object")return[new Ke(q,V,`object expected, ${Wt(V[0])} found`)];if(V[0].zoom===void 0)return[new Ke(q,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new Ke(q,V,"object stop key must have value")];const Y=st(V[0].zoom);if(typeof Y!="number")return[new Ke(q,V[0].zoom,"stop zoom values must be numbers")];if(u&&u>Y)return[new Ke(q,V[0].zoom,"stop zoom values must appear in ascending order")];Y!==u&&(u=Y,a=void 0,p={}),F=F.concat(hn({key:`${q}[0]`,value:V[0],valueSpec:{zoom:{}},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:vu,value:M}}))}else F=F.concat(M({key:`${q}[0]`,value:V[0],valueSpec:{},style:P.style,styleSpec:P.styleSpec},V));return ko(Ut(V[1]))?F.concat([new Ke(`${q}[1]`,V[1],"expressions are not allowed in function stops.")]):F.concat(Mi({key:`${q}[1]`,value:V[1],valueSpec:e,style:P.style,styleSpec:P.styleSpec}))}function M(P,F){const V=Wt(P.value),q=st(P.value),Y=P.value!==null?P.value:F;if(r){if(V!==r)return[new Ke(P.key,Y,`${V} stop domain type must match previous stop domain type ${r}`)]}else r=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new Ke(P.key,Y,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&n!=="categorical"){let oe=`number expected, ${V} found`;return zo(e)&&n===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ke(P.key,Y,oe)]}return n!=="categorical"||V!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?n!=="categorical"&&V==="number"&&typeof q=="number"&&typeof a=="number"&&a!==void 0&&q<a?[new Ke(P.key,Y,"stop domain values must appear in ascending order")]:(a=q,n==="categorical"&&q in p?[new Ke(P.key,Y,"stop domain values must be unique")]:(p[q]=!0,[])):[new Ke(P.key,Y,`integer expected, found ${String(q)}`)]}}function Po(i){const e=(i.expressionContext==="property"?xu:fs)(Ut(i.value),i.valueSpec);if(e.result==="error")return e.value.map(r=>new Ke(`${i.key}${r.key}`,i.value,r.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Ke(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!os(n))return[new Ke(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return Yn(n,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ss(n,["zoom","feature-state"]))return[new Ke(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ji(n))return[new Ke(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yn(i,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const a of e.valueSpec.expression.parameters)n.delete(a);if(n.size===0)return[];const r=[];return i instanceof Ki&&n.has(i.name)?[new Ke(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(a=>{r.push(...Yn(a,e))}),r)}function _s(i){const e=i.key,n=i.value,r=i.valueSpec,a=[];return Array.isArray(r.values)?r.values.indexOf(st(n))===-1&&a.push(new Ke(e,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(r.values).indexOf(st(n))===-1&&a.push(new Ke(e,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),a}function yr(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!yr(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function xr(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yr(i)||(i=gs(i));const n=i;let r=!0;try{r=function(v){if(!vr(v))return v;let T=Ut(v);return wu(T),T=Ll(T),T}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const a=ye[`filter_${e}`],u=fs(r,a);let p=null;if(u.result==="error")throw new Error(u.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,T,S)=>u.value.evaluate(v,T,{},S);let f=null,g=null;if(r!==n){const v=fs(n,a);if(v.result==="error")throw new Error(v.value.map(T=>`${T.key}: ${T.message}`).join(", "));f=(T,S,M,P,F)=>v.value.evaluate(T,S,{},M,void 0,void 0,P,F),g=!ji(v.value.expression)}return p=p,{filter:p,dynamicFilter:f||void 0,needGeometry:va(r),needFeature:!!g}}function Ll(i){if(!Array.isArray(i))return i;const e=function(n){if(Tu.has(n[0])){for(let r=1;r<n.length;r++)if(vr(n[r]))return!0}return n}(i);return e===!0?e:e.map(n=>Ll(n))}function wu(i){let e=!1;const n=[];if(i[0]==="case"){for(let r=1;r<i.length-1;r+=2)e=e||vr(i[r]),n.push(i[r+1]);n.push(i[i.length-1])}else if(i[0]==="match"){e=e||vr(i[1]);for(let r=2;r<i.length-1;r+=2)n.push(i[r+1]);n.push(i[i.length-1])}else if(i[0]==="step"){e=e||vr(i[1]);for(let r=1;r<i.length-1;r+=2)n.push(i[r+1])}e&&(i.length=0,i.push("any",...n));for(let r=1;r<i.length;r++)wu(i[r])}function vr(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<i.length;n++)if(vr(i[n]))return!0;return!1}const Tu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Rl(i,e){return i<e?-1:i>e?1:0}function va(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(va(i[e]))return!0;return!1}function gs(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ys(i[1],i[2],"=="):e==="!="?xs(ys(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ys(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(gs))):e==="all"?["all"].concat(i.slice(1).map(gs)):e==="none"?["all"].concat(i.slice(1).map(gs).map(xs)):e==="in"?Bl(i[1],i.slice(2)):e==="!in"?xs(Bl(i[1],i.slice(2))):e==="has"?Fl(i[1]):e==="!has"?xs(Fl(i[1])):e!=="within"||i;var n}function ys(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Bl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Rl)]]:["filter-in-small",i,["literal",e]]}}function Fl(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function xs(i){return["!",i]}function br(i){return yr(Ut(i.value))?Po(jt({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Ol(i)}function Ol(i){const e=i.value,n=i.key;if(Wt(e)!=="array")return[new Ke(n,e,`array expected, ${Wt(e)} found`)];const r=i.styleSpec;let a,u=[];if(e.length<1)return[new Ke(n,e,"filter array must have at least 1 element")];switch(u=u.concat(_s({key:`${n}[0]`,value:e[0],valueSpec:r.filter_operator,style:i.style,styleSpec:i.styleSpec})),st(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&st(e[1])==="$type"&&u.push(new Ke(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new Ke(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=Wt(e[1]),a!=="string"&&u.push(new Ke(`${n}[1]`,e[1],`string expected, ${a} found`)));for(let p=2;p<e.length;p++)a=Wt(e[p]),st(e[1])==="$type"?u=u.concat(_s({key:`${n}[${p}]`,value:e[p],valueSpec:r.geometry_type,style:i.style,styleSpec:i.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&u.push(new Ke(`${n}[${p}]`,e[p],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)u=u.concat(Ol({key:`${n}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":a=Wt(e[1]),e.length!==2?u.push(new Ke(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="string"&&u.push(new Ke(`${n}[1]`,e[1],`string expected, ${a} found`));break;case"within":a=Wt(e[1]),e.length!==2?u.push(new Ke(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="object"&&u.push(new Ke(`${n}[1]`,e[1],`object expected, ${a} found`))}return u}function Nl(i,e){const n=i.key,r=i.style,a=i.styleSpec,u=i.value,p=i.objectKey,f=a[`${e}_${i.layerType}`];if(!f)return[];const g=p.match(/^(.*)-transition$/);if(e==="paint"&&g&&f[g[1]]&&f[g[1]].transition)return Mi({key:n,value:u,valueSpec:a.transition,style:r,styleSpec:a});const v=i.valueSpec||f[p];if(!v)return[new Ke(n,u,`unknown property "${p}"`)];let T;if(Wt(u)==="string"&&zo(v)&&!v.tokens&&(T=/^{([^}]+)}$/.exec(u)))return[new Ke(n,u,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const S=[];return i.layerType==="symbol"&&(p==="text-field"&&r&&!r.glyphs&&S.push(new Ke(n,u,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&io(Ut(u))&&st(u.type)==="identity"&&S.push(new Ke(n,u,'"text-font" does not support identity functions'))),S.concat(Mi({key:i.key,value:u,valueSpec:v,style:r,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:p}))}function ba(i){return Nl(i,"paint")}function Ul(i){return Nl(i,"layout")}function Eu(i){let e=[];const n=i.value,r=i.key,a=i.style,u=i.styleSpec;n.type||n.ref||e.push(new Ke(r,n,'either "type" or "ref" is required'));let p=st(n.type);const f=st(n.ref);if(n.id){const g=st(n.id);for(let v=0;v<i.arrayIndex;v++){const T=a.layers[v];st(T.id)===g&&e.push(new Ke(r,n.id,`duplicate layer id "${n.id}", previously used at line ${T.id.__line__}`))}}if("ref"in n){let g;["type","source","source-layer","filter","layout"].forEach(v=>{v in n&&e.push(new Ke(r,n[v],`"${v}" is prohibited for ref layers`))}),a.layers.forEach(v=>{st(v.id)===f&&(g=v)}),g?g.ref?e.push(new Ke(r,n.ref,"ref cannot reference another ref layer")):p=st(g.type):typeof f=="string"&&e.push(new Ke(r,n.ref,`ref layer "${f}" not found`))}else if(p!=="background"&&p!=="sky")if(n.source){const g=a.sources&&a.sources[n.source],v=g&&st(g.type);g?v==="vector"&&p==="raster"?e.push(new Ke(r,n.source,`layer "${n.id}" requires a raster source`)):v==="raster"&&p!=="raster"?e.push(new Ke(r,n.source,`layer "${n.id}" requires a vector source`)):v!=="vector"||n["source-layer"]?v==="raster-dem"&&p!=="hillshade"?e.push(new Ke(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!n.paint||!n.paint["line-gradient"]||v==="geojson"&&g.lineMetrics||e.push(new Ke(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ke(r,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Ke(r,n.source,`source "${n.source}" not found`))}else e.push(new Ke(r,n,'missing required property "source"'));return e=e.concat(hn({key:r,value:n,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Mi({key:`${r}.type`,value:n.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:g=>br(jt({layerType:p},g)),layout:g=>hn({layer:n,key:g.key,value:g.value,valueSpec:{},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":v=>Ul(jt({layerType:p},v))}}),paint:g=>hn({layer:n,key:g.key,value:g.value,valueSpec:{},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":v=>ba(jt({layerType:p},v))}})}})),e}function Kn(i){const e=i.value,n=i.key,r=Wt(e);return r!=="string"?[new Ke(n,e,`string expected, ${r} found`)]:[]}const Su={promoteId:function({key:i,value:e}){if(Wt(e)==="string")return Kn({key:i,value:e});{const n=[];for(const r in e)n.push(...Kn({key:`${i}.${r}`,value:e[r]}));return n}}};function Au(i){const e=i.value,n=i.key,r=i.styleSpec,a=i.style;if(!e.type)return[new Ke(n,e,'"type" is required')];const u=st(e.type);let p;switch(u){case"vector":case"raster":case"raster-dem":return p=hn({key:n,value:e,valueSpec:r[`source_${u.replace("-","_")}`],style:i.style,styleSpec:r,objectElementValidators:Su}),p;case"geojson":if(p=hn({key:n,value:e,valueSpec:r.source_geojson,style:a,styleSpec:r,objectElementValidators:Su}),e.cluster)for(const f in e.clusterProperties){const[g,v]=e.clusterProperties[f],T=typeof g=="string"?[g,["accumulated"],["get",f]]:g;p.push(...Po({key:`${n}.${f}.map`,value:v,expressionContext:"cluster-map"})),p.push(...Po({key:`${n}.${f}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return p;case"video":return hn({key:n,value:e,valueSpec:r.source_video,style:a,styleSpec:r});case"image":return hn({key:n,value:e,valueSpec:r.source_image,style:a,styleSpec:r});case"canvas":return[new Ke(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _s({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:a,styleSpec:r})}}function Mu(i){const e=i.value,n=i.styleSpec,r=n.light,a=i.style;let u=[];const p=Wt(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new Ke("light",e,`object expected, ${p} found`)]),u;for(const f in e){const g=f.match(/^(.*)-transition$/);u=u.concat(g&&r[g[1]]&&r[g[1]].transition?Mi({key:f,value:e[f],valueSpec:n.transition,style:a,styleSpec:n}):r[f]?Mi({key:f,value:e[f],valueSpec:r[f],style:a,styleSpec:n}):[new Ke(f,e[f],`unknown property "${f}"`)])}return u}function Iu(i){const e=i.value,n=i.key,r=i.style,a=i.styleSpec,u=a.terrain;let p=[];const f=Wt(e);if(e===void 0)return p;if(f!=="object")return p=p.concat([new Ke("terrain",e,`object expected, ${f} found`)]),p;for(const g in e){const v=g.match(/^(.*)-transition$/);p=p.concat(v&&u[v[1]]&&u[v[1]].transition?Mi({key:g,value:e[g],valueSpec:a.transition,style:r,styleSpec:a}):u[g]?Mi({key:g,value:e[g],valueSpec:u[g],style:r,styleSpec:a}):[new Ke(g,e[g],`unknown property "${g}"`)])}if(e.source){const g=r.sources&&r.sources[e.source],v=g&&st(g.type);g?v!=="raster-dem"&&p.push(new Ke(n,e.source,`terrain cannot be used with a source of type ${String(v)}, it only be used with a "raster-dem" source type`)):p.push(new Ke(n,e.source,`source "${e.source}" not found`))}else p.push(new Ke(n,e,'terrain is missing required property "source"'));return p}function Cu(i){const e=i.value,n=i.style,r=i.styleSpec,a=r.fog;let u=[];const p=Wt(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new Ke("fog",e,`object expected, ${p} found`)]),u;for(const f in e){const g=f.match(/^(.*)-transition$/);u=u.concat(g&&a[g[1]]&&a[g[1]].transition?Mi({key:f,value:e[f],valueSpec:r.transition,style:n,styleSpec:r}):a[f]?Mi({key:f,value:e[f],valueSpec:a[f],style:n,styleSpec:r}):[new Ke(f,e[f],`unknown property "${f}"`)])}return u}const vs={"*":()=>[],array:ms,boolean:function(i){const e=i.value,n=i.key,r=Wt(e);return r!=="boolean"?[new Ke(n,e,`boolean expected, ${r} found`)]:[]},number:vu,color:function(i){const e=i.key,n=i.value,r=Wt(n);return r!=="string"?[new Ke(e,n,`color expected, ${r} found`)]:dl.parseCSSColor(n)===null?[new Ke(e,n,`color expected, "${n}" found`)]:[]},enum:_s,filter:br,function:bu,layer:Eu,object:hn,source:Au,light:Mu,terrain:Iu,fog:Cu,string:Kn,formatted:function(i){return Kn(i).length===0?[]:Po(i)},resolvedImage:function(i){return Kn(i).length===0?[]:Po(i)},projection:function(i){const e=i.value,n=i.styleSpec,r=n.projection,a=i.style;let u=[];const p=Wt(e);if(p==="object")for(const f in e)u=u.concat(Mi({key:f,value:e[f],valueSpec:r[f],style:a,styleSpec:n}));else p!=="string"&&(u=u.concat([new Ke("projection",e,`object or string expected, ${p} found`)]));return u}};function Mi(i){const e=i.value,n=i.valueSpec,r=i.styleSpec;return n.expression&&io(st(e))?bu(i):n.expression&&ko(Ut(e))?Po(i):n.type&&vs[n.type]?vs[n.type](i):hn(jt({},i,{valueSpec:n.type?r[n.type]:n}))}function Qi(i){const e=i.value,n=i.key,r=Kn(i);return r.length||(e.indexOf("{fontstack}")===-1&&r.push(new Ke(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&r.push(new Ke(n,e,'"glyphs" url must include a "{range}" token'))),r}function bs(i,e=ye){return Jn(Mi({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Qi,"*":()=>[]}}))}const Lp=i=>Jn(ba(i)),Rp=i=>Jn(Ul(i));function Jn(i){return i.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function zu(i,e){let n=!1;if(e&&e.length)for(const r of e)i.fire(new ut(new Error(r.message))),n=!0;return n}var wr=Un;function Un(i,e,n){var r=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var a=new Int32Array(this.arrayBuffer);i=a[0],this.d=(e=a[1])+2*(n=a[2]);for(var u=0;u<this.d*this.d;u++){var p=a[3+u],f=a[3+u+1];r.push(p===f?null:a.subarray(p,f))}var g=a[3+r.length+1];this.keys=a.subarray(a[3+r.length],g),this.bboxes=a.subarray(g),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var v=0;v<this.d*this.d;v++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=n,this.scale=e/i,this.uid=0;var T=n/e*i;this.min=-T,this.max=i+T}Un.prototype.insert=function(i,e,n,r,a){this._forEachCell(e,n,r,a,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(a)},Un.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Un.prototype._insertCell=function(i,e,n,r,a,u){this.cells[a].push(u)},Un.prototype.query=function(i,e,n,r,a){var u=this.min,p=this.max;if(i<=u&&e<=u&&p<=n&&p<=r&&!a)return Array.prototype.slice.call(this.keys);var f=[];return this._forEachCell(i,e,n,r,this._queryCell,f,{},a),f},Un.prototype._queryCell=function(i,e,n,r,a,u,p,f){var g=this.cells[a];if(g!==null)for(var v=this.keys,T=this.bboxes,S=0;S<g.length;S++){var M=g[S];if(p[M]===void 0){var P=4*M;(f?f(T[P+0],T[P+1],T[P+2],T[P+3]):i<=T[P+2]&&e<=T[P+3]&&n>=T[P+0]&&r>=T[P+1])?(p[M]=!0,u.push(v[M])):p[M]=!1}}},Un.prototype._forEachCell=function(i,e,n,r,a,u,p,f){for(var g=this._convertToCellCoord(i),v=this._convertToCellCoord(e),T=this._convertToCellCoord(n),S=this._convertToCellCoord(r),M=g;M<=T;M++)for(var P=v;P<=S;P++){var F=this.d*P+M;if((!f||f(this._convertFromCellCoord(M),this._convertFromCellCoord(P),this._convertFromCellCoord(M+1),this._convertFromCellCoord(P+1)))&&a.call(this,i,e,n,r,F,u,p,f))return}},Un.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Un.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Un.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var a=new Int32Array(e+n+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var u=e,p=0;p<i.length;p++){var f=i[p];a[3+p]=u,a.set(f,u),u+=f.length}return a[3+i.length]=u,a.set(this.keys,u),a[3+i.length+1]=u+=this.keys.length,a.set(this.bboxes,u),u+=this.bboxes.length,a.buffer};const Do={};function et(i,e,n={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),Do[e]={klass:i,omit:n.omit||[]}}et(Object,"Object"),wr.serialize=function(i,e){const n=i.toArrayBuffer();return e&&e.push(n),{buffer:n}},wr.deserialize=function(i){return new wr(i.buffer)},Object.defineProperty(wr,"name",{value:"Grid"}),et(wr,"Grid"),et(Vt,"Color"),et(Error,"Error"),et(L,"AJAXError"),et(Yi,"ResolvedImage"),et(ya,"StylePropertyFunction"),et(ga,"StyleExpression",{omit:["_evaluator"]}),et(Dl,"ZoomDependentExpression"),et(Pl,"ZoomConstantExpression"),et(Ki,"CompoundExpression",{omit:["_evaluate"]});for(const i in eo)Do[eo[i]._classRegistryKey]||et(eo[i],`Expression${i}`);function ku(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function wa(i){return J.ImageBitmap&&i instanceof J.ImageBitmap}function ws(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(ku(i)||wa(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof J.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const r of i)n.push(ws(r,e));return n}if(typeof i=="object"){const n=i.constructor,r=n._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const a=n.serialize?n.serialize(i,e):{};if(!n.serialize){for(const u in i)i.hasOwnProperty(u)&&(Do[r].omit.indexOf(u)>=0||(a[u]=ws(i[u],e)));i instanceof Error&&(a.message=i.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(a.$name=r),a}throw new Error("can't serialize object of type "+typeof i)}function Lo(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||ku(i)||wa(i)||ArrayBuffer.isView(i)||i instanceof J.ImageData)return i;if(Array.isArray(i))return i.map(Lo);if(typeof i=="object"){const e=i.$name||"Object",{klass:n}=Do[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const r=Object.create(n.prototype);for(const a of Object.keys(i))a!=="$name"&&(r[a]=Lo(i[a]));return r}throw new Error("can't deserialize object of type "+typeof i)}class Vl{constructor(){this.first=!0}update(e,n){const r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const Pu=i=>i>=1536&&i<=1791,Ta=i=>i>=1872&&i<=1919,Ts=i=>i>=2208&&i<=2303,$l=i=>i>=11904&&i<=12031,Du=i=>i>=12032&&i<=12255,jl=i=>i>=12272&&i<=12287,Ea=i=>i>=12288&&i<=12351,Es=i=>i>=12352&&i<=12447,Sa=i=>i>=12448&&i<=12543,Lu=i=>i>=12544&&i<=12591,Ru=i=>i>=12704&&i<=12735,Bu=i=>i>=12736&&i<=12783,Gl=i=>i>=12784&&i<=12799,Fu=i=>i>=12800&&i<=13055,Ou=i=>i>=13056&&i<=13311,Nu=i=>i>=13312&&i<=19903,Zl=i=>i>=19968&&i<=40959,Uu=i=>i>=40960&&i<=42127,Vu=i=>i>=42128&&i<=42191,$u=i=>i>=44032&&i<=55215,Ss=i=>i>=63744&&i<=64255,ql=i=>i>=64336&&i<=65023,ju=i=>i>=65040&&i<=65055,Ro=i=>i>=65072&&i<=65103,Gu=i=>i>=65104&&i<=65135,Aa=i=>i>=65136&&i<=65279,Xl=i=>i>=65280&&i<=65519;function Ma(i){for(const e of i)if(Ia(e.charCodeAt(0)))return!0;return!1}function Zu(i){for(const e of i)if(!qu(e.charCodeAt(0)))return!1;return!0}function qu(i){return!(Pu(i)||Ta(i)||Ts(i)||ql(i)||Aa(i))}function Ia(i){return!(i!==746&&i!==747&&(i<4352||!(Ru(i)||Lu(i)||Ro(i)&&!(i>=65097&&i<=65103)||Ss(i)||Ou(i)||$l(i)||Bu(i)||!(!Ea(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Nu(i)||Zl(i)||Fu(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||$u(i)||Es(i)||jl(i)||(e=>e>=12688&&e<=12703)(i)||Du(i)||Gl(i)||Sa(i)&&i!==12540||!(!Xl(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Gu(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||ju(i)||(e=>e>=19904&&e<=19967)(i)||Uu(i)||Vu(i))))}function Ca(i){return!(Ia(i)||function(e){return!!((n=>n>=128&&n<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(n=>n>=8192&&n<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&e!==9251||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ea(e)||Sa(e)||(n=>n>=57344&&n<=63743)(e)||Ro(e)||Gu(e)||Xl(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function za(i){return i>=1424&&i<=2303||ql(i)||Aa(i)}function Bp(i,e){return!(!e&&za(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(n=>n>=6016&&n<=6143)(i))}function Fp(i){for(const e of i)if(za(e.charCodeAt(0)))return!0;return!1}const Wl="deferred",As="loading",Hl="loaded";let Yl=null,Gi="unavailable",en=null;const Ms=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Gi="error"),Yl&&Yl(i)};function no(){Kl.fire(new ct("pluginStateChange",{pluginStatus:Gi,pluginURL:en}))}const Kl=new _t,ka=function(){return Gi},Bo=function(){if(Gi!==Wl||!en)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gi=As,no(),en&&ne({url:en},i=>{i?Ms(i):(Gi=Hl,no())})},pn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gi===Hl||pn.applyArabicShaping!=null,isLoading:()=>Gi===As,setState(i){Gi=i.pluginStatus,en=i.pluginURL},isParsed:()=>pn.applyArabicShaping!=null&&pn.processBidirectionalText!=null&&pn.processStyledBidirectionalText!=null,getPluginURL:()=>en};class ti{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vl,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,r){for(const a of n)if(!Bp(a.charCodeAt(0),r))return!1;return!0}(e,pn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*n}}}class Is{constructor(e,n){this.property=e,this.value=n,this.expression=function(r,a){if(io(r))return new ya(r,a);if(ko(r)){const u=xu(r,a);if(u.result==="error")throw new Error(u.value.map(p=>`${p.key}: ${p.message}`).join(", "));return u.value}{let u=r;return typeof r=="string"&&a.type==="color"&&(u=Vt.parse(r)),{kind:"constant",evaluate:()=>u}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,r){return this.property.possiblyEvaluate(this,e,n,r)}}class Fo{constructor(e){this.property=e,this.value=new Is(e,void 0)}transitioned(e,n){return new t(this.property,this.value,n,Ie({},e.transition,this.transition),e.now)}untransitioned(){return new t(this.property,this.value,null,{},0)}}class c{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ri(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Fo(this._values[e].property)),this._values[e].value=new Is(this._values[e].property,n===null?void 0:ri(n))}getTransition(e){return ri(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Fo(this._values[e].property)),this._values[e].transition=ri(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const r=this.getValue(n);r!==void 0&&(e[n]=r);const a=this.getTransition(n);a!==void 0&&(e[`${n}-transition`]=a)}return e}transitioned(e,n){const r=new s(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].transitioned(e,n._values[a]);return r}untransitioned(){const e=new s(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class t{constructor(e,n,r,a,u){const p=a.delay||0,f=a.duration||0;u=u||0,this.property=e,this.value=n,this.begin=u+p,this.end=this.begin+f,e.specification.transition&&(a.delay||a.duration)&&(this.prior=r)}possiblyEvaluate(e,n,r){const a=e.now||0,u=this.value.possiblyEvaluate(e,n,r),p=this.prior;if(p){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return p.possiblyEvaluate(e,n,r);{const f=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,r),u,Ze(f))}}return u}}class s{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,r){const a=new _(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,n,r);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class h{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ri(this._values[e].value)}setValue(e,n){this._values[e]=new Is(this._values[e].property,n===null?void 0:ri(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const r=this.getValue(n);r!==void 0&&(e[n]=r)}return e}possiblyEvaluate(e,n,r){const a=new _(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,n,r);return a}}class m{constructor(e,n,r){this.property=e,this.value=n,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,r,a){return this.property.evaluate(this.value,this.parameters,e,n,r,a)}}class _{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class x{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,r){const a=aa[this.specification.type];return a?a(e,n,r):e}}class w{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,r,a){return new m(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},r,a)}:e.expression,n)}interpolate(e,n,r){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new m(this,{kind:"constant",value:void 0},e.parameters);const a=aa[this.specification.type];return a?new m(this,{kind:"constant",value:a(e.value.value,n.value.value,r)},e.parameters):e}evaluate(e,n,r,a,u,p){return e.kind==="constant"?e.value:e.evaluate(n,r,a,u,p)}}class A extends w{possiblyEvaluate(e,n,r,a){if(e.value===void 0)return new m(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const u=e.expression.evaluate(n,null,{},r,a),p=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,f=this._calculate(p,p,p,n);return new m(this,{kind:"constant",value:f},n)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new m(this,{kind:"constant",value:u},n)}return new m(this,e.expression,n)}evaluate(e,n,r,a,u,p){if(e.kind==="source"){const f=e.evaluate(n,r,a,u,p);return this._calculate(f,f,f,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},r,a),e.evaluate({zoom:Math.floor(n.zoom)},r,a),e.evaluate({zoom:Math.floor(n.zoom)+1},r,a),n):e.value}_calculate(e,n,r,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:n,other:r}:{from:r,to:n,other:e}}interpolate(e){return e}}class I{constructor(e){this.specification=e}possiblyEvaluate(e,n,r,a){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(n,null,{},r,a);return this._calculate(u,u,u,n)}return this._calculate(e.expression.evaluate(new ti(Math.floor(n.zoom-1),n)),e.expression.evaluate(new ti(Math.floor(n.zoom),n)),e.expression.evaluate(new ti(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,r,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:r,to:n}}interpolate(e){return e}}class z{constructor(e){this.specification=e}possiblyEvaluate(e,n,r,a){return!!e.expression.evaluate(n,null,{},r,a)}interpolate(){return!1}}class R{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const r=e[n];r.specification.overridable&&this.overridableProperties.push(n);const a=this.defaultPropertyValues[n]=new Is(r,void 0),u=this.defaultTransitionablePropertyValues[n]=new Fo(r);this.defaultTransitioningPropertyValues[n]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=a.possiblyEvaluate({})}}}function j(i,e){return 256*(i=Ge(Math.floor(i),0,255))+Ge(Math.floor(e),0,255)}et(w,"DataDrivenProperty"),et(x,"DataConstantProperty"),et(A,"CrossFadedDataDrivenProperty"),et(I,"CrossFadedProperty"),et(z,"ColorRampProperty");const X={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Z{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class U{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ie(i,e=1){let n=0,r=0;return{members:i.map(a=>{const u=X[a.type].BYTES_PER_ELEMENT,p=n=H(n,Math.max(e,u)),f=a.components||1;return r=Math.max(r,u),n+=u*f,{name:a.name,type:a.type,components:f,offset:p}}),size:H(n,Math.max(r,e)),alignment:e}}function H(i,e){return Math.ceil(i/e)*e}class ee extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,n)}emplace(e,n,r){const a=2*e;return this.int16[a+0]=n,this.int16[a+1]=r,e}}ee.prototype.bytesPerElement=4,et(ee,"StructArrayLayout2i4");class te extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,r)}emplace(e,n,r,a){const u=3*e;return this.int16[u+0]=n,this.int16[u+1]=r,this.int16[u+2]=a,e}}te.prototype.bytesPerElement=6,et(te,"StructArrayLayout3i6");class re extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,r,a)}emplace(e,n,r,a,u){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=r,this.int16[p+2]=a,this.int16[p+3]=u,e}}re.prototype.bytesPerElement=8,et(re,"StructArrayLayout4i8");class Q extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,r,a,u,p,f)}emplace(e,n,r,a,u,p,f,g){const v=6*e,T=12*e,S=3*e;return this.int16[v+0]=n,this.int16[v+1]=r,this.uint8[T+4]=a,this.uint8[T+5]=u,this.uint8[T+6]=p,this.uint8[T+7]=f,this.float32[S+2]=g,e}}Q.prototype.bytesPerElement=12,et(Q,"StructArrayLayout2i4ub1f12");class se extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,r,a)}emplace(e,n,r,a,u){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=r,this.float32[p+2]=a,this.float32[p+3]=u,e}}se.prototype.bytesPerElement=16,et(se,"StructArrayLayout4f16");class me extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p,f,g,v,T){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,r,a,u,p,f,g,v,T)}emplace(e,n,r,a,u,p,f,g,v,T,S){const M=10*e;return this.uint16[M+0]=n,this.uint16[M+1]=r,this.uint16[M+2]=a,this.uint16[M+3]=u,this.uint16[M+4]=p,this.uint16[M+5]=f,this.uint16[M+6]=g,this.uint16[M+7]=v,this.uint16[M+8]=T,this.uint16[M+9]=S,e}}me.prototype.bytesPerElement=20,et(me,"StructArrayLayout10ui20");class we extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,r,a,u,p,f,g)}emplace(e,n,r,a,u,p,f,g,v){const T=8*e;return this.uint16[T+0]=n,this.uint16[T+1]=r,this.uint16[T+2]=a,this.uint16[T+3]=u,this.uint16[T+4]=p,this.uint16[T+5]=f,this.uint16[T+6]=g,this.uint16[T+7]=v,e}}we.prototype.bytesPerElement=16,et(we,"StructArrayLayout8ui16");class Ae extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,r,a,u,p)}emplace(e,n,r,a,u,p,f){const g=6*e;return this.int16[g+0]=n,this.int16[g+1]=r,this.int16[g+2]=a,this.int16[g+3]=u,this.int16[g+4]=p,this.int16[g+5]=f,e}}Ae.prototype.bytesPerElement=12,et(Ae,"StructArrayLayout6i12");class Ee extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p,f,g,v,T,S,M,P,F,V,q){const Y=this.length;return this.resize(Y+1),this.emplace(Y,e,n,r,a,u,p,f,g,v,T,S,M,P,F,V,q)}emplace(e,n,r,a,u,p,f,g,v,T,S,M,P,F,V,q,Y){const oe=16*e;return this.int16[oe+0]=n,this.int16[oe+1]=r,this.int16[oe+2]=a,this.int16[oe+3]=u,this.uint16[oe+4]=p,this.uint16[oe+5]=f,this.uint16[oe+6]=g,this.uint16[oe+7]=v,this.int16[oe+8]=T,this.int16[oe+9]=S,this.int16[oe+10]=M,this.int16[oe+11]=P,this.int16[oe+12]=F,this.int16[oe+13]=V,this.int16[oe+14]=q,this.int16[oe+15]=Y,e}}Ee.prototype.bytesPerElement=32,et(Ee,"StructArrayLayout4i4ui4i4i32");class Ne extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,r)}emplace(e,n,r,a){const u=3*e;return this.float32[u+0]=n,this.float32[u+1]=r,this.float32[u+2]=a,e}}Ne.prototype.bytesPerElement=12,et(Ne,"StructArrayLayout3f12");class _e extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}_e.prototype.bytesPerElement=4,et(_e,"StructArrayLayout1ul4");class Ue extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p,f,g,v,T,S,M,P){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,r,a,u,p,f,g,v,T,S,M,P)}emplace(e,n,r,a,u,p,f,g,v,T,S,M,P,F){const V=20*e,q=10*e;return this.int16[V+0]=n,this.int16[V+1]=r,this.int16[V+2]=a,this.int16[V+3]=u,this.int16[V+4]=p,this.float32[q+3]=f,this.float32[q+4]=g,this.float32[q+5]=v,this.float32[q+6]=T,this.int16[V+14]=S,this.uint32[q+8]=M,this.uint16[V+18]=P,this.uint16[V+19]=F,e}}Ue.prototype.bytesPerElement=40,et(Ue,"StructArrayLayout5i4f1i1ul2ui40");class Fe extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,r,a,u,p,f)}emplace(e,n,r,a,u,p,f,g){const v=8*e;return this.int16[v+0]=n,this.int16[v+1]=r,this.int16[v+2]=a,this.int16[v+4]=u,this.int16[v+5]=p,this.int16[v+6]=f,this.int16[v+7]=g,e}}Fe.prototype.bytesPerElement=16,et(Fe,"StructArrayLayout3i2i2i16");class ot extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,r,a,u)}emplace(e,n,r,a,u,p){const f=4*e,g=8*e;return this.float32[f+0]=n,this.float32[f+1]=r,this.float32[f+2]=a,this.int16[g+6]=u,this.int16[g+7]=p,e}}ot.prototype.bytesPerElement=16,et(ot,"StructArrayLayout2f1f2i16");class Me extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,r,a)}emplace(e,n,r,a,u){const p=12*e,f=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=r,this.float32[f+1]=a,this.float32[f+2]=u,e}}Me.prototype.bytesPerElement=12,et(Me,"StructArrayLayout2ub2f12");class tt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,r)}emplace(e,n,r,a){const u=3*e;return this.uint16[u+0]=n,this.uint16[u+1]=r,this.uint16[u+2]=a,e}}tt.prototype.bytesPerElement=6,et(tt,"StructArrayLayout3ui6");class ht extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p,f,g,v,T,S,M,P,F,V,q,Y,oe,le,ue,he){const pe=this.length;return this.resize(pe+1),this.emplace(pe,e,n,r,a,u,p,f,g,v,T,S,M,P,F,V,q,Y,oe,le,ue,he)}emplace(e,n,r,a,u,p,f,g,v,T,S,M,P,F,V,q,Y,oe,le,ue,he,pe){const Te=30*e,Se=15*e,ze=60*e;return this.int16[Te+0]=n,this.int16[Te+1]=r,this.int16[Te+2]=a,this.float32[Se+2]=u,this.float32[Se+3]=p,this.uint16[Te+8]=f,this.uint16[Te+9]=g,this.uint32[Se+5]=v,this.uint32[Se+6]=T,this.uint32[Se+7]=S,this.uint16[Te+16]=M,this.uint16[Te+17]=P,this.uint16[Te+18]=F,this.float32[Se+10]=V,this.float32[Se+11]=q,this.uint8[ze+48]=Y,this.uint8[ze+49]=oe,this.uint8[ze+50]=le,this.uint32[Se+13]=ue,this.int16[Te+28]=he,this.uint8[ze+58]=pe,e}}ht.prototype.bytesPerElement=60,et(ht,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class it extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p,f,g,v,T,S,M,P,F,V,q,Y,oe,le,ue,he,pe,Te,Se,ze,De,be,Ce,Re,$e){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,e,n,r,a,u,p,f,g,v,T,S,M,P,F,V,q,Y,oe,le,ue,he,pe,Te,Se,ze,De,be,Ce,Re,$e)}emplace(e,n,r,a,u,p,f,g,v,T,S,M,P,F,V,q,Y,oe,le,ue,he,pe,Te,Se,ze,De,be,Ce,Re,$e,Oe){const Ve=38*e,bt=19*e;return this.int16[Ve+0]=n,this.int16[Ve+1]=r,this.int16[Ve+2]=a,this.float32[bt+2]=u,this.float32[bt+3]=p,this.int16[Ve+8]=f,this.int16[Ve+9]=g,this.int16[Ve+10]=v,this.int16[Ve+11]=T,this.int16[Ve+12]=S,this.int16[Ve+13]=M,this.uint16[Ve+14]=P,this.uint16[Ve+15]=F,this.uint16[Ve+16]=V,this.uint16[Ve+17]=q,this.uint16[Ve+18]=Y,this.uint16[Ve+19]=oe,this.uint16[Ve+20]=le,this.uint16[Ve+21]=ue,this.uint16[Ve+22]=he,this.uint16[Ve+23]=pe,this.uint16[Ve+24]=Te,this.uint16[Ve+25]=Se,this.uint16[Ve+26]=ze,this.uint16[Ve+27]=De,this.uint16[Ve+28]=be,this.uint32[bt+15]=Ce,this.float32[bt+16]=Re,this.float32[bt+17]=$e,this.float32[bt+18]=Oe,e}}it.prototype.bytesPerElement=76,et(it,"StructArrayLayout3i2f6i15ui1ul3f76");class nt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}nt.prototype.bytesPerElement=4,et(nt,"StructArrayLayout1f4");class ft extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,r,a,u,p,f)}emplace(e,n,r,a,u,p,f,g){const v=7*e;return this.float32[v+0]=n,this.float32[v+1]=r,this.float32[v+2]=a,this.float32[v+3]=u,this.float32[v+4]=p,this.float32[v+5]=f,this.float32[v+6]=g,e}}ft.prototype.bytesPerElement=28,et(ft,"StructArrayLayout7f28");class At extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,r,a,u)}emplace(e,n,r,a,u,p){const f=5*e;return this.float32[f+0]=n,this.float32[f+1]=r,this.float32[f+2]=a,this.float32[f+3]=u,this.float32[f+4]=p,e}}At.prototype.bytesPerElement=20,et(At,"StructArrayLayout5f20");class lt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,r,a)}emplace(e,n,r,a,u){const p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=r,this.uint16[p+3]=a,this.uint16[p+4]=u,e}}lt.prototype.bytesPerElement=12,et(lt,"StructArrayLayout1ul3ui12");class gt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,n)}emplace(e,n,r){const a=2*e;return this.uint16[a+0]=n,this.uint16[a+1]=r,e}}gt.prototype.bytesPerElement=4,et(gt,"StructArrayLayout2ui4");class Nt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Nt.prototype.bytesPerElement=2,et(Nt,"StructArrayLayout1ui2");class ai extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,n)}emplace(e,n,r){const a=2*e;return this.float32[a+0]=n,this.float32[a+1]=r,e}}ai.prototype.bytesPerElement=8,et(ai,"StructArrayLayout2f8");class Ri extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,a,u,p,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,r,a,u,p,f)}emplace(e,n,r,a,u,p,f,g){const v=8*e,T=4*e;return this.int16[v+0]=n,this.int16[v+1]=r,this.int16[v+2]=a,this.int16[v+3]=u,this.int16[v+4]=p,this.int16[v+5]=f,this.float32[T+3]=g,e}}Ri.prototype.bytesPerElement=16,et(Ri,"StructArrayLayout6i1f16");class Bi extends Z{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Bi.prototype.size=12;class tn extends Ae{get(e){return new Bi(this,e)}}et(tn,"FillExtrusionExtArray");class kn extends Z{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}kn.prototype.size=40;class Qn extends Ue{get(e){return new kn(this,e)}}et(Qn,"CollisionBoxArray");class Tr extends Z{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Tr.prototype.size=60;class er extends ht{get(e){return new Tr(this,e)}}et(er,"PlacedSymbolArray");class ui extends Z{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ui.prototype.size=76;class di extends it{get(e){return new ui(this,e)}}et(di,"SymbolInstanceArray");class Zt extends nt{getoffsetX(e){return this.float32[1*e+0]}}et(Zt,"GlyphOffsetArray");class yi extends te{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}et(yi,"SymbolLineVertexArray");class nn extends Z{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}nn.prototype.size=12;class li extends lt{get(e){return new nn(this,e)}}et(li,"FeatureIndexArray");class dn extends Z{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}dn.prototype.size=4;class Cs extends gt{get(e){return new dn(this,e)}}et(Cs,"FillExtrusionCentroidArray");class rn extends Z{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}rn.prototype.size=16;class ro extends Ri{get(e){return new rn(this,e)}}et(ro,"CircleGlobeExtArray");const Xu=ie([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Jl=ie([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Oo=ea(function(i){i.exports=function(e,n){var r,a,u,p,f,g,v,T;for(a=e.length-(r=3&e.length),u=n,f=3432918353,g=461845907,T=0;T<a;)v=255&e.charCodeAt(T)|(255&e.charCodeAt(++T))<<8|(255&e.charCodeAt(++T))<<16|(255&e.charCodeAt(++T))<<24,++T,u=27492+(65535&(p=5*(65535&(u=(u^=v=(65535&(v=(v=(65535&v)*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(v=0,r){case 3:v^=(255&e.charCodeAt(T+2))<<16;case 2:v^=(255&e.charCodeAt(T+1))<<8;case 1:u^=v=(65535&(v=(v=(65535&(v^=255&e.charCodeAt(T)))*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),Op=ea(function(i){i.exports=function(e,n){for(var r,a=e.length,u=n^a,p=0;a>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++p;switch(a){case 3:u^=(255&e.charCodeAt(p+2))<<16;case 2:u^=(255&e.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),Er=Oo,Ql=Op;Er.murmur3=Oo,Er.murmur2=Ql;class Wu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,r,a){this.ids.push(tm(e)),this.positions.push(n,r,a)}getPositions(e){const n=tm(e);let r=0,a=this.ids.length-1;for(;r<a;){const p=r+a>>1;this.ids[p]>=n?a=p:r=p+1}const u=[];for(;this.ids[r]===n;)u.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return u}static serialize(e,n){const r=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Np(r,a,0,r.length-1),n&&n.push(r.buffer,a.buffer),{ids:r,positions:a}}static deserialize(e){const n=new Wu;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function tm(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Er(String(i))}function Np(i,e,n,r){for(;n<r;){const a=i[n+r>>1];let u=n-1,p=r+1;for(;;){do u++;while(i[u]<a);do p--;while(i[p]>a);if(u>=p)break;Hu(i,u,p),Hu(e,3*u,3*p),Hu(e,3*u+1,3*p+1),Hu(e,3*u+2,3*p+2)}p-n<r-p?(Np(i,e,n,p),n=p+1):(Np(i,e,p+1,r),r=p)}}function Hu(i,e,n){const r=i[e];i[e]=i[n],i[n]=r}et(Wu,"FeaturePositionMap");class oo{constructor(e,n){this.gl=e.gl,this.location=n}}class Yu extends oo{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class im extends oo{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class nm extends oo{constructor(e,n){super(e,n),this.current=Vt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const z0=new Float32Array(16),k0=new Float32Array(9),P0=new Float32Array(4);function Up(i){return[j(255*i.r,255*i.g),j(255*i.b,255*i.a)]}class ec{constructor(e,n,r){this.value=e,this.uniformNames=n.map(a=>`u_${a}`),this.type=r}setUniform(e,n,r){e.set(r.constantOr(this.value))}getBinding(e,n,r){return this.type==="color"?new nm(e,n):new Yu(e,n)}}class Pa{constructor(e,n){this.uniformNames=n.map(r=>`u_${r}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=n.tl.concat(n.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,n,r,a){const u=a==="u_pattern_to"||a==="u_dash_to"?this.patternTo:a==="u_pattern_from"||a==="u_dash_from"?this.patternFrom:a==="u_pixel_ratio_to"?this.pixelRatioTo:a==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&e.set(u)}getBinding(e,n,r){return r==="u_pattern_from"||r==="u_pattern_to"||r==="u_dash_from"||r==="u_dash_to"?new im(e,n):new Yu(e,n)}}class so{constructor(e,n,r,a){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=n.map(u=>({name:`a_${u}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,n,r,a,u,p){const f=this.paintVertexArray.length,g=this.expression.evaluate(new ti(0),n,{},u,a,p);this.paintVertexArray.resize(e),this._setPaintValue(f,e,g)}updatePaintArray(e,n,r,a,u){const p=this.expression.evaluate({zoom:0},r,a,void 0,u);this._setPaintValue(e,n,p)}_setPaintValue(e,n,r){if(this.type==="color"){const a=Up(r);for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,a[0],a[1])}else{for(let a=e;a<n;a++)this.paintVertexArray.emplace(a,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tr{constructor(e,n,r,a,u,p){this.expression=e,this.uniformNames=n.map(f=>`u_${f}_t`),this.type=r,this.useIntegerZoom=a,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,r,a,u,p){const f=this.expression.evaluate(new ti(this.zoom),n,{},u,a,p),g=this.expression.evaluate(new ti(this.zoom+1),n,{},u,a,p),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,f,g)}updatePaintArray(e,n,r,a,u){const p=this.expression.evaluate({zoom:this.zoom},r,a,void 0,u),f=this.expression.evaluate({zoom:this.zoom+1},r,a,void 0,u);this._setPaintValue(e,n,p,f)}_setPaintValue(e,n,r,a){if(this.type==="color"){const u=Up(r),p=Up(a);for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,u[0],u[1],p[0],p[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,r,a);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const r=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,a=Ge(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(a)}getBinding(e,n,r){return new Yu(e,n)}}class No{constructor(e,n,r,a,u,p,f){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=u,this.layerId=f,this.paintVertexAttributes=(r==="array"?Jl:Xu).members;for(let g=0;g<n.length;++g);this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,n,r){const a=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(a,e,n.patterns&&n.patterns[this.layerId],r)}updatePaintArray(e,n,r,a,u,p){this._setPaintValues(e,n,r.patterns&&r.patterns[this.layerId],p)}_setPaintValues(e,n,r,a){if(!a||!r)return;const{min:u,mid:p,max:f}=r,g=a[u],v=a[p],T=a[f];if(g&&v&&T)for(let S=e;S<n;S++)this._setPaintValue(this.zoomInPaintVertexArray,S,v,g),this._setPaintValue(this.zoomOutPaintVertexArray,S,v,T)}_setPaintValue(e,n,r,a){e.emplace(n,r.tl[0],r.tl[1],r.br[0],r.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],r.pixelRatio,a.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Uo{constructor(e,n,r=()=>!0){this.binders={},this._buffers=[];const a=[];for(const u in e.paint._values){if(!r(u))continue;const p=e.paint.get(u);if(!(p instanceof m&&zo(p.property.specification)))continue;const f=L0(u,e.type),g=p.value,v=p.property.specification.type,T=p.property.useIntegerZoom,S=p.property.specification["property-type"],M=S==="cross-faded"||S==="cross-faded-data-driven",P=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(g.kind!=="constant"||P)if(g.kind==="source"||P||M){const F=rm(u,v,"source");this.binders[u]=M?new No(g,f,v,T,n,F,e.id):new so(g,f,v,F),a.push(`/a_${u}`)}else{const F=rm(u,v,"composite");this.binders[u]=new tr(g,f,v,T,n,F),a.push(`/z_${u}`)}else this.binders[u]=M?new Pa(g.value,f):new ec(g.value,f,v),a.push(`/u_${u}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof so||n instanceof tr?n.maxValue:0}populatePaintArrays(e,n,r,a,u,p){for(const f in this.binders){const g=this.binders[f];(g instanceof so||g instanceof tr||g instanceof No)&&g.populatePaintArray(e,n,r,a,u,p)}}setConstantPatternPositions(e,n){for(const r in this.binders){const a=this.binders[r];a instanceof Pa&&a.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,r,a,u,p){let f=!1;for(const g in e){const v=n.getPositions(g);for(const T of v){const S=r.feature(T.index);for(const M in this.binders){const P=this.binders[M];if((P instanceof so||P instanceof tr||P instanceof No)&&P.expression.isStateDependent===!0){const F=a.paint.get(M);P.expression=F.value,P.updatePaintArray(T.start,T.end,S,e[g],u,p),f=!0}}}}return f}defines(){const e=[];for(const n in this.binders){const r=this.binders[n];(r instanceof ec||r instanceof Pa)&&e.push(...r.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof so||r instanceof tr||r instanceof No)for(let a=0;a<r.paintVertexAttributes.length;a++)e.push(r.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof ec||r instanceof Pa||r instanceof tr)for(const a of r.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const r=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof ec||u instanceof Pa||u instanceof tr){for(const p of u.uniformNames)if(n[p]){const f=u.getBinding(e,n[p],p);r.push({name:p,property:a,binding:f})}}}return r}setUniforms(e,n,r,a){for(const{name:u,property:p,binding:f}of n)this.binders[p].setUniform(f,a,r.get(p),u)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const r=this.binders[n];if(e&&r instanceof No){const a=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;a&&this._buffers.push(a)}else(r instanceof so||r instanceof tr)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const n in this.binders){const r=this.binders[n];(r instanceof so||r instanceof tr||r instanceof No)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof so||n instanceof tr||n instanceof No)&&n.destroy()}}}class zs{constructor(e,n,r=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new Uo(a,n,r);this.needsUpload=!1,this._featureMap=new Wu,this._bufferOffset=0}populatePaintArrays(e,n,r,a,u,p,f){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(e,n,a,u,p,f);n.id!==void 0&&this._featureMap.add(n.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,r,a,u){for(const p of r)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,n,p,a,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const D0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function L0(i,e){return D0[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const R0={"line-pattern":{source:me,composite:me},"fill-pattern":{source:me,composite:me},"fill-extrusion-pattern":{source:me,composite:me},"line-dasharray":{source:we,composite:we}},B0={color:{source:ai,composite:se},number:{source:nt,composite:ai}};function rm(i,e,n){const r=R0[i];return r&&r[n]||B0[e][n]}et(ec,"ConstantBinder"),et(Pa,"CrossFadedConstantBinder"),et(so,"SourceExpressionBinder"),et(No,"CrossFadedCompositeBinder"),et(tr,"CompositeExpressionBinder"),et(Uo,"ProgramConfiguration",{omit:["_buffers"]}),et(zs,"ProgramConfigurationSet");const Ku="-transition";class ir extends _t{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new h(n.layout)),n.paint)){this._transitionablePaint=new c(n.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,r={}){n!=null&&this._validate(Rp,`layers.${this.id}.layout.${e}`,e,n,r)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return Rt(e,Ku)?this._transitionablePaint.getTransition(e.slice(0,-Ku.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,r={}){if(n!=null&&this._validate(Lp,`layers.${this.id}.paint.${e}`,e,n,r))return!1;if(Rt(e,Ku))return this._transitionablePaint.setTransition(e.slice(0,-Ku.length),n||void 0),!1;{const a=this._transitionablePaint._values[e],u=a.property.specification["property-type"]==="cross-faded-data-driven",p=a.value.isDataDriven(),f=a.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const g=this._transitionablePaint._values[e].value;return g.isDataDriven()||p||u||this._handleOverridablePaintPropertyUpdate(e,f,g)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Di(e,(n,r)=>!(n===void 0||r==="layout"&&!Object.keys(n).length||r==="paint"&&!Object.keys(n).length))}_validate(e,n,r,a,u={}){return(!u||u.validate!==!1)&&zu(this,e.call(bs,{key:n,layerType:this.type,objectKey:r,value:a,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof m&&zo(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=xr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const F0=ie([{name:"a_pos",components:2,type:"Int16"}],4),O0=ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class fi{constructor(e=[]){this.segments=e}prepareSegment(e,n,r,a){let u=this.segments[this.segments.length-1];return e>fi.MAX_VERTEX_ARRAY_LENGTH&&Ct(`Max vertices per segment is ${fi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>fi.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:n.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},a!==void 0&&(u.sortKey=a),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,r,a){return new fi([{vertexOffset:e,primitiveOffset:n,vertexLength:r,primitiveLength:a,vaos:{},sortKey:0}])}}fi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,et(fi,"SegmentVector");var Et=8192;class Vo{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Kt?new Kt(e.lng,e.lat):Kt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Kt?new Kt(e.lng,e.lat):Kt.convert(e),this}extend(e){const n=this._sw,r=this._ne;let a,u;if(e instanceof Kt)a=e,u=e;else{if(!(e instanceof Vo))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Vo.convert(e)):this.extend(Kt.convert(e)):this;if(a=e._sw,u=e._ne,!a||!u)return this}return n||r?(n.lng=Math.min(a.lng,n.lng),n.lat=Math.min(a.lat,n.lat),r.lng=Math.max(u.lng,r.lng),r.lat=Math.max(u.lat,r.lat)):(this._sw=new Kt(a.lng,a.lat),this._ne=new Kt(u.lng,u.lat)),this}getCenter(){return new Kt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Kt(this.getWest(),this.getNorth())}getSouthEast(){return new Kt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:r}=Kt.convert(e);let a=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&a}static convert(e){return!e||e instanceof Vo?e:new Vo(e)}}const Vp=63710088e-1;class Kt{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Kt(yt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,r=this.lat*n,a=e.lat*n,u=Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos((e.lng-this.lng)*n);return Vp*Math.acos(Math.min(u,1))}toBounds(e=0){const n=360*e/40075017,r=n/Math.cos(Math.PI/180*this.lat);return new Vo(new Kt(this.lng-r,this.lat-n),new Kt(this.lng+r,this.lat+n))}static convert(e){if(e instanceof Kt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Kt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Kt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const om=2*Math.PI*Vp;function $p(i){return om*Math.cos(i*Math.PI/180)}function tc(i){return(180+i)/360}function Da(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function La(i,e){return i/$p(e)}function Vn(i){return 360*i-180}function Fi(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function sm(i,e){return i*$p(Fi(e))}const Sr=85.051129;class Ju{constructor(e,n,r=0){this.x=+e,this.y=+n,this.z=+r}static fromLngLat(e,n=0){const r=Kt.convert(e);return new Ju(tc(r.lng),Da(r.lat),La(n,r.lat))}toLngLat(){return new Kt(Vn(this.x),Fi(this.y))}toAltitude(){return sm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/om*(e=Fi(this.y),1/Math.cos(e*Math.PI/180));var e}}function jp(i,e,n,r,a,u,p,f,g){const v=(e+r)/2,T=(n+a)/2,S=new D(v,T);f(S),function(M,P,F,V,q,Y){const oe=F-q,le=V-Y;return Math.abs((V-P)*oe-(F-M)*le)/Math.hypot(oe,le)}(S.x,S.y,u.x,u.y,p.x,p.y)>=g?(jp(i,e,n,v,T,u,S,f,g),jp(i,v,T,r,a,S,p,f,g)):i.push(p)}function N0(i,e,n){let r=i[0],a=r.x,u=r.y;e(r);const p=[r];for(let f=1;f<i.length;f++){const g=i[f],{x:v,y:T}=g;e(g),jp(p,a,u,v,T,r,g,e,n),a=v,u=T,r=g}return p}const Gp=Math.pow(2,14)-1,am=-Gp-1;function U0(i,e){const n=Math.round(i.x*e),r=Math.round(i.y*e);return i.x=Ge(n,am,Gp),i.y=Ge(r,am,Gp),(n<i.x||n>i.x+1||r<i.y||r>i.y+1)&&Ct("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function ao(i,e,n){const r=i.loadGeometry(),a=i.extent,u=Et/a;if(e&&n&&n.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:f,x:g,y:v,projection:T}=n,S=M=>{const P=Vn((e.x+M.x/a)/p),F=Fi((e.y+M.y/a)/p),V=T.project(P,F);M.x=(V.x*f-g)*a,M.y=(V.y*f-v)*a};for(let M=0;M<r.length;M++)if(i.type!==1)r[M]=N0(r[M],S,1);else{const P=[];for(const F of r[M])F.x<0||F.x>=a||F.y<0||F.y>=a||(S(F),P.push(F));r[M]=P}}for(const p of r)for(const f of p)U0(f,u);return r}function ks(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ao(i):[]}}function Qu(i,e,n,r,a){i.emplaceBack(2*e+(r+1)/2,2*n+(a+1)/2)}function eh(i,e,n,r){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384,r)}class Zp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ee,this.indexArray=new tt,this.segments=new fi,this.programConfigurations=new zs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,r,a){const u=this.layers[0],p=[];let f=null;u.type==="circle"&&(f=u.layout.get("circle-sort-key"));for(const{feature:v,id:T,index:S,sourceLayerIndex:M}of e){const P=this.layers[0]._featureFilter.needGeometry,F=ks(v,P);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),F,r))continue;const V=f?f.evaluate(F,{},r):void 0,q={id:T,properties:v.properties,type:v.type,sourceLayerIndex:M,index:S,geometry:P?F.geometry:ao(v,r,a),patterns:{},sortKey:V};p.push(q)}f&&p.sort((v,T)=>v.sortKey-T.sortKey);let g=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new ro,g=a.projection);for(const v of p){const{geometry:T,index:S,sourceLayerIndex:M}=v,P=e[S].feature;this.addFeature(v,T,S,n.availableImages,r,g),n.featureIndex.insert(P,T,S,M,this.index)}}update(e,n,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,F0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,O0.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,r,a,u,p){for(const f of n)for(const g of f){const v=g.x,T=g.y;if(v<0||v>=Et||T<0||T>=Et)continue;if(p){const P=p.projectTilePoint(v,T,u),F=p.upVector(u,v,T),V=Fi((T/Et+u.y)/(1<<u.z)),q=p.pixelsPerMeter(V,1)/La(1,V),Y=this.globeExtVertexArray;eh(Y,P,F,q),eh(Y,P,F,q),eh(Y,P,F,q),eh(Y,P,F,q)}const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=S.vertexLength;Qu(this.layoutVertexArray,v,T,-1,-1),Qu(this.layoutVertexArray,v,T,1,-1),Qu(this.layoutVertexArray,v,T,1,1),Qu(this.layoutVertexArray,v,T,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+3,M+2),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},a,u)}}function lm(i,e){for(let n=0;n<i.length;n++)if(Ra(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Ra(i,e[n]))return!0;return!!qp(i,e)}function V0(i,e,n){return!!Ra(i,e)||!!Xp(e,i,n)}function cm(i,e){if(i.length===1)return hm(e,i[0]);for(let n=0;n<e.length;n++){const r=e[n];for(let a=0;a<r.length;a++)if(Ra(i,r[a]))return!0}for(let n=0;n<i.length;n++)if(hm(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(qp(i,e[n]))return!0;return!1}function $0(i,e,n){if(i.length>1){if(qp(i,e))return!0;for(let r=0;r<e.length;r++)if(Xp(e[r],i,n))return!0}for(let r=0;r<i.length;r++)if(Xp(i[r],e,n))return!0;return!1}function qp(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const r=i[n],a=i[n+1];for(let u=0;u<e.length-1;u++)if(j0(r,a,e[u],e[u+1]))return!0}return!1}function j0(i,e,n,r){return Yt(i,n,r)!==Yt(e,n,r)&&Yt(i,e,n)!==Yt(i,e,r)}function Xp(i,e,n){const r=n*n;if(e.length===1)return i.distSqr(e[0])<r;for(let a=1;a<e.length;a++)if(um(i,e[a-1],e[a])<r)return!0;return!1}function um(i,e,n){const r=e.distSqr(n);if(r===0)return i.distSqr(e);const a=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/r;return i.distSqr(a<0?e:a>1?n:n.sub(e)._mult(a)._add(e))}function hm(i,e){let n,r,a,u=!1;for(let p=0;p<i.length;p++){n=i[p];for(let f=0,g=n.length-1;f<n.length;g=f++)r=n[f],a=n[g],r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(u=!u)}return u}function Ra(i,e){let n=!1;for(let r=0,a=i.length-1;r<i.length;a=r++){const u=i[r],p=i[a];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(n=!n)}return n}function pm(i,e,n,r,a){for(const p of i)if(e<=p.x&&n<=p.y&&r>=p.x&&a>=p.y)return!0;const u=[new D(e,n),new D(e,a),new D(r,a),new D(r,n)];if(i.length>2){for(const p of u)if(Ra(i,p))return!0}for(let p=0;p<i.length-1;p++)if(G0(i[p],i[p+1],u))return!0;return!1}function G0(i,e,n){const r=n[0],a=n[2];if(i.x<r.x&&e.x<r.x||i.x>a.x&&e.x>a.x||i.y<r.y&&e.y<r.y||i.y>a.y&&e.y>a.y)return!1;const u=Yt(i,e,n[0]);return u!==Yt(i,e,n[1])||u!==Yt(i,e,n[2])||u!==Yt(i,e,n[3])}function Ba(i,e,n){const r=e.paint.get(i).value;return r.kind==="constant"?r.value:n.programConfigurations.get(e.id).getMaxValue(i)}function th(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function dm(i,e,n,r,a){if(!e[0]&&!e[1])return i;const u=D.convert(e)._mult(a);n==="viewport"&&u._rotate(-r);const p=[];for(let f=0;f<i.length;f++)p.push(i[f].sub(u));return p}function fm(i,e,n,r){const a=D.convert(i)._mult(r);return e==="viewport"&&a._rotate(-n),a}et(Zp,"CircleBucket",{omit:["layers"]});const Z0=new R({"circle-sort-key":new w(ye.layout_circle["circle-sort-key"])});var q0={paint:new R({"circle-radius":new w(ye.paint_circle["circle-radius"]),"circle-color":new w(ye.paint_circle["circle-color"]),"circle-blur":new w(ye.paint_circle["circle-blur"]),"circle-opacity":new w(ye.paint_circle["circle-opacity"]),"circle-translate":new x(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new x(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new x(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new x(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new w(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new w(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new w(ye.paint_circle["circle-stroke-opacity"])}),layout:Z0},Wp=1e-6,fn=typeof Float32Array!="undefined"?Float32Array:Array;function mm(){var i=new fn(9);return fn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Ar(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Hp(i,e,n){var r=e[0],a=e[1],u=e[2],p=e[3],f=e[4],g=e[5],v=e[6],T=e[7],S=e[8],M=e[9],P=e[10],F=e[11],V=e[12],q=e[13],Y=e[14],oe=e[15],le=n[0],ue=n[1],he=n[2],pe=n[3];return i[0]=le*r+ue*f+he*S+pe*V,i[1]=le*a+ue*g+he*M+pe*q,i[2]=le*u+ue*v+he*P+pe*Y,i[3]=le*p+ue*T+he*F+pe*oe,i[4]=(le=n[4])*r+(ue=n[5])*f+(he=n[6])*S+(pe=n[7])*V,i[5]=le*a+ue*g+he*M+pe*q,i[6]=le*u+ue*v+he*P+pe*Y,i[7]=le*p+ue*T+he*F+pe*oe,i[8]=(le=n[8])*r+(ue=n[9])*f+(he=n[10])*S+(pe=n[11])*V,i[9]=le*a+ue*g+he*M+pe*q,i[10]=le*u+ue*v+he*P+pe*Y,i[11]=le*p+ue*T+he*F+pe*oe,i[12]=(le=n[12])*r+(ue=n[13])*f+(he=n[14])*S+(pe=n[15])*V,i[13]=le*a+ue*g+he*M+pe*q,i[14]=le*u+ue*v+he*P+pe*Y,i[15]=le*p+ue*T+he*F+pe*oe,i}function Ps(i,e,n){var r,a,u,p,f,g,v,T,S,M,P,F,V=n[0],q=n[1],Y=n[2];return e===i?(i[12]=e[0]*V+e[4]*q+e[8]*Y+e[12],i[13]=e[1]*V+e[5]*q+e[9]*Y+e[13],i[14]=e[2]*V+e[6]*q+e[10]*Y+e[14],i[15]=e[3]*V+e[7]*q+e[11]*Y+e[15]):(a=e[1],u=e[2],p=e[3],f=e[4],g=e[5],v=e[6],T=e[7],S=e[8],M=e[9],P=e[10],F=e[11],i[0]=r=e[0],i[1]=a,i[2]=u,i[3]=p,i[4]=f,i[5]=g,i[6]=v,i[7]=T,i[8]=S,i[9]=M,i[10]=P,i[11]=F,i[12]=r*V+f*q+S*Y+e[12],i[13]=a*V+g*q+M*Y+e[13],i[14]=u*V+v*q+P*Y+e[14],i[15]=p*V+T*q+F*Y+e[15]),i}function $o(i,e,n){var r=n[0],a=n[1],u=n[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*a,i[5]=e[5]*a,i[6]=e[6]*a,i[7]=e[7]*a,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Yp(i,e,n){var r=Math.sin(n),a=Math.cos(n),u=e[4],p=e[5],f=e[6],g=e[7],v=e[8],T=e[9],S=e[10],M=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*a+v*r,i[5]=p*a+T*r,i[6]=f*a+S*r,i[7]=g*a+M*r,i[8]=v*a-u*r,i[9]=T*a-p*r,i[10]=S*a-f*r,i[11]=M*a-g*r,i}function Kp(i,e,n){var r=Math.sin(n),a=Math.cos(n),u=e[0],p=e[1],f=e[2],g=e[3],v=e[8],T=e[9],S=e[10],M=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*a-v*r,i[1]=p*a-T*r,i[2]=f*a-S*r,i[3]=g*a-M*r,i[8]=u*r+v*a,i[9]=p*r+T*a,i[10]=f*r+S*a,i[11]=g*r+M*a,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var X0=Hp;function Jp(){var i=new fn(3);return fn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function _m(i){var e=new fn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function gm(i){return Math.hypot(i[0],i[1],i[2])}function ic(i,e,n){var r=new fn(3);return r[0]=i,r[1]=e,r[2]=n,r}function ym(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function xm(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function vm(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function Qp(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i}function ed(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i}function nc(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function td(i,e,n,r){return i[0]=e[0]+n[0]*r,i[1]=e[1]+n[1]*r,i[2]=e[2]+n[2]*r,i}function rc(i,e){var n=e[0],r=e[1],a=e[2],u=n*n+r*r+a*a;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i}function oc(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function bm(i,e,n){var r=e[0],a=e[1],u=e[2],p=n[0],f=n[1],g=n[2];return i[0]=a*g-u*f,i[1]=u*p-r*g,i[2]=r*f-a*p,i}function Ds(i,e,n){var r=e[0],a=e[1],u=e[2],p=n[3]*r+n[7]*a+n[11]*u+n[15];return i[0]=(n[0]*r+n[4]*a+n[8]*u+n[12])/(p=p||1),i[1]=(n[1]*r+n[5]*a+n[9]*u+n[13])/p,i[2]=(n[2]*r+n[6]*a+n[10]*u+n[14])/p,i}function wm(i,e,n){var r=n[0],a=n[1],u=n[2],p=e[0],f=e[1],g=e[2],v=a*g-u*f,T=u*p-r*g,S=r*f-a*p,M=a*S-u*T,P=u*v-r*S,F=r*T-a*v,V=2*n[3];return T*=V,S*=V,P*=2,F*=2,i[0]=p+(v*=V)+(M*=2),i[1]=f+T+P,i[2]=g+S+F,i}var sc,Fa=xm,W0=vm,H0=gm;function Oa(i,e,n){var r=e[0],a=e[1],u=e[2],p=e[3];return i[0]=n[0]*r+n[4]*a+n[8]*u+n[12]*p,i[1]=n[1]*r+n[5]*a+n[9]*u+n[13]*p,i[2]=n[2]*r+n[6]*a+n[10]*u+n[14]*p,i[3]=n[3]*r+n[7]*a+n[11]*u+n[15]*p,i}function Tm(){var i=new fn(4);return fn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Em(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Sm(i,e,n){n*=.5;var r=e[0],a=e[1],u=e[2],p=e[3],f=Math.sin(n),g=Math.cos(n);return i[0]=r*g+p*f,i[1]=a*g+u*f,i[2]=u*g-a*f,i[3]=p*g-r*f,i}Jp(),sc=new fn(4),fn!=Float32Array&&(sc[0]=0,sc[1]=0,sc[2]=0,sc[3]=0),Jp(),ic(1,0,0),ic(0,1,0),Tm(),Tm(),mm();class id{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,r,a){const u=Math.pow(2,r),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>{const v=Oa([],g,e),T=1/v[3]/n*u;return function(S,M,P){return S[0]=M[0]*P[0],S[1]=M[1]*P[1],S[2]=M[2]*P[2],S[3]=M[3]*P[3],S}(v,v,[T,T,a?1/v[3]:T,T])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{const v=rc([],bm([],Fa([],p[g[0]],p[g[1]]),Fa([],p[g[2]],p[g[1]]))),T=-oc(v,p[g[1]]);return v.concat(T)});return new id(p,f)}}class Pn{constructor(e,n){this.min=e,this.max=n,this.center=nc([],ym([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],r=_m(this.min),a=_m(this.max);for(let u=0;u<n.length;u++)r[u]=n[u]?this.min[u]:this.center[u],a[u]=n[u]?this.center[u]:this.max[u];return a[2]=this.max[2],new Pn(r,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let r=!0;for(let a=0;a<e.planes.length;a++){const u=e.planes[a];let p=0;for(let f=0;f<n.length;f++)p+=oc(u,n[f])+u[3]>=0;if(p===0)return 0;p!==n.length&&(r=!1)}if(r)return 2;for(let a=0;a<3;a++){let u=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let f=0;f<e.points.length;f++){const g=e.points[f][a]-this.min[a];u=Math.min(u,g),p=Math.max(p,g)}if(p<0||u>this.max[a]-this.min[a])return 0}return 1}}function Am(i,e,n,r,a,u,p,f,g){if(u&&i.queryGeometry.isAboveHorizon)return!1;u&&(g*=i.pixelToTileUnitsFactor);for(const v of e)for(const T of v){const S=T.add(f),M=a&&n.elevation?n.elevation.exaggeration()*a.getElevationAt(S.x,S.y,!0):0,P=u?S:Y0(S,M,r),F=u?i.tilespaceRays.map(q=>J0(q,M)):i.queryGeometry.screenGeometry,V=Oa([],[T.x,T.y,M,1],r);if(!p&&u?g*=V[3]/n.cameraToCenterDistance:p&&!u&&(g*=n.cameraToCenterDistance/V[3]),V0(F,P,g))return!0}return!1}function Y0(i,e,n){const r=Oa([],[i.x,i.y,e,1],n);return new D(r[0]/r[3],r[1]/r[3])}const Mm=ic(0,0,0),K0=ic(0,0,1);function J0(i,e){const n=Jp();return Mm[2]=e,i.intersectsPlane(Mm,K0,n),new D(n[0],n[1])}class Im extends Zp{}function Cm(i,{width:e,height:n},r,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*n*r)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*n*r);return i.width=e,i.height=n,i.data=a,i}function zm(i,e,n){const{width:r,height:a}=e;r===i.width&&a===i.height||(nd(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,r),height:Math.min(i.height,a)},n),i.width=r,i.height=a,i.data=e.data)}function nd(i,e,n,r,a,u){if(a.width===0||a.height===0)return e;if(a.width>i.width||a.height>i.height||n.x>i.width-a.width||n.y>i.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||r.x>e.width-a.width||r.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,f=e.data;for(let g=0;g<a.height;g++){const v=((n.y+g)*i.width+n.x)*u,T=((r.y+g)*e.width+r.x)*u;for(let S=0;S<a.width*u;S++)f[T+S]=p[v+S]}return e}et(Im,"HeatmapBucket",{omit:["layers"]});class lo{constructor(e,n){Cm(this,e,1,n)}resize(e){zm(this,new lo(e),1)}clone(){return new lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,r,a,u){nd(e,n,r,a,u,1)}}class mn{constructor(e,n){Cm(this,e,4,n)}resize(e){zm(this,new mn(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new mn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,r,a,u){nd(e,n,r,a,u,4)}}et(lo,"AlphaImage"),et(mn,"RGBAImage");var Q0={paint:new R({"heatmap-radius":new w(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new w(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new x(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new z(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new x(ye.paint_heatmap["heatmap-opacity"])})};function rd(i){const e={},n=i.resolution||256,r=i.clips?i.clips.length:1,a=i.image||new mn({width:n,height:r}),u=(p,f,g)=>{e[i.evaluationKey]=g;const v=i.expression.evaluate(e);a.data[p+f+0]=Math.floor(255*v.r/v.a),a.data[p+f+1]=Math.floor(255*v.g/v.a),a.data[p+f+2]=Math.floor(255*v.b/v.a),a.data[p+f+3]=Math.floor(255*v.a)};if(i.clips)for(let p=0,f=0;p<r;++p,f+=4*n)for(let g=0,v=0;g<n;g++,v+=4){const T=g/(n-1),{start:S,end:M}=i.clips[p];u(f,v,S*(1-T)+M*T)}else for(let p=0,f=0;p<n;p++,f+=4)u(0,f,p/(n-1));return a}var ex={paint:new R({"hillshade-illumination-direction":new x(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new x(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new x(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new x(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new x(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new x(ye.paint_hillshade["hillshade-accent-color"])})};const tx=ie([{name:"a_pos",components:2,type:"Int16"}],4),{members:ix}=tx;var ih=nh,nx=nh;function nh(i,e,n){n=n||2;var r,a,u,p,f,g,v,T=e&&e.length,S=T?e[0]*n:i.length,M=km(i,0,S,n,!0),P=[];if(!M||M.next===M.prev)return P;if(T&&(M=function(V,q,Y,oe){var le,ue,he,pe=[];for(le=0,ue=q.length;le<ue;le++)(he=km(V,q[le]*oe,le<ue-1?q[le+1]*oe:V.length,oe,!1))===he.next&&(he.steiner=!0),pe.push(hx(he));for(pe.sort(lx),le=0;le<pe.length;le++)Y=jo(Y=cx(pe[le],Y),Y.next);return Y}(i,e,M,n)),i.length>80*n){r=u=i[0],a=p=i[1];for(var F=n;F<S;F+=n)(f=i[F])<r&&(r=f),(g=i[F+1])<a&&(a=g),f>u&&(u=f),g>p&&(p=g);v=(v=Math.max(u-r,p-a))!==0?1/v:0}return ac(M,P,n,r,a,v),P}function km(i,e,n,r,a){var u,p;if(a===ad(i,e,n,r)>0)for(u=e;u<n;u+=r)p=Lm(u,i[u],i[u+1],p);else for(u=n-r;u>=e;u-=r)p=Lm(u,i[u],i[u+1],p);return p&&rh(p,p.next)&&(cc(p),p=p.next),p}function jo(i,e){if(!i)return i;e||(e=i);var n,r=i;do if(n=!1,r.steiner||!rh(r,r.next)&&xi(r.prev,r,r.next)!==0)r=r.next;else{if(cc(r),(r=e=r.prev)===r.next)break;n=!0}while(n||r!==e);return e}function ac(i,e,n,r,a,u,p){if(i){!p&&u&&function(T,S,M,P){var F=T;do F.z===null&&(F.z=od(F.x,F.y,S,M,P)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==T);F.prevZ.nextZ=null,F.prevZ=null,function(V){var q,Y,oe,le,ue,he,pe,Te,Se=1;do{for(Y=V,V=null,ue=null,he=0;Y;){for(he++,oe=Y,pe=0,q=0;q<Se&&(pe++,oe=oe.nextZ);q++);for(Te=Se;pe>0||Te>0&&oe;)pe!==0&&(Te===0||!oe||Y.z<=oe.z)?(le=Y,Y=Y.nextZ,pe--):(le=oe,oe=oe.nextZ,Te--),ue?ue.nextZ=le:V=le,le.prevZ=ue,ue=le;Y=oe}ue.nextZ=null,Se*=2}while(he>1)}(F)}(i,r,a,u);for(var f,g,v=i;i.prev!==i.next;)if(f=i.prev,g=i.next,u?ox(i,r,a,u):rx(i))e.push(f.i/n),e.push(i.i/n),e.push(g.i/n),cc(i),i=g.next,v=g.next;else if((i=g)===v){p?p===1?ac(i=sx(jo(i),e,n),e,n,r,a,u,2):p===2&&ax(i,e,n,r,a,u):ac(jo(i),e,n,r,a,u,1);break}}}function rx(i){var e=i.prev,n=i,r=i.next;if(xi(e,n,r)>=0)return!1;for(var a=i.next.next;a!==i.prev;){if(Na(e.x,e.y,n.x,n.y,r.x,r.y,a.x,a.y)&&xi(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function ox(i,e,n,r){var a=i.prev,u=i,p=i.next;if(xi(a,u,p)>=0)return!1;for(var f=a.x>u.x?a.x>p.x?a.x:p.x:u.x>p.x?u.x:p.x,g=a.y>u.y?a.y>p.y?a.y:p.y:u.y>p.y?u.y:p.y,v=od(a.x<u.x?a.x<p.x?a.x:p.x:u.x<p.x?u.x:p.x,a.y<u.y?a.y<p.y?a.y:p.y:u.y<p.y?u.y:p.y,e,n,r),T=od(f,g,e,n,r),S=i.prevZ,M=i.nextZ;S&&S.z>=v&&M&&M.z<=T;){if(S!==i.prev&&S!==i.next&&Na(a.x,a.y,u.x,u.y,p.x,p.y,S.x,S.y)&&xi(S.prev,S,S.next)>=0||(S=S.prevZ,M!==i.prev&&M!==i.next&&Na(a.x,a.y,u.x,u.y,p.x,p.y,M.x,M.y)&&xi(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;S&&S.z>=v;){if(S!==i.prev&&S!==i.next&&Na(a.x,a.y,u.x,u.y,p.x,p.y,S.x,S.y)&&xi(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;M&&M.z<=T;){if(M!==i.prev&&M!==i.next&&Na(a.x,a.y,u.x,u.y,p.x,p.y,M.x,M.y)&&xi(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function sx(i,e,n){var r=i;do{var a=r.prev,u=r.next.next;!rh(a,u)&&Pm(a,r,r.next,u)&&lc(a,u)&&lc(u,a)&&(e.push(a.i/n),e.push(r.i/n),e.push(u.i/n),cc(r),cc(r.next),r=i=u),r=r.next}while(r!==i);return jo(r)}function ax(i,e,n,r,a,u){var p=i;do{for(var f=p.next.next;f!==p.prev;){if(p.i!==f.i&&px(p,f)){var g=Dm(p,f);return p=jo(p,p.next),g=jo(g,g.next),ac(p,e,n,r,a,u),void ac(g,e,n,r,a,u)}f=f.next}p=p.next}while(p!==i)}function lx(i,e){return i.x-e.x}function cx(i,e){var n=function(u,p){var f,g=p,v=u.x,T=u.y,S=-1/0;do{if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){var M=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(M<=v&&M>S){if(S=M,M===v){if(T===g.y)return g;if(T===g.next.y)return g.next}f=g.x<g.next.x?g:g.next}}g=g.next}while(g!==p);if(!f)return null;if(v===S)return f;var P,F=f,V=f.x,q=f.y,Y=1/0;g=f;do v>=g.x&&g.x>=V&&v!==g.x&&Na(T<q?v:S,T,V,q,T<q?S:v,T,g.x,g.y)&&(P=Math.abs(T-g.y)/(v-g.x),lc(g,u)&&(P<Y||P===Y&&(g.x>f.x||g.x===f.x&&ux(f,g)))&&(f=g,Y=P)),g=g.next;while(g!==F);return f}(i,e);if(!n)return e;var r=Dm(n,i),a=jo(n,n.next);return jo(r,r.next),e===n?a:e}function ux(i,e){return xi(i.prev,i,e.prev)<0&&xi(e.next,i,i.next)<0}function od(i,e,n,r,a){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-n)*a)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*a)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function hx(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Na(i,e,n,r,a,u,p,f){return(a-p)*(e-f)-(i-p)*(u-f)>=0&&(i-p)*(r-f)-(n-p)*(e-f)>=0&&(n-p)*(u-f)-(a-p)*(r-f)>=0}function px(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,r){var a=n;do{if(a.i!==n.i&&a.next.i!==n.i&&a.i!==r.i&&a.next.i!==r.i&&Pm(a,a.next,n,r))return!0;a=a.next}while(a!==n);return!1}(i,e)&&(lc(i,e)&&lc(e,i)&&function(n,r){var a=n,u=!1,p=(n.x+r.x)/2,f=(n.y+r.y)/2;do a.y>f!=a.next.y>f&&a.next.y!==a.y&&p<(a.next.x-a.x)*(f-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next;while(a!==n);return u}(i,e)&&(xi(i.prev,i,e.prev)||xi(i,e.prev,e))||rh(i,e)&&xi(i.prev,i,i.next)>0&&xi(e.prev,e,e.next)>0)}function xi(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function rh(i,e){return i.x===e.x&&i.y===e.y}function Pm(i,e,n,r){var a=sh(xi(i,e,n)),u=sh(xi(i,e,r)),p=sh(xi(n,r,i)),f=sh(xi(n,r,e));return a!==u&&p!==f||!(a!==0||!oh(i,n,e))||!(u!==0||!oh(i,r,e))||!(p!==0||!oh(n,i,r))||!(f!==0||!oh(n,e,r))}function oh(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function sh(i){return i>0?1:i<0?-1:0}function lc(i,e){return xi(i.prev,i,i.next)<0?xi(i,e,i.next)>=0&&xi(i,i.prev,e)>=0:xi(i,e,i.prev)<0||xi(i,i.next,e)<0}function Dm(i,e){var n=new sd(i.i,i.x,i.y),r=new sd(e.i,e.x,e.y),a=i.next,u=e.prev;return i.next=e,e.prev=i,n.next=a,a.prev=n,r.next=n,n.prev=r,u.next=r,r.prev=u,r}function Lm(i,e,n,r){var a=new sd(i,e,n);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function cc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function sd(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ad(i,e,n,r){for(var a=0,u=e,p=n-r;u<n;u+=r)a+=(i[p]-i[u])*(i[u+1]+i[p+1]),p=u;return a}function dx(i,e,n,r,a){Rm(i,e,n||0,r||i.length-1,a||fx)}function Rm(i,e,n,r,a){for(;r>n;){if(r-n>600){var u=r-n+1,p=e-n+1,f=Math.log(u),g=.5*Math.exp(2*f/3),v=.5*Math.sqrt(f*g*(u-g)/u)*(p-u/2<0?-1:1);Rm(i,e,Math.max(n,Math.floor(e-p*g/u+v)),Math.min(r,Math.floor(e+(u-p)*g/u+v)),a)}var T=i[e],S=n,M=r;for(uc(i,n,e),a(i[r],T)>0&&uc(i,n,r);S<M;){for(uc(i,S,M),S++,M--;a(i[S],T)<0;)S++;for(;a(i[M],T)>0;)M--}a(i[n],T)===0?uc(i,n,M):uc(i,++M,r),M<=e&&(n=M+1),e<=M&&(r=M-1)}}function uc(i,e,n){var r=i[e];i[e]=i[n],i[n]=r}function fx(i,e){return i<e?-1:i>e?1:0}function ld(i,e){const n=i.length;if(n<=1)return[i];const r=[];let a,u;for(let p=0;p<n;p++){const f=Ai(i[p]);f!==0&&(i[p].area=Math.abs(f),u===void 0&&(u=f<0),u===f<0?(a&&r.push(a),a=[i[p]]):a.push(i[p]))}if(a&&r.push(a),e>1)for(let p=0;p<r.length;p++)r[p].length<=e||(dx(r[p],e,1,r[p].length-1,mx),r[p]=r[p].slice(0,e));return r}function mx(i,e){return e.area-i.area}function cd(i,e,n){const r=n.patternDependencies;let a=!1;for(const u of e){const p=u.paint.get(`${i}-pattern`);p.isConstant()||(a=!0);const f=p.constantOr(null);f&&(a=!0,r[f.to]=!0,r[f.from]=!0)}return a}function ud(i,e,n,r,a){const u=a.patternDependencies;for(const p of e){const f=p.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let g=f.evaluate({zoom:r-1},n,{},a.availableImages),v=f.evaluate({zoom:r},n,{},a.availableImages),T=f.evaluate({zoom:r+1},n,{},a.availableImages);g=g&&g.name?g.name:g,v=v&&v.name?v.name:v,T=T&&T.name?T.name:T,u[g]=!0,u[v]=!0,u[T]=!0,n.patterns[p.id]={min:g,mid:v,max:T}}}return n}nh.deviation=function(i,e,n,r){var a=e&&e.length,u=Math.abs(ad(i,0,a?e[0]*n:i.length,n));if(a)for(var p=0,f=e.length;p<f;p++)u-=Math.abs(ad(i,e[p]*n,p<f-1?e[p+1]*n:i.length,n));var g=0;for(p=0;p<r.length;p+=3){var v=r[p]*n,T=r[p+1]*n,S=r[p+2]*n;g+=Math.abs((i[v]-i[S])*(i[T+1]-i[v+1])-(i[v]-i[T])*(i[S+1]-i[v+1]))}return u===0&&g===0?0:Math.abs((g-u)/u)},nh.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,a=0;a<i.length;a++){for(var u=0;u<i[a].length;u++)for(var p=0;p<e;p++)n.vertices.push(i[a][u][p]);a>0&&n.holes.push(r+=i[a-1].length)}return n},ih.default=nx;class ah{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ee,this.indexArray=new tt,this.indexArray2=new gt,this.programConfigurations=new zs(e.layers,e.zoom),this.segments=new fi,this.segments2=new fi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,r,a){this.hasPattern=cd("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:f,id:g,index:v,sourceLayerIndex:T}of e){const S=this.layers[0]._featureFilter.needGeometry,M=ks(f,S);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),M,r))continue;const P=u?u.evaluate(M,{},r,n.availableImages):void 0,F={id:g,properties:f.properties,type:f.type,sourceLayerIndex:T,index:v,geometry:S?M.geometry:ao(f,r,a),patterns:{},sortKey:P};p.push(F)}u&&p.sort((f,g)=>f.sortKey-g.sortKey);for(const f of p){const{geometry:g,index:v,sourceLayerIndex:T}=f;if(this.hasPattern){const S=ud("fill",this.layers,f,this.zoom,n);this.patternFeatures.push(S)}else this.addFeature(f,g,v,r,{},n.availableImages);n.featureIndex.insert(e[v].feature,g,v,T,this.index)}}update(e,n,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,r,a)}addFeatures(e,n,r,a,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ix),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,r,a,u,p=[]){for(const f of ld(n,500)){let g=0;for(const F of f)g+=F.length;const v=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),T=v.vertexLength,S=[],M=[];for(const F of f){if(F.length===0)continue;F!==f[0]&&M.push(S.length/2);const V=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),q=V.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(q+F.length-1,q),S.push(F[0].x),S.push(F[0].y);for(let Y=1;Y<F.length;Y++)this.layoutVertexArray.emplaceBack(F[Y].x,F[Y].y),this.indexArray2.emplaceBack(q+Y-1,q+Y),S.push(F[Y].x),S.push(F[Y].y);V.vertexLength+=F.length,V.primitiveLength+=F.length}const P=ih(S,M);for(let F=0;F<P.length;F+=3)this.indexArray.emplaceBack(T+P[F],T+P[F+1],T+P[F+2]);v.vertexLength+=g,v.primitiveLength+=P.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,p,a)}}et(ah,"FillBucket",{omit:["layers","patternFeatures"]});const _x=new R({"fill-sort-key":new w(ye.layout_fill["fill-sort-key"])});var gx={paint:new R({"fill-antialias":new x(ye.paint_fill["fill-antialias"]),"fill-opacity":new w(ye.paint_fill["fill-opacity"]),"fill-color":new w(ye.paint_fill["fill-color"]),"fill-outline-color":new w(ye.paint_fill["fill-outline-color"]),"fill-translate":new x(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new x(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new A(ye.paint_fill["fill-pattern"])}),layout:_x};const yx=ie([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),xx=ie([{name:"a_centroid_pos",components:2,type:"Uint16"}]),vx=ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:bx}=yx;var Bm=Ua;function Ua(i,e,n,r,a){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=r,this._values=a,i.readFields(wx,this,e)}function wx(i,e,n){i==1?e.id=n.readVarint():i==2?function(r,a){for(var u=r.readVarint()+r.pos;r.pos<u;){var p=a._keys[r.readVarint()],f=a._values[r.readVarint()];a.properties[p]=f}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function Tx(i){for(var e,n,r=0,a=0,u=i.length,p=u-1;a<u;p=a++)r+=((n=i[p]).x-(e=i[a]).x)*(e.y+n.y);return r}Ua.types=["Unknown","Point","LineString","Polygon"],Ua.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,r=1,a=0,u=0,p=0,f=[];i.pos<n;){if(a<=0){var g=i.readVarint();r=7&g,a=g>>3}if(a--,r===1||r===2)u+=i.readSVarint(),p+=i.readSVarint(),r===1&&(e&&f.push(e),e=[]),e.push(new D(u,p));else{if(r!==7)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&f.push(e),f},Ua.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,r=0,a=0,u=0,p=1/0,f=-1/0,g=1/0,v=-1/0;i.pos<e;){if(r<=0){var T=i.readVarint();n=7&T,r=T>>3}if(r--,n===1||n===2)(a+=i.readSVarint())<p&&(p=a),a>f&&(f=a),(u+=i.readSVarint())<g&&(g=u),u>v&&(v=u);else if(n!==7)throw new Error("unknown command "+n)}return[p,g,f,v]},Ua.prototype.toGeoJSON=function(i,e,n){var r,a,u=this.extent*Math.pow(2,n),p=this.extent*i,f=this.extent*e,g=this.loadGeometry(),v=Ua.types[this.type];function T(P){for(var F=0;F<P.length;F++){var V=P[F];P[F]=[360*(V.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+f)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(r=0;r<g.length;r++)S[r]=g[r][0];T(g=S);break;case 2:for(r=0;r<g.length;r++)T(g[r]);break;case 3:for(g=function(P){var F=P.length;if(F<=1)return[P];for(var V,q,Y=[],oe=0;oe<F;oe++){var le=Tx(P[oe]);le!==0&&(q===void 0&&(q=le<0),q===le<0?(V&&Y.push(V),V=[P[oe]]):V.push(P[oe]))}return V&&Y.push(V),Y}(g),r=0;r<g.length;r++)for(a=0;a<g[r].length;a++)T(g[r][a])}g.length===1?g=g[0]:v="Multi"+v;var M={type:"Feature",geometry:{type:v,coordinates:g},properties:this.properties};return"id"in this&&(M.id=this.id),M};var Fm=Om;function Om(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Ex,this,e),this.length=this._features.length}function Ex(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(r){for(var a=null,u=r.readVarint()+r.pos;r.pos<u;){var p=r.readVarint()>>3;a=p===1?r.readString():p===2?r.readFloat():p===3?r.readDouble():p===4?r.readVarint64():p===5?r.readVarint():p===6?r.readSVarint():p===7?r.readBoolean():null}return a}(n))}function Sx(i,e,n){if(i===3){var r=new Fm(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}Om.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Bm(this._pbf,e,this.extent,this._keys,this._values)};var Ls={VectorTile:function(i,e){this.layers=i.readFields(Sx,{},e)},VectorTileFeature:Bm,VectorTileLayer:Fm};function lh(i,e,n,r){const a=[],u=r===0?(p,f,g,v,T,S)=>{p.push(new D(S,g+(S-f)/(v-f)*(T-g)))}:(p,f,g,v,T,S)=>{p.push(new D(f+(S-g)/(T-g)*(v-f),S))};for(const p of i){const f=[];for(const g of p){if(g.length<=2)continue;const v=[];for(let M=0;M<g.length-1;M++){const P=g[M].x,F=g[M].y,V=g[M+1].x,q=g[M+1].y,Y=r===0?P:F,oe=r===0?V:q;Y<e?oe>e&&u(v,P,F,V,q,e):Y>n?oe<n&&u(v,P,F,V,q,n):v.push(g[M]),oe<e&&Y>=e&&u(v,P,F,V,q,e),oe>n&&Y<=n&&u(v,P,F,V,q,n)}let T=g[g.length-1];const S=r===0?T.x:T.y;S>=e&&S<=n&&v.push(T),v.length&&(T=v[v.length-1],v[0].x===T.x&&v[0].y===T.y||v.push(v[0]),f.push(v))}f.length&&a.push(f)}return a}const Ax=Ls.VectorTileFeature.types,Mx=Math.pow(2,13);function hc(i,e,n,r,a,u,p,f){i.emplaceBack((e<<1)+p,(n<<1)+u,(Math.floor(r*Mx)<<1)+a,Math.round(f))}function pc(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Nm{constructor(){this.acc=new D(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new D(e.x,e.y),this.max=new D(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,a=this.max;e.x<r.x?r.x=e.x:e.x>a.x&&(a.x=e.x),e.y<r.y?r.y=e.y:e.y>a.y&&(a.y=e.y),((e.x===0||e.x===Et)&&e.x===n.x)!=((e.y===0||e.y===Et)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,pt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Et!=e.x>Et&&this.addBorderIntersection(1,pt(n.y,e.y,(Et-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,pt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Et!=e.y>Et&&this.addBorderIntersection(3,pt(n.x,e.x,(Et-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];n<r[0]&&(r[0]=n),n>r[1]&&(r[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const r=e.x===0?0:1;this.addBorderIntersection(r,n.y),this.addBorderIntersection(r,e.y)}else{const r=e.y===0?2:3;this.addBorderIntersection(r,n.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce((n,r)=>n+r.edges,0);return e!==0?this.acc.div(e)._round():new D(0,0)}span(){return new D(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class dc{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new re,this.centroidVertexArray=new Cs,this.indexArray=new tt,this.programConfigurations=new zs(e.layers,e.zoom),this.segments=new fi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,r,a){this.features=[],this.hasPattern=cd("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(u){const p=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*p/(p*p+1)/Et/(1<<u.z)}(r);for(const{feature:u,id:p,index:f,sourceLayerIndex:g}of e){const v=this.layers[0]._featureFilter.needGeometry,T=ks(u,v);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),T,r))continue;const S={id:p,sourceLayerIndex:g,index:f,geometry:v?T.geometry:ao(u,r,a),properties:u.properties,type:u.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(ud("fill-extrusion",this.layers,S,this.zoom,n)):this.addFeature(S,S.geometry,f,r,{},n.availableImages,a),n.featureIndex.insert(u,S.geometry,f,g,this.index,M)}this.sortBorders()}addFeatures(e,n,r,a,u){for(const p of this.features){const{geometry:f}=p;this.addFeature(p,f,p.index,n,r,a,u)}this.sortBorders()}update(e,n,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,vx.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,xx.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,r,a,u,p,f){const g=[new D(0,0),new D(Et,Et)],v=f.projection,T=v.name==="globe",S=this.enableTerrain&&!T?new Nm:null;T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new tn);const M=ld(n,500);for(let V=M.length-1;V>=0;V--){const q=M[V];(q.length===0||(P=q[0]).every(Y=>Y.x<=0)||P.every(Y=>Y.x>=Et)||P.every(Y=>Y.y<=0)||P.every(Y=>Y.y>=Et))&&M.splice(V,1)}var P;let F;if(T){const q=1<<a.z,Y=Vn(a.x/q),oe=Vn((a.x+1)/q),le=Fi(a.y/q),ue=Fi((a.y+1)/q);F=function(he,pe,Te,Se,ze=0,De){const be=[];if(!he.length||!Te||!Se)return be;const Ce=(wt,Mt)=>{for(const at of wt)be.push({polygon:at,bounds:Mt})},Re=Math.ceil(Math.log2(Te)),$e=Math.ceil(Math.log2(Se)),Oe=Re-$e,Ve=[];for(let wt=0;wt<Math.abs(Oe);wt++)Ve.push(Oe>0?0:1);for(let wt=0;wt<Math.min(Re,$e);wt++)Ve.push(0),Ve.push(1);let bt=he;if(bt=lh(bt,pe[0].y-ze,pe[1].y+ze,1),bt=lh(bt,pe[0].x-ze,pe[1].x+ze,0),!bt.length)return be;const kt=[];for(Ve.length?kt.push({polygons:bt,bounds:pe,depth:0}):Ce(bt,pe);kt.length;){const wt=kt.pop(),Mt=wt.depth,at=Ve[Mt],Qe=wt.bounds[0],Lt=wt.bounds[1],qt=at===0?Qe.x:Qe.y,Ti=at===0?Lt.x:Lt.y,ii=De?De(at,qt,Ti):.5*(qt+Ti),Ei=lh(wt.polygons,qt-ze,ii+ze,at),Xt=lh(wt.polygons,ii-ze,Ti+ze,at);if(Ei.length){const Ft=[Qe,new D(at===0?ii:Lt.x,at===1?ii:Lt.y)];Ve.length>Mt+1?kt.push({polygons:Ei,bounds:Ft,depth:Mt+1}):Ce(Ei,Ft)}if(Xt.length){const Ft=[new D(at===0?ii:Qe.x,at===1?ii:Qe.y),Lt];Ve.length>Mt+1?kt.push({polygons:Xt,bounds:Ft,depth:Mt+1}):Ce(Xt,Ft)}}return be}(M,g,Math.ceil((oe-Y)/11.25),Math.ceil((le-ue)/11.25),1,(he,pe,Te)=>{if(he===0)return .5*(pe+Te);{const Se=Fi((a.y+pe/Et)/q);return(Da(.5*(Fi((a.y+Te/Et)/q)+Se))*q-a.y)*Et}})}else{F=[];for(const V of M)F.push({polygon:V,bounds:g})}for(const V of F){const q=V.polygon;let Y=0,oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Te=0;Te<q.length;Te++){const Se=q[Te];if(Se.length===0)continue;Y+=Se.length;let ze=0;S&&S.startRing(Se[0]);for(let De=0;De<Se.length;De++){const be=Se[De];if(De>=1){const Ce=Se[De-1];if(!Ix(be,Ce,V.bounds)){S&&S.append(be,Ce),oe.vertexLength+4>fi.MAX_VERTEX_ARRAY_LENGTH&&(oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Re=be.sub(Ce)._perp(),$e=Re.x/(Math.abs(Re.x)+Math.abs(Re.y)),Oe=Re.y>0?1:0,Ve=Ce.dist(be);ze+Ve>32768&&(ze=0),hc(this.layoutVertexArray,be.x,be.y,$e,Oe,0,0,ze),hc(this.layoutVertexArray,be.x,be.y,$e,Oe,0,1,ze),ze+=Ve,hc(this.layoutVertexArray,Ce.x,Ce.y,$e,Oe,0,0,ze),hc(this.layoutVertexArray,Ce.x,Ce.y,$e,Oe,0,1,ze);const bt=oe.vertexLength;if(this.indexArray.emplaceBack(bt,bt+2,bt+1),this.indexArray.emplaceBack(bt+1,bt+2,bt+3),oe.vertexLength+=4,oe.primitiveLength+=2,T){const kt=this.layoutVertexExtArray,wt=v.projectTilePoint(be.x,be.y,a),Mt=v.projectTilePoint(Ce.x,Ce.y,a),at=v.upVector(a,be.x,be.y),Qe=v.upVector(a,Ce.x,Ce.y);pc(kt,wt,at),pc(kt,wt,at),pc(kt,Mt,Qe),pc(kt,Mt,Qe)}}}}}if(oe.vertexLength+Y>fi.MAX_VERTEX_ARRAY_LENGTH&&(oe=this.segments.prepareSegment(Y,this.layoutVertexArray,this.indexArray)),Ax[e.type]!=="Polygon")continue;const le=[],ue=[],he=oe.vertexLength;for(let Te=0;Te<q.length;Te++){const Se=q[Te];if(Se.length!==0){Se!==q[0]&&ue.push(le.length/2);for(let ze=0;ze<Se.length;ze++){const De=Se[ze];hc(this.layoutVertexArray,De.x,De.y,0,0,1,1,0),le.push(De.x),le.push(De.y),S&&S.currentPolyCount.top++,T&&pc(this.layoutVertexExtArray,v.projectTilePoint(De.x,De.y,a),v.upVector(a,De.x,De.y))}}}const pe=ih(le,ue);for(let Te=0;Te<pe.length;Te+=3)this.indexArray.emplaceBack(he+pe[Te],he+pe[Te+2],he+pe[Te+1]);oe.primitiveLength+=pe.length/3,oe.vertexLength+=Y}if(S&&S.polyCount.length>0){if(S.borders){S.vertexArrayOffset=this.centroidVertexArray.length;const V=S.borders,q=this.featuresOnBorder.push(S)-1;for(let Y=0;Y<4;Y++)V[Y][0]!==Number.MAX_VALUE&&this.borders[Y].push(q)}this.encodeCentroid(S.borders?void 0:S.centroid(),S)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,p,a)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,r)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}encodeCentroid(e,n,r=!0){let a,u;if(e)if(e.y!==0){const f=n.span()._mult(this.tileToMeter);a=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(f.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(f.y/10))}else a=Math.ceil(7*(e.x+450)),u=0;else a=0,u=+r;let p=r?this.centroidVertexArray.length:n.vertexArrayOffset;for(const f of n.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*f.edges+f.top);for(let g=0;g<2*f.edges;g++)this.centroidVertexArray.emplace(p++,0,u),this.centroidVertexArray.emplace(p++,a,u);for(let g=0;g<f.top;g++)this.centroidVertexArray.emplace(p++,a,u)}}}function Ix(i,e,n){return i.x===e.x&&(i.x<n[0].x||i.x>n[1].x)||i.y===e.y&&(i.y<n[0].y||i.y>n[1].y)}et(dc,"FillExtrusionBucket",{omit:["layers","features"]}),et(Nm,"PartMetadata");var Cx={paint:new R({"fill-extrusion-opacity":new x(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new w(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new x(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new x(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new A(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new w(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new w(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new x(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function fc(i,e){return i.x*e.x+i.y*e.y}function Um(i,e){if(i.length===1){let n=0;const r=e[n++];let a;for(;!a||r.equals(a);)if(a=e[n++],!a)return 1/0;for(;n<e.length;n++){const u=e[n],p=i[0],f=a.sub(r),g=u.sub(r),v=p.sub(r),T=fc(f,f),S=fc(f,g),M=fc(g,g),P=fc(v,f),F=fc(v,g),V=T*M-S*S,q=(M*P-S*F)/V,Y=(T*F-S*P)/V,oe=r.z*(1-q-Y)+a.z*q+u.z*Y;if(isFinite(oe))return oe}return 1/0}{let n=1/0;for(const r of e)n=Math.min(n,r.z);return n}}function Vm(i){const e=new D(i[0],i[1]);return e.z=i[2],e}function zx(i,e,n,r,a,u,p,f){const g=p*a.getElevationAt(i,e,!0,!0),v=u[0]!==0,T=v?u[1]===0?p*(u[0]/7-450):p*function(S,M,P){const F=Math.floor(M[0]/8),V=Math.floor(M[1]/8),q=10*(M[0]-8*F),Y=10*(M[1]-8*V),oe=S.getElevationAt(F,V,!0,!0),le=S.getMeterToDEM(P),ue=Math.floor(.5*(q*le-1)),he=Math.floor(.5*(Y*le-1)),pe=S.tileCoordToPixel(F,V),Te=2*ue+1,Se=2*he+1,ze=function(Oe,Ve,bt,kt,wt){return[Oe.getElevationAtPixel(Ve,bt,!0),Oe.getElevationAtPixel(Ve+wt,bt,!0),Oe.getElevationAtPixel(Ve,bt+wt,!0),Oe.getElevationAtPixel(Ve+kt,bt+wt,!0)]}(S,pe.x-ue,pe.y-he,Te,Se),De=Math.abs(ze[0]-ze[1]),be=Math.abs(ze[2]-ze[3]),Ce=Math.abs(ze[0]-ze[2])+Math.abs(ze[1]-ze[3]),Re=Math.min(.25,.5*le*(De+be)/Te),$e=Math.min(.25,.5*le*Ce/Se);return oe+Math.max(Re*q,$e*Y)}(a,u,f):g;return{base:g+(n===0)?-1:n,top:v?Math.max(T+r,g+n+2):g+r}}const kx=ie([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Px}=kx,Dx=ie([{name:"a_packed",components:3,type:"Float32"}]),{members:Lx}=Dx,Rx=Ls.VectorTileFeature.types,Bx=Math.cos(Math.PI/180*37.5);class ch{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Q,this.layoutVertexArray2=new Ne,this.indexArray=new tt,this.programConfigurations=new zs(e.layers,e.zoom),this.segments=new fi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,r,a){this.hasPattern=cd("line",this.layers,n);const u=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:T,id:S,index:M,sourceLayerIndex:P}of e){const F=this.layers[0]._featureFilter.needGeometry,V=ks(T,F);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),V,r))continue;const q=u?u.evaluate(V,{},r):void 0,Y={id:S,properties:T.properties,type:T.type,sourceLayerIndex:P,index:M,geometry:F?V.geometry:ao(T,r,a),patterns:{},sortKey:q};p.push(Y)}u&&p.sort((T,S)=>T.sortKey-S.sortKey);const{lineAtlas:f,featureIndex:g}=n,v=this.addConstantDashes(f);for(const T of p){const{geometry:S,index:M,sourceLayerIndex:P}=T;if(v&&this.addFeatureDashes(T,f),this.hasPattern){const F=ud("line",this.layers,T,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(T,S,M,r,f.positions,n.availableImages);g.insert(e[M].feature,S,M,P,this.index)}}addConstantDashes(e){let n=!1;for(const r of this.layers){const a=r.paint.get("line-dasharray").value,u=r.layout.get("line-cap").value;if(a.kind!=="constant"||u.kind!=="constant")n=!0;else{const p=u.value,f=a.value;if(!f)continue;e.addDash(f.from,p),e.addDash(f.to,p),f.other&&e.addDash(f.other,p)}}return n}addFeatureDashes(e,n){const r=this.zoom;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,p=a.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let f,g,v,T,S,M;if(u.kind==="constant"){const q=u.value;if(!q)continue;f=q.other||q.to,g=q.to,v=q.from}else f=u.evaluate({zoom:r-1},e),g=u.evaluate({zoom:r},e),v=u.evaluate({zoom:r+1},e);p.kind==="constant"?T=S=M=p.value:(T=p.evaluate({zoom:r-1},e),S=p.evaluate({zoom:r},e),M=p.evaluate({zoom:r+1},e)),n.addDash(f,T),n.addDash(g,S),n.addDash(v,M);const P=n.getKey(f,T),F=n.getKey(g,S),V=n.getKey(v,M);e.patterns[a.id]={min:P,mid:F,max:V}}}update(e,n,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,r,a)}addFeatures(e,n,r,a,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Lx)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Px),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,r,a,u,p){const f=this.layers[0].layout,g=f.get("line-join").evaluate(e,{}),v=f.get("line-cap").evaluate(e,{}),T=f.get("line-miter-limit"),S=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of n)this.addLine(M,e,g,v,T,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,p,a)}addLine(e,n,r,a,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=Rx[n.type]==="Polygon";let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let v=0;for(;v<g-1&&e[v].equals(e[v+1]);)v++;if(g<(f?3:2))return;r==="bevel"&&(u=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,S=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let M,P,F,V,q;this.e1=this.e2=-1,f&&(M=e[g-2],q=e[v].sub(M)._unit()._perp());for(let Y=v;Y<g;Y++){if(F=Y===g-1?f?e[v+1]:void 0:e[Y+1],F&&e[Y].equals(F))continue;q&&(V=q),M&&(P=M),M=e[Y],q=F?F.sub(M)._unit()._perp():V,V=V||q;let oe=V.add(q);oe.x===0&&oe.y===0||oe._unit();const le=V.x*q.x+V.y*q.y,ue=oe.x*q.x+oe.y*q.y,he=ue!==0?1/ue:1/0,pe=2*Math.sqrt(2-2*ue),Te=ue<Bx&&P&&F,Se=V.x*q.y-V.y*q.x>0;if(Te&&Y>v){const be=M.dist(P);if(be>2*T){const Ce=M.sub(M.sub(P)._mult(T/be)._round());this.updateDistance(P,Ce),this.addCurrentVertex(Ce,V,0,0,S),P=Ce}}const ze=P&&F;let De=ze?r:f?"butt":a;if(ze&&De==="round"&&(he<p?De="miter":he<=2&&(De="fakeround")),De==="miter"&&he>u&&(De="bevel"),De==="bevel"&&(he>2&&(De="flipbevel"),he<u&&(De="miter")),P&&this.updateDistance(P,M),De==="miter")oe._mult(he),this.addCurrentVertex(M,oe,0,0,S);else if(De==="flipbevel"){if(he>100)oe=q.mult(-1);else{const be=he*V.add(q).mag()/V.sub(q).mag();oe._perp()._mult(be*(Se?-1:1))}this.addCurrentVertex(M,oe,0,0,S),this.addCurrentVertex(M,oe.mult(-1),0,0,S)}else if(De==="bevel"||De==="fakeround"){const be=-Math.sqrt(he*he-1),Ce=Se?be:0,Re=Se?0:be;if(P&&this.addCurrentVertex(M,V,Ce,Re,S),De==="fakeround"){const $e=Math.round(180*pe/Math.PI/20);for(let Oe=1;Oe<$e;Oe++){let Ve=Oe/$e;if(Ve!==.5){const kt=Ve-.5;Ve+=Ve*kt*(Ve-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*kt*kt+(.848013+le*(.215638*le-1.06021)))}const bt=q.sub(V)._mult(Ve)._add(V)._unit()._mult(Se?-1:1);this.addHalfVertex(M,bt.x,bt.y,!1,Se,0,S)}}F&&this.addCurrentVertex(M,q,-Ce,-Re,S)}else if(De==="butt")this.addCurrentVertex(M,oe,0,0,S);else if(De==="square"){const be=P?1:-1;P||this.addCurrentVertex(M,oe,be,be,S),this.addCurrentVertex(M,oe,0,0,S),P&&this.addCurrentVertex(M,oe,be,be,S)}else De==="round"&&(P&&(this.addCurrentVertex(M,V,0,0,S),this.addCurrentVertex(M,V,1,1,S,!0)),F&&(this.addCurrentVertex(M,q,-1,-1,S,!0),this.addCurrentVertex(M,q,0,0,S)));if(Te&&Y<g-1){const be=M.dist(F);if(be>2*T){const Ce=M.add(F.sub(M)._mult(T/be)._round());this.updateDistance(M,Ce),this.addCurrentVertex(Ce,q,0,0,S),M=Ce}}}}addCurrentVertex(e,n,r,a,u,p=!1){const f=n.y*a-n.x,g=-n.y-n.x*a;this.addHalfVertex(e,n.x+n.y*r,n.y-n.x*r,p,!1,r,u),this.addHalfVertex(e,f,g,p,!0,-a,u)}addHalfVertex({x:e,y:n},r,a,u,p,f,g){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(n<<1)+(p?1:0),Math.round(63*r)+128,Math.round(63*a)+128,1+(f===0?0:f<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const v=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),g.primitiveLength++),p?this.e2=v:this.e1=v}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}et(ch,"LineBucket",{omit:["layers","patternFeatures"]});const Fx=new R({"line-cap":new w(ye.layout_line["line-cap"]),"line-join":new w(ye.layout_line["line-join"]),"line-miter-limit":new x(ye.layout_line["line-miter-limit"]),"line-round-limit":new x(ye.layout_line["line-round-limit"]),"line-sort-key":new w(ye.layout_line["line-sort-key"])});var $m={paint:new R({"line-opacity":new w(ye.paint_line["line-opacity"]),"line-color":new w(ye.paint_line["line-color"]),"line-translate":new x(ye.paint_line["line-translate"]),"line-translate-anchor":new x(ye.paint_line["line-translate-anchor"]),"line-width":new w(ye.paint_line["line-width"]),"line-gap-width":new w(ye.paint_line["line-gap-width"]),"line-offset":new w(ye.paint_line["line-offset"]),"line-blur":new w(ye.paint_line["line-blur"]),"line-dasharray":new A(ye.paint_line["line-dasharray"]),"line-pattern":new A(ye.paint_line["line-pattern"]),"line-gradient":new z(ye.paint_line["line-gradient"])}),layout:Fx};const jm=new class extends w{possiblyEvaluate(i,e){return e=new ti(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,n,r){return e=Ie({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,n,r)}}($m.paint.properties["line-width"].specification);function Gm(i,e){return e>0?e+2*i:i}jm.useIntegerZoom=!0;const Ox=ie([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Nx=ie([{name:"a_projected_pos",components:3,type:"Float32"}],4);ie([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ux=ie([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Vx=ie([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Zm=ie([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$x=ie([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ie([{name:"triangle",components:3,type:"Uint16"}]),ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ie([{type:"Float32",name:"offsetX"}]),ie([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Oi=24;const Mr=128;function hd(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ti(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:a}=n;let u=0;for(;u<r.length&&r[u]<=i;)u++;u=Math.max(0,u-1);let p=u;for(;p<r.length&&r[p]<i+1;)p++;p=Math.min(r.length-1,p);const f=r[u],g=r[p];return n.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:g,interpolationType:a}:{kind:"camera",minZoom:f,maxZoom:g,minSize:n.evaluate(new ti(f)),maxSize:n.evaluate(new ti(g)),interpolationType:a}}}function uh(i,{uSize:e,uSizeT:n},{lowerSize:r,upperSize:a}){return i.kind==="source"?r/Mr:i.kind==="composite"?pt(r/Mr,a/Mr,n):e}function Va(i,e){let n=0,r=0;if(i.kind==="constant")r=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:a,minZoom:u,maxZoom:p}=i,f=a?Ge(Ji.interpolationFactor(a,e,u,p),0,1):0;i.kind==="camera"?r=pt(i.minSize,i.maxSize,f):n=f}return{uSizeT:n,uSize:r}}var jx=Object.freeze({__proto__:null,getSizeData:hd,evaluateSizeForFeature:uh,evaluateSizeForZoom:Va,SIZE_PACK_FACTOR:Mr});function Gx(i,e,n){return i.sections.forEach(r=>{r.text=function(a,u,p){const f=u.layout.get("text-transform").evaluate(p,{});return f==="uppercase"?a=a.toLocaleUpperCase():f==="lowercase"&&(a=a.toLocaleLowerCase()),pn.applyArabicShaping&&(a=pn.applyArabicShaping(a)),a}(r.text,e,n)}),i}const mc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function Zx(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function qx(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var qm=function(i,e,n,r,a){var u,p,f=8*a-r-1,g=(1<<f)-1,v=g>>1,T=-7,S=n?a-1:0,M=n?-1:1,P=i[e+S];for(S+=M,u=P&(1<<-T)-1,P>>=-T,T+=f;T>0;u=256*u+i[e+S],S+=M,T-=8);for(p=u&(1<<-T)-1,u>>=-T,T+=r;T>0;p=256*p+i[e+S],S+=M,T-=8);if(u===0)u=1-v;else{if(u===g)return p?NaN:1/0*(P?-1:1);p+=Math.pow(2,r),u-=v}return(P?-1:1)*p*Math.pow(2,u-r)},Xm=function(i,e,n,r,a,u){var p,f,g,v=8*u-a-1,T=(1<<v)-1,S=T>>1,M=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=r?0:u-1,F=r?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-p))<1&&(p--,g*=2),(e+=p+S>=1?M/g:M*Math.pow(2,1-S))*g>=2&&(p++,g/=2),p+S>=T?(f=0,p=T):p+S>=1?(f=(e*g-1)*Math.pow(2,a),p+=S):(f=e*Math.pow(2,S-1)*Math.pow(2,a),p=0));a>=8;i[n+P]=255&f,P+=F,f/=256,a-=8);for(p=p<<a|f,v+=a;v>0;i[n+P]=255&p,P+=F,p/=256,v-=8);i[n+P-F]|=128*V},_c=ei;function ei(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ei.Varint=0,ei.Fixed64=1,ei.Bytes=2,ei.Fixed32=5;var pd=4294967296,Wm=1/pd,Hm=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function co(i){return i.type===ei.Bytes?i.readVarint()+i.pos:i.pos+1}function $a(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Ym(i,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var a=n.pos-1;a>=i;a--)n.buf[a+r]=n.buf[a]}function Xx(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function Wx(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function Hx(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function Yx(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function Kx(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function Jx(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function Qx(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function ev(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function tv(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function hh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function ja(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function Km(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function iv(i,e,n){e.glyphs=[],i===1&&n.readMessage(nv,e)}function nv(i,e,n){if(i===3){const{id:r,bitmap:a,width:u,height:p,left:f,top:g,advance:v}=n.readMessage(rv,{});e.glyphs.push({id:r,bitmap:new lo({width:u+6,height:p+6},a),metrics:{width:u,height:p,left:f,top:g,advance:v}})}else i===4?e.ascender=n.readSVarint():i===5&&(e.descender=n.readSVarint())}function rv(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function dd(i){let e=0,n=0;for(const p of i)e+=p.w*p.h,n=Math.max(n,p.w);i.sort((p,f)=>f.h-p.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let a=0,u=0;for(const p of i)for(let f=r.length-1;f>=0;f--){const g=r[f];if(!(p.w>g.w||p.h>g.h)){if(p.x=g.x,p.y=g.y,u=Math.max(u,p.y+p.h),a=Math.max(a,p.x+p.w),p.w===g.w&&p.h===g.h){const v=r.pop();f<r.length&&(r[f]=v)}else p.h===g.h?(g.x+=p.w,g.w-=p.w):p.w===g.w?(g.y+=p.h,g.h-=p.h):(r.push({x:g.x+p.w,y:g.y,w:g.w-p.w,h:p.h}),g.y+=p.h,g.h-=p.h);break}}return{w:a,h:u,fill:e/(a*u)||0}}ei.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),a=r>>3,u=this.pos;this.type=7&r,i(a,e,this),this.pos===u&&this.skip(r)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=hh(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Km(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=hh(this.buf,this.pos)+hh(this.buf,this.pos+4)*pd;return this.pos+=8,i},readSFixed64:function(){var i=hh(this.buf,this.pos)+Km(this.buf,this.pos+4)*pd;return this.pos+=8,i},readFloat:function(){var i=qm(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=qm(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(a,u,p){var f,g,v=p.buf;if(f=(112&(g=v[p.pos++]))>>4,g<128||(f|=(127&(g=v[p.pos++]))<<3,g<128)||(f|=(127&(g=v[p.pos++]))<<10,g<128)||(f|=(127&(g=v[p.pos++]))<<17,g<128)||(f|=(127&(g=v[p.pos++]))<<24,g<128)||(f|=(1&(g=v[p.pos++]))<<31,g<128))return $a(a,f,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Hm?function(n,r,a){return Hm.decode(n.subarray(r,a))}(this.buf,e,i):function(n,r,a){for(var u="",p=r;p<a;){var f,g,v,T=n[p],S=null,M=T>239?4:T>223?3:T>191?2:1;if(p+M>a)break;M===1?T<128&&(S=T):M===2?(192&(f=n[p+1]))==128&&(S=(31&T)<<6|63&f)<=127&&(S=null):M===3?(g=n[p+2],(192&(f=n[p+1]))==128&&(192&g)==128&&((S=(15&T)<<12|(63&f)<<6|63&g)<=2047||S>=55296&&S<=57343)&&(S=null)):M===4&&(g=n[p+2],v=n[p+3],(192&(f=n[p+1]))==128&&(192&g)==128&&(192&v)==128&&((S=(15&T)<<18|(63&f)<<12|(63&g)<<6|63&v)<=65535||S>=1114112)&&(S=null)),S===null?(S=65533,M=1):S>65535&&(S-=65536,u+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),u+=String.fromCharCode(S),p+=M}return u}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==ei.Bytes)return i.push(this.readVarint(e));var n=co(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==ei.Bytes)return i.push(this.readSVarint());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ei.Bytes)return i.push(this.readBoolean());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ei.Bytes)return i.push(this.readFloat());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ei.Bytes)return i.push(this.readDouble());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ei.Bytes)return i.push(this.readFixed32());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ei.Bytes)return i.push(this.readSFixed32());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ei.Bytes)return i.push(this.readFixed64());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ei.Bytes)return i.push(this.readSFixed64());var e=co(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===ei.Varint)for(;this.buf[this.pos++]>127;);else if(e===ei.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ei.Fixed32)this.pos+=4;else{if(e!==ei.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ja(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ja(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ja(this.buf,-1&i,this.pos),ja(this.buf,Math.floor(i*Wm),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ja(this.buf,-1&i,this.pos),ja(this.buf,Math.floor(i*Wm),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var r,a;if(e>=0?(r=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(u,p,f){f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,f.buf[f.pos]=127&(u>>>=7)}(r,0,n),function(u,p){var f=(7&u)<<4;p.buf[p.pos++]|=f|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(a,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(r,a,u){for(var p,f,g=0;g<a.length;g++){if((p=a.charCodeAt(g))>55295&&p<57344){if(!f){p>56319||g+1===a.length?(r[u++]=239,r[u++]=191,r[u++]=189):f=p;continue}if(p<56320){r[u++]=239,r[u++]=191,r[u++]=189,f=p;continue}p=f-55296<<10|p-56320|65536,f=null}else f&&(r[u++]=239,r[u++]=191,r[u++]=189,f=null);p<128?r[u++]=p:(p<2048?r[u++]=p>>6|192:(p<65536?r[u++]=p>>12|224:(r[u++]=p>>18|240,r[u++]=p>>12&63|128),r[u++]=p>>6&63|128),r[u++]=63&p|128)}return u}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&Ym(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Xm(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Xm(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var r=this.pos-n;r>=128&&Ym(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(i,e,n){this.writeTag(i,ei.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Xx,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Wx,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Kx,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Hx,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Yx,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Jx,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Qx,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,ev,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,tv,e)},writeBytesField:function(i,e){this.writeTag(i,ei.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,ei.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,ei.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,ei.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,ei.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,ei.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,ei.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,ei.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,ei.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,ei.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class fd{constructor(e,{pixelRatio:n,version:r,stretchX:a,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=a,this.stretchY=u,this.content=p,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Jm{constructor(e,n){const r={},a={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,r,u),this.addImages(n,a,u);const{w:p,h:f}=dd(u),g=new mn({width:p||1,height:f||1});for(const v in e){const T=e[v],S=r[v].paddedRect;mn.copy(T.data,g,{x:0,y:0},{x:S.x+1,y:S.y+1},T.data)}for(const v in n){const T=n[v],S=a[v].paddedRect,M=S.x+1,P=S.y+1,F=T.data.width,V=T.data.height;mn.copy(T.data,g,{x:0,y:0},{x:M,y:P},T.data),mn.copy(T.data,g,{x:0,y:V-1},{x:M,y:P-1},{width:F,height:1}),mn.copy(T.data,g,{x:0,y:0},{x:M,y:P+V},{width:F,height:1}),mn.copy(T.data,g,{x:F-1,y:0},{x:M-1,y:P},{width:1,height:V}),mn.copy(T.data,g,{x:0,y:0},{x:M+F,y:P},{width:1,height:V})}this.image=g,this.iconPositions=r,this.patternPositions=a}addImages(e,n,r){for(const a in e){const u=e[a],p={x:0,y:0,w:u.data.width+2,h:u.data.height+2};r.push(p),n[a]=new fd(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>e.hasImage(r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),n),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),n)}patchUpdatedImage(e,n,r){if(!e||!n||e.version===n.version)return;e.version=n.version;const[a,u]=e.tl;r.update(n.data,void 0,{x:a,y:u})}}et(fd,"ImagePosition"),et(Jm,"ImageAtlas");const Dn={horizontal:1,vertical:2,horizontalOnly:3};class gc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const r=new gc;return r.scale=e||1,r.fontStack=n,r}static forImage(e){const n=new gc;return n.imageName=e,n}}class Ga{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const r=new Ga;for(let a=0;a<e.sections.length;a++){const u=e.sections[a];u.image?r.addImageSection(u):r.addTextSection(u,n)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,r){let a="";for(let u=0;u<n.length;u++){const p=n.charCodeAt(u+1)||null,f=n.charCodeAt(u-1)||null;a+=!r&&(p&&Ca(p)&&!mc[n[u+1]]||f&&Ca(f)&&!mc[n[u-1]])||!mc[n[u]]?n[u]:mc[n[u]]}return a}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&ph[this.text.charCodeAt(r)];r++)e++;let n=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&ph[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const r=new Ga;return r.text=this.text.substring(e,n),r.sectionIndex=this.sectionIndex.slice(e,n),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(gc.forText(e.scale,e.fontStack||n));const r=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(r)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Ct("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(gc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Ct("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function md(i,e,n,r,a,u,p,f,g,v,T,S,M,P,F,V){const q=Ga.fromFeature(i,a);let Y;S===Dn.vertical&&q.verticalizePunctuation(M);const{processBidirectionalText:oe,processStyledBidirectionalText:le}=pn;if(oe&&q.sections.length===1){Y=[];const pe=oe(q.toString(),_d(q,v,u,e,r,P,F));for(const Te of pe){const Se=new Ga;Se.text=Te,Se.sections=q.sections;for(let ze=0;ze<Te.length;ze++)Se.sectionIndex.push(0);Y.push(Se)}}else if(le){Y=[];const pe=le(q.text,q.sectionIndex,_d(q,v,u,e,r,P,F));for(const Te of pe){const Se=new Ga;Se.text=Te[0],Se.sectionIndex=Te[1],Se.sections=q.sections,Y.push(Se)}}else Y=function(pe,Te){const Se=[],ze=pe.text;let De=0;for(const be of Te)Se.push(pe.substring(De,be)),De=be;return De<ze.length&&Se.push(pe.substring(De,ze.length)),Se}(q,_d(q,v,u,e,r,P,F));const ue=[],he={positionedLines:ue,text:q.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(pe,Te,Se,ze,De,be,Ce,Re,$e,Oe,Ve,bt){let kt=0,wt=0,Mt=0;const at=Re==="right"?1:Re==="left"?0:.5;let Qe=!1;for(const Xt of De){const Ft=Xt.getSections();for(const Jt of Ft){if(Jt.imageName)continue;const hi=Te[Jt.fontStack];if(hi&&(Qe=hi.ascender!==void 0&&hi.descender!==void 0,!Qe))break}if(!Qe)break}let Lt=0;for(const Xt of De){Xt.trim();const Ft=Xt.getMaxScale(),Jt=(Ft-1)*Oi,hi={positionedGlyphs:[],lineOffset:0};pe.positionedLines[Lt]=hi;const mi=hi.positionedGlyphs;let Si=0;if(!Xt.length()){wt+=be,++Lt;continue}let Ii=0,yn=0;for(let Qt=0;Qt<Xt.length();Qt++){const qi=Xt.getSection(Qt),xn=Xt.getSectionIndex(Qt),Pi=Xt.getCharCode(Qt);let Ci=qi.scale,oi=null,ni=null,sn=null,Xi=Oi,vi=0;const Wi=!($e===Dn.horizontal||!Ve&&!Ia(Pi)||Ve&&(ph[Pi]||(qt=Pi,Pu(qt)||Ta(qt)||Ts(qt)||ql(qt)||Aa(qt))));if(qi.imageName){const Vi=ze[qi.imageName];if(!Vi)continue;sn=qi.imageName,pe.iconsInText=pe.iconsInText||!0,ni=Vi.paddedRect;const zi=Vi.displaySize;Ci=Ci*Oi/bt,oi={width:zi[0],height:zi[1],left:1,top:-3,advance:Wi?zi[1]:zi[0],localGlyph:!1},vi=Qe?-oi.height*Ci:Ft*Oi-17-zi[1]*Ci,Xi=oi.advance;const jn=(Wi?zi[0]:zi[1])*Ci-Oi*Ft;jn>0&&jn>Si&&(Si=jn)}else{const Vi=Se[qi.fontStack];if(!Vi)continue;Vi[Pi]&&(ni=Vi[Pi]);const zi=Te[qi.fontStack];if(!zi)continue;const jn=zi.glyphs[Pi];if(!jn)continue;if(oi=jn.metrics,Xi=Pi!==8203?Oi:0,Qe){const Yo=zi.ascender!==void 0?Math.abs(zi.ascender):0,Mc=zi.descender!==void 0?Math.abs(zi.descender):0,Ic=(Yo+Mc)*Ci;Ii<Ic&&(Ii=Ic,yn=(Yo-Mc)/2*Ci),vi=-Yo*Ci}else vi=(Ft-Ci)*Oi-17}Wi?(pe.verticalizable=!0,mi.push({glyph:Pi,imageName:sn,x:kt,y:wt+vi,vertical:Wi,scale:Ci,localGlyph:oi.localGlyph,fontStack:qi.fontStack,sectionIndex:xn,metrics:oi,rect:ni}),kt+=Xi*Ci+Oe):(mi.push({glyph:Pi,imageName:sn,x:kt,y:wt+vi,vertical:Wi,scale:Ci,localGlyph:oi.localGlyph,fontStack:qi.fontStack,sectionIndex:xn,metrics:oi,rect:ni}),kt+=oi.advance*Ci+Oe)}mi.length!==0&&(Mt=Math.max(kt-Oe,Mt),Qe?n_(mi,at,Si,yn,be*Ft/2):n_(mi,at,Si,0,be/2)),kt=0;const on=be*Ft+Si;hi.lineOffset=Math.max(Si,Jt),wt+=on,++Lt}var qt;const Ti=wt,{horizontalAlign:ii,verticalAlign:Ei}=gd(Ce);(function(Xt,Ft,Jt,hi,mi,Si){const Ii=(Ft-Jt)*mi,yn=-Si*hi;for(const on of Xt)for(const Qt of on.positionedGlyphs)Qt.x+=Ii,Qt.y+=yn})(pe.positionedLines,at,ii,Ei,Mt,Ti),pe.top+=-Ei*Ti,pe.bottom=pe.top+Ti,pe.left+=-ii*Mt,pe.right=pe.left+Mt,pe.hasBaseline=Qe}(he,e,n,r,Y,p,f,g,S,v,M,V),!function(pe){for(const Te of pe)if(Te.positionedGlyphs.length!==0)return!1;return!0}(ue)&&he}const ph={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ov={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Qm(i,e,n,r,a,u){if(e.imageName){const p=r[e.imageName];return p?p.displaySize[0]*e.scale*Oi/u+a:0}{const p=n[e.fontStack],f=p&&p.glyphs[i];return f?f.metrics.advance*e.scale+a:0}}function e_(i,e,n,r){const a=Math.pow(i-e,2);return r?i<e?a/2:2*a:a+Math.abs(n)*n}function sv(i,e,n){let r=0;return i===10&&(r-=1e4),n&&(r+=150),i!==40&&i!==65288||(r+=50),e!==41&&e!==65289||(r+=50),r}function t_(i,e,n,r,a,u){let p=null,f=e_(e,n,a,u);for(const g of r){const v=e_(e-g.x,n,a,u)+g.badness;v<=f&&(p=g,f=v)}return{index:i,x:e,priorBreak:p,badness:f}}function i_(i){return i?i_(i.priorBreak).concat(i.index):[]}function _d(i,e,n,r,a,u,p){if(u!=="point")return[];if(!i)return[];const f=[],g=function(M,P,F,V,q,Y){let oe=0;for(let le=0;le<M.length();le++){const ue=M.getSection(le);oe+=Qm(M.getCharCode(le),ue,V,q,P,Y)}return oe/Math.max(1,Math.ceil(oe/F))}(i,e,n,r,a,p),v=i.text.indexOf("\u200B")>=0;let T=0;for(let M=0;M<i.length();M++){const P=i.getSection(M),F=i.getCharCode(M);if(ph[F]||(T+=Qm(F,P,r,a,e,p)),M<i.length()-1){const V=!((S=F)<11904||!(Ru(S)||Lu(S)||Ro(S)||Ss(S)||Ou(S)||$l(S)||Bu(S)||Ea(S)||Nu(S)||Zl(S)||Fu(S)||Xl(S)||Es(S)||jl(S)||Du(S)||Gl(S)||Sa(S)||ju(S)||Vu(S)||Uu(S)));(ov[F]||V||P.imageName)&&f.push(t_(M+1,T,g,f,sv(F,i.getCharCode(M+1),V&&v),!1))}}var S;return i_(t_(i.length(),T,g,f,0,!0))}function gd(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function n_(i,e,n,r,a){if(!(e||n||r||a))return;const u=i.length-1,p=i[u],f=(p.x+p.metrics.advance*p.scale)*e;for(let g=0;g<=u;g++)i[g].x-=f,i[g].y+=n+r+a}function av(i,e,n){const{horizontalAlign:r,verticalAlign:a}=gd(n),u=e[0]-i.displaySize[0]*r,p=e[1]-i.displaySize[1]*a;return{image:i,top:p,bottom:p+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function r_(i,e,n,r,a,u){const p=i.image;let f;if(p.content){const q=p.content,Y=p.pixelRatio||1;f=[q[0]/Y,q[1]/Y,p.displaySize[0]-q[2]/Y,p.displaySize[1]-q[3]/Y]}const g=e.left*u,v=e.right*u;let T,S,M,P;n==="width"||n==="both"?(P=a[0]+g-r[3],S=a[0]+v+r[1]):(P=a[0]+(g+v-p.displaySize[0])/2,S=P+p.displaySize[0]);const F=e.top*u,V=e.bottom*u;return n==="height"||n==="both"?(T=a[1]+F-r[0],M=a[1]+V+r[2]):(T=a[1]+(F+V-p.displaySize[1])/2,M=T+p.displaySize[1]),{image:p,top:T,right:S,bottom:M,left:P,collisionPadding:f}}class uo extends D{constructor(e,n,r,a,u){super(e,n),this.angle=a,this.z=r,u!==void 0&&(this.segment=u)}clone(){return new uo(this.x,this.y,this.z,this.angle,this.segment)}}function o_(i,e,n,r,a){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,f=0;for(;f>-n/2;){if(p--,p<0)return!1;f-=i[p].dist(u),u=i[p]}f+=i[p].dist(i[p+1]),p++;const g=[];let v=0;for(;f<n/2;){const T=i[p],S=i[p+1];if(!S)return!1;let M=i[p-1].angleTo(T)-T.angleTo(S);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:f,angleDelta:M}),v+=M;f-g[0].distance>r;)v-=g.shift().angleDelta;if(v>a)return!1;p++,f+=T.dist(S)}return!0}function s_(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function a_(i,e,n){return i?.6*e*n:0}function l_(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function lv(i,e,n,r,a,u){const p=a_(n,a,u),f=l_(n,r)*u;let g=0;const v=s_(i)/2;for(let T=0;T<i.length-1;T++){const S=i[T],M=i[T+1],P=S.dist(M);if(g+P>v){const F=(v-g)/P,V=pt(S.x,M.x,F),q=pt(S.y,M.y,F),Y=new uo(V,q,0,M.angleTo(S),T);return!p||o_(i,Y,f,p,e)?Y:void 0}g+=P}}function cv(i,e,n,r,a,u,p,f,g){const v=a_(r,u,p),T=l_(r,a),S=T*p,M=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return e-S<e/4&&(e=S+e/4),c_(i,M?e/2*f%e:(T/2+2*u)*p*f%e,e,v,n,S,M,!1,g)}function c_(i,e,n,r,a,u,p,f,g){const v=u/2,T=s_(i);let S=0,M=e-n,P=[];for(let F=0;F<i.length-1;F++){const V=i[F],q=i[F+1],Y=V.dist(q),oe=q.angleTo(V);for(;M+n<S+Y;){M+=n;const le=(M-S)/Y,ue=pt(V.x,q.x,le),he=pt(V.y,q.y,le);if(ue>=0&&ue<g&&he>=0&&he<g&&M-v>=0&&M+v<=T){const pe=new uo(ue,he,0,oe,F);pe._round(),r&&!o_(i,pe,u,r,a)||P.push(pe)}}S+=Y}return f||P.length||p||(P=c_(i,S/2,n,r,a,u,p,!0,g)),P}function u_(i,e,n,r,a){const u=[];for(let p=0;p<i.length;p++){const f=i[p];let g;for(let v=0;v<f.length-1;v++){let T=f[v],S=f[v+1];T.x<e&&S.x<e||(T.x<e?T=new D(e,T.y+(e-T.x)/(S.x-T.x)*(S.y-T.y))._round():S.x<e&&(S=new D(e,T.y+(e-T.x)/(S.x-T.x)*(S.y-T.y))._round()),T.y<n&&S.y<n||(T.y<n?T=new D(T.x+(n-T.y)/(S.y-T.y)*(S.x-T.x),n)._round():S.y<n&&(S=new D(T.x+(n-T.y)/(S.y-T.y)*(S.x-T.x),n)._round()),T.x>=r&&S.x>=r||(T.x>=r?T=new D(r,T.y+(r-T.x)/(S.x-T.x)*(S.y-T.y))._round():S.x>=r&&(S=new D(r,T.y+(r-T.x)/(S.x-T.x)*(S.y-T.y))._round()),T.y>=a&&S.y>=a||(T.y>=a?T=new D(T.x+(a-T.y)/(S.y-T.y)*(S.x-T.x),a)._round():S.y>=a&&(S=new D(T.x+(a-T.y)/(S.y-T.y)*(S.x-T.x),a)._round()),g&&T.equals(g[g.length-1])||(g=[T],u.push(g)),g.push(S)))))}}return u}et(uo,"Anchor");const yc=1e20;function h_(i,e,n,r,a,u,p,f,g){for(let v=e;v<e+r;v++)p_(i,n*u+v,u,a,p,f,g);for(let v=n;v<n+a;v++)p_(i,v*u+e,1,r,p,f,g)}function p_(i,e,n,r,a,u,p){u[0]=0,p[0]=-yc,p[1]=yc,a[0]=i[e];for(let f=1,g=0,v=0;f<r;f++){a[f]=i[e+f*n];const T=f*f;do{const S=u[g];v=(a[f]-a[S]+T-S*S)/(f-S)/2}while(v<=p[g]&&--g>-1);g++,u[g]=f,p[g]=v,p[g+1]=yc}for(let f=0,g=0;f<r;f++){for(;p[g+1]<f;)g++;const v=u[g],T=f-v;i[e+f*n]=a[v]+T*T}}const yd={none:0,ideographs:1,all:2};class Za{constructor(e,n,r){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const r=[];for(const a in e)for(const u of e[a])r.push({stack:a,id:u});xt(r,({stack:a,id:u},p)=>{let f=this.entries[a];f||(f=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let g=f.glyphs[u];if(g!==void 0)return void p(null,{stack:a,id:u,glyph:g});if(g=this._tinySDF(f,a,u),g)return f.glyphs[u]=g,void p(null,{stack:a,id:u,glyph:g});const v=Math.floor(u/256);if(256*v>65535)return void p(new Error("glyphs > 65535 not supported"));if(f.ranges[v])return void p(null,{stack:a,id:u,glyph:g});let T=f.requests[v];T||(T=f.requests[v]=[],Za.loadGlyphRange(a,v,this.url,this.requestManager,(S,M)=>{if(M){f.ascender=M.ascender,f.descender=M.descender;for(const P in M.glyphs)this._doesCharSupportLocalGlyph(+P)||(f.glyphs[+P]=M.glyphs[+P]);f.ranges[v]=!0}for(const P of T)P(S,M);delete f.requests[v]})),T.push((S,M)=>{S?p(S):M&&p(null,{stack:a,id:u,glyph:M.glyphs[u]||null})})},(a,u)=>{if(a)n(a);else if(u){const p={};for(const{stack:f,id:g,glyph:v}of u)p[f]===void 0&&(p[f]={}),p[f].glyphs===void 0&&(p[f].glyphs={}),p[f].glyphs[g]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics},p[f].ascender=this.entries[f].ascender,p[f].descender=this.entries[f].descender;n(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==yd.none&&(this.localGlyphMode===yd.all?!!this.localFontFamily:!!this.localFontFamily&&(Zl(e)||$u(e)||Es(e)||Sa(e)||Ea(e)))}_tinySDF(e,n,r){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(r))return;let u=e.tinySDF;if(!u){let V="400";/bold/i.test(n)?V="900":/medium/i.test(n)?V="500":/light/i.test(n)&&(V="200"),u=e.tinySDF=new Za.TinySDF({fontFamily:a,fontWeight:V,fontSize:48,buffer:6,radius:16}),u.fontWeight=V}if(this.localGlyphs[u.fontWeight][r])return this.localGlyphs[u.fontWeight][r];const p=String.fromCharCode(r),{data:f,width:g,height:v,glyphWidth:T,glyphHeight:S,glyphLeft:M,glyphTop:P,glyphAdvance:F}=u.draw(p);return this.localGlyphs[u.fontWeight][r]={id:r,bitmap:new lo({width:g,height:v},f),metrics:{width:T/2,height:S/2,left:M/2,top:P/2-27,advance:F/2,localGlyph:!0}}}}function d_(i,e,n,r){const a=[],u=i.image,p=u.pixelRatio,f=u.paddedRect.w-2,g=u.paddedRect.h-2,v=i.right-i.left,T=i.bottom-i.top,S=u.stretchX||[[0,f]],M=u.stretchY||[[0,g]],P=(be,Ce)=>be+Ce[1]-Ce[0],F=S.reduce(P,0),V=M.reduce(P,0),q=f-F,Y=g-V;let oe=0,le=F,ue=0,he=V,pe=0,Te=q,Se=0,ze=Y;if(u.content&&r){const be=u.content;oe=dh(S,0,be[0]),ue=dh(M,0,be[1]),le=dh(S,be[0],be[2]),he=dh(M,be[1],be[3]),pe=be[0]-oe,Se=be[1]-ue,Te=be[2]-be[0]-le,ze=be[3]-be[1]-he}const De=(be,Ce,Re,$e)=>{const Oe=fh(be.stretch-oe,le,v,i.left),Ve=mh(be.fixed-pe,Te,be.stretch,F),bt=fh(Ce.stretch-ue,he,T,i.top),kt=mh(Ce.fixed-Se,ze,Ce.stretch,V),wt=fh(Re.stretch-oe,le,v,i.left),Mt=mh(Re.fixed-pe,Te,Re.stretch,F),at=fh($e.stretch-ue,he,T,i.top),Qe=mh($e.fixed-Se,ze,$e.stretch,V),Lt=new D(Oe,bt),qt=new D(wt,bt),Ti=new D(wt,at),ii=new D(Oe,at),Ei=new D(Ve/p,kt/p),Xt=new D(Mt/p,Qe/p),Ft=e*Math.PI/180;if(Ft){const mi=Math.sin(Ft),Si=Math.cos(Ft),Ii=[Si,-mi,mi,Si];Lt._matMult(Ii),qt._matMult(Ii),ii._matMult(Ii),Ti._matMult(Ii)}const Jt=be.stretch+be.fixed,hi=Ce.stretch+Ce.fixed;return{tl:Lt,tr:qt,bl:ii,br:Ti,tex:{x:u.paddedRect.x+1+Jt,y:u.paddedRect.y+1+hi,w:Re.stretch+Re.fixed-Jt,h:$e.stretch+$e.fixed-hi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ei,pixelOffsetBR:Xt,minFontScaleX:Te/p/v,minFontScaleY:ze/p/T,isSDF:n}};if(r&&(u.stretchX||u.stretchY)){const be=f_(S,q,F),Ce=f_(M,Y,V);for(let Re=0;Re<be.length-1;Re++){const $e=be[Re],Oe=be[Re+1];for(let Ve=0;Ve<Ce.length-1;Ve++)a.push(De($e,Ce[Ve],Oe,Ce[Ve+1]))}}else a.push(De({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:g+1}));return a}function dh(i,e,n){let r=0;for(const a of i)r+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]));return r}function f_(i,e,n){const r=[{fixed:-1,stretch:0}];for(const[a,u]of i){const p=r[r.length-1];r.push({fixed:a-p.stretch,stretch:p.stretch}),r.push({fixed:a-p.stretch,stretch:p.stretch+(u-a)})}return r.push({fixed:e+1,stretch:n}),r}function fh(i,e,n,r){return i/e*n+r}function mh(i,e,n,r){return i-e*n/r}function uv(i,e,n,r){const a=e+i.positionedLines[r].lineOffset;return r===0?n+a/2:n+(a+(e+i.positionedLines[r-1].lineOffset))/2}Za.loadGlyphRange=function(i,e,n,r,a){const u=256*e,p=u+255,f=r.transformRequest(r.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${u}-${p}`),K.Glyphs);ne(f,(g,v)=>{if(g)a(g);else if(v){const T={},S=function(M){return new _c(M).readFields(iv,{})}(v);for(const M of S.glyphs)T[M.id]=M;a(null,{glyphs:T,ascender:S.ascender,descender:S.descender})}})},Za.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:n=8,cutoff:r=.25,fontFamily:a="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}){this.buffer=e,this.cutoff=r,this.radius=n;const f=this.size=i+4*e,g=this._createCanvas(f),v=this.ctx=g.getContext("2d",{willReadFrequently:!0});v.font=`${p} ${u} ${i}px ${a}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:a,actualBoundingBoxRight:u}=this.ctx.measureText(i),p=Math.floor(n),f=Math.min(this.size-this.buffer,Math.ceil(u-a)),g=Math.min(this.size-this.buffer,Math.ceil(n)+Math.ceil(r)),v=f+2*this.buffer,T=g+2*this.buffer,S=v*T,M=new Uint8ClampedArray(S),P={data:M,width:v,height:T,glyphWidth:f,glyphHeight:g,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(f===0||g===0)return P;const{ctx:F,buffer:V,gridInner:q,gridOuter:Y}=this;F.clearRect(V,V,f,g),F.fillText(i,V,V+p+1);const oe=F.getImageData(V,V,f,g);Y.fill(yc,0,S),q.fill(0,0,S);for(let le=0;le<g;le++)for(let ue=0;ue<f;ue++){const he=oe.data[4*(le*f+ue)+3]/255;if(he===0)continue;const pe=(le+V)*v+ue+V;if(he===1)Y[pe]=0,q[pe]=yc;else{const Te=.5-he;Y[pe]=Te>0?Te*Te:0,q[pe]=Te<0?Te*Te:0}}h_(Y,0,0,v,T,v,this.f,this.v,this.z),h_(q,V,V,f,g,v,this.f,this.v,this.z);for(let le=0;le<S;le++){const ue=Math.sqrt(Y[le])-Math.sqrt(q[le]);M[le]=Math.round(255-255*(ue/this.radius+this.cutoff))}return P}};class hv{constructor(e=[],n=pv){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:r}=this,a=n[e];for(;e>0;){const u=e-1>>1,p=n[u];if(r(a,p)>=0)break;n[e]=p,e=u}n[e]=a}_down(e){const{data:n,compare:r}=this,a=this.length>>1,u=n[e];for(;e<a;){let p=1+(e<<1),f=n[p];const g=p+1;if(g<this.length&&r(n[g],f)<0&&(p=g,f=n[g]),r(f,u)>=0)break;n[e]=f,e=p}n[e]=u}}function pv(i,e){return i<e?-1:i>e?1:0}function dv(i,e=1,n=!1){let r=1/0,a=1/0,u=-1/0,p=-1/0;const f=i[0];for(let P=0;P<f.length;P++){const F=f[P];(!P||F.x<r)&&(r=F.x),(!P||F.y<a)&&(a=F.y),(!P||F.x>u)&&(u=F.x),(!P||F.y>p)&&(p=F.y)}const g=Math.min(u-r,p-a);let v=g/2;const T=new hv([],fv);if(g===0)return new D(r,a);for(let P=r;P<u;P+=g)for(let F=a;F<p;F+=g)T.push(new qa(P+v,F+v,v,i));let S=function(P){let F=0,V=0,q=0;const Y=P[0];for(let oe=0,le=Y.length,ue=le-1;oe<le;ue=oe++){const he=Y[oe],pe=Y[ue],Te=he.x*pe.y-pe.x*he.y;V+=(he.x+pe.x)*Te,q+=(he.y+pe.y)*Te,F+=3*Te}return new qa(V/F,q/F,0,P)}(i),M=T.length;for(;T.length;){const P=T.pop();(P.d>S.d||!S.d)&&(S=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,M)),P.max-S.d<=e||(v=P.h/2,T.push(new qa(P.p.x-v,P.p.y-v,v,i)),T.push(new qa(P.p.x+v,P.p.y-v,v,i)),T.push(new qa(P.p.x-v,P.p.y+v,v,i)),T.push(new qa(P.p.x+v,P.p.y+v,v,i)),M+=4)}return n&&(console.log(`num probes: ${M}`),console.log(`best distance: ${S.d}`)),S.p}function fv(i,e){return e.max-i.max}function qa(i,e,n,r){this.p=new D(i,e),this.h=n,this.d=function(a,u){let p=!1,f=1/0;for(let g=0;g<u.length;g++){const v=u[g];for(let T=0,S=v.length,M=S-1;T<S;M=T++){const P=v[T],F=v[M];P.y>a.y!=F.y>a.y&&a.x<(F.x-P.x)*(a.y-P.y)/(F.y-P.y)+P.x&&(p=!p),f=Math.min(f,um(a,P,F))}}return(p?1:-1)*Math.sqrt(f)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}const xd=Number.POSITIVE_INFINITY,mv=Math.sqrt(2);function m_(i,e){return e[1]!==xd?function(n,r,a){let u=0,p=0;switch(r=Math.abs(r),a=Math.abs(a),n){case"top-right":case"top-left":case"top":p=a-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-a}switch(n){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}return[u,p]}(i,e[0],e[1]):function(n,r){let a=0,u=0;r<0&&(r=0);const p=r/mv;switch(n){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-r;break;case"top":u=r-7}switch(n){case"top-right":case"bottom-right":a=-p;break;case"top-left":case"bottom-left":a=p;break;case"left":a=r;break;case"right":a=-r}return[a,u]}(i,e[0])}function _v(i,e,n,r,a,u,p,f,g,v){i.createArrays(),i.tilePixelRatio=Et/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const T=i.layers[0].layout,S=i.layers[0]._unevaluatedLayout._values,M={};if(i.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:q}=i.textSizeData;M.compositeTextSizes=[S["text-size"].possiblyEvaluate(new ti(V),f),S["text-size"].possiblyEvaluate(new ti(q),f)]}if(i.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:q}=i.iconSizeData;M.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new ti(V),f),S["icon-size"].possiblyEvaluate(new ti(q),f)]}M.layoutTextSize=S["text-size"].possiblyEvaluate(new ti(g+1),f),M.layoutIconSize=S["icon-size"].possiblyEvaluate(new ti(g+1),f),M.textMaxSize=S["text-size"].possiblyEvaluate(new ti(18),f);const P=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",F=T.get("text-size");for(const V of i.features){const q=T.get("text-font").evaluate(V,{},f).join(","),Y=F.evaluate(V,{},f),oe=M.layoutTextSize.evaluate(V,{},f),le=(M.layoutIconSize.evaluate(V,{},f),{horizontal:{},vertical:void 0}),ue=V.text;let he,pe=[0,0];if(ue){const ze=ue.toString(),De=T.get("text-letter-spacing").evaluate(V,{},f)*Oi,be=T.get("text-line-height").evaluate(V,{},f)*Oi,Ce=Zu(ze)?De:0,Re=T.get("text-anchor").evaluate(V,{},f),$e=T.get("text-variable-anchor");if(!$e){const Mt=T.get("text-radial-offset").evaluate(V,{},f);pe=Mt?m_(Re,[Mt*Oi,xd]):T.get("text-offset").evaluate(V,{},f).map(at=>at*Oi)}let Oe=P?"center":T.get("text-justify").evaluate(V,{},f);const Ve=T.get("symbol-placement"),bt=Ve==="point",kt=Ve==="point"?T.get("text-max-width").evaluate(V,{},f)*Oi:0,wt=Mt=>{i.allowVerticalPlacement&&Ma(ze)&&(le.vertical=md(ue,e,n,a,q,kt,be,Re,Mt,Ce,pe,Dn.vertical,!0,Ve,oe,Y))};if(!P&&$e){const Mt=Oe==="auto"?$e.map(Qe=>vd(Qe)):[Oe];let at=!1;for(let Qe=0;Qe<Mt.length;Qe++){const Lt=Mt[Qe];if(!le.horizontal[Lt])if(at)le.horizontal[Lt]=le.horizontal[0];else{const qt=md(ue,e,n,a,q,kt,be,"center",Lt,Ce,pe,Dn.horizontal,!1,Ve,oe,Y);qt&&(le.horizontal[Lt]=qt,at=qt.positionedLines.length===1)}}wt("left")}else{if(Oe==="auto"&&(Oe=vd(Re)),bt||T.get("text-writing-mode").indexOf("horizontal")>=0||!Ma(ze)){const Mt=md(ue,e,n,a,q,kt,be,Re,Oe,Ce,pe,Dn.horizontal,!1,Ve,oe,Y);Mt&&(le.horizontal[Oe]=Mt)}wt(Ve==="point"?"left":Oe)}}let Te=!1;if(V.icon&&V.icon.name){const ze=r[V.icon.name];ze&&(he=av(a[V.icon.name],T.get("icon-offset").evaluate(V,{},f),T.get("icon-anchor").evaluate(V,{},f)),Te=ze.sdf,i.sdfIcons===void 0?i.sdfIcons=ze.sdf:i.sdfIcons!==ze.sdf&&Ct("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ze.pixelRatio!==i.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Se=g_(le.horizontal)||le.vertical;i.iconsInText||(i.iconsInText=!!Se&&Se.iconsInText),(Se||he)&&gv(i,V,le,he,r,M,oe,0,pe,Te,p,f,v)}u&&i.generateCollisionDebugBuffers(g,i.collisionBoxArray)}function vd(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gv(i,e,n,r,a,u,p,f,g,v,T,S,M){let P=u.textMaxSize.evaluate(e,{},S);P===void 0&&(P=p);const F=i.layers[0].layout,V=F.get("icon-offset").evaluate(e,{},S),q=g_(n.horizontal)||n.vertical,Y=p/24,oe=i.tilePixelRatio*P/24,le=(be=i.overscaling,i.zoom>18&&be>2&&(be>>=1),Math.max(Et/(512*be),1)*F.get("symbol-spacing")),ue=F.get("text-padding")*i.tilePixelRatio,he=F.get("icon-padding")*i.tilePixelRatio,pe=ve(F.get("text-max-angle")),Te=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Se=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",ze=F.get("symbol-placement"),De=le/2;var be;const Ce=F.get("icon-text-fit");let Re;r&&Ce!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Re=r_(r,n.vertical,Ce,F.get("icon-text-fit-padding"),V,Y)),q&&(r=r_(r,q,Ce,F.get("icon-text-fit-padding"),V,Y)));const $e=(Oe,Ve,bt)=>{if(Ve.x<0||Ve.x>=Et||Ve.y<0||Ve.y>=Et)return;const{x:kt,y:wt,z:Mt}=M.projectTilePoint(Ve.x,Ve.y,bt),at=new uo(kt,wt,Mt,0,void 0);(function(Qe,Lt,qt,Ti,ii,Ei,Xt,Ft,Jt,hi,mi,Si,Ii,yn,on,Qt,qi,xn,Pi,Ci,oi,ni,sn,Xi,vi){const Wi=Qe.addToLineVertexArray(Lt,Ti);let Vi,zi,jn,Yo,Mc,Ic,Q_,eg=0,tg=0,ig=0,ng=0,Fd=-1,Od=-1;const kr={};let rg=Er(""),Nd=0,Ud=0;if(Jt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Nd,Ud]=Jt.layout.get("text-offset").evaluate(oi,{},vi).map(vn=>vn*Oi):(Nd=Jt.layout.get("text-radial-offset").evaluate(oi,{},vi)*Oi,Ud=xd),Qe.allowVerticalPlacement&&ii.vertical){const vn=ii.vertical;if(on)Ic=bd(vn),Ft&&(Q_=bd(Ft));else{const bn=Jt.layout.get("text-rotate").evaluate(oi,{},vi)+90;jn=_h(hi,qt,Lt,mi,Si,Ii,vn,yn,bn,Qt),Ft&&(Yo=_h(hi,qt,Lt,mi,Si,Ii,Ft,xn,bn))}}if(Ei){const vn=Jt.layout.get("icon-rotate").evaluate(oi,{},vi),bn=Jt.layout.get("icon-text-fit")!=="none",Cc=d_(Ei,vn,sn,bn),$d=Ft?d_(Ft,vn,sn,bn):void 0;zi=_h(hi,qt,Lt,mi,Si,Ii,Ei,xn,vn),eg=4*Cc.length;const og=Qe.iconSizeData;let Fs=null;og.kind==="source"?(Fs=[Mr*Jt.layout.get("icon-size").evaluate(oi,{},vi)],Fs[0]>Go&&Ct(`${Qe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):og.kind==="composite"&&(Fs=[Mr*ni.compositeIconSizes[0].evaluate(oi,{},vi),Mr*ni.compositeIconSizes[1].evaluate(oi,{},vi)],(Fs[0]>Go||Fs[1]>Go)&&Ct(`${Qe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Qe.addSymbols(Qe.icon,Cc,Fs,Ci,Pi,oi,!1,qt,Lt,Wi.lineStartIndex,Wi.lineLength,-1,Xi,vi),Fd=Qe.icon.placedSymbolArray.length-1,$d&&(tg=4*$d.length,Qe.addSymbols(Qe.icon,$d,Fs,Ci,Pi,oi,Dn.vertical,qt,Lt,Wi.lineStartIndex,Wi.lineLength,-1,Xi,vi),Od=Qe.icon.placedSymbolArray.length-1)}for(const vn in ii.horizontal){const bn=ii.horizontal[vn];Vi||(rg=Er(bn.text),on?Mc=bd(bn):Vi=_h(hi,qt,Lt,mi,Si,Ii,bn,yn,Jt.layout.get("text-rotate").evaluate(oi,{},vi),Qt));const Cc=bn.positionedLines.length===1;if(ig+=__(Qe,qt,Lt,bn,Xt,Jt,on,oi,Qt,Wi,ii.vertical?Dn.horizontal:Dn.horizontalOnly,Cc?Object.keys(ii.horizontal):[vn],kr,Fd,ni,Xi,vi),Cc)break}ii.vertical&&(ng+=__(Qe,qt,Lt,ii.vertical,Xt,Jt,on,oi,Qt,Wi,Dn.vertical,["vertical"],kr,Od,ni,Xi,vi));let Ko=-1;const Vd=(vn,bn)=>vn?Math.max(vn,bn):bn;Ko=Vd(Mc,Ko),Ko=Vd(Ic,Ko),Ko=Vd(Q_,Ko);const Kv=Ko>-1?1:0;Qe.glyphOffsetArray.length>=Zo.MAX_GLYPHS&&Ct("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),oi.sortKey!==void 0&&Qe.addToSortKeyRanges(Qe.symbolInstances.length,oi.sortKey),Qe.symbolInstances.emplaceBack(qt.x,qt.y,qt.z,Lt.x,Lt.y,kr.right>=0?kr.right:-1,kr.center>=0?kr.center:-1,kr.left>=0?kr.left:-1,kr.vertical>=0?kr.vertical:-1,Fd,Od,rg,Vi!==void 0?Vi:Qe.collisionBoxArray.length,Vi!==void 0?Vi+1:Qe.collisionBoxArray.length,jn!==void 0?jn:Qe.collisionBoxArray.length,jn!==void 0?jn+1:Qe.collisionBoxArray.length,zi!==void 0?zi:Qe.collisionBoxArray.length,zi!==void 0?zi+1:Qe.collisionBoxArray.length,Yo||Qe.collisionBoxArray.length,Yo?Yo+1:Qe.collisionBoxArray.length,mi,ig,ng,eg,tg,Kv,0,Nd,Ud,Ko)})(i,Ve,at,Oe,n,r,a,Re,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ue,Te,g,0,he,Se,V,e,u,v,T,S)};if(ze==="line")for(const Oe of u_(e.geometry,0,0,Et,Et)){const Ve=cv(Oe,le,pe,n.vertical||q,r,24,oe,i.overscaling,Et);for(const bt of Ve){const kt=q;kt&&yv(i,kt.text,De,bt)||$e(Oe,bt,S)}}else if(ze==="line-center"){for(const Oe of e.geometry)if(Oe.length>1){const Ve=lv(Oe,pe,n.vertical||q,r,24,oe);Ve&&$e(Oe,Ve,S)}}else if(e.type==="Polygon")for(const Oe of ld(e.geometry,0)){const Ve=dv(Oe,16);$e(Oe[0],new uo(Ve.x,Ve.y,0,0,void 0),S)}else if(e.type==="LineString")for(const Oe of e.geometry)$e(Oe,new uo(Oe[0].x,Oe[0].y,0,0,void 0),S);else if(e.type==="Point")for(const Oe of e.geometry)for(const Ve of Oe)$e([Ve],new uo(Ve.x,Ve.y,0,0,void 0),S)}const Go=32640;function __(i,e,n,r,a,u,p,f,g,v,T,S,M,P,F,V,q){const Y=function(ue,he,pe,Te,Se,ze,De,be){const Ce=[];if(he.positionedLines.length===0)return Ce;const Re=Te.layout.get("text-rotate").evaluate(ze,{})*Math.PI/180,$e=function(wt){const Mt=wt[0],at=wt[1],Qe=Mt*at;return Qe>0?[Mt,-at]:Qe<0?[-Mt,at]:Mt===0?[at,Mt]:[at,-Mt]}(pe);let Oe=Math.abs(he.top-he.bottom);for(const wt of he.positionedLines)Oe-=wt.lineOffset;const Ve=he.positionedLines.length,bt=Oe/Ve;let kt=he.top-pe[1];for(let wt=0;wt<Ve;++wt){const Mt=he.positionedLines[wt];kt=uv(he,bt,kt,wt);for(const at of Mt.positionedGlyphs){if(!at.rect)continue;const Qe=at.rect||{};let Lt=4,qt=!0,Ti=1,ii=0;if(at.imageName){const ni=De[at.imageName];if(!ni)continue;if(ni.sdf){Ct("SDF images are not supported in formatted text and will be ignored.");continue}qt=!1,Ti=ni.pixelRatio,Lt=1/Ti}const Ei=(Se||be)&&at.vertical,Xt=at.metrics.advance*at.scale/2,Ft=at.metrics,Jt=at.rect;if(Jt===null)continue;be&&he.verticalizable&&(ii=at.imageName?Xt-at.metrics.width*at.scale/2:0);const hi=Se?[at.x+Xt,at.y]:[0,0];let mi=[0,0],Si=[0,0],Ii=!1;Se||(Ei?(Si=[at.x+Xt+$e[0],at.y+$e[1]-ii],Ii=!0):mi=[at.x+Xt+pe[0],at.y+pe[1]-ii]);const yn=Jt.w*at.scale/(Ti*(at.localGlyph?2:1)),on=Jt.h*at.scale/(Ti*(at.localGlyph?2:1));let Qt,qi,xn,Pi;if(Ei){const ni=at.y-kt,sn=new D(-Xt,Xt-ni),Xi=-Math.PI/2,vi=new D(...Si);Qt=new D(-Xt+mi[0],mi[1]),Qt._rotateAround(Xi,sn)._add(vi),Qt.x+=-ni+Xt,Qt.y-=(Ft.left-Lt)*at.scale;const Wi=at.imageName?Ft.advance*at.scale:Oi*at.scale,Vi=String.fromCharCode(at.glyph);Zx(Vi)?Qt.x+=(1-Lt)*at.scale:qx(Vi)?Qt.x+=Wi-Ft.height*at.scale+(-Lt-1)*at.scale:Qt.x+=at.imageName||Ft.width+2*Lt===Jt.w&&Ft.height+2*Lt===Jt.h?(Wi-on)/2:(Wi-(Ft.height+2*Lt)*at.scale)/2,qi=new D(Qt.x,Qt.y-yn),xn=new D(Qt.x+on,Qt.y),Pi=new D(Qt.x+on,Qt.y-yn)}else{const ni=(Ft.left-Lt)*at.scale-Xt+mi[0],sn=(-Ft.top-Lt)*at.scale+mi[1],Xi=ni+yn,vi=sn+on;Qt=new D(ni,sn),qi=new D(Xi,sn),xn=new D(ni,vi),Pi=new D(Xi,vi)}if(Re){let ni;ni=Se?new D(0,0):Ii?new D($e[0],$e[1]):new D(pe[0],pe[1]),Qt._rotateAround(Re,ni),qi._rotateAround(Re,ni),xn._rotateAround(Re,ni),Pi._rotateAround(Re,ni)}const Ci=new D(0,0),oi=new D(0,0);Ce.push({tl:Qt,tr:qi,bl:xn,br:Pi,tex:Qe,writingMode:he.writingMode,glyphOffset:hi,sectionIndex:at.sectionIndex,isSDF:qt,pixelOffsetTL:Ci,pixelOffsetBR:oi,minFontScaleX:0,minFontScaleY:0})}}return Ce}(0,r,g,u,p,f,a,i.allowVerticalPlacement),oe=i.textSizeData;let le=null;oe.kind==="source"?(le=[Mr*u.layout.get("text-size").evaluate(f,{},q)],le[0]>Go&&Ct(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(le=[Mr*F.compositeTextSizes[0].evaluate(f,{},q),Mr*F.compositeTextSizes[1].evaluate(f,{},q)],(le[0]>Go||le[1]>Go)&&Ct(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,Y,le,g,p,f,T,e,n,v.lineStartIndex,v.lineLength,P,V,q);for(const ue of S)M[ue]=i.text.placedSymbolArray.length-1;return 4*Y.length}function g_(i){for(const e in i)return i[e];return null}function _h(i,e,n,r,a,u,p,f,g,v){let T=p.top,S=p.bottom,M=p.left,P=p.right;const F=p.collisionPadding;if(F&&(M-=F[0],T-=F[1],P+=F[2],S+=F[3]),g){const V=new D(M,T),q=new D(P,T),Y=new D(M,S),oe=new D(P,S),le=ve(g);let ue=new D(0,0);v&&(ue=new D(v[0],v[1])),V._rotateAround(le,ue),q._rotateAround(le,ue),Y._rotateAround(le,ue),oe._rotateAround(le,ue),M=Math.min(V.x,q.x,Y.x,oe.x),P=Math.max(V.x,q.x,Y.x,oe.x),T=Math.min(V.y,q.y,Y.y,oe.y),S=Math.max(V.y,q.y,Y.y,oe.y)}return i.emplaceBack(e.x,e.y,e.z,n.x,n.y,M,T,P,S,f,r,a,u),i.length-1}function bd(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function yv(i,e,n,r){const a=i.compareText;if(e in a){const u=a[e];for(let p=u.length-1;p>=0;p--)if(r.dist(u[p])<n)return!0}else a[e]=[];return a[e].push(r),!1}const xv=Ls.VectorTileFeature.types,vv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gh(i,e,n,r,a,u,p,f,g,v,T,S,M,P,F,V){const q=T?Math.min(Go,Math.round(T[0])):0,Y=T?Math.min(Go,Math.round(T[1])):0;i.emplaceBack(e,n,Math.round(32*p),Math.round(32*f),g,v,(q<<1)+(S?1:0),Y,16*M,16*P,256*F,256*V,r,a,u,0)}function wd(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function bv(i){for(const e of i.sections)if(Fp(e.text))return!0;return!1}class Td{constructor(e){this.layoutVertexArray=new Ee,this.indexArray=new tt,this.programConfigurations=e,this.segments=new fi,this.dynamicLayoutVertexArray=new Ne,this.opacityVertexArray=new _e,this.placedSymbolArray=new er}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,r,a){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ox.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Nx.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,vv,!0),this.opacityVertexBuffer.itemSize=1),(r||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}et(Td,"SymbolBuffers");class Ed{constructor(e,n,r){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new r,this.segments=new fi,this.collisionVertexArray=new Me,this.collisionVertexArrayExt=new Ne}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ux.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Vx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}et(Ed,"CollisionBuffers");class Zo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ar([]),this.placementViewportMatrix=Ar([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hd(this.zoom,n["text-size"]),this.iconSizeData=hd(this.zoom,n["icon-size"]);const r=this.layers[0].layout,a=r.get("symbol-sort-key"),u=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(p=>Dn[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Td(new zs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Td(new zs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Zt,this.lineVertexArray=new yi,this.symbolInstances=new di}calculateGlyphDependencies(e,n,r,a,u){for(let p=0;p<e.length;p++)if(n[e.charCodeAt(p)]=!0,a&&u){const f=mc[e.charAt(p)];f&&(n[f.charCodeAt(0)]=!0)}}populate(e,n,r,a){const u=this.layers[0],p=u.layout,f=p.get("text-font"),g=p.get("text-field"),v=p.get("icon-image"),T=(g.value.kind!=="constant"||g.value.value instanceof wi&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),S=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,M=p.get("symbol-sort-key");if(this.features=[],!T&&!S)return;const P=n.iconDependencies,F=n.glyphDependencies,V=n.availableImages,q=new ti(this.zoom);for(const{feature:Y,id:oe,index:le,sourceLayerIndex:ue}of e){const he=u._featureFilter.needGeometry,pe=ks(Y,he);if(!u._featureFilter.filter(q,pe,r))continue;let Te,Se;if(he||(pe.geometry=ao(Y,r,a)),T){const De=u.getValueAndResolveTokens("text-field",pe,r,V),be=wi.factory(De);bv(be)&&(this.hasRTLText=!0),(!this.hasRTLText||ka()==="unavailable"||this.hasRTLText&&pn.isParsed())&&(Te=Gx(be,u,pe))}if(S){const De=u.getValueAndResolveTokens("icon-image",pe,r,V);Se=De instanceof Yi?De:Yi.fromString(De)}if(!Te&&!Se)continue;const ze=this.sortFeaturesByKey?M.evaluate(pe,{},r):void 0;if(this.features.push({id:oe,text:Te,icon:Se,index:le,sourceLayerIndex:ue,geometry:pe.geometry,properties:Y.properties,type:xv[Y.type],sortKey:ze}),Se&&(P[Se.name]=!0),Te){const De=f.evaluate(pe,{},r).join(","),be=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dn.vertical)>=0;for(const Ce of Te.sections)if(Ce.image)P[Ce.image.name]=!0;else{const Re=Ma(Te.toString()),$e=Ce.fontStack||De,Oe=F[$e]=F[$e]||{};this.calculateGlyphDependencies(Ce.text,Oe,be,this.allowVerticalPlacement,Re)}}}p.get("symbol-placement")==="line"&&(this.features=function(Y){const oe={},le={},ue=[];let he=0;function pe(De){ue.push(Y[De]),he++}function Te(De,be,Ce){const Re=le[De];return delete le[De],le[be]=Re,ue[Re].geometry[0].pop(),ue[Re].geometry[0]=ue[Re].geometry[0].concat(Ce[0]),Re}function Se(De,be,Ce){const Re=oe[be];return delete oe[be],oe[De]=Re,ue[Re].geometry[0].shift(),ue[Re].geometry[0]=Ce[0].concat(ue[Re].geometry[0]),Re}function ze(De,be,Ce){const Re=Ce?be[0][be[0].length-1]:be[0][0];return`${De}:${Re.x}:${Re.y}`}for(let De=0;De<Y.length;De++){const be=Y[De],Ce=be.geometry,Re=be.text?be.text.toString():null;if(!Re){pe(De);continue}const $e=ze(Re,Ce),Oe=ze(Re,Ce,!0);if($e in le&&Oe in oe&&le[$e]!==oe[Oe]){const Ve=Se($e,Oe,Ce),bt=Te($e,Oe,ue[Ve].geometry);delete oe[$e],delete le[Oe],le[ze(Re,ue[bt].geometry,!0)]=bt,ue[Ve].geometry=null}else $e in le?Te($e,Oe,Ce):Oe in oe?Se($e,Oe,Ce):(pe(De),oe[$e]=he-1,le[Oe]=he-1)}return ue.filter(De=>De.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,oe)=>Y.sortKey-oe.sortKey)}update(e,n,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,r,a),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,r,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const r=this.lineVertexArray.length,a=e.segment;if(a!==void 0){let u=e.dist(n[a+1]),p=e.dist(n[a]);const f={};for(let g=a+1;g<n.length;g++)f[g]={x:n[g].x,y:n[g].y,tileUnitDistanceFromAnchor:u},g<n.length-1&&(u+=n[g+1].dist(n[g]));for(let g=a||0;g>=0;g--)f[g]={x:n[g].x,y:n[g].y,tileUnitDistanceFromAnchor:p},g>0&&(p+=n[g-1].dist(n[g]));for(let g=0;g<n.length;g++){const v=f[g];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,n,r,a,u,p,f,g,v,T,S,M,P,F){const V=e.indexArray,q=e.layoutVertexArray,Y=e.segments.prepareSegment(4*n.length,q,V,this.canOverlap?p.sortKey:void 0),oe=this.glyphOffsetArray.length,le=Y.vertexLength,ue=this.allowVerticalPlacement&&f===Dn.vertical?Math.PI/2:0,he=p.text&&p.text.sections;for(let pe=0;pe<n.length;pe++){const{tl:Te,tr:Se,bl:ze,br:De,tex:be,pixelOffsetTL:Ce,pixelOffsetBR:Re,minFontScaleX:$e,minFontScaleY:Oe,glyphOffset:Ve,isSDF:bt,sectionIndex:kt}=n[pe],wt=Y.vertexLength,Mt=Ve[1];gh(q,g.x,g.y,g.z,v.x,v.y,Te.x,Mt+Te.y,be.x,be.y,r,bt,Ce.x,Ce.y,$e,Oe),gh(q,g.x,g.y,g.z,v.x,v.y,Se.x,Mt+Se.y,be.x+be.w,be.y,r,bt,Re.x,Ce.y,$e,Oe),gh(q,g.x,g.y,g.z,v.x,v.y,ze.x,Mt+ze.y,be.x,be.y+be.h,r,bt,Ce.x,Re.y,$e,Oe),gh(q,g.x,g.y,g.z,v.x,v.y,De.x,Mt+De.y,be.x+be.w,be.y+be.h,r,bt,Re.x,Re.y,$e,Oe),wd(e.dynamicLayoutVertexArray,g,ue),V.emplaceBack(wt,wt+1,wt+2),V.emplaceBack(wt+1,wt+2,wt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ve[0]),pe!==n.length-1&&kt===n[pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,p,p.index,{},P,F,he&&he[kt])}e.placedSymbolArray.emplaceBack(g.x,g.y,g.z,v.x,v.y,oe,this.glyphOffsetArray.length-oe,le,T,S,v.segment,r?r[0]:0,r?r[1]:0,a[0],a[1],f,0,!1,0,M,0)}_commitLayoutVertex(e,n,r,a,u,p,f){e.emplaceBack(n,r,a,u,p,Math.round(f.x),Math.round(f.y))}_addCollisionDebugVertices(e,n,r,a,u,p,f){const g=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),v=g.vertexLength,T=f.tileAnchorX,S=f.tileAnchorY;for(let P=0;P<4;P++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,a,u,p,T,S,new D(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,a,u,p,T,S,new D(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,a,u,p,T,S,new D(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,a,u,p,T,S,new D(e.x1,e.y2)),g.vertexLength+=4;const M=r.indexArray;M.emplaceBack(v,v+1),M.emplaceBack(v+1,v+2),M.emplaceBack(v+2,v+3),M.emplaceBack(v+3,v),g.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,r,a,u,p){for(let f=a;f<u;f++){const g=r.get(f),v=this.getSymbolInstanceTextSize(e,p,n,f);this._addCollisionDebugVertices(g,v,this.textCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,r,a,u,p){for(let f=a;f<u;f++){const g=r.get(f),v=this.getSymbolInstanceIconSize(e,n,f);this._addCollisionDebugVertices(g,v,this.iconCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ed(Fe,Zm.members,gt),this.iconCollisionBox=new Ed(Fe,Zm.members,gt);const r=Va(this.iconSizeData,e),a=Va(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(a,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(a,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(r,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(r,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,r,a){const u=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:a),p=uh(this.textSizeData,e,u)/Oi;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,r){const a=this.icon.placedSymbolArray.get(r),u=uh(this.iconSizeData,e,a);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,n,r){e.emplaceBack(n,-r,-r),e.emplaceBack(n,r,-r),e.emplaceBack(n,r,r),e.emplaceBack(n,-r,r)}_updateTextDebugCollisionBoxes(e,n,r,a,u,p){for(let f=a;f<u;f++){const g=r.get(f),v=this.getSymbolInstanceTextSize(e,p,n,f);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,g.padding)}}_updateIconDebugCollisionBoxes(e,n,r,a,u){for(let p=a;p<u;p++){const f=r.get(p),g=this.getSymbolInstanceIconSize(e,n,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,g,f.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Va(this.iconSizeData,e),a=Va(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(a,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(a,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(r,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(r,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,r,a,u,p,f,g,v){const T={};for(let S=n;S<r;S++){const M=e.get(S);T.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.textFeatureIndex=M.featureIndex;break}for(let S=a;S<u;S++){const M=e.get(S);T.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.verticalTextFeatureIndex=M.featureIndex;break}for(let S=p;S<f;S++){const M=e.get(S);T.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.iconFeatureIndex=M.featureIndex;break}for(let S=g;S<v;S++){const M=e.get(S);T.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.verticalIconFeatureIndex=M.featureIndex;break}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const r=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const r=e.placedSymbolArray.get(n),a=r.vertexStartIndex+4*r.numGlyphs;for(let u=r.vertexStartIndex;u<a;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),r=Math.cos(e),a=[],u=[],p=[];for(let f=0;f<this.symbolInstances.length;++f){p.push(f);const g=this.symbolInstances.get(f);a.push(0|Math.round(n*g.tileAnchorX+r*g.tileAnchorY)),u.push(g.featureIndex)}return p.sort((f,g)=>a[f]-a[g]||u[g]-u[f]),p}addToSortKeyRanges(e,n){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===n?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const r=this.symbolInstances.get(n);this.featureSortOrder.push(r.featureIndex),[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((a,u,p)=>{a>=0&&p.indexOf(a)===u&&this.addIndicesForPlacedSymbol(this.text,a)}),r.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,r.verticalPlacedTextSymbolIndex),r.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.placedIconSymbolIndex),r.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}et(Zo,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Zo.MAX_GLYPHS=65535,Zo.addDynamicAttributes=wd;const wv=new R({"symbol-placement":new x(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new x(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new x(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new w(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new x(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new x(ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new x(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new x(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new x(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new w(ye.layout_symbol["icon-size"]),"icon-text-fit":new x(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new x(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new w(ye.layout_symbol["icon-image"]),"icon-rotate":new w(ye.layout_symbol["icon-rotate"]),"icon-padding":new x(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new x(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new w(ye.layout_symbol["icon-offset"]),"icon-anchor":new w(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new x(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new x(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new x(ye.layout_symbol["text-rotation-alignment"]),"text-field":new w(ye.layout_symbol["text-field"]),"text-font":new w(ye.layout_symbol["text-font"]),"text-size":new w(ye.layout_symbol["text-size"]),"text-max-width":new w(ye.layout_symbol["text-max-width"]),"text-line-height":new w(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new w(ye.layout_symbol["text-letter-spacing"]),"text-justify":new w(ye.layout_symbol["text-justify"]),"text-radial-offset":new w(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new x(ye.layout_symbol["text-variable-anchor"]),"text-anchor":new w(ye.layout_symbol["text-anchor"]),"text-max-angle":new x(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new x(ye.layout_symbol["text-writing-mode"]),"text-rotate":new w(ye.layout_symbol["text-rotate"]),"text-padding":new x(ye.layout_symbol["text-padding"]),"text-keep-upright":new x(ye.layout_symbol["text-keep-upright"]),"text-transform":new w(ye.layout_symbol["text-transform"]),"text-offset":new w(ye.layout_symbol["text-offset"]),"text-allow-overlap":new x(ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new x(ye.layout_symbol["text-ignore-placement"]),"text-optional":new x(ye.layout_symbol["text-optional"])});var Sd={paint:new R({"icon-opacity":new w(ye.paint_symbol["icon-opacity"]),"icon-color":new w(ye.paint_symbol["icon-color"]),"icon-halo-color":new w(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new w(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new w(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new x(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new x(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new w(ye.paint_symbol["text-opacity"]),"text-color":new w(ye.paint_symbol["text-color"],{runtimeType:Nn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new w(ye.paint_symbol["text-halo-color"]),"text-halo-width":new w(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new w(ye.paint_symbol["text-halo-blur"]),"text-translate":new x(ye.paint_symbol["text-translate"]),"text-translate-anchor":new x(ye.paint_symbol["text-translate-anchor"])}),layout:wv};class y_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Xn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}et(y_,"FormatSectionOverride",{omit:["defaultValue"]});class yh extends ir{constructor(e){super(e,Sd)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const a=[];for(const u of r)a.indexOf(u)<0&&a.push(u);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,r,a){const u=this.layout.get(e).evaluate(n,{},r,a),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ko(p.value)||!u?u:function(f,g){return g.replace(/{([^{}]+)}/g,(v,T)=>T in f?String(f[T]):"")}(n.properties,u)}createBucket(e){return new Zo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Sd.paint.overridableProperties){if(!yh.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),r=new y_(n),a=new ga(r,n.property.specification);let u=null;u=n.value.kind==="constant"||n.value.kind==="source"?new Pl("source",a):new Dl("composite",a,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new m(n.property,u,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&yh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const r=e.get("text-field"),a=Sd.paint.properties[n];let u=!1;const p=f=>{for(const g of f)if(a.overrides&&a.overrides.hasOverride(g))return void(u=!0)};if(r.value.kind==="constant"&&r.value.value instanceof wi)p(r.value.value.sections);else if(r.value.kind==="source"){const f=v=>{u||(v instanceof Hn&&gi(v.value)===To?p(v.value.sections):v instanceof Ao?p(v.sections):v.eachChild(f))},g=r.value;g._styleExpression&&f(g._styleExpression.expression)}return u}getProgramConfiguration(e){return new Uo(this,e)}}var Tv={paint:new R({"background-color":new x(ye.paint_background["background-color"]),"background-pattern":new I(ye.paint_background["background-pattern"]),"background-opacity":new x(ye.paint_background["background-opacity"])})},Ev={paint:new R({"raster-opacity":new x(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new x(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new x(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new x(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new x(ye.paint_raster["raster-saturation"]),"raster-contrast":new x(ye.paint_raster["raster-contrast"]),"raster-resampling":new x(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new x(ye.paint_raster["raster-fade-duration"])})};class Sv extends ir{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Av={paint:new R({"sky-type":new x(ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new x(ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new x(ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new x(ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new x(ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new z(ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new x(ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new x(ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new x(ye.paint_sky["sky-opacity"])})};function Ad(i,e,n){const r=[0,0,1],a=Em([]);return function(u,p,f){f*=.5;var g=p[0],v=p[1],T=p[2],S=p[3],M=Math.sin(f),P=Math.cos(f);u[0]=g*P-T*M,u[1]=v*P+S*M,u[2]=T*P+g*M,u[3]=S*P-v*M}(a,a,n?-ve(i)+Math.PI:ve(i)),Sm(a,a,-ve(e)),wm(r,r,a),rc(r,r)}const Mv={circle:class extends ir{constructor(i){super(i,q0)}createBucket(i){return new Zp(i)}queryRadius(i){const e=i;return Ba("circle-radius",this,e)+Ba("circle-stroke-width",this,e)+th(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,r,a,u,p,f){const g=fm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Am(i,r,u,p,f,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",g,v)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Uo(this,i)}},heatmap:class extends ir{createBucket(i){return new Im(i)}constructor(i){super(i,Q0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Ba("heatmap-radius",this,i)}queryIntersectsFeature(i,e,n,r,a,u,p,f){const g=this.paint.get("heatmap-radius").evaluate(e,n);return Am(i,r,u,p,f,!0,!0,new D(0,0),g)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Uo(this,i)}},hillshade:class extends ir{constructor(i){super(i,ex)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ir{constructor(i){super(i,gx)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(i){return new Uo(this,i)}recalculate(i,e){super.recalculate(i,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new ah(i)}queryRadius(){return th(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,r,a,u){return!i.queryGeometry.isAboveHorizon&&cm(dm(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends ir{constructor(i){super(i,Cx)}createBucket(i){return new dc(i)}queryRadius(){return th(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Uo(this,i)}queryIntersectsFeature(i,e,n,r,a,u,p,f,g){const v=fm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,n),S=this.paint.get("fill-extrusion-base").evaluate(e,n),M=[0,0],P=f&&u.elevation,F=u.elevation?u.elevation.exaggeration():1,V=i.tile.getBucket(this);if(P&&V instanceof dc){const oe=V.centroidVertexArray,le=g+1;if(le<oe.length){const ue=oe.get(le);M[0]=ue.a_centroid_pos0,M[1]=ue.a_centroid_pos1}}if(M[0]===0&&M[1]===1)return!1;const q=function(oe,le,ue,he,pe,Te,Se,ze,De){return Te?function(be,Ce,Re,$e,Oe,Ve,bt,kt,wt){const Mt=[],at=[],Qe=[0,0,0,1];for(const Lt of be){const qt=[],Ti=[];for(const ii of Lt){const Ei=ii.x+$e.x,Xt=ii.y+$e.y,Ft=zx(Ei,Xt,Ce,Re,Ve,bt,kt,wt);Qe[0]=Ei,Qe[1]=Xt,Qe[2]=Ft.base,Qe[3]=1,Oa(Qe,Qe,Oe),Qe[3]=Math.max(Qe[3],1e-5);const Jt=Vm([Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]]);Qe[0]=Ei,Qe[1]=Xt,Qe[2]=Ft.top,Qe[3]=1,Oa(Qe,Qe,Oe),Qe[3]=Math.max(Qe[3],1e-5);const hi=Vm([Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]]);qt.push(Jt),Ti.push(hi)}Mt.push(qt),at.push(Ti)}return[Mt,at]}(oe,le,ue,he,pe,Te,Se,ze,De):function(be,Ce,Re,$e,Oe){const Ve=[],bt=[],kt=Oe[8]*Ce,wt=Oe[9]*Ce,Mt=Oe[10]*Ce,at=Oe[11]*Ce,Qe=Oe[8]*Re,Lt=Oe[9]*Re,qt=Oe[10]*Re,Ti=Oe[11]*Re;for(const ii of be){const Ei=[],Xt=[];for(const Ft of ii){const Jt=Ft.x+$e.x,hi=Ft.y+$e.y,mi=Oe[0]*Jt+Oe[4]*hi+Oe[12],Si=Oe[1]*Jt+Oe[5]*hi+Oe[13],Ii=Oe[2]*Jt+Oe[6]*hi+Oe[14],yn=Oe[3]*Jt+Oe[7]*hi+Oe[15],on=mi+kt,Qt=Si+wt,qi=Ii+Mt,xn=Math.max(yn+at,1e-5),Pi=mi+Qe,Ci=Si+Lt,oi=Ii+qt,ni=Math.max(yn+Ti,1e-5),sn=new D(on/xn,Qt/xn);sn.z=qi/xn,Ei.push(sn);const Xi=new D(Pi/ni,Ci/ni);Xi.z=oi/ni,Xt.push(Xi)}Ve.push(Ei),bt.push(Xt)}return[Ve,bt]}(oe,le,ue,he,pe)}(r,S,T,v,p,P?f:null,M,F,u.center.lat),Y=i.queryGeometry;return function(oe,le,ue){let he=1/0;cm(ue,le)&&(he=Um(ue,le[0]));for(let pe=0;pe<le.length;pe++){const Te=le[pe],Se=oe[pe];for(let ze=0;ze<Te.length-1;ze++){const De=Te[ze],be=[De,Te[ze+1],Se[ze+1],Se[ze],De];lm(ue,be)&&(he=Math.min(he,Um(ue,be)))}}return he!==1/0&&he}(q[0],q[1],Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},line:class extends ir{constructor(i){super(i,$m),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ls,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=jm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new ch(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Uo(this,i)}queryRadius(i){const e=i,n=Gm(Ba("line-width",this,e),Ba("line-gap-width",this,e)),r=Ba("line-offset",this,e);return n/2+Math.abs(r)+th(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,r,a,u){if(i.queryGeometry.isAboveHorizon)return!1;const p=dm(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),f=i.pixelToTileUnitsFactor/2*Gm(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),g=this.paint.get("line-offset").evaluate(e,n);return g&&(r=function(v,T){const S=[],M=new D(0,0);for(let P=0;P<v.length;P++){const F=v[P],V=[];for(let q=0;q<F.length;q++){const Y=F[q-1],oe=F[q],le=F[q+1],ue=q===0?M:oe.sub(Y)._unit()._perp(),he=q===F.length-1?M:le.sub(oe)._unit()._perp(),pe=ue._add(he)._unit();pe._mult(1/(pe.x*he.x+pe.y*he.y)),V.push(pe._mult(T)._add(oe))}S.push(V)}return S}(r,g*i.pixelToTileUnitsFactor)),function(v,T,S){for(let M=0;M<T.length;M++){const P=T[M];if(v.length>=3){for(let F=0;F<P.length;F++)if(Ra(v,P[F]))return!0}if($0(v,P,S))return!0}return!1}(p,r,f)}isTileClipped(){return!0}},symbol:yh,background:class extends ir{constructor(i){super(i,Tv)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ir{constructor(i){super(i,Ev)}getProgramIds(){return["raster"]}},sky:class extends ir{constructor(i){super(i,Av),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=rd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),a=!r,u=i.style.light,p=u.properties.get("position");return a&&u.properties.get("anchor")==="viewport"&&Ct("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Ad(p.azimuthal,90-p.polar,e):Ad(r[0],90-r[1],e)}const n=this.paint.get("sky-gradient-center");return Ad(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class xc{constructor(e,n,r,a){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(n,a)}update(e,n,r){const{width:a,height:u}=e,{context:p}=this,{gl:f}=p,{HTMLImageElement:g,HTMLCanvasElement:v,HTMLVideoElement:T,ImageData:S,ImageBitmap:M}=J;if(f.bindTexture(f.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA&&(!n||n.premultiply!==!1)),r||this.size&&this.size[0]===a&&this.size[1]===u){const{x:P,y:F}=r||{x:0,y:0};e instanceof g||e instanceof v||e instanceof T||e instanceof S||M&&e instanceof M?f.texSubImage2D(f.TEXTURE_2D,0,P,F,f.RGBA,f.UNSIGNED_BYTE,e):f.texSubImage2D(f.TEXTURE_2D,0,P,F,a,u,f.RGBA,f.UNSIGNED_BYTE,e.data)}else this.size=[a,u],e instanceof g||e instanceof v||e instanceof T||e instanceof S||M&&e instanceof M?f.texImage2D(f.TEXTURE_2D,0,this.format,this.format,f.UNSIGNED_BYTE,e):f.texImage2D(f.TEXTURE_2D,0,this.format,a,u,0,this.format,f.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,n){const{context:r}=this,{gl:a}=r;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Md{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new lo({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const r=this.getKey(e,n);return this.positions[r]}trim(){const e=this.width,n=this.height=Be(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,r){const a=[];let u=e.length%2==1?-e[e.length-1]*r:0,p=e[0]*r,f=!0;a.push({left:u,right:p,isDash:f,zeroLength:e[0]===0});let g=e[0];for(let v=1;v<e.length;v++){f=!f;const T=e[v];u=g*r,g+=T,p=g*r,a.push({left:u,right:p,isDash:f,zeroLength:T===0})}return a}addRoundDash(e,n,r){const a=n/2;for(let u=-r;u<=r;u++){const p=this.width*(this.nextRow+r+u);let f=0,g=e[f];for(let v=0;v<this.width;v++){v/g.right>1&&(g=e[++f]);const T=Math.abs(v-g.left),S=Math.abs(v-g.right),M=Math.min(T,S);let P;const F=u/r*(a+1);if(g.isDash){const V=a-Math.abs(F);P=Math.sqrt(M*M+V*V)}else P=a-Math.sqrt(M*M+F*F);this.image.data[p+v]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let g=e.length-1;g>=0;--g){const v=e[g],T=e[g+1];v.zeroLength?e.splice(g,1):T&&T.isDash===v.isDash&&(T.left=v.left,e.splice(g,1))}const r=e[0],a=e[e.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);const u=this.width*this.nextRow;let p=0,f=e[p];for(let g=0;g<this.width;g++){g/f.right>1&&(f=e[++p]);const v=Math.abs(g-f.left),T=Math.abs(g-f.right),S=Math.min(v,T);this.image.data[u+g]=Math.max(0,Math.min(255,(f.isDash?S:-S)+n+128))}}addDash(e,n){const r=this.getKey(e,n);if(this.positions[r])return this.positions[r];const a=n==="round",u=a?7:0,p=2*u+1;if(this.nextRow+p>this.height)return Ct("LineAtlas out of space"),null;e.length===0&&e.push(1);let f=0;for(let T=0;T<e.length;T++)e[T]<0&&(Ct("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),f+=e[T];if(f!==0){const T=this.width/f,S=this.getDashRanges(e,this.width,T);a?this.addRoundDash(S,T,u):this.addRegularDash(S,n==="square"?.5*T:0)}const g=this.nextRow+u;this.nextRow+=p;const v={tl:[g,u],br:[f,0]};return this.positions[r]=v,v}}et(Md,"LineAtlas");class Iv{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const Cv=J.performance;function x_(i){const e=i?i.url.toString():void 0;return Cv.getEntriesByName(e)}class zv{constructor(){this.tasks={},this.taskQueue=[],Pt(["process"],this),this.invoker=new Iv(this.process),this.nextId=0}add(e,n){const r=this.nextId++,a=function({type:u,isSymbolTile:p,zoom:f}){return f=f||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-f:u==="maybePrepare"&&p?400-f:500:200-f:100-f}(n);if(a===0){Ni();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:n,priority:a,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Ni();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let a=0;a<this.taskQueue.length;a++){const u=this.tasks[this.taskQueue[a]];u.priority<n&&(n=u.priority,e=a)}if(e===null)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}const kv=ie([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),Pv=ie([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:v_}=kv,b_=ie([{name:"a_pos_3",components:3,type:"Int16"}]);var vc=ie([{name:"a_pos",type:"Int16",components:2}]);const Xa=Et/Math.PI/2,_n=-Xa,gn=Xa,Dv=[new Pn([_n,_n,_n],[gn,gn,gn]),new Pn([_n,_n,_n],[0,0,gn]),new Pn([0,_n,_n],[gn,0,gn]),new Pn([_n,0,_n],[0,gn,gn]),new Pn([0,0,_n],[gn,gn,gn])];class Lv{constructor(e,n,r){this.a=Fa([],e,r),this.b=Fa([],n,r),this.center=r;const a=rc([],this.a),u=rc([],this.b);this.angle=Math.acos(oc(a,u))}}function Id(i,e){if(i.angle===0)return null;let n;return n=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),n<0||n>1?null:function(r,a,u,p){const f=Math.sin(u);return r*(Math.sin((1-p)*u)/f)+a*(Math.sin(p*u)/f)}(i.a[e],i.b[e],i.angle,Ge(n,0,1))+i.center[e]}function bc(i){if(i.z<=1)return Dv[i.z+2*i.y+i.x];const[e,n]=Cd(i),r=[ho(e[0],e[1]),ho(e[0],n[1]),ho(n[0],e[1]),ho(n[0],n[1])],a=[gn,gn,gn],u=[_n,_n,_n];for(const p of r)a[0]=Math.min(a[0],p[0]),a[1]=Math.min(a[1],p[1]),a[2]=Math.min(a[2],p[2]),u[0]=Math.max(u[0],p[0]),u[1]=Math.max(u[1],p[1]),u[2]=Math.max(u[2],p[2]);return new Pn(a,u)}function Rv(i,e,n){const r=e/i.worldSize,a=(Ce,Re)=>{nc(Ce,Ce,r),nc(Re,Re,r)},u=Number.MAX_VALUE,p=[-u,-u,-u],f=[u,u,u],g=A_(i);if(n.z<=1){const Ce=bc(n).getCorners();for(let Re=0;Re<Ce.length;Re++)Ds(Ce[Re],Ce[Re],g),Qp(f,f,Ce[Re]),ed(p,p,Ce[Re]);return a(f,p),new Pn(f,p)}const[v,T]=Cd(n),S=new Vo;S.setSouthWest([v[1],T[0]]),S.setNorthEast([T[1],v[0]]);const M=[ho(S.getSouth(),S.getWest()),ho(S.getSouth(),S.getEast()),ho(S.getNorth(),S.getEast()),ho(S.getNorth(),S.getWest())];for(let Ce=0;Ce<M.length;Ce++)Ds(M[Ce],M[Ce],g),Qp(f,f,M[Ce]),ed(p,p,M[Ce]);if(S.contains(i.center))return p[2]=0,a(f,p),new Pn(f,p);const P=[g[12],g[13],g[14]],F=i.center.lng,V=Ge(i.center.lat,-85.051129,Sr),q=[tc(F),Da(V)],Y=S.getCenter().lng,oe=Ge(S.getCenter().lat,-85.051129,Sr),le=[tc(Y),Da(oe)];let ue=new Array(3),he=0;const pe=q[0]-le[0],Te=q[1]-le[1];if(Math.abs(pe)>Math.abs(Te))he=pe>=0?1:3,ue=P;else{he=Te>=0?0:2;const Ce=[g[4],g[5],g[6]];let Re;Re=Te>=0?-Math.sin(ve(S.getSouth()))*Xa:-Math.sin(ve(S.getNorth()))*Xa,ue=td(ue,P,Ce,Re)}const Se=M[he],ze=M[(he+1)%4],De=new Lv(Se,ze,ue),be=[Id(De,0)||Se[0],Id(De,1)||Se[1],Id(De,2)||Se[2]];return f[2]=Math.min(Se[2],ze[2]),Qp(f,f,be),ed(p,p,be),a(f,p),new Pn(f,p)}function Cd(i){const e=1<<i.z,n=i.x/e,r=(i.x+1)/e,a=(i.y+1)/e;return[[Fi(i.y/e),Vn(n)],[Fi(a),Vn(r)]]}function w_(i,e,n,r=Xa){return n=ve(n),[i*Math.sin(n)*r,-e*r,i*Math.cos(n)*r]}function ho(i,e,n){return w_(Math.cos(ve(i)),Math.sin(ve(i)),e,n)}function T_(i,e,n){const r=Math.pow(2,n.z),a=(i/Et+n.x)/r;return ho(Fi((e/Et+n.y)/r),Vn(a))}function zd(i){return 16383/Math.max(...Fa([],i.max,i.min))}function E_(i){const e=Ar(new Float64Array(16)),n=zd(i);var r,a;return $o(e,e,[n,n,n]),Ps(e,e,((r=[])[0]=-(a=i.min)[0],r[1]=-a[1],r[2]=-a[2],r)),e}function S_(i,e,n,r,a){const u=function(g){const v=Et/(2*Math.PI);return g/(2*Math.PI)/v}(n),p=[i,e,-n/(2*Math.PI)],f=Ar(new Float64Array(16));return Ps(f,f,p),$o(f,f,[u,u,u]),Yp(f,f,ve(-a)),Kp(f,f,ve(-r)),f}function A_(i){const{x:e,y:n}=i.point,{lng:r,lat:a}=i._center;return S_(e,n,i.worldSize,r,a)}const M_=ve(85),Bv=Math.cos(M_),Fv=Math.sin(M_);function I_(i,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[i*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class xh{constructor(e,n,r){this.z=e,this.x=n,this.y=r,this.key=wc(0,e,e,n,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const r=function(u,p,f){var g=I_(256*u,256*(p=Math.pow(2,f)-p-1),f),v=I_(256*(u+1),256*(p+1),f);return g[0]+","+g[1]+","+v[0]+","+v[1]}(this.x,this.y,this.z),a=function(u,p,f){let g,v="";for(let T=u;T>0;T--)g=1<<T-1,v+=(p&g?1:0)+(f&g?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class C_{constructor(e,n){this.wrap=e,this.canonical=n,this.key=wc(e,n.z,n.z,n.x,n.y)}}class Zi{constructor(e,n,r,a,u){this.overscaledZ=e,this.wrap=n,this.canonical=new xh(r,+a,+u),this.key=n===0&&e===r?this.canonical.key:wc(n,e,r,a,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Zi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zi(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return wc(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return wc(this.wrap*+n,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Zi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,r=2*this.canonical.x,a=2*this.canonical.y;return[new Zi(n,this.wrap,n,r,a),new Zi(n,this.wrap,n,r+1,a),new Zi(n,this.wrap,n,r,a+1),new Zi(n,this.wrap,n,r+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Zi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Zi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new C_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function wc(i,e,n,r,a){const u=1<<Math.min(n,22);let p=u*(a%u)+r%u;return i&&n<22&&(p+=u*u*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}function Rs(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const n=Math.pow(2,-i.z),r=i.x*n,a=(i.x+1)*n,u=i.y*n,p=(i.y+1)*n,f=Vn(r),g=Vn(a),v=Fi(u),T=Fi(p),S=e.project(f,v),M=e.project(g,v),P=e.project(g,T),F=e.project(f,T);let V=Math.min(S.x,M.x,P.x,F.x),q=Math.min(S.y,M.y,P.y,F.y),Y=Math.max(S.x,M.x,P.x,F.x),oe=Math.max(S.y,M.y,P.y,F.y);const le=n/16;function ue(pe,Te,Se,ze,De,be){const Ce=(Se+De)/2,Re=(ze+be)/2,$e=e.project(Vn(Ce),Fi(Re)),Oe=Math.max(0,V-$e.x,q-$e.y,$e.x-Y,$e.y-oe);V=Math.min(V,$e.x),Y=Math.max(Y,$e.x),q=Math.min(q,$e.y),oe=Math.max(oe,$e.y),Oe>le&&(ue(pe,$e,Se,ze,Ce,Re),ue($e,Te,Ce,Re,De,be))}ue(S,M,r,u,a,u),ue(M,P,a,u,a,p),ue(P,F,a,p,r,p),ue(F,S,r,p,r,u),V-=le,q-=le,Y+=le,oe+=le;const he=1/Math.max(Y-V,oe-q);return{scale:he,x:V*he,y:q*he,x2:Y*he,y2:oe*he,projection:e}}et(xh,"CanonicalTileID"),et(Zi,"OverscaledTileID",{omit:["projMatrix"]});class z_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const r=e[n];this._stringToNumber[r]=n,this._numberToString[n]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Ov=["tile","layer","source","sourceLayer","state"];class k_{constructor(e,n,r,a,u){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=r,this._y=a,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const n of Ov)this[n]!==void 0&&(e[n]=this[n]);return e}}const $n=32,Ir=33,qo=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,n=0,r=0,a=0,u=0,p=0,f=0;for(1&e?a=u=p=$n:n=r=f=$n;(e>>=1)>1;){const v=n+a>>1,T=r+u>>1;1&e?(a=n,u=r,n=p,r=f):(n=a,r=u,a=p,u=f),p=v,f=T}const g=4*i;qo[g+0]=n,qo[g+1]=r,qo[g+2]=a,qo[g+3]=u}const Cr=new Uint16Array(2178),Xo=new Uint8Array(1089),vh=new Uint16Array(1089);function P_(i){return i===0?-.03125:i===32?.03125:0}var D_=ie([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const L_={type:2,extent:Et,loadGeometry:()=>[[new D(0,0),new D(8193,0),new D(8193,8193),new D(0,8193),new D(0,0)]]};class kd{constructor(e,n,r,a,u){this.tileID=e,this.uid=Je(),this.uses=0,this.tileSize=n,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<$i.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Rs(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,u){const p={};if(!u)return p;for(const f of a){const g=f.layerIds.map(v=>u.getLayer(v)).filter(Boolean);if(g.length!==0){f.layers=g,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(v=>g.filter(T=>T.id===v)[0]));for(const v of g)p[v.id]=f}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const u=this.buckets[a];if(u instanceof Zo){if(this.hasSymbolBuckets=!0,!r)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const u=this.buckets[a];if(u instanceof Zo&&u.hasRTLText){this.hasRTLText=!0,pn.isLoading()||pn.isLoaded()||ka()!=="deferred"||Bo();break}}this.queryPadding=0;for(const a in this.buckets){const u=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(a).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Qn}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){const a=this.buckets[r];a.uploadPending()&&a.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new xc(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new xc(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new xc(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,r,a,u,p,f,g){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:f,transform:p,params:u,tileTransform:this.tileTransform},e,n,r):{}}querySourceFeatures(e,n){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const a=r.loadVTLayers(),u=n?n.sourceLayer:"",p=a._geojsonTileLayer||a[u];if(!p)return;const f=xr(n&&n.filter),{z:g,x:v,y:T}=this.tileID.canonical,S={z:g,x:v,y:T};for(let M=0;M<p.length;M++){const P=p.feature(M);if(f.needGeometry){const q=ks(P,!0);if(!f.filter(new ti(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!f.filter(new ti(this.tileID.overscaledZ),P))continue;const F=r.getId(P,u),V=new k_(P,g,v,T,F);V.tile=S,e.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const r=Bn(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let a=!1;if(this.expirationTime>r)a=!1;else if(n)if(this.expirationTime<n)a=!0;else{const u=this.expirationTime-n;u?this.expirationTime=r+Math.max(u,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!n)return;const r=this.latestFeatureIndex.loadVTLayers(),a=n.style.listImages();for(const u in this.buckets){if(!n.style.hasLayer(u))continue;const p=this.buckets[u],f=p.layers[0].sourceLayer||"_geojsonTileLayer",g=r[f],v=e[f];if(!g||!v||Object.keys(v).length===0)continue;if(p.update(v,g,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof ch||p instanceof ah){const S=n.style._getSourceCache(p.layers[0].source);n._terrain&&n._terrain.enabled&&S&&p.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(S.id,this.tileID)}const T=n&&n.style&&n.style.getLayer(u);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<$i.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=$i.now()+e}setTexture(e,n){const r=n.context,a=r.gl;this.texture=n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new xc(r,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}setDependencies(e,n){const r={};for(const a of n)r[a]=!0;this.dependencies[e]=r}hasDependency(e,n){for(const r of e){const a=this.dependencies[r];if(a){for(const u of n)if(a[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const r=ao(L_,this.tileID.canonical,this.tileTransform)[0],a=new ee,u=new Nt;for(let p=0;p<r.length;p++){const{x:f,y:g}=r[p];a.emplaceBack(f,g),u.emplaceBack(p)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(a,vc.members),this._tileDebugSegments=fi.simpleSegment(0,0,a.length,u.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const r=ao(L_,this.tileID.canonical,this.tileTransform)[0];let a,u;if(this.isRaster){const p=function(f,g){const v=Rs(f,g),T=Math.pow(2,f.z);for(let q=0;q<Ir;q++)for(let Y=0;Y<Ir;Y++){const oe=Vn((f.x+(Y+P_(Y))/$n)/T),le=Fi((f.y+(q+P_(q))/$n)/T),ue=g.project(oe,le),he=q*Ir+Y;Cr[2*he+0]=Math.round((ue.x*v.scale-v.x)*Et),Cr[2*he+1]=Math.round((ue.y*v.scale-v.y)*Et)}Xo.fill(0),vh.fill(0);for(let q=2045;q>=0;q--){const Y=4*q,oe=qo[Y+0],le=qo[Y+1],ue=qo[Y+2],he=qo[Y+3],pe=oe+ue>>1,Te=le+he>>1,Se=pe+Te-le,ze=Te+oe-pe,De=le*Ir+oe,be=he*Ir+ue,Ce=Te*Ir+pe,Re=Math.hypot((Cr[2*De+0]+Cr[2*be+0])/2-Cr[2*Ce+0],(Cr[2*De+1]+Cr[2*be+1])/2-Cr[2*Ce+1])>=16;if(Xo[Ce]=Xo[Ce]||(Re?1:0),q<1022){const $e=(le+ze>>1)*Ir+(oe+Se>>1),Oe=(he+ze>>1)*Ir+(ue+Se>>1);Xo[Ce]=Xo[Ce]||Xo[$e]||Xo[Oe]}}const S=new re,M=new tt;let P=0;function F(q,Y){const oe=Y*Ir+q;return vh[oe]===0&&(S.emplaceBack(Cr[2*oe+0],Cr[2*oe+1],q*Et/$n,Y*Et/$n),vh[oe]=++P),vh[oe]-1}function V(q,Y,oe,le,ue,he){const pe=q+oe>>1,Te=Y+le>>1;if(Math.abs(q-ue)+Math.abs(Y-he)>1&&Xo[Te*Ir+pe])V(ue,he,q,Y,pe,Te),V(oe,le,ue,he,pe,Te);else{const Se=F(q,Y),ze=F(oe,le),De=F(ue,he);M.emplaceBack(Se,ze,De)}}return V(0,0,$n,$n,$n,0),V($n,$n,0,0,0,$n),{vertices:S,indices:M}}(this.tileID.canonical,n);a=p.vertices,u=p.indices}else{a=new re,u=new tt;for(const{x:f,y:g}of r)a.emplaceBack(f,g,0,0);const p=ih(a.int16,void 0,4);for(let f=0;f<p.length;f+=3)u.emplaceBack(p[f],p[f+1],p[f+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,D_.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=fi.simpleSegment(0,0,a.length,u.length)}_makeGlobeTileDebugBuffers(e,n){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!n||n.name!=="globe")return;const r=this.tileID.canonical,a=E_(bc(r));this._makeGlobeTileDebugBorderBuffer(e,r,a),this._makeGlobeTileDebugTextBuffer(e,r,a)}_makeGlobeTileDebugBorderBuffer(e,n,r){const a=new ee,u=new Nt,p=new te,f=(v,T,S,M,P)=>{const F=(S-v)/(P-1),V=(M-T)/(P-1),q=a.length;for(let Y=0;Y<P;Y++){const oe=v+Y*F,le=T+Y*V;a.emplaceBack(oe,le);const ue=T_(oe,le,n),he=Ds(ue,ue,r);p.emplaceBack(he[0],he[1],he[2]),u.emplaceBack(q+Y)}},g=Et;f(0,0,g,0,16),f(g,0,g,g,16),f(g,g,0,g,16),f(0,g,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(a,vc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(p,b_.members),this._tileDebugSegments=fi.simpleSegment(0,0,a.length,u.length)}_makeGlobeTileDebugTextBuffer(e,n,r){const a=new ee,u=new tt,p=new te,f=25;u.reserve(32),a.reserve(f),p.reserve(f);const g=(v,T)=>f*v+T;for(let v=0;v<f;v++){const T=2048*v;for(let S=0;S<f;S++){const M=2048*S;a.emplaceBack(M,T);const P=T_(M,T,n),F=Ds(P,P,r);p.emplaceBack(F[0],F[1],F[2])}}for(let v=0;v<4;v++)for(let T=0;T<4;T++){const S=g(v,T),M=g(v,T+1),P=g(v+1,T),F=g(v+1,T+1);u.emplaceBack(S,M,P),u.emplaceBack(P,M,F)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(u),this._tileDebugTextBuffer=e.createVertexBuffer(a,vc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(p,b_.members),this._tileDebugTextSegments=fi.simpleSegment(0,0,f,32)}}class Nv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,r){const a=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},Ie(this.stateChanges[e][a],r),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==a&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][a]===null){this.deletedStates[e][a]={};for(const u in this.state[e][a])r[u]||(this.deletedStates[e][a][u]=null)}else for(const u in r)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][u]===null&&delete this.deletedStates[e][a][u]}removeFeatureState(e,n,r){if(this.deletedStates[e]===null)return;const a=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&n!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][r]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(r in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][r]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,n){const r=String(n),a=Ie({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][n];if(u===null)return{};for(const p in u)delete a[p]}return a}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const r={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const u={};for(const p in this.stateChanges[a])this.state[a][p]||(this.state[a][p]={}),Ie(this.state[a][p],this.stateChanges[a][p]),u[p]=this.state[a][p];r[a]=u}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const u={};if(this.deletedStates[a]===null)for(const p in this.state[a])u[p]={},this.state[a][p]={};else for(const p in this.deletedStates[a]){if(this.deletedStates[a][p]===null)this.state[a][p]={};else for(const f of Object.keys(this.deletedStates[a][p]))delete this.state[a][p][f];u[p]=this.state[a][p]}r[a]=r[a]||{},Ie(r[a],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(const a in e)e[a].setFeatureState(r,n)}}class R_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const r=this.toIdx(e,n);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function B_(i,e,n,r){let a=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(r[p])<1e-15){if(n[p]<i[p]||n[p]>e[p])return null}else{const f=1/r[p];let g=(i[p]-n[p])*f,v=(e[p]-n[p])*f;if(g>v){const T=g;g=v,v=T}if(g>a&&(a=g),v<u&&(u=v),a>u)return null}return a}function F_(i,e,n,r,a,u,p,f,g,v,T){const S=r-i,M=a-e,P=u-n,F=p-i,V=f-e,q=g-n,Y=T[1]*q-T[2]*V,oe=T[2]*F-T[0]*q,le=T[0]*V-T[1]*F,ue=S*Y+M*oe+P*le;if(Math.abs(ue)<1e-15)return null;const he=1/ue,pe=v[0]-i,Te=v[1]-e,Se=v[2]-n,ze=(pe*Y+Te*oe+Se*le)*he;if(ze<0||ze>1)return null;const De=Te*P-Se*M,be=Se*S-pe*P,Ce=pe*M-Te*S,Re=(T[0]*De+T[1]*be+T[2]*Ce)*he;return Re<0||ze+Re>1?null:(F*De+V*be+q*Ce)*he}function O_(i,e,n){return(i-e)/(n-e)}function N_(i,e,n,r,a,u,p,f,g){const v=1<<n,T=u-r,S=p-a,M=(i+1)/v*T+r,P=(e+0)/v*S+a,F=(e+1)/v*S+a;f[0]=(i+0)/v*T+r,f[1]=P,g[0]=M,g[1]=F}class U_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(u){const p=Math.ceil(Math.log2(u.dim/8)),f=[];let g=Math.ceil(Math.pow(2,p));const v=1/g,T=(P,F,V,q,Y)=>{const oe=q?1:0,le=(P+1)*V-oe,ue=F*V,he=(F+1)*V-oe;Y[0]=P*V,Y[1]=ue,Y[2]=le,Y[3]=he};let S=new R_(g);const M=[];for(let P=0;P<g*g;P++){T(P%g,Math.floor(P/g),v,!1,M);const F=Wo(M[0],M[1],u),V=Wo(M[2],M[1],u),q=Wo(M[2],M[3],u),Y=Wo(M[0],M[3],u);S.minimums.push(Math.min(F,V,q,Y)),S.maximums.push(Math.max(F,V,q,Y)),S.leaves.push(1)}for(f.push(S),g/=2;g>=1;g/=2){const P=f[f.length-1];S=new R_(g);for(let F=0;F<g*g;F++){T(F%g,Math.floor(F/g),2,!0,M);const V=P.getElevation(M[0],M[1]),q=P.getElevation(M[2],M[1]),Y=P.getElevation(M[2],M[3]),oe=P.getElevation(M[0],M[3]),le=P.isLeaf(M[0],M[1]),ue=P.isLeaf(M[2],M[1]),he=P.isLeaf(M[2],M[3]),pe=P.isLeaf(M[0],M[3]),Te=Math.min(V.min,q.min,Y.min,oe.min),Se=Math.max(V.max,q.max,Y.max,oe.max),ze=le&&ue&&he&&pe;S.maximums.push(Se),S.minimums.push(Te),S.leaves.push(Se-Te<=5&&ze?1:0)}f.push(S)}return f}(this.dem),r=n.length-1,a=n[r];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(n,0,0,r,0)}raycastRoot(e,n,r,a,u,p,f=1){return B_([e,n,-100],[r,a,this.maximums[0]*f],u,p)}raycast(e,n,r,a,u,p,f=1){if(!this.nodeCount)return null;const g=this.raycastRoot(e,n,r,a,u,p,f);if(g==null)return null;const v=[],T=[],S=[],M=[],P=[{idx:0,t:g,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:F,t:V,nodex:q,nodey:Y,depth:oe}=P.pop();if(this.leaves[F]){N_(q,Y,oe,e,n,r,a,S,M);const ue=1<<oe,he=(q+0)/ue,pe=(q+1)/ue,Te=(Y+0)/ue,Se=(Y+1)/ue,ze=Wo(he,Te,this.dem)*f,De=Wo(pe,Te,this.dem)*f,be=Wo(pe,Se,this.dem)*f,Ce=Wo(he,Se,this.dem)*f,Re=F_(S[0],S[1],ze,M[0],S[1],De,M[0],M[1],be,u,p),$e=F_(M[0],M[1],be,S[0],M[1],Ce,S[0],S[1],ze,u,p),Oe=Math.min(Re!==null?Re:Number.MAX_VALUE,$e!==null?$e:Number.MAX_VALUE);if(Oe!==Number.MAX_VALUE)return Oe;{const Ve=td([],u,p,V);if(V_(ze,De,Ce,be,O_(Ve[0],S[0],M[0]),O_(Ve[1],S[1],M[1]))>=Ve[2])return V}continue}let le=0;for(let ue=0;ue<this._siblingOffset.length;ue++){N_((q<<1)+this._siblingOffset[ue][0],(Y<<1)+this._siblingOffset[ue][1],oe+1,e,n,r,a,S,M),S[2]=-100,M[2]=this.maximums[this.childOffsets[F]+ue]*f;const he=B_(S,M,u,p);if(he!=null){const pe=he;v[ue]=pe;let Te=!1;for(let Se=0;Se<le&&!Te;Se++)pe>=v[T[Se]]&&(T.splice(Se,0,ue),Te=!0);Te||(T[le]=ue),le++}}for(let ue=0;ue<le;ue++){const he=T[ue];P.push({idx:this.childOffsets[F]+he,t:v[he],nodex:(q<<1)+this._siblingOffset[he][0],nodey:(Y<<1)+this._siblingOffset[he][1],depth:oe+1})}}return null}_addNode(e,n,r){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,r,a,u){if(e[a].isLeaf(n,r)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const p=a-1,f=e[p];let g=0,v=0;for(let T=0;T<this._siblingOffset.length;T++){const S=2*n+this._siblingOffset[T][0],M=2*r+this._siblingOffset[T][1],P=f.getElevation(S,M),F=f.isLeaf(S,M),V=this._addNode(P.min,P.max,F);F&&(g|=1<<T),v||(v=V)}for(let T=0;T<this._siblingOffset.length;T++)g&1<<T||this._construct(e,2*n+this._siblingOffset[T][0],2*r+this._siblingOffset[T][1],p,v+T)}}function V_(i,e,n,r,a,u){return pt(pt(i,n,u),pt(e,r,u),a)}function Wo(i,e,n){const r=n.dim,a=Ge(i*r-.5,0,r-1),u=Ge(e*r-.5,0,r-1),p=Math.floor(a),f=Math.floor(u),g=Math.min(p+1,r-1),v=Math.min(f+1,r-1);return V_(n.get(p,f),n.get(g,f),n.get(p,v),n.get(g,v),a-p,u-f)}const $_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class bh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,r,a=!1,u=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Ct(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const p=this.dim=n.height-2,f=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=r||"mapbox",this.borderReady=a,!a){for(let g=0;g<p;g++)f[this._idx(-1,g)]=f[this._idx(0,g)],f[this._idx(p,g)]=f[this._idx(p-1,g)],f[this._idx(g,-1)]=f[this._idx(g,0)],f[this._idx(g,p)]=f[this._idx(g,p-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(p,-1)]=f[this._idx(p-1,0)],f[this._idx(-1,p)]=f[this._idx(0,p-1)],f[this._idx(p,p)]=f[this._idx(p-1,p-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new U_(this)}get(e,n,r=!1){r&&(e=Ge(e,-1,this.dim),n=Ge(n,-1,this.dim));const a=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[a],this.pixels[a+1],this.pixels[a+2])}static getUnpackVector(e){return $_[e]}get unpackVector(){return $_[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,r){return(256*e*256+256*n+r)/10-1e4}_unpackTerrarium(e,n,r){return 256*e+n+r/256-32768}static pack(e,n){const r=[0,0,0,0],a=bh.getUnpackVector(n);let u=Math.floor((e+a[3])/a[2]);return r[2]=u%256,u=Math.floor(u/256),r[1]=u%256,u=Math.floor(u/256),r[0]=u,r}getPixels(){return new mn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=n*this.dim,u=n*this.dim+this.dim,p=r*this.dim,f=r*this.dim+this.dim;switch(n){case-1:a=u-1;break;case 1:u=a+1}switch(r){case-1:p=f-1;break;case 1:f=p+1}const g=-n*this.dim,v=-r*this.dim;for(let T=p;T<f;T++)for(let S=a;S<u;S++){const M=4*this._idx(S,T),P=4*this._idx(S+g,T+v);this.pixels[M+0]=e.pixels[P+0],this.pixels[M+1]=e.pixels[P+1],this.pixels[M+2]=e.pixels[P+2],this.pixels[M+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}et(bh,"DEMData"),et(U_,"DemMinMaxQuadTree",{omit:["dem"]});class Uv{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,r){const a=e.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const u={value:n,timeout:void 0};if(r!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},r)),this.data[a].push(u),this.order.push(a),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const r=e.wrapped().key,a=n===void 0?0:this.data[r].indexOf(n),u=this.data[r][a];return this.data[r].splice(a,1),u.timeout&&clearTimeout(u.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(u.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const r in this.data)for(const a of this.data[r])e(a.value)||n.push(a);for(const r of n)this.remove(r.value.tileID,r)}}class Wa{constructor(e,n,r){this.func=e,this.mask=n,this.range=r}}Wa.ReadOnly=!1,Wa.ReadWrite=!0,Wa.disabled=new Wa(519,Wa.ReadOnly,[0,1]);const Pd=7680;class Dd{constructor(e,n,r,a,u,p){this.test=e,this.ref=n,this.mask=r,this.fail=a,this.depthFail=u,this.pass=p}}Dd.disabled=new Dd({func:519,mask:0},0,0,Pd,Pd,Pd);class zr{constructor(e,n,r){this.blendFunction=e,this.blendColor=n,this.mask=r}}zr.Replace=[1,0],zr.disabled=new zr(zr.Replace,Vt.transparent,[!1,!1,!1,!1]),zr.unblended=new zr(zr.Replace,Vt.transparent,[!0,!0,!0,!0]),zr.alphaBlended=new zr([1,771],Vt.transparent,[!0,!0,!0,!0]);const Ld=1029,Rd=2305;class nr{constructor(e,n,r){this.enable=e,this.mode=n,this.frontFace=r}}nr.disabled=new nr(!1,Ld,Rd),nr.backCCW=new nr(!0,Ld,Rd),nr.backCW=new nr(!0,Ld,2304),nr.frontCW=new nr(!0,1028,2304),nr.frontCCW=new nr(!0,1028,Rd);class Bs extends _t{constructor(e,n,r){super(),this.id=e,this._onlySymbols=r,n.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Uv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Nv,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const n in this._tiles){const r=this._tiles[n];this._source.prepareTile(r)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,r.tileID),r.upload(e),r.prepare(this.map.style.imageManager)}else for(const n in this._tiles){const r=this._tiles[n];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return St(this._tiles).map(e=>e.tileID).sort(j_).map(e=>e.key)}getRenderableIds(e){const n=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&n.push(this._tiles[r]);return e?n.sort((r,a)=>{const u=r.tileID,p=a.tileID,f=new D(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),g=new D(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-p.overscaledZ||g.y-f.y||g.x-f.x}).map(r=>r.tileID.key):n.map(r=>r.tileID).sort(j_).map(r=>r.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const r=this._tiles[e];r&&(r.state!=="loading"&&(r.state=n),this._loadTile(r,this._tileLoaded.bind(this,r,e,n)))}_tileLoaded(e,n,r,a){if(a)if(e.state="errored",a.status!==404)this._source.fire(new ut(a,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=$i.now(),r==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ct("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let a=0;a<n.length;a++){const u=n[a];if(e.neighboringTiles&&e.neighboringTiles[u]){const p=this.getTileByID(u);r(e,p),r(p,e)}}function r(a,u){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let p=u.tileID.canonical.x-a.tileID.canonical.x;const f=u.tileID.canonical.y-a.tileID.canonical.y,g=Math.pow(2,a.tileID.canonical.z),v=u.tileID.key;p===0&&f===0||Math.abs(f)>1||(Math.abs(p)>1&&(Math.abs(p+g)===1?p+=g:Math.abs(p-g)===1&&(p-=g)),u.dem&&a.dem&&(a.dem.backfillBorder(u.dem,p,f),a.neighboringTiles&&a.neighboringTiles[v]&&(a.neighboringTiles[v].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,r,a){for(const u in this._tiles){let p=this._tiles[u];if(a[u]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>r)continue;let f=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){const v=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[v.key],p&&p.hasData()&&(f=v)}let g=f;for(;g.overscaledZ>n;)if(g=g.scaledTo(g.overscaledZ-1),e[g.key]){a[f.key]=f;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=n?r:null}for(let r=e.overscaledZ-1;r>=n;r--){const a=e.scaledTo(r),u=this._getLoadedTile(a);if(u)return u}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const r=Math.ceil(e.width/n)+1,a=Math.ceil(e.height/n)+1,u=Math.floor(r*a*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(f)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const r={};for(const a in this._tiles){const u=this._tiles[a];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+n),r[u.tileID.key]=u}this._tiles=r;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,n,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let a;this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new Zi(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(a=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter(f=>this._source.hasTile(f)))):a=[];const u=this._updateRetainedTiles(a);if(G_(this._source.type)&&a.length!==0){const f={},g={},v=Object.keys(u);for(const S of v){const M=u[S],P=this._tiles[S];if(!P||P.fadeEndTime&&P.fadeEndTime<=$i.now())continue;const F=this.findLoadedParent(M,Math.max(M.overscaledZ-Bs.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),f[F.tileID.key]=F.tileID),g[S]=M}const T=a[a.length-1].overscaledZ;for(const S in this._tiles){const M=this._tiles[S];if(u[S]||!M.hasData())continue;let P=M.tileID;for(;P.overscaledZ>T;){P=P.scaledTo(P.overscaledZ-1);const F=this._tiles[P.key];if(F&&F.hasData()&&g[P.key]){u[S]=M.tileID;break}}}for(const S in f)u[S]||(this._coveredTiles[S]=!0,u[S]=f[S])}for(const f in u)this._tiles[f].clearFadeHold();const p=function(f,g){const v=[];for(const T in f)T in g||v.push(T);return v}(this._tiles,u);for(const f of p){const g=this._tiles[f];g.hasSymbolBuckets&&!g.holdingForFade()?g.setHoldDuration(this.map._fadeDuration):g.hasSymbolBuckets&&!g.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const r={},a=e.reduce((v,T)=>Math.min(v,T.overscaledZ),1/0),u=e[0].overscaledZ,p=Math.max(u-Bs.maxOverzooming,this._source.minzoom),f=Math.max(u+Bs.maxUnderzooming,this._source.minzoom),g={};for(const v of e){const T=this._addTile(v);n[v.key]=v,T.hasData()||a<this._source.maxzoom&&(g[v.key]=v)}this._retainLoadedChildren(g,a,f,n);for(const v of e){let T=this._tiles[v.key];if(T.hasData())continue;if(v.canonical.z>=this._source.maxzoom){const M=v.children(this._source.maxzoom)[0],P=this.getTile(M);if(P&&P.hasData()){n[M.key]=M;continue}}else{const M=v.children(this._source.maxzoom);if(n[M[0].key]&&n[M[1].key]&&n[M[2].key]&&n[M[3].key])continue}let S=T.wasRequested();for(let M=v.overscaledZ-1;M>=p;--M){const P=v.scaledTo(M);if(r[P.key]||(r[P.key]=!0,T=this.getTile(P),!T&&S&&(T=this._addTile(P)),T&&(n[P.key]=P,S=T.wasRequested(),T.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let r,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){r=this._loadedParentTiles[a.key];break}n.push(a.key);const u=a.scaledTo(a.overscaledZ-1);if(r=this._getLoadedTile(u),r)break;a=u}for(const u of n)this._loadedParentTiles[u]=r}}_addTile(e){let n=this._tiles[e.key];if(n)return this._source.prepareTile&&this._source.prepareTile(n),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const r=Boolean(n);if(!r){const a=this.map?this.map.painter:null;n=new kd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._source.prepareTile&&this._source.prepareTile(n)||this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,r||this._source.fire(new ct("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=n.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,r){const a=[],u=this.transform;if(!u)return a;for(const p in this._tiles){const f=this._tiles[p];if(r&&f.clearQueryDebugViz(),f.holdingForFade())continue;const g=e.containsTile(f,u,n);g&&a.push(g)}return a}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(r=>this._tiles[r].tileID);for(const r of n)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(G_(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=$i.now())return!0}return!1}setFeatureState(e,n,r){this._state.updateState(e=e||"_geojsonTileLayer",n,r)}removeFeatureState(e,n,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,r)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,r){const a=this._tiles[e];a&&a.setDependencies(n,r)}reloadTilesForDependencies(e,n){for(const r in this._tiles)this._tiles[r].hasDependency(e,n)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,n))}_preloadTiles(e,n){const r=new Map,a=Array.isArray(e)?e:[e],u=this.map.painter.terrain,p=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const f of a){const g=f.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const v of g)r.set(v.key,v);this.usedForTerrain&&f.updateElevation(!1)}xt(Array.from(r.values()),(f,g)=>{const v=new kd(f,this._source.tileSize*f.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(v,T=>{this._source.type==="raster-dem"&&v.dem&&this._backfillDEM(v),g(T,v)})},n)}}function j_(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||r-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function G_(i){return i==="raster"||i==="image"||i==="video"}Bs.maxOverzooming=10,Bs.maxUnderzooming=3;class wh{constructor(e,n,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=r}static create(e,n,r){const a=r||e.findDEMTileFor(n);if(!a||!a.dem)return;const u=a.dem,p=a.tileID,f=1<<n.canonical.z-p.canonical.z;return new wh(a,a.tileSize/Et/f,[(n.canonical.x/f-p.canonical.x)*u.dim,(n.canonical.y/f-p.canonical.y)*u.dim])}tileCoordToPixel(e,n){const r=n*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(r);return new D(a,u)}getElevationAt(e,n,r,a){const u=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],f=Math.floor(u),g=Math.floor(p),v=this._dem;return a=!!a,r?pt(pt(v.get(f,g,a),v.get(f,g+1,a),p-g),pt(v.get(f+1,g,a),v.get(f+1,g+1,a),p-g),u-f):v.get(f,g,a)}getElevationAtPixel(e,n,r){return this._dem.get(e,n,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*La(1,e)*this._dem.stride}}class Z_{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new wr(Et,16,0),this.featureIndexArray=new li,this.promoteId=n}insert(e,n,r,a,u,p=0){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,a,u,p);const g=this.grid;for(let v=0;v<n.length;v++){const T=n[v],S=[1/0,1/0,-1/0,-1/0];for(let M=0;M<T.length;M++){const P=T[M];S[0]=Math.min(S[0],P.x),S[1]=Math.min(S[1],P.y),S[2]=Math.max(S[2],P.x),S[3]=Math.max(S[3],P.y)}S[0]<Et&&S[1]<Et&&S[2]>=0&&S[3]>=0&&g.insert(f,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ls.VectorTile(new _c(this.rawTileData)).layers,this.sourceLayerCoder=new z_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,r,a){this.loadVTLayers();const u=e.params||{},p=xr(u.filter),f=e.tileResult,g=e.transform,v=f.bufferedTilespaceBounds,T=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(F,V,q,Y)=>pm(f.bufferedTilespaceGeometry,F,V,q,Y));T.sort(Vv);let S=null;g.elevation&&T.length>0&&(S=wh.create(g.elevation,this.tileID));const M={};let P;for(let F=0;F<T.length;F++){const V=T[F];if(V===P)continue;P=V;const q=this.featureIndexArray.get(V);let Y=null;this.loadMatchingFeature(M,q,p,u.layers,u.availableImages,n,r,a,(oe,le,ue,he=0)=>(Y||(Y=ao(oe,this.tileID.canonical,e.tileTransform)),le.queryIntersectsFeature(f,oe,ue,Y,this.z,e.transform,e.pixelPosMatrix,S,he)))}return M}loadMatchingFeature(e,n,r,a,u,p,f,g,v){const{featureIndex:T,bucketIndex:S,sourceLayerIndex:M,layoutVertexArrayOffset:P}=n,F=this.bucketLayerIDs[S];if(a&&!function(oe,le){for(let ue=0;ue<oe.length;ue++)if(le.indexOf(oe[ue])>=0)return!0;return!1}(a,F))return;const V=this.sourceLayerCoder.decode(M),q=this.vtLayers[V].feature(T);if(r.needGeometry){const oe=ks(q,!0);if(!r.filter(new ti(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!r.filter(new ti(this.tileID.overscaledZ),q))return;const Y=this.getId(q,V);for(let oe=0;oe<F.length;oe++){const le=F[oe];if(a&&a.indexOf(le)<0)continue;const ue=p[le];if(!ue)continue;let he={};Y!==void 0&&g&&(he=g.getState(ue.sourceLayer||"_geojsonTileLayer",Y));const pe=Ie({},f[le]);pe.paint=q_(pe.paint,ue.paint,q,he,u),pe.layout=q_(pe.layout,ue.layout,q,he,u);const Te=!v||v(q,ue,he,P);if(!Te)continue;const Se=new k_(q,this.z,this.x,this.y,Y);Se.layer=pe;let ze=e[le];ze===void 0&&(ze=e[le]=[]),ze.push({featureIndex:T,feature:Se,intersectionZ:Te})}}lookupSymbolFeatures(e,n,r,a,u,p,f,g){const v={};this.loadVTLayers();const T=xr(u);for(const S of e)this.loadMatchingFeature(v,{bucketIndex:r,sourceLayerIndex:a,featureIndex:S,layoutVertexArrayOffset:0},T,p,f,g,n);return v}loadFeature(e){const{featureIndex:n,sourceLayerIndex:r}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(r),u=this.vtFeatures[a];if(u[n])return u[n];const p=this.vtLayers[a].feature(n);return u[n]=p,p}hasLayer(e){for(const n of this.bucketLayerIDs)for(const r of n)if(e===r)return!0;return!1}getId(e,n){let r=e.id;return this.promoteId&&(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof r=="boolean"&&(r=Number(r))),r}}function q_(i,e,n,r,a){return It(i,(u,p)=>{const f=e instanceof _?e.get(p):null;return f&&f.evaluate?f.evaluate(n,r,a):f})}function Vv(i,e){return e-i}et(Z_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class X_{constructor(e){const n={},r=[];for(const f in e){const g=e[f],v=n[f]={};for(const T in g.glyphs){const S=g.glyphs[+T];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const M=S.metrics.localGlyph?2:1,P={x:0,y:0,w:S.bitmap.width+2*M,h:S.bitmap.height+2*M};r.push(P),v[T]=P}}const{w:a,h:u}=dd(r),p=new lo({width:a||1,height:u||1});for(const f in e){const g=e[f];for(const v in g.glyphs){const T=g.glyphs[+v];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const S=n[f][v],M=T.metrics.localGlyph?2:1;lo.copy(T.bitmap,p,{x:0,y:0},{x:S.x+M,y:S.y+M},T.bitmap)}}this.image=p,this.positions=n}}et(X_,"GlyphAtlas");class $v{constructor(e){this.tileID=new Zi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Rs(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,r,a,u){this.status="parsing",this.data=e,this.collisionBoxArray=new Qn;const p=new z_(Object.keys(e.layers).sort()),f=new Z_(this.tileID,this.promoteId);f.bucketLayerIDs=[];const g={},v=new Md(256,256),T={featureIndex:f,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:v,availableImages:r},S=n.familiesBySource[this.source];for(const he in S){const pe=e.layers[he];if(!pe)continue;let Te=!1,Se=!1;for(const be of S[he])be[0].type==="symbol"?Te=!0:Se=!0;if(this.isSymbolTile===!0&&!Te||this.isSymbolTile===!1&&!Se)continue;pe.version===1&&Ct(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ze=p.encode(he),De=[];for(let be=0;be<pe.length;be++){const Ce=pe.feature(be),Re=f.getId(Ce,he);De.push({feature:Ce,id:Re,index:be,sourceLayerIndex:ze})}for(const be of S[he]){const Ce=be[0];this.isSymbolTile!==void 0&&Ce.type==="symbol"!==this.isSymbolTile||Ce.minzoom&&this.zoom<Math.floor(Ce.minzoom)||Ce.maxzoom&&this.zoom>=Ce.maxzoom||Ce.visibility!=="none"&&(Bd(be,this.zoom,r),(g[Ce.id]=Ce.createBucket({index:f.bucketLayerIDs.length,layers:be,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ze,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:r})).populate(De,T,this.tileID.canonical,this.tileTransform),f.bucketLayerIDs.push(be.map(Re=>Re.id)))}}let M,P,F,V;v.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Y=It(T.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(Y).length?a.send("getGlyphs",{uid:this.uid,stacks:Y},(he,pe)=>{M||(M=he,P=pe,ue.call(this))},void 0,!1,q):P={};const oe=Object.keys(T.iconDependencies);oe.length?a.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"icons"},(he,pe)=>{M||(M=he,F=pe,ue.call(this))},void 0,!1,q):F={};const le=Object.keys(T.patternDependencies);function ue(){if(M)return u(M);if(P&&F&&V){const he=new X_(P),pe=new Jm(F,V);for(const Te in g){const Se=g[Te];Se instanceof Zo?(Bd(Se.layers,this.zoom,r),_v(Se,P,he.positions,F,pe.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):Se.hasPattern&&(Se instanceof ch||Se instanceof ah||Se instanceof dc)&&(Bd(Se.layers,this.zoom,r),Se.addFeatures(T,this.tileID.canonical,pe.patternPositions,r,this.tileTransform))}this.status="done",u(null,{buckets:St(g).filter(Te=>!Te.isEmpty()),featureIndex:f,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:he.image,lineAtlas:v,imageAtlas:pe,glyphMap:this.returnDependencies?P:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?he.positions:null})}}le.length?a.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"patterns"},(he,pe)=>{M||(M=he,V=pe,ue.call(this))},void 0,!1,q):V={},ue.call(this)}}function Bd(i,e,n){const r=new ti(e);for(const a of i)a.recalculate(r,n)}class W_{constructor(e){this.entries={},this.scheduler=e}request(e,n,r,a){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[p,f]=u.result;return this.scheduler?this.scheduler.add(()=>{a(p,f)},n):a(p,f),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=r((p,f)=>{u.result=[p,f];for(const g of u.callbacks)this.scheduler?this.scheduler.add(()=>{g(p,f)},n):g(p,f);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(p=>p!==a),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function H_(i,e,n){const r=JSON.stringify(i.request);return i.data&&(this.deduped.entries[r]={result:[null,i.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},a=>{const u=ne(i.request,(p,f,g,v)=>{p?a(p):f&&a(null,{vectorTile:n?void 0:new Ls.VectorTile(new _c(f)),rawData:f,cacheControl:g,expires:v})});return()=>{u.cancel(),a()}},e)}const jv=Ar(new Float32Array(16));class Ho{constructor(e){this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Kt(0,0)}projectTilePoint(e,n,r){return{x:e,y:n,z:0}}locationPoint(e,n){return e._coordinatePoint(e.locationCoordinate(n),!1)}pixelsPerMeter(e,n){return La(1,e)*n}farthestPixelDistance(e){return function(n,r){const a=n.fovAboveCenter,u=n.elevation?n.elevation.getMinElevationBelowMSL()*r:0,p=(n._camera.position[2]*n.worldSize-u)/Math.cos(n._pitch),f=Math.sin(a)*p/Math.sin(Math.max(Math.PI/2-n._pitch-a,.01)),g=Math.sin(n._pitch)*f+p;return Math.min(1.01*g,p*(1/n._horizonShift))}(e,e.pixelsPerMeter)}pointCoordinate(e,n,r,a){const u=e.horizonLineFromTop(!1),p=new D(n,Math.max(u,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,a))}createInversionMatrix(e,n){return jv}createTileMatrix(e,n,r){let a,u,p;const f=r.canonical,g=Ar(new Float64Array(16));if(this.isReprojectedInTileSpace){const v=Rs(f,this);a=1,u=v.x+r.wrap*v.scale,p=v.y,$o(g,g,[a/v.scale,a/v.scale,e.pixelsPerMeter/n])}else a=n/e.zoomScale(f.z),u=(f.x+Math.pow(2,f.z)*r.wrap)*a,p=f.y*a;return Ps(g,g,[u,p,0]),$o(g,g,[a/Et,a/Et,1]),g}upVector(e,n,r){return[0,0,1]}upVectorScale(e,n,r){return{metersToTile:1,metersToLabelSpace:1}}}class Gv extends Ho{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:tc(e),y:Da(n),z:0}}unproject(e,n){const r=Vn(e),a=Fi(n);return new Kt(r,a)}}class Zv extends Ho{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,r]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(ve(n));this.n=(a+Math.sin(ve(r)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:r,c:a,r0:u}=this,p=ve(e-this.center[0]),f=ve(n),g=Math.sqrt(a-2*r*Math.sin(f))/r;return{x:g*Math.sin(p*r),y:g*Math.cos(p*r)-u,z:0}}unproject(e,n){const{n:r,c:a,r0:u}=this,p=u+n;let f=Math.atan2(e,Math.abs(p))*Math.sign(p);p*r<0&&(f-=Math.PI*Math.sign(e)*Math.sign(p));const g=ve(this.center[0])*r;f=yt(f,-Math.PI-g,Math.PI-g);const v=We(f/r)+this.center[0],T=Math.asin(Ge((a-(e*e+p*p)*r*r)/(2*r),-1,1)),S=Ge(We(T),-85.051129,Sr);return new Kt(v,S)}}const Tc=1.340264,Ec=-.081106,Sc=893e-6,Ac=.003796,Th=Math.sqrt(3)/2;class qv extends Ho{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(Th*Math.sin(n)),a=r*r,u=a*a*a;return{x:.5*(e*Math.cos(r)/(Th*(Tc+3*Ec*a+u*(7*Sc+9*Ac*a)))/Math.PI+.5),y:1-.5*(r*(Tc+Ec*a+u*(Sc+Ac*a))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let r=n=(2*(1-n)-1)*Math.PI,a=r*r,u=a*a*a;for(let T,S,M,P=0;P<12&&(S=r*(Tc+Ec*a+u*(Sc+Ac*a))-n,M=Tc+3*Ec*a+u*(7*Sc+9*Ac*a),T=S/M,r=Ge(r-T,-Math.PI/3,Math.PI/3),a=r*r,u=a*a*a,!(Math.abs(T)<1e-12));++P);const p=Th*e*(Tc+3*Ec*a+u*(7*Sc+9*Ac*a))/Math.cos(r),f=Math.asin(Math.sin(r)/Th),g=Ge(180*p/Math.PI,-180,180),v=Ge(180*f/Math.PI,-85.051129,Sr);return new Kt(g,v)}}class Xv extends Ho{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const r=360*(e-.5),a=Ge(360*(.5-n),-85.051129,Sr);return new Kt(r,a)}}const Ha=Math.PI/2;function Eh(i){return Math.tan((Ha+i)/2)}class Wv extends Ho{constructor(e){super(e),this.center=e.center||[0,30];const[n,r]=this.parallels=e.parallels||[30,30],a=ve(n),u=ve(r),p=Math.cos(a);this.n=a===u?Math.sin(a):Math.log(p/Math.cos(u))/Math.log(Eh(u)/Eh(a)),this.f=p*Math.pow(Eh(a),this.n)/this.n}project(e,n){n=ve(n),e=ve(e-this.center[0]);const r=1e-6,{n:a,f:u}=this;u>0?n<-Ha+r&&(n=-Ha+r):n>Ha-r&&(n=Ha-r);const p=u/Math.pow(Eh(n),a),f=p*Math.sin(a*e),g=u-p*Math.cos(a*e);return{x:.5*(f/Math.PI+.5),y:1-.5*(g/Math.PI+.5),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,n=(2*(1-n)-.5)*Math.PI;const{n:r,f:a}=this,u=a-n,p=Math.sign(u),f=Math.sign(r)*Math.sqrt(e*e+u*u);let g=Math.atan2(e,Math.abs(u))*p;u*r<0&&(g-=Math.PI*Math.sign(e)*p);const v=Ge(We(g/r)+this.center[0],-180,180),T=Ge(We(2*Math.atan(Math.pow(a/f,1/r))-Ha),-85.051129,Sr);return new Kt(v,T)}}const Y_=ve(Sr);class Hv extends Ho{project(e,n){const r=(n=ve(n))*n,a=r*r;return{x:.5*((e=ve(e))*(.8707-.131979*r+a*(a*(.003971*r-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+r*(.015085+a*(.028874*r-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let r=n=(2*(1-n)-1)*Math.PI,a=25,u=0,p=r*r;do{p=r*r;const v=p*p;u=(r*(1.007226+p*(.015085+v*(.028874*p-.044475-.005916*v)))-n)/(1.007226+p*(.045255+v*(.259866*p-.311325-.005916*11*v))),r=Ge(r-u,-Y_,Y_)}while(Math.abs(u)>1e-6&&--a>0);p=r*r;const f=Ge(We(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),g=We(r);return new Kt(f,g)}}const K_=ve(Sr);class Yv extends Ho{project(e,n){n=ve(n),e=ve(e);const r=Math.cos(n),a=2/Math.PI,u=Math.acos(r*Math.cos(e/2)),p=Math.sin(u)/u,f=.5*(e*a+2*r*Math.sin(e/2)/p)||0,g=.5*(n+Math.sin(n)/p)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}}unproject(e,n){let r=e=(2*e-.5)*Math.PI,a=n=(2*(1-n)-1)*Math.PI,u=25;const p=1e-6;let f=0,g=0;do{const v=Math.cos(a),T=Math.sin(a),S=2*T*v,M=T*T,P=v*v,F=Math.cos(r/2),V=Math.sin(r/2),q=2*F*V,Y=V*V,oe=1-P*F*F,le=oe?1/oe:0,ue=oe?Math.acos(v*F)*Math.sqrt(1/oe):0,he=.5*(2*ue*v*V+2*r/Math.PI)-e,pe=.5*(ue*T+a)-n,Te=.5*le*(P*Y+ue*v*F*M)+1/Math.PI,Se=le*(q*S/4-ue*T*V),ze=.125*le*(S*V-ue*T*P*q),De=.5*le*(M*F+ue*Y*v)+.5,be=Se*ze-De*Te;f=(pe*Se-he*De)/be,g=(he*ze-pe*Te)/be,r=Ge(r-f,-Math.PI,Math.PI),a=Ge(a-g,-K_,K_)}while((Math.abs(f)>p||Math.abs(g)>p)&&--u>0);return new Kt(We(r),We(a))}}class J_ extends Ho{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ve(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:r,cosPhi:a}=this;return{x:ve(e)*a*r+.5,y:-Math.sin(ve(n))/a*r+.5,z:0}}unproject(e,n){const{scale:r,cosPhi:a}=this,u=-(n-.5)/r,p=Ge(We((e-.5)/r)/a,-180,180),f=Math.asin(Ge(u*a,-1,1)),g=Ge(We(f),-85.051129,Sr);return new Kt(p,g)}}o.ARRAY_TYPE=fn,o.AUTH_ERR_MSG=jr,o.Aabb=Pn,o.Actor=class{constructor(i,e,n){this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Pt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ni()?i:J,this.scheduler=new zv}send(i,e,n,r,a=!1,u){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=u,this.callbacks[p]=n);const f=ur(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:i,hasCallback:!!n,targetMapId:r,mustQueue:a,sourceMapId:this.mapId,data:ws(e,f)},f),{cancel:()=>{n&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(i){const e=i.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const r=this.cancelCallbacks[n];delete this.cancelCallbacks[n],r&&r.cancel()}else if(e.mustQueue||Ni()){const r=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),r&&r.metadata||{type:"message"})}else this.processTask(n,e)}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(Lo(e.error)):n(null,Lo(e.data)))}else{const n=ur(this.globalScope)?void 0:[],r=e.hasCallback?(u,p)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:u?ws(u):null,data:ws(p,n)},n)}:u=>{},a=Lo(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,r);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],a.source)[u[1]](a,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=xh,o.Color=Vt,o.ColorMode=zr,o.CullFaceMode=nr,o.DEMData=bh,o.DataConstantProperty=x,o.DedupedRequest=W_,o.DepthMode=Wa,o.EXTENT=Et,o.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const n=e.getSource().maxzoom,r=1<<n,a=Math.floor(i.x),u=Math.floor((i.x-a)*r),p=Math.floor(i.y*r),f=this.findDEMTileFor(new Zi(n,a,n,u,p));return!(!f||!f.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,n=!0){e==null&&(e=null);const r=this._source();if(!r||i.y<0||i.y>1)return e;const a=r.getSource().maxzoom,u=1<<a,p=Math.floor(i.x),f=i.x-p,g=new Zi(a,p,a,Math.floor(f*u),Math.floor(i.y*u)),v=this.findDEMTileFor(g);if(!v||!v.dem)return e;const T=v.dem,S=1<<v.tileID.canonical.z,M=(f*S-v.tileID.canonical.x)*T.dim,P=(i.y*S-v.tileID.canonical.y)*T.dim,F=Math.floor(M),V=Math.floor(P);return(n?this.exaggeration():1)*pt(pt(T.get(F,V),T.get(F,V+1),P-V),pt(T.get(F+1,V),T.get(F+1,V+1),P-V),M-F)}getAtTileOffset(i,e,n){const r=1<<i.canonical.z;return this.getAtPointOrZero(new Ju(i.wrap+(i.canonical.x+e/Et)/r,(i.canonical.y+n/Et)/r))}getAtTileOffsetFunc(i,e,n,r){return a=>{const u=this.getAtTileOffset(i,a.x,a.y),p=r.upVector(i.canonical,a.x,a.y);return nc(p,p,u*r.upVectorScale(i.canonical,e,n).metersToTile),p}}getForTilePoints(i,e,n,r){const a=wh.create(this,i,r);return!!a&&(e.forEach(u=>{u[2]=this.exaggeration()*a.getElevationAt(u[0],u[1],n)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const n=e.dem.tree,r=e.tileID,a=1<<i.canonical.z-r.canonical.z;let u=i.canonical.x/a-r.canonical.x,p=i.canonical.y/a-r.canonical.y,f=0;for(let g=0;g<i.canonical.z-r.canonical.z&&!n.leaves[f];g++){u*=2,p*=2;const v=2*Math.floor(p)+Math.floor(u);f=n.childOffsets[f]+v,u%=1,p%=1}return{min:this.exaggeration()*n.minimums[f],max:this.exaggeration()*n.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=ut,o.EvaluationParameters=ti,o.Event=ct,o.Evented=_t,o.FillExtrusionBucket=dc,o.Frustum=id,o.GLOBE_RADIUS=Xa,o.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i),this._createAtmosphere(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(i){const e=new ee,n=new tt,r=65;for(let a=0;a<r;a++)for(let u=0;u<r;u++)e.emplaceBack(u,a);for(let a=0;a<64;a++)for(let u=0;u<64;u++){const p=a*r+u;n.emplaceBack(p+1,p,p+r),n.emplaceBack(p+r,p+r+1,p+1)}this._gridBuffer=i.createVertexBuffer(e,vc.members),this._gridIndexBuffer=i.createIndexBuffer(n,!0),this._gridSegments=fi.simpleSegment(0,0,4225,8192)}_createPoles(i){const e=new tt;for(let a=0;a<=64;a++)e.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const n=new ft,r=new ft;this._poleSegments=[];for(let a=0,u=0;a<5;a++){const p=1<<a,f=512*p/Math.PI/2,g=360/p;n.emplaceBack(0,-f,0,0,0,.5,0),r.emplaceBack(0,-f,0,0,0,.5,1);for(let v=0;v<=64;v++){const T=v/64,S=pt(0,g,T),[M,P,F]=w_(Bv,Fv,S,f);n.emplaceBack(M,P,F,0,0,T,0),r.emplaceBack(M,P,F,0,0,T,1)}this._poleSegments.push(fi.simpleSegment(u,0,66,64)),u+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(n,v_,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(r,v_,!1)}_createAtmosphere(i){const e=new At;e.emplaceBack(-1,1,1,0,0),e.emplaceBack(1,1,1,1,0),e.emplaceBack(1,-1,1,1,1),e.emplaceBack(-1,-1,1,0,1);const n=new tt;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.atmosphereVertexBuffer=i.createVertexBuffer(e,Pv.members),this.atmosphereIndexBuffer=i.createIndexBuffer(n),this.atmosphereSegments=fi.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i){if(!this._wireframeSegments){const e=new gt,n=64,r=n+1;for(let a=0;a<n;a++)for(let u=0;u<n;u++){const p=a*r+u;e.emplaceBack(p,p+1),e.emplaceBack(p,p+r),e.emplaceBack(p,p+r+1)}this._wireframeIndexBuffer=i.createIndexBuffer(e),this._wireframeSegments=fi.simpleSegment(0,0,n*n,e.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},o.GlyphManager=Za,o.ImagePosition=fd,o.LineAtlas=Md,o.LngLat=Kt,o.LngLatBounds=Vo,o.LocalGlyphMode=yd,o.MAX_MERCATOR_LATITUDE=Sr,o.MercatorCoordinate=Ju,o.ONE_EM=Oi,o.OverscaledTileID=Zi,o.Properties=R,o.RGBAImage=mn,o.Ray=class{constructor(i,e){this.pos=i,this.dir=e}intersectsPlane(i,e,n){const r=oc(e,this.dir);if(Math.abs(r)<1e-6)return!1;const a=((i[0]-this.pos[0])*e[0]+(i[1]-this.pos[1])*e[1]+(i[2]-this.pos[2])*e[2])/r;return n[0]=this.pos[0]+this.dir[0]*a,n[1]=this.pos[1]+this.dir[1]*a,n[2]=this.pos[2]+this.dir[2]*a,!0}closestPointOnSphere(i,e,n){if(function(M,P){var F=M[0],V=M[1],q=M[2],Y=P[0],oe=P[1],le=P[2];return Math.abs(F-Y)<=Wp*Math.max(1,Math.abs(F),Math.abs(Y))&&Math.abs(V-oe)<=Wp*Math.max(1,Math.abs(V),Math.abs(oe))&&Math.abs(q-le)<=Wp*Math.max(1,Math.abs(q),Math.abs(le))}(this.pos,i)||e===0)return n[0]=n[1]=n[2]=0,!1;const[r,a,u]=this.dir,p=this.pos[0]-i[0],f=this.pos[1]-i[1],g=this.pos[2]-i[2],v=r*r+a*a+u*u,T=2*(p*r+f*a+g*u),S=T*T-4*v*(p*p+f*f+g*g-e*e);if(S<0){const M=Math.max(-T/2,0),P=p+r*M,F=f+a*M,V=g+u*M,q=Math.hypot(P,F,V);return n[0]=P*e/q,n[1]=F*e/q,n[2]=V*e/q,!1}{const M=(-T-Math.sqrt(S))/(2*v);if(M<0){const P=Math.hypot(p,f,g);return n[0]=p*e/P,n[1]=f*e/P,n[2]=g*e/P,!1}return n[0]=p+r*M,n[1]=f+a*M,n[2]=g+u*M,!0}}},o.RequestManager=class{constructor(i,e,n){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yo,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!En(i))return i;const n=An(i);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!En(i))return i;const n=An(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(i,e){if(!En(i))return i;const n=An(i);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(i,e,n,r){const a=An(i);return En(i)?(a.path=`/styles/v1${a.path}/sprite${e}${n}`,this._makeAPIURL(a,this._customAccessToken||r)):(a.path+=`${e}${n}`,pr(a))}normalizeTileURL(i,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!En(i))return i;const r=An(i);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&r.authority!=="raster"&&n===512?"@2x":""}${hr.supported?".webp":"$1"}`),r.authority==="raster"?r.path=`/${$t.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${$t.TILE_URL_VERSION}${r.path}`);const a=this._customAccessToken||function(u){for(const p of u){const f=p.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(r.params)||$t.ACCESS_TOKEN;return $t.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,a)}canonicalizeTileURL(i,e){const n=An(i);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let r="mapbox://";n.path.match(/^\/raster\/v1\//)?r+=`raster/${n.path.replace(`/${$t.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${n.path.replace(`/${$t.TILE_URL_VERSION}/`,"")}`;let a=n.params;return e&&(a=a.filter(u=>!u.match(/^access_token=/))),a.length&&(r+=`?${a.join("&")}`),r}canonicalizeTileset(i,e){const n=!!e&&En(e),r=[];for(const a of i.tiles||[])Gr(a)?r.push(this.canonicalizeTileURL(a,n)):r.push(a);return r}_makeAPIURL(i,e){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=An($t.API_URL);if(i.protocol=r.protocol,i.authority=r.authority,i.protocol==="http"){const a=i.params.indexOf("secure");a>=0&&i.params.splice(a,1)}if(r.path!=="/"&&(i.path=`${r.path}${i.path}`),!$t.REQUIRE_ACCESS_TOKEN)return pr(i);if(e=e||$t.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(a=>a.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),pr(i)}},o.ResourceType=K,o.SegmentVector=fi,o.SourceCache=Bs,o.StencilMode=Dd,o.StructArrayLayout1ui2=Nt,o.StructArrayLayout2f1f2i16=ot,o.StructArrayLayout2i4=ee,o.StructArrayLayout2ui4=gt,o.StructArrayLayout3f12=Ne,o.StructArrayLayout3ui6=tt,o.StructArrayLayout4i8=re,o.Texture=xc,o.Tile=kd,o.Transitionable=c,o.Uniform1f=Yu,o.Uniform1i=class extends oo{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends oo{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.Uniform3f=class extends oo{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.Uniform4f=im,o.UniformColor=nm,o.UniformMatrix2f=class extends oo{constructor(i,e){super(i,e),this.current=P0}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},o.UniformMatrix3f=class extends oo{constructor(i,e){super(i,e),this.current=k0}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},o.UniformMatrix4f=class extends oo{constructor(i,e){super(i,e),this.current=z0}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.UnwrappedTileID=C_,o.ValidationError=Ke,o.VectorTileWorkerSource=class extends _t{constructor(i,e,n,r,a){super(),this.actor=i,this.layerIndex=e,this.availableImages=n,this.loadVectorData=a||H_,this.loading={},this.loaded={},this.deduped=new W_(i.scheduler),this.isSpriteLoaded=r,this.scheduler=i.scheduler}loadTile(i,e){const n=i.uid,r=i&&i.request,a=r&&r.collectResourceTiming,u=this.loading[n]=new $v(i);u.abort=this.loadVectorData(i,(p,f)=>{const g=!this.loading[n];if(delete this.loading[n],g||p||!f)return u.status="done",g||(this.loaded[n]=u),e(p);const v=f.rawData,T={};f.expires&&(T.expires=f.expires),f.cacheControl&&(T.cacheControl=f.cacheControl),u.vectorTile=f.vectorTile||new Ls.VectorTile(new _c(v));const S=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,P)=>{if(M||!P)return e(M);const F={};if(a){const V=x_(r);V.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify(V)))}e(null,Ie({rawTileData:v.slice(0)},P,T,F))})};this.isSpriteLoaded?S():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(S,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):S()}),this.loaded=this.loaded||{},this.loaded[n]=u})}reloadTile(i,e){const n=this.loaded,r=i.uid,a=this;if(n&&n[r]){const u=n[r];u.showCollisionBoxes=i.showCollisionBoxes,u.enableTerrain=!!i.enableTerrain,u.projection=i.projection,u.tileTransform=Rs(i.tileID.canonical,i.projection);const p=(f,g)=>{const v=u.reloadCallback;v&&(delete u.reloadCallback,u.parse(u.vectorTile,a.layerIndex,this.availableImages,a.actor,v)),e(f,g)};u.status==="parsing"?u.reloadCallback=p:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(i,e){const n=i.uid,r=this.loading[n];r&&(r.abort&&r.abort(),delete this.loading[n]),e()}removeTile(i,e){const n=this.loaded,r=i.uid;n&&n[r]&&delete n[r],e()}},o.WritingMode=Dn,o.ZoomHistory=Vl,o.add=ym,o.addDynamicAttributes=wd,o.adjoint=function(i,e){var n=e[0],r=e[1],a=e[2],u=e[3],p=e[4],f=e[5],g=e[6],v=e[7],T=e[8];return i[0]=p*T-f*v,i[1]=a*v-r*T,i[2]=r*f-a*p,i[3]=f*g-u*T,i[4]=n*T-a*g,i[5]=a*u-n*f,i[6]=u*v-p*g,i[7]=r*g-n*v,i[8]=n*p-r*u,i},o.asyncAll=xt,o.bezier=He,o.bindAll=Pt,o.boundsAttributes=D_,o.bufferConvexPolygon=function(i,e){const n=[];for(let r=0;r<i.length;r++){const a=yt(r-1,-1,i.length-1),u=yt(r+1,-1,i.length-1),p=i[r],f=i[u],g=i[a].sub(p).unit(),v=f.sub(p).unit(),T=v.angleWithSep(g.x,g.y),S=g.add(v).unit().mult(-1*e/Math.sin(T/2));n.push(p.add(S))}return n},o.cacheEntryPossiblyAdded=function(i){wo++,wo>Wr&&(i.getActor().send("enforceCacheSizeLimit",Xr),wo=0)},o.calculateGlobeLabelMatrix=function(i,e){const{lng:n,lat:r}=i._center,a=S_(0,0,i.worldSize/i._projectionScaler,n,r);return Hp(a,a,function(u){const p=Ar(new Float64Array(16)),f=1/zd(u);return Ps(p,p,u.min),$o(p,p,[f,f,f]),p}(bc(e)))},o.calculateGlobeMatrix=A_,o.calculateGlobeMercatorMatrix=function(i){const e=i.worldSize,n=i.point,r=La(1,i.center.lat)*e,a=i.pixelsPerMeter,u=e/(r/i.pixelsPerMeter),p=Ar(new Float64Array(16));return Ps(p,p,[n.x,n.y,0]),$o(p,p,[u,u,a]),Float32Array.from(p)},o.circumferenceAtLatitude=$p,o.clamp=Ge,o.clearTileCache=function(i){const e=J.caches.delete(Js);i&&e.catch(i).then(()=>i())},o.clipLine=u_,o.clone=function(i){var e=new fn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=ri,o.collisionCircleLayout=$x,o.config=$t,o.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},o.create=function(){var i=new fn(16);return fn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.create$1=mm,o.createExpression=fs,o.createLayout=ie,o.createStyleLayer=function(i){return i.type==="custom"?new Sv(i):new Mv[i.type](i)},o.cross=bm,o.degToRad=ve,o.div=function(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i},o.dot=oc,o.earthRadius=Vp,o.ease=je,o.easeCubicInOut=Ze,o.emitValidationErrors=zu,o.endsWith=Rt,o.enforceCacheSizeLimit=function(i){bo(),Mn&&Mn.then(e=>{e.keys().then(n=>{for(let r=0;r<n.length-i;r++)e.delete(n[r])})})},o.evaluateSizeForFeature=uh,o.evaluateSizeForZoom=Va,o.evaluateVariableOffset=m_,o.evented=Kl,o.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},o.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},o.exported=$i,o.exported$1=hr,o.extend=Ie,o.extend$1=jt,o.filterObject=Di,o.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},o.fromQuat=function(i,e){var n=e[0],r=e[1],a=e[2],u=e[3],p=n+n,f=r+r,g=a+a,v=n*p,T=r*p,S=r*f,M=a*p,P=a*f,F=a*g,V=u*p,q=u*f,Y=u*g;return i[0]=1-S-F,i[1]=T+Y,i[2]=M-q,i[3]=0,i[4]=T-Y,i[5]=1-v-F,i[6]=P+V,i[7]=0,i[8]=M+q,i[9]=P-V,i[10]=1-v-S,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.fromRotation=function(i,e){var n=Math.sin(e),r=Math.cos(e);return i[0]=r,i[1]=n,i[2]=0,i[3]=-n,i[4]=r,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},o.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return Xe[e]},o.getAABBPointSquareDist=function(i,e,n){let r=0;for(let a=0;a<2;++a){const u=n?n[a]:0;i[a]>u&&(r+=(i[a]-u)*(i[a]-u)),e[a]<u&&(r+=(u-e[a])*(u-e[a]))}return r},o.getAnchorAlignment=gd,o.getAnchorJustification=vd,o.getBounds=function(i){let e=1/0,n=1/0,r=-1/0,a=-1/0;for(const u of i)e=Math.min(e,u.x),n=Math.min(n,u.y),r=Math.max(r,u.x),a=Math.max(a,u.y);return{min:new D(e,n),max:new D(r,a)}},o.getColumn=function(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]},o.getGridMatrix=function(i,e){const[n,r]=e,a=.015625;return[0,(r[1]-n[1])*a,1<<i.z,(r[0]-n[0])*a,0,i.y,n[0],n[1],a]},o.getImage=Ye,o.getJSON=function(i,e){return W(Ie(i,{type:"json"}),e)},o.getMapSessionAPI=Ks,o.getPerformanceMeasurement=x_,o.getProjection=function(i){const e=i.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new Gv(i);case"equirectangular":return new Xv(i);case"naturalEarth":return new Hv(i);case"equalEarth":return new qv(i);case"winkelTripel":return new Yv(i);case"albers":return n?new J_(i):new Zv(i);case"lambertConformalConic":return n?new J_(i):new Wv(i)}throw new Error(`Invalid projection name: ${i.name}`)},o.getRTLTextPluginStatus=ka,o.getReferrer=N,o.getTilePoint=function(i,{x:e,y:n},r=0){return new D(((e-r)*i.scale-i.x)*Et,(n*i.scale-i.y)*Et)},o.getTileVec3=function(i,e,n=0){return ic(((e.x-n)*i.scale-i.x)*Et,(e.y*i.scale-i.y)*Et,sm(e.z,e.y))},o.getVideo=function(i,e){const n=J.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let r=0;r<i.length;r++){const a=J.document.createElement("source");de(i[r])||(n.crossOrigin="Anonymous"),a.src=i[r],n.appendChild(a)}return{cancel:()=>{}}},o.globeECEFOrigin=function(i,e){const n=[0,0,0];return Ds(n,n,E_(bc(e.canonical))),Ds(n,n,i),n},o.globePixelsToTileUnits=function(i,e){return Et/(512*Math.pow(2,i))*zd(bc(e))},o.globePoleMatrixForTile=function(i,e,n){const r=Ar(new Float64Array(16)),a=1<<i,u=360*(e/a-.5),p=n.point,f=n.worldSize/(n.tileSize*a);return Ps(r,r,[p.x,p.y,-n.worldSize/Math.PI/2]),$o(r,r,[f,f,f]),Yp(r,r,ve(-n._center.lat)),Kp(r,r,ve(-n._center.lng+u)),Float32Array.from(r)},o.globeTileLatLngCorners=Cd,o.globeToMercatorTransition=function(i){return Tt(5,6,i)},o.identity=Ar,o.identity$1=Em,o.invert=function(i,e){var n=e[0],r=e[1],a=e[2],u=e[3],p=e[4],f=e[5],g=e[6],v=e[7],T=e[8],S=e[9],M=e[10],P=e[11],F=e[12],V=e[13],q=e[14],Y=e[15],oe=n*f-r*p,le=n*g-a*p,ue=n*v-u*p,he=r*g-a*f,pe=r*v-u*f,Te=a*v-u*g,Se=T*V-S*F,ze=T*q-M*F,De=T*Y-P*F,be=S*q-M*V,Ce=S*Y-P*V,Re=M*Y-P*q,$e=oe*Re-le*Ce+ue*be+he*De-pe*ze+Te*Se;return $e?(i[0]=(f*Re-g*Ce+v*be)*($e=1/$e),i[1]=(a*Ce-r*Re-u*be)*$e,i[2]=(V*Te-q*pe+Y*he)*$e,i[3]=(M*pe-S*Te-P*he)*$e,i[4]=(g*De-p*Re-v*ze)*$e,i[5]=(n*Re-a*De+u*ze)*$e,i[6]=(q*ue-F*Te-Y*le)*$e,i[7]=(T*Te-M*ue+P*le)*$e,i[8]=(p*Ce-f*De+v*Se)*$e,i[9]=(r*De-n*Ce-u*Se)*$e,i[10]=(F*pe-V*ue+Y*oe)*$e,i[11]=(S*ue-T*pe-P*oe)*$e,i[12]=(f*ze-p*be-g*Se)*$e,i[13]=(n*be-r*ze+a*Se)*$e,i[14]=(V*le-F*he-q*oe)*$e,i[15]=(T*he-S*le+M*oe)*$e,i):null},o.isMapAuthenticated=function(i){return qr.has(i)},o.isMapboxURL=En,o.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!ur(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Fi,o.len=H0,o.length=gm,o.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},o.loadVectorTile=H_,o.makeRequest=W,o.mercatorXfromLng=tc,o.mercatorYfromLat=Da,o.mercatorZfromAltitude=La,o.mul=X0,o.mul$1=W0,o.multiply=function(i,e,n){var r=e[0],a=e[1],u=e[2],p=e[3],f=e[4],g=e[5],v=e[6],T=e[7],S=e[8],M=n[0],P=n[1],F=n[2],V=n[3],q=n[4],Y=n[5],oe=n[6],le=n[7],ue=n[8];return i[0]=M*r+P*p+F*v,i[1]=M*a+P*f+F*T,i[2]=M*u+P*g+F*S,i[3]=V*r+q*p+Y*v,i[4]=V*a+q*f+Y*T,i[5]=V*u+q*g+Y*S,i[6]=oe*r+le*p+ue*v,i[7]=oe*a+le*f+ue*T,i[8]=oe*u+le*g+ue*S,i},o.multiply$1=Hp,o.multiply$2=vm,o.nextPowerOfTwo=Be,o.normalize=rc,o.normalize$1=function(i,e){var n=e[0],r=e[1],a=e[2],u=e[3],p=n*n+r*r+a*a+u*u;return p>0&&(p=1/Math.sqrt(p)),i[0]=n*p,i[1]=r*p,i[2]=a*p,i[3]=u*p,i},o.number=pt,o.ortho=function(i,e,n,r,a,u,p){var f=1/(e-n),g=1/(r-a),v=1/(u-p);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*v,i[11]=0,i[12]=(e+n)*f,i[13]=(a+r)*g,i[14]=(p+u)*v,i[15]=1,i},o.pbf=_c,o.perspective=function(i,e,n,r,a){var u,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,a!=null&&a!==1/0?(i[10]=(a+r)*(u=1/(r-a)),i[14]=2*a*r*u):(i[10]=-1,i[14]=-2*r),i},o.pick=function(i,e){const n={};for(let r=0;r<e.length;r++){const a=e[r];a in i&&(n[a]=i[a])}return n},o.plugin=pn,o.pointGeometry=D,o.polygonIntersectsBox=pm,o.polygonIntersectsPolygon=lm,o.polygonizeBounds=function(i,e,n=0,r=!0){const a=new D(n,n),u=i.sub(a),p=e.add(a),f=[u,new D(p.x,u.y),p,new D(u.x,p.y)];return r&&f.push(u),f},o.posAttributes=vc,o.postMapLoadEvent=Ys,o.postTurnstileEvent=pl,o.potpack=dd,o.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},o.radToDeg=We,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(i){return i({pluginStatus:Gi,pluginURL:en}),Kl.on("pluginStateChange",i),i},o.removeAuthState=function(i){qr.delete(i)},o.renderColorRamp=rd,o.rotateX=Yp,o.rotateX$1=Sm,o.rotateY=Kp,o.rotateZ=function(i,e,n){var r=Math.sin(n),a=Math.cos(n),u=e[0],p=e[1],f=e[2],g=e[3],v=e[4],T=e[5],S=e[6],M=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*a+v*r,i[1]=p*a+T*r,i[2]=f*a+S*r,i[3]=g*a+M*r,i[4]=v*a-u*r,i[5]=T*a-p*r,i[6]=S*a-f*r,i[7]=M*a-g*r,i},o.rotateZ$1=function(i,e,n){n*=.5;var r=e[0],a=e[1],u=e[2],p=e[3],f=Math.sin(n),g=Math.cos(n);return i[0]=r*g+a*f,i[1]=a*g-r*f,i[2]=u*g+p*f,i[3]=p*g-u*f,i},o.scale=$o,o.scale$1=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},o.scale$2=nc,o.scaleAndAdd=td,o.setCacheLimits=function(i,e){Xr=i,Wr=e},o.setColumn=function(i,e,n){i[4*e+0]=n[0],i[4*e+1]=n[1],i[4*e+2]=n[2],i[4*e+3]=n[3]},o.setRTLTextPlugin=function(i,e,n=!1){if(Gi===Wl||Gi===As||Gi===Hl)throw new Error("setRTLTextPlugin cannot be called multiple times.");en=$i.resolveURL(i),Gi=Wl,Yl=e,no(),n||Bo()},o.smoothstep=Tt,o.spec=ye,o.storeAuthState=function(i,e){e?qr.add(i):qr.delete(i)},o.sub=Fa,o.subtract=xm,o.symbolSize=jx,o.tileAABB=function(i,e,n,r,a,u,p,f,g){if(g.name==="globe")return Rv(i,e,new xh(n,r,a));const v=Rs({z:n,x:r,y:a},g);return new Pn([(u+v.x/v.scale)*e,e*(v.y/v.scale),p],[(u+v.x2/v.scale)*e,e*(v.y2/v.scale),f])},o.tileTransform=Rs,o.transformMat3=function(i,e,n){var r=e[0],a=e[1],u=e[2];return i[0]=r*n[0]+a*n[3]+u*n[6],i[1]=r*n[1]+a*n[4]+u*n[7],i[2]=r*n[2]+a*n[5]+u*n[8],i},o.transformMat4=Ds,o.transformMat4$1=Oa,o.transformQuat=wm,o.translate=Ps,o.transpose=function(i,e){if(i===e){var n=e[1],r=e[2],a=e[5];i[1]=e[3],i[2]=e[6],i[3]=n,i[5]=e[7],i[6]=r,i[7]=a}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},o.triggerPluginCompletionEvent=Ms,o.uniqueId=Je,o.validateCustomStyleLayer=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=i=>Jn(br(i)),o.validateFog=i=>Jn(Cu(i)),o.validateLayer=i=>Jn(Eu(i)),o.validateLight=i=>Jn(Mu(i)),o.validateSource=i=>Jn(Au(i)),o.validateStyle=bs,o.validateTerrain=i=>Jn(Iu(i)),o.values=St,o.vectorTile=Ls,o.version=O,o.warnOnce=Ct,o.window=J,o.wrap=yt}),C(["./shared"],function(o){function O(K){if(typeof K=="number"||typeof K=="boolean"||typeof K=="string"||K==null)return JSON.stringify(K);if(Array.isArray(K)){let N="[";for(const W of K)N+=`${O(W)},`;return`${N}]`}let L="{";for(const N of Object.keys(K).sort())L+=`${N}:${O(K[N])},`;return`${L}}`}function B(K){let L="";for(const N of o.refProperties)L+=`/${O(K[N])}`;return L}class ${constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,N){for(const ne of L)this._layerConfigs[ne.id]=ne,(this._layers[ne.id]=o.createStyleLayer(ne)).compileFilter(),this.keyCache[ne.id]&&delete this.keyCache[ne.id];for(const ne of N)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const W=function(ne,ae){const fe={};for(let ce=0;ce<ne.length;ce++){const ge=ae&&ae[ne[ce].id]||B(ne[ce]);ae&&(ae[ne[ce].id]=ge);let ke=fe[ge];ke||(ke=fe[ge]=[]),ke.push(ne[ce])}const de=[];for(const ce in fe)de.push(fe[ce]);return de}(o.values(this._layerConfigs),this.keyCache);for(const ne of W){const ae=ne.map(Ye=>this._layers[Ye.id]),fe=ae[0];if(fe.visibility==="none")continue;const de=fe.source||"";let ce=this.familiesBySource[de];ce||(ce=this.familiesBySource[de]={});const ge=fe.sourceLayer||"_geojsonTileLayer";let ke=ce[ge];ke||(ke=ce[ge]=[]),ke.push(ae)}}}class D{loadTile(L,N){const{uid:W,encoding:ne,rawImageData:ae,padding:fe,buildQuadTree:de}=L,ce=o.window.ImageBitmap&&ae instanceof o.window.ImageBitmap?this.getImageData(ae,fe):ae;N(null,new o.DEMData(W,ce,ne,fe<1,de))}getImageData(L,N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const W=this.offscreenCanvasContext.getImageData(-N,-N,L.width+2*N,L.height+2*N);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),W}}var G=function K(L,N){var W,ne=L&&L.type;if(ne==="FeatureCollection")for(W=0;W<L.features.length;W++)K(L.features[W],N);else if(ne==="GeometryCollection")for(W=0;W<L.geometries.length;W++)K(L.geometries[W],N);else if(ne==="Feature")K(L.geometry,N);else if(ne==="Polygon")J(L.coordinates,N);else if(ne==="MultiPolygon")for(W=0;W<L.coordinates.length;W++)J(L.coordinates[W],N);return L};function J(K,L){if(K.length!==0){xe(K[0],L);for(var N=1;N<K.length;N++)xe(K[N],!L)}}function xe(K,L){for(var N=0,W=0,ne=0,ae=K.length,fe=ae-1;ne<ae;fe=ne++){var de=(K[ne][0]-K[fe][0])*(K[fe][1]+K[ne][1]),ce=N+de;W+=Math.abs(N)>=Math.abs(de)?N-ce+de:de-ce+N,N=ce}N+W>=0!=!!L&&K.reverse()}const Pe=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ve{constructor(L){this._feature=L,this.extent=o.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(this._feature.type===1){const L=[];for(const N of this._feature.geometry)L.push([new o.pointGeometry(N[0],N[1])]);return L}{const L=[];for(const N of this._feature.geometry){const W=[];for(const ne of N)W.push(new o.pointGeometry(ne[0],ne[1]));L.push(W)}return L}}toGeoJSON(L,N,W){return Pe.call(this,L,N,W)}}class We{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=L.length,this._features=L}feature(L){return new ve(this._features[L])}}var Xe=o.vectorTile.VectorTileFeature,Ze=He;function He(K,L){this.options=L||{},this.features=K,this.length=K.length}function je(K,L){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=L||4096}He.prototype.feature=function(K){return new je(this.features[K],this.options.extent)},je.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var L=0;L<K.length;L++){for(var N=K[L],W=[],ne=0;ne<N.length;ne++)W.push(new o.pointGeometry(N[ne][0],N[ne][1]));this.geometry.push(W)}return this.geometry},je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,L=1/0,N=-1/0,W=1/0,ne=-1/0,ae=0;ae<K.length;ae++)for(var fe=K[ae],de=0;de<fe.length;de++){var ce=fe[de];L=Math.min(L,ce.x),N=Math.max(N,ce.x),W=Math.min(W,ce.y),ne=Math.max(ne,ce.y)}return[L,W,N,ne]},je.prototype.toGeoJSON=Xe.prototype.toGeoJSON;var Ge=yt,Tt=Ze;function yt(K){var L=new o.pbf;return function(N,W){for(var ne in N.layers)W.writeMessage(3,xt,N.layers[ne])}(K,L),L.finish()}function xt(K,L){var N;L.writeVarintField(15,K.version||1),L.writeStringField(1,K.name||""),L.writeVarintField(5,K.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<K.length;N++)W.feature=K.feature(N),L.writeMessage(2,St,W);var ne=W.keys;for(N=0;N<ne.length;N++)L.writeStringField(3,ne[N]);var ae=W.values;for(N=0;N<ae.length;N++)L.writeMessage(4,Be,ae[N])}function St(K,L){var N=K.feature;N.id!==void 0&&L.writeVarintField(1,N.id),L.writeMessage(2,Ie,K),L.writeVarintField(3,N.type),L.writeMessage(4,vt,N)}function Ie(K,L){var N=K.feature,W=K.keys,ne=K.values,ae=K.keycache,fe=K.valuecache;for(var de in N.properties){var ce=N.properties[de],ge=ae[de];if(ce!==null){ge===void 0&&(W.push(de),ae[de]=ge=W.length-1),L.writeVarint(ge);var ke=typeof ce;ke!=="string"&&ke!=="boolean"&&ke!=="number"&&(ce=JSON.stringify(ce));var Ye=ke+":"+ce,Le=fe[Ye];Le===void 0&&(ne.push(ce),fe[Ye]=Le=ne.length-1),L.writeVarint(Le)}}}function rt(K,L){return(L<<3)+(7&K)}function Je(K){return K<<1^K>>31}function vt(K,L){for(var N=K.loadGeometry(),W=K.type,ne=0,ae=0,fe=N.length,de=0;de<fe;de++){var ce=N[de],ge=1;W===1&&(ge=ce.length),L.writeVarint(rt(1,ge));for(var ke=W===3?ce.length-1:ce.length,Ye=0;Ye<ke;Ye++){Ye===1&&W!==1&&L.writeVarint(rt(2,ke-1));var Le=ce[Ye].x-ne,dt=ce[Ye].y-ae;L.writeVarint(Je(Le)),L.writeVarint(Je(dt)),ne+=Le,ae+=dt}W===3&&L.writeVarint(rt(7,1))}}function Be(K,L){var N=typeof K;N==="string"?L.writeStringField(1,K):N==="boolean"?L.writeBooleanField(7,K):N==="number"&&(K%1!=0?L.writeDoubleField(3,K):K<0?L.writeSVarintField(6,K):L.writeVarintField(5,K))}function mt(K,L,N,W,ne,ae){if(ne-W<=N)return;const fe=W+ne>>1;Pt(K,L,fe,W,ne,ae%2),mt(K,L,N,W,fe-1,ae+1),mt(K,L,N,fe+1,ne,ae+1)}function Pt(K,L,N,W,ne,ae){for(;ne>W;){if(ne-W>600){const ge=ne-W+1,ke=N-W+1,Ye=Math.log(ge),Le=.5*Math.exp(2*Ye/3),dt=.5*Math.sqrt(Ye*Le*(ge-Le)/ge)*(ke-ge/2<0?-1:1);Pt(K,L,N,Math.max(W,Math.floor(N-ke*Le/ge+dt)),Math.min(ne,Math.floor(N+(ge-ke)*Le/ge+dt)),ae)}const fe=L[2*N+ae];let de=W,ce=ne;for(Rt(K,L,W,N),L[2*ne+ae]>fe&&Rt(K,L,W,ne);de<ce;){for(Rt(K,L,de,ce),de++,ce--;L[2*de+ae]<fe;)de++;for(;L[2*ce+ae]>fe;)ce--}L[2*W+ae]===fe?Rt(K,L,W,ce):(ce++,Rt(K,L,ce,ne)),ce<=N&&(W=ce+1),N<=ce&&(ne=ce-1)}}function Rt(K,L,N,W){It(K,N,W),It(L,2*N,2*W),It(L,2*N+1,2*W+1)}function It(K,L,N){const W=K[L];K[L]=K[N],K[N]=W}function Di(K,L,N,W){const ne=K-N,ae=L-W;return ne*ne+ae*ae}Ge.fromVectorTileJs=yt,Ge.fromGeojsonVt=function(K,L){L=L||{};var N={};for(var W in K)N[W]=new Ze(K[W].features,L),N[W].name=W,N[W].version=L.version,N[W].extent=L.extent;return yt({layers:N})},Ge.GeoJSONWrapper=Tt;const ri=K=>K[0],Li=K=>K[1];class Ct{constructor(L,N=ri,W=Li,ne=64,ae=Float64Array){this.nodeSize=ne,this.points=L;const fe=L.length<65536?Uint16Array:Uint32Array,de=this.ids=new fe(L.length),ce=this.coords=new ae(2*L.length);for(let ge=0;ge<L.length;ge++)de[ge]=ge,ce[2*ge]=N(L[ge]),ce[2*ge+1]=W(L[ge]);mt(de,ce,ne,0,de.length-1,0)}range(L,N,W,ne){return function(ae,fe,de,ce,ge,ke,Ye){const Le=[0,ae.length-1,0],dt=[];let ct,ut;for(;Le.length;){const _t=Le.pop(),ye=Le.pop(),jt=Le.pop();if(ye-jt<=Ye){for(let Gt=jt;Gt<=ye;Gt++)ct=fe[2*Gt],ut=fe[2*Gt+1],ct>=de&&ct<=ge&&ut>=ce&&ut<=ke&&dt.push(ae[Gt]);continue}const st=Math.floor((jt+ye)/2);ct=fe[2*st],ut=fe[2*st+1],ct>=de&&ct<=ge&&ut>=ce&&ut<=ke&&dt.push(ae[st]);const Ut=(_t+1)%2;(_t===0?de<=ct:ce<=ut)&&(Le.push(jt),Le.push(st-1),Le.push(Ut)),(_t===0?ge>=ct:ke>=ut)&&(Le.push(st+1),Le.push(ye),Le.push(Ut))}return dt}(this.ids,this.coords,L,N,W,ne,this.nodeSize)}within(L,N,W){return function(ne,ae,fe,de,ce,ge){const ke=[0,ne.length-1,0],Ye=[],Le=ce*ce;for(;ke.length;){const dt=ke.pop(),ct=ke.pop(),ut=ke.pop();if(ct-ut<=ge){for(let Ut=ut;Ut<=ct;Ut++)Di(ae[2*Ut],ae[2*Ut+1],fe,de)<=Le&&Ye.push(ne[Ut]);continue}const _t=Math.floor((ut+ct)/2),ye=ae[2*_t],jt=ae[2*_t+1];Di(ye,jt,fe,de)<=Le&&Ye.push(ne[_t]);const st=(dt+1)%2;(dt===0?fe-ce<=ye:de-ce<=jt)&&(ke.push(ut),ke.push(_t-1),ke.push(st)),(dt===0?fe+ce>=ye:de+ce>=jt)&&(ke.push(_t+1),ke.push(ct),ke.push(st))}return Ye}(this.ids,this.coords,L,N,W,this.nodeSize)}}const Yt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Ai=Math.fround||(Ni=new Float32Array(1),K=>(Ni[0]=+K,Ni[0]));var Ni;class Bn{constructor(L){this.options=$i(Object.create(Yt),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:N,minZoom:W,maxZoom:ne,nodeSize:ae}=this.options;N&&console.time("total time");const fe=`prepare ${L.length} points`;N&&console.time(fe),this.points=L;let de=[];for(let ce=0;ce<L.length;ce++)L[ce].geometry&&de.push(cr(L[ce],ce));this.trees[ne+1]=new Ct(de,Ur,$t,ae,Float32Array),N&&console.timeEnd(fe);for(let ce=ne;ce>=W;ce--){const ge=+Date.now();de=this._cluster(de,ce),this.trees[ce]=new Ct(de,Ur,$t,ae,Float32Array),N&&console.log("z%d: %d clusters in %dms",ce,de.length,+Date.now()-ge)}return N&&console.timeEnd("total time"),this}getClusters(L,N){let W=((L[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,L[1]));let ae=L[2]===180?180:((L[2]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)W=-180,ae=180;else if(W>ae){const ke=this.getClusters([W,ne,180,fe],N),Ye=this.getClusters([-180,ne,ae,fe],N);return ke.concat(Ye)}const de=this.trees[this._limitZoom(N)],ce=de.range(Ot(W),ur(fe),Ot(ae),ur(ne)),ge=[];for(const ke of ce){const Ye=de.points[ke];ge.push(Ye.numPoints?Fn(Ye):this.points[Ye.index])}return ge}getChildren(L){const N=this._getOriginId(L),W=this._getOriginZoom(L),ne="No cluster with the specified id.",ae=this.trees[W];if(!ae)throw new Error(ne);const fe=ae.points[N];if(!fe)throw new Error(ne);const de=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ce=ae.within(fe.x,fe.y,de),ge=[];for(const ke of ce){const Ye=ae.points[ke];Ye.parentId===L&&ge.push(Ye.numPoints?Fn(Ye):this.points[Ye.index])}if(ge.length===0)throw new Error(ne);return ge}getLeaves(L,N,W){const ne=[];return this._appendLeaves(ne,L,N=N||10,W=W||0,0),ne}getTile(L,N,W){const ne=this.trees[this._limitZoom(L)],ae=Math.pow(2,L),{extent:fe,radius:de}=this.options,ce=de/fe,ge=(W-ce)/ae,ke=(W+1+ce)/ae,Ye={features:[]};return this._addTileFeatures(ne.range((N-ce)/ae,ge,(N+1+ce)/ae,ke),ne.points,N,W,ae,Ye),N===0&&this._addTileFeatures(ne.range(1-ce/ae,ge,1,ke),ne.points,ae,W,ae,Ye),N===ae-1&&this._addTileFeatures(ne.range(0,ge,ce/ae,ke),ne.points,-1,W,ae,Ye),Ye.features.length?Ye:null}getClusterExpansionZoom(L){let N=this._getOriginZoom(L)-1;for(;N<=this.options.maxZoom;){const W=this.getChildren(L);if(N++,W.length!==1)break;L=W[0].properties.cluster_id}return N}_appendLeaves(L,N,W,ne,ae){const fe=this.getChildren(N);for(const de of fe){const ce=de.properties;if(ce&&ce.cluster?ae+ce.point_count<=ne?ae+=ce.point_count:ae=this._appendLeaves(L,ce.cluster_id,W,ne,ae):ae<ne?ae++:L.push(de),L.length===W)break}return ae}_addTileFeatures(L,N,W,ne,ae,fe){for(const de of L){const ce=N[de],ge=ce.numPoints;let ke,Ye,Le;if(ge)ke=On(ce),Ye=ce.x,Le=ce.y;else{const ut=this.points[ce.index];ke=ut.properties,Ye=Ot(ut.geometry.coordinates[0]),Le=ur(ut.geometry.coordinates[1])}const dt={type:1,geometry:[[Math.round(this.options.extent*(Ye*ae-W)),Math.round(this.options.extent*(Le*ae-ne))]],tags:ke};let ct;ge?ct=ce.id:this.options.generateId?ct=ce.index:this.points[ce.index].id&&(ct=this.points[ce.index].id),ct!==void 0&&(dt.id=ct),fe.features.push(dt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(+L,this.options.maxZoom+1))}_cluster(L,N){const W=[],{radius:ne,extent:ae,reduce:fe,minPoints:de}=this.options,ce=ne/(ae*Math.pow(2,N));for(let ge=0;ge<L.length;ge++){const ke=L[ge];if(ke.zoom<=N)continue;ke.zoom=N;const Ye=this.trees[N+1],Le=Ye.within(ke.x,ke.y,ce),dt=ke.numPoints||1;let ct=dt;for(const ut of Le){const _t=Ye.points[ut];_t.zoom>N&&(ct+=_t.numPoints||1)}if(ct>dt&&ct>=de){let ut=ke.x*dt,_t=ke.y*dt,ye=fe&&dt>1?this._map(ke,!0):null;const jt=(ge<<5)+(N+1)+this.points.length;for(const st of Le){const Ut=Ye.points[st];if(Ut.zoom<=N)continue;Ut.zoom=N;const Gt=Ut.numPoints||1;ut+=Ut.x*Gt,_t+=Ut.y*Gt,Ut.parentId=jt,fe&&(ye||(ye=this._map(ke,!0)),fe(ye,this._map(Ut)))}ke.parentId=jt,W.push(ln(ut/ct,_t/ct,jt,ct,ye))}else if(W.push(ke),ct>1)for(const ut of Le){const _t=Ye.points[ut];_t.zoom<=N||(_t.zoom=N,W.push(_t))}}return W}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,N){if(L.numPoints)return N?$i({},L.properties):L.properties;const W=this.points[L.index].properties,ne=this.options.map(W);return N&&ne===W?$i({},ne):ne}}function ln(K,L,N,W,ne){return{x:Ai(K),y:Ai(L),zoom:1/0,id:N,parentId:-1,numPoints:W,properties:ne}}function cr(K,L){const[N,W]=K.geometry.coordinates;return{x:Ai(Ot(N)),y:Ai(ur(W)),zoom:1/0,index:L,parentId:-1}}function Fn(K){return{type:"Feature",id:K.id,properties:On(K),geometry:{type:"Point",coordinates:[(L=K.x,360*(L-.5)),Ws(K.y)]}};var L}function On(K){const L=K.numPoints,N=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return $i($i({},K.properties),{cluster:!0,cluster_id:K.id,point_count:L,point_count_abbreviated:N})}function Ot(K){return K/360+.5}function ur(K){const L=Math.sin(K*Math.PI/180),N=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return N<0?0:N>1?1:N}function Ws(K){const L=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function $i(K,L){for(const N in L)K[N]=L[N];return K}function Ur(K){return K.x}function $t(K){return K.y}function hr(K,L,N,W){for(var ne,ae=W,fe=N-L>>1,de=N-L,ce=K[L],ge=K[L+1],ke=K[N],Ye=K[N+1],Le=L+3;Le<N;Le+=3){var dt=Vr(K[Le],K[Le+1],ce,ge,ke,Ye);if(dt>ae)ne=Le,ae=dt;else if(dt===ae){var ct=Math.abs(Le-fe);ct<de&&(ne=Le,de=ct)}}ae>W&&(ne-L>3&&hr(K,L,ne,W),K[ne+2]=ae,N-ne>3&&hr(K,ne,N,W))}function Vr(K,L,N,W,ne,ae){var fe=ne-N,de=ae-W;if(fe!==0||de!==0){var ce=((K-N)*fe+(L-W)*de)/(fe*fe+de*de);ce>1?(N=ne,W=ae):ce>0&&(N+=fe*ce,W+=de*ce)}return(fe=K-N)*fe+(de=L-W)*de}function cn(K,L,N,W){var ne={id:K===void 0?null:K,type:L,geometry:N,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ae){var fe=ae.geometry,de=ae.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")$r(ae,fe);else if(de==="Polygon"||de==="MultiLineString")for(var ce=0;ce<fe.length;ce++)$r(ae,fe[ce]);else if(de==="MultiPolygon")for(ce=0;ce<fe.length;ce++)for(var ge=0;ge<fe[ce].length;ge++)$r(ae,fe[ce][ge])}(ne),ne}function $r(K,L){for(var N=0;N<L.length;N+=3)K.minX=Math.min(K.minX,L[N]),K.minY=Math.min(K.minY,L[N+1]),K.maxX=Math.max(K.maxX,L[N]),K.maxY=Math.max(K.maxY,L[N+1])}function go(K,L,N,W){if(L.geometry){var ne=L.geometry.coordinates,ae=L.geometry.type,fe=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),de=[],ce=L.id;if(N.promoteId?ce=L.properties[N.promoteId]:N.generateId&&(ce=W||0),ae==="Point")es(ne,de);else if(ae==="MultiPoint")for(var ge=0;ge<ne.length;ge++)es(ne[ge],de);else if(ae==="LineString")yo(ne,de,fe,!1);else if(ae==="MultiLineString"){if(N.lineMetrics){for(ge=0;ge<ne.length;ge++)yo(ne[ge],de=[],fe,!1),K.push(cn(ce,"LineString",de,L.properties));return}jr(ne,de,fe,!1)}else if(ae==="Polygon")jr(ne,de,fe,!0);else{if(ae!=="MultiPolygon"){if(ae==="GeometryCollection"){for(ge=0;ge<L.geometry.geometries.length;ge++)go(K,{id:ce,geometry:L.geometry.geometries[ge],properties:L.properties},N,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<ne.length;ge++){var ke=[];jr(ne[ge],ke,fe,!0),de.push(ke)}}K.push(cn(ce,ae,de,L.properties))}}function es(K,L){L.push(En(K[0])),L.push(Gr(K[1])),L.push(0)}function yo(K,L,N,W){for(var ne,ae,fe=0,de=0;de<K.length;de++){var ce=En(K[de][0]),ge=Gr(K[de][1]);L.push(ce),L.push(ge),L.push(0),de>0&&(fe+=W?(ne*ge-ce*ae)/2:Math.sqrt(Math.pow(ce-ne,2)+Math.pow(ge-ae,2))),ne=ce,ae=ge}var ke=L.length-3;L[2]=1,hr(L,0,ke,N),L[ke+2]=1,L.size=Math.abs(fe),L.start=0,L.end=L.size}function jr(K,L,N,W){for(var ne=0;ne<K.length;ne++){var ae=[];yo(K[ne],ae,N,W),L.push(ae)}}function En(K){return K/360+.5}function Gr(K){var L=Math.sin(K*Math.PI/180),N=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return N<0?0:N>1?1:N}function Sn(K,L,N,W,ne,ae,fe,de){if(W/=L,ae>=(N/=L)&&fe<W)return K;if(fe<N||ae>=W)return null;for(var ce=[],ge=0;ge<K.length;ge++){var ke=K[ge],Ye=ke.geometry,Le=ke.type,dt=ne===0?ke.minX:ke.minY,ct=ne===0?ke.maxX:ke.maxY;if(dt>=N&&ct<W)ce.push(ke);else if(!(ct<N||dt>=W)){var ut=[];if(Le==="Point"||Le==="MultiPoint")An(Ye,ut,N,W,ne);else if(Le==="LineString")pr(Ye,ut,N,W,ne,!1,de.lineMetrics);else if(Le==="MultiLineString")Zr(Ye,ut,N,W,ne,!1);else if(Le==="Polygon")Zr(Ye,ut,N,W,ne,!0);else if(Le==="MultiPolygon")for(var _t=0;_t<Ye.length;_t++){var ye=[];Zr(Ye[_t],ye,N,W,ne,!0),ye.length&&ut.push(ye)}if(ut.length){if(de.lineMetrics&&Le==="LineString"){for(_t=0;_t<ut.length;_t++)ce.push(cn(ke.id,Le,ut[_t],ke.tags));continue}Le!=="LineString"&&Le!=="MultiLineString"||(ut.length===1?(Le="LineString",ut=ut[0]):Le="MultiLineString"),Le!=="Point"&&Le!=="MultiPoint"||(Le=ut.length===3?"Point":"MultiPoint"),ce.push(cn(ke.id,Le,ut,ke.tags))}}}return ce.length?ce:null}function An(K,L,N,W,ne){for(var ae=0;ae<K.length;ae+=3){var fe=K[ae+ne];fe>=N&&fe<=W&&(L.push(K[ae]),L.push(K[ae+1]),L.push(K[ae+2]))}}function pr(K,L,N,W,ne,ae,fe){for(var de,ce,ge=ts(K),ke=ne===0?pl:Hs,Ye=K.start,Le=0;Le<K.length-3;Le+=3){var dt=K[Le],ct=K[Le+1],ut=K[Le+2],_t=K[Le+3],ye=K[Le+4],jt=ne===0?dt:ct,st=ne===0?_t:ye,Ut=!1;fe&&(de=Math.sqrt(Math.pow(dt-_t,2)+Math.pow(ct-ye,2))),jt<N?st>N&&(ce=ke(ge,dt,ct,_t,ye,N),fe&&(ge.start=Ye+de*ce)):jt>W?st<W&&(ce=ke(ge,dt,ct,_t,ye,W),fe&&(ge.start=Ye+de*ce)):xo(ge,dt,ct,ut),st<N&&jt>=N&&(ce=ke(ge,dt,ct,_t,ye,N),Ut=!0),st>W&&jt<=W&&(ce=ke(ge,dt,ct,_t,ye,W),Ut=!0),!ae&&Ut&&(fe&&(ge.end=Ye+de*ce),L.push(ge),ge=ts(K)),fe&&(Ye+=de)}var Gt=K.length-3;dt=K[Gt],ct=K[Gt+1],ut=K[Gt+2],(jt=ne===0?dt:ct)>=N&&jt<=W&&xo(ge,dt,ct,ut),Gt=ge.length-3,ae&&Gt>=3&&(ge[Gt]!==ge[0]||ge[Gt+1]!==ge[1])&&xo(ge,ge[0],ge[1],ge[2]),ge.length&&L.push(ge)}function ts(K){var L=[];return L.size=K.size,L.start=K.start,L.end=K.end,L}function Zr(K,L,N,W,ne,ae){for(var fe=0;fe<K.length;fe++)pr(K[fe],L,N,W,ne,ae,!1)}function xo(K,L,N,W){K.push(L),K.push(N),K.push(W)}function pl(K,L,N,W,ne,ae){var fe=(ae-L)/(W-L);return K.push(ae),K.push(N+(ne-N)*fe),K.push(1),fe}function Hs(K,L,N,W,ne,ae){var fe=(ae-N)/(ne-N);return K.push(L+(W-L)*fe),K.push(ae),K.push(1),fe}function Ys(K,L){for(var N=[],W=0;W<K.length;W++){var ne,ae=K[W],fe=ae.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")ne=vo(ae.geometry,L);else if(fe==="MultiLineString"||fe==="Polygon"){ne=[];for(var de=0;de<ae.geometry.length;de++)ne.push(vo(ae.geometry[de],L))}else if(fe==="MultiPolygon")for(ne=[],de=0;de<ae.geometry.length;de++){for(var ce=[],ge=0;ge<ae.geometry[de].length;ge++)ce.push(vo(ae.geometry[de][ge],L));ne.push(ce)}N.push(cn(ae.id,fe,ne,ae.tags))}return N}function vo(K,L){var N=[];N.size=K.size,K.start!==void 0&&(N.start=K.start,N.end=K.end);for(var W=0;W<K.length;W+=3)N.push(K[W]+L,K[W+1],K[W+2]);return N}function Ks(K,L){if(K.transformed)return K;var N,W,ne,ae=1<<K.z,fe=K.x,de=K.y;for(N=0;N<K.features.length;N++){var ce=K.features[N],ge=ce.geometry,ke=ce.type;if(ce.geometry=[],ke===1)for(W=0;W<ge.length;W+=2)ce.geometry.push(qr(ge[W],ge[W+1],L,ae,fe,de));else for(W=0;W<ge.length;W++){var Ye=[];for(ne=0;ne<ge[W].length;ne+=2)Ye.push(qr(ge[W][ne],ge[W][ne+1],L,ae,fe,de));ce.geometry.push(Ye)}}return K.transformed=!0,K}function qr(K,L,N,W,ne,ae){return[Math.round(N*(K*W-ne)),Math.round(N*(L*W-ae))]}function Js(K,L,N,W,ne){for(var ae=L===ne.maxZoom?0:ne.tolerance/((1<<L)*ne.extent),fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:W,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},de=0;de<K.length;de++){fe.numFeatures++,Mn(fe,K[de],ae,ne);var ce=K[de].minX,ge=K[de].minY,ke=K[de].maxX,Ye=K[de].maxY;ce<fe.minX&&(fe.minX=ce),ge<fe.minY&&(fe.minY=ge),ke>fe.maxX&&(fe.maxX=ke),Ye>fe.maxY&&(fe.maxY=Ye)}return fe}function Mn(K,L,N,W){var ne=L.geometry,ae=L.type,fe=[];if(ae==="Point"||ae==="MultiPoint")for(var de=0;de<ne.length;de+=3)fe.push(ne[de]),fe.push(ne[de+1]),K.numPoints++,K.numSimplified++;else if(ae==="LineString")dr(fe,ne,K,N,!1,!1);else if(ae==="MultiLineString"||ae==="Polygon")for(de=0;de<ne.length;de++)dr(fe,ne[de],K,N,ae==="Polygon",de===0);else if(ae==="MultiPolygon")for(var ce=0;ce<ne.length;ce++){var ge=ne[ce];for(de=0;de<ge.length;de++)dr(fe,ge[de],K,N,!0,de===0)}if(fe.length){var ke=L.tags||null;if(ae==="LineString"&&W.lineMetrics){for(var Ye in ke={},L.tags)ke[Ye]=L.tags[Ye];ke.mapbox_clip_start=ne.start/ne.size,ke.mapbox_clip_end=ne.end/ne.size}var Le={geometry:fe,type:ae==="Polygon"||ae==="MultiPolygon"?3:ae==="LineString"||ae==="MultiLineString"?2:1,tags:ke};L.id!==null&&(Le.id=L.id),K.features.push(Le)}}function dr(K,L,N,W,ne,ae){var fe=W*W;if(W>0&&L.size<(ne?fe:W))N.numPoints+=L.length/3;else{for(var de=[],ce=0;ce<L.length;ce+=3)(W===0||L[ce+2]>fe)&&(N.numSimplified++,de.push(L[ce]),de.push(L[ce+1])),N.numPoints++;ne&&function(ge,ke){for(var Ye=0,Le=0,dt=ge.length,ct=dt-2;Le<dt;ct=Le,Le+=2)Ye+=(ge[Le]-ge[ct])*(ge[Le+1]+ge[ct+1]);if(Ye>0===ke)for(Le=0,dt=ge.length;Le<dt/2;Le+=2){var ut=ge[Le],_t=ge[Le+1];ge[Le]=ge[dt-2-Le],ge[Le+1]=ge[dt-1-Le],ge[dt-2-Le]=ut,ge[dt-1-Le]=_t}}(de,ae),K.push(de)}}function Xr(K,L){var N=(L=this.options=function(ne,ae){for(var fe in ae)ne[fe]=ae[fe];return ne}(Object.create(this.options),L)).debug;if(N&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var W=function(ne,ae){var fe=[];if(ne.type==="FeatureCollection")for(var de=0;de<ne.features.length;de++)go(fe,ne.features[de],ae,de);else go(fe,ne.type==="Feature"?ne:{geometry:ne},ae);return fe}(K,L);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(W=function(ne,ae){var fe=ae.buffer/ae.extent,de=ne,ce=Sn(ne,1,-1-fe,fe,0,-1,2,ae),ge=Sn(ne,1,1-fe,2+fe,0,-1,2,ae);return(ce||ge)&&(de=Sn(ne,1,-fe,1+fe,0,-1,2,ae)||[],ce&&(de=Ys(ce,1).concat(de)),ge&&(de=de.concat(Ys(ge,-1)))),de}(W,L)).length&&this.splitTile(W,0,0,0),N&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Wr(K,L,N){return 32*((1<<K)*N+L)+K}function bo(K,L){const N=K.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const W=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!W)return L(null,null);const ne=new We(W.features);let ae=Ge(ne);ae.byteOffset===0&&ae.byteLength===ae.buffer.byteLength||(ae=new Uint8Array(ae)),L(null,{vectorTile:ne,rawData:ae.buffer})}Xr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Xr.prototype.splitTile=function(K,L,N,W,ne,ae,fe){for(var de=[K,L,N,W],ce=this.options,ge=ce.debug;de.length;){W=de.pop(),N=de.pop(),L=de.pop(),K=de.pop();var ke=1<<L,Ye=Wr(L,N,W),Le=this.tiles[Ye];if(!Le&&(ge>1&&console.time("creation"),Le=this.tiles[Ye]=Js(K,L,N,W,ce),this.tileCoords.push({z:L,x:N,y:W}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,N,W,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));var dt="z"+L;this.stats[dt]=(this.stats[dt]||0)+1,this.total++}if(Le.source=K,ne){if(L===ce.maxZoom||L===ne)continue;var ct=1<<ne-L;if(N!==Math.floor(ae/ct)||W!==Math.floor(fe/ct))continue}else if(L===ce.indexMaxZoom||Le.numPoints<=ce.indexMaxPoints)continue;if(Le.source=null,K.length!==0){ge>1&&console.time("clipping");var ut,_t,ye,jt,st,Ut,Gt=.5*ce.buffer/ce.extent,Hr=.5-Gt,Xn=.5+Gt,qe=1+Gt;ut=_t=ye=jt=null,st=Sn(K,ke,N-Gt,N+Xn,0,Le.minX,Le.maxX,ce),Ut=Sn(K,ke,N+Hr,N+qe,0,Le.minX,Le.maxX,ce),K=null,st&&(ut=Sn(st,ke,W-Gt,W+Xn,1,Le.minY,Le.maxY,ce),_t=Sn(st,ke,W+Hr,W+qe,1,Le.minY,Le.maxY,ce),st=null),Ut&&(ye=Sn(Ut,ke,W-Gt,W+Xn,1,Le.minY,Le.maxY,ce),jt=Sn(Ut,ke,W+Hr,W+qe,1,Le.minY,Le.maxY,ce),Ut=null),ge>1&&console.timeEnd("clipping"),de.push(ut||[],L+1,2*N,2*W),de.push(_t||[],L+1,2*N,2*W+1),de.push(ye||[],L+1,2*N+1,2*W),de.push(jt||[],L+1,2*N+1,2*W+1)}}},Xr.prototype.getTile=function(K,L,N){var W=this.options,ne=W.extent,ae=W.debug;if(K<0||K>24)return null;var fe=1<<K,de=Wr(K,L=(L%fe+fe)%fe,N);if(this.tiles[de])return Ks(this.tiles[de],ne);ae>1&&console.log("drilling down to z%d-%d-%d",K,L,N);for(var ce,ge=K,ke=L,Ye=N;!ce&&ge>0;)ge--,ke=Math.floor(ke/2),Ye=Math.floor(Ye/2),ce=this.tiles[Wr(ge,ke,Ye)];return ce&&ce.source?(ae>1&&console.log("found parent tile z%d-%d-%d",ge,ke,Ye),ae>1&&console.time("drilling down"),this.splitTile(ce.source,ge,ke,Ye,K,L,N),ae>1&&console.timeEnd("drilling down"),this.tiles[de]?Ks(this.tiles[de],ne):null):null};class is extends o.VectorTileWorkerSource{constructor(L,N,W,ne,ae){super(L,N,W,ne,bo),ae&&(this.loadGeoJSON=ae)}loadData(L,N){const W=L&&L.request,ne=W&&W.collectResourceTiming;this.loadGeoJSON(L,(ae,fe)=>{if(ae||!fe)return N(ae);if(typeof fe!="object")return N(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{G(fe,!0);try{if(L.filter){const ce=o.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ce.result==="error")throw new Error(ce.value.map(ke=>`${ke.key}: ${ke.message}`).join(", "));const ge=fe.features.filter(ke=>ce.value.evaluate({zoom:0},ke));fe={type:"FeatureCollection",features:ge}}this._geoJSONIndex=L.cluster?new Bn(function({superclusterOptions:ce,clusterProperties:ge}){if(!ge||!ce)return ce;const ke={},Ye={},Le={accumulated:null,zoom:0},dt={properties:null},ct=Object.keys(ge);for(const ut of ct){const[_t,ye]=ge[ut],jt=o.createExpression(ye),st=o.createExpression(typeof _t=="string"?[_t,["accumulated"],["get",ut]]:_t);ke[ut]=jt.value,Ye[ut]=st.value}return ce.map=ut=>{dt.properties=ut;const _t={};for(const ye of ct)_t[ye]=ke[ye].evaluate(Le,dt);return _t},ce.reduce=(ut,_t)=>{dt.properties=_t;for(const ye of ct)Le.accumulated=ut[ye],ut[ye]=Ye[ye].evaluate(Le,dt)},ce}(L)).load(fe.features):function(ce,ge){return new Xr(ce,ge)}(fe,L.geojsonVtOptions)}catch(ce){return N(ce)}this.loaded={};const de={};if(ne){const ce=o.getPerformanceMeasurement(W);ce&&(de.resourceTiming={},de.resourceTiming[L.source]=JSON.parse(JSON.stringify(ce)))}N(null,de)}})}reloadTile(L,N){const W=this.loaded;return W&&W[L.uid]?super.reloadTile(L,N):this.loadTile(L,N)}loadGeoJSON(L,N){if(L.request)o.getJSON(L.request,N);else{if(typeof L.data!="string")return N(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));try{return N(null,JSON.parse(L.data))}catch{return N(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(L,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(W){N(W)}}getClusterChildren(L,N){try{N(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(W){N(W)}}getClusterLeaves(L,N){try{N(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(W){N(W)}}}class wo{constructor(L){this.self=L,this.actor=new o.Actor(L,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:is},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,W)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=W},this.self.registerRTLTextPlugin=N=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=N.applyArabicShaping,o.plugin.processBidirectionalText=N.processBidirectionalText,o.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}clearCaches(L,N,W){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L],W()}checkIfReady(L,N,W){W()}setReferrer(L,N){this.referrer=N}spriteLoaded(L,N){this.isSpriteLoaded[L]=N;for(const W in this.workerSources[L]){const ne=this.workerSources[L][W];for(const ae in ne)ne[ae]instanceof o.VectorTileWorkerSource&&(ne[ae].isSpriteLoaded=N,ne[ae].fire(new o.Event("isSpriteLoaded")))}}setImages(L,N,W){this.availableImages[L]=N;for(const ne in this.workerSources[L]){const ae=this.workerSources[L][ne];for(const fe in ae)ae[fe].availableImages=N}W()}enableTerrain(L,N,W){this.terrain=N,W()}setProjection(L,N){this.projections[L]=o.getProjection(N)}setLayers(L,N,W){this.getLayerIndex(L).replace(N),W()}updateLayers(L,N,W){this.getLayerIndex(L).update(N.layers,N.removedIds),W()}loadTile(L,N,W){const ne=this.enableTerrain?o.extend({enableTerrain:this.terrain},N):N;ne.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,N.type,N.source).loadTile(ne,W)}loadDEMTile(L,N,W){const ne=this.enableTerrain?o.extend({buildQuadTree:this.terrain},N):N;this.getDEMWorkerSource(L,N.source).loadTile(ne,W)}reloadTile(L,N,W){const ne=this.enableTerrain?o.extend({enableTerrain:this.terrain},N):N;ne.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,N.type,N.source).reloadTile(ne,W)}abortTile(L,N,W){this.getWorkerSource(L,N.type,N.source).abortTile(N,W)}removeTile(L,N,W){this.getWorkerSource(L,N.type,N.source).removeTile(N,W)}removeSource(L,N,W){if(!this.workerSources[L]||!this.workerSources[L][N.type]||!this.workerSources[L][N.type][N.source])return;const ne=this.workerSources[L][N.type][N.source];delete this.workerSources[L][N.type][N.source],ne.removeSource!==void 0?ne.removeSource(N,W):W()}loadWorkerSource(L,N,W){try{this.self.importScripts(N.url),W()}catch(ne){W(ne.toString())}}syncRTLPluginState(L,N,W){try{o.plugin.setState(N);const ne=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);const ae=o.plugin.isParsed();W(ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),ae)}}catch(ne){W(ne.toString())}}getAvailableImages(L){let N=this.availableImages[L];return N||(N=[]),N}getLayerIndex(L){let N=this.layerIndexes[L];return N||(N=this.layerIndexes[L]=new $),N}getWorkerSource(L,N,W){return this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][N]||(this.workerSources[L][N]={}),this.workerSources[L][N][W]||(this.workerSources[L][N][W]=new this.workerSourceTypes[N]({send:(ne,ae,fe,de,ce,ge)=>{this.actor.send(ne,ae,fe,L,ce,ge)},scheduler:this.actor.scheduler},this.getLayerIndex(L),this.getAvailableImages(L),this.isSpriteLoaded[L])),this.workerSources[L][N][W]}getDEMWorkerSource(L,N){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][N]||(this.demWorkerSources[L][N]=new D),this.demWorkerSources[L][N]}enforceCacheSizeLimit(L,N){o.enforceCacheSizeLimit(N)}getWorkerPerformanceMetrics(L,N,W){W(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new wo(self)),wo}),C(["./shared"],function(o){var O=B;function B(c){return!function(t){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,m,_=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(_);try{m=new Worker(x),h=!0}catch{h=!1}return m&&m.terminate(),URL.revokeObjectURL(x),h}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var h=document.createElement("canvas");h.width=h.height=1;var m=h.getContext("2d");if(!m)return!1;var _=m.getImageData(0,0,1,1);return _&&_.width===h.width}()?($[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&($[s]=function(h){var m,_=function(x){var w=document.createElement("canvas"),A=Object.create(B.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=x,w.getContext("webgl",A)||w.getContext("experimental-webgl",A)}(h);if(!_)return!1;try{m=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!m||_.isContextLost())&&(_.shaderSource(m,"void main() {}"),_.compileShader(m),_.getShaderParameter(m,_.COMPILE_STATUS)===!0)}(s)),$[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(c)}var $={};function D(c,t){if(Array.isArray(c)){if(!Array.isArray(t)||c.length!==t.length)return!1;for(let s=0;s<c.length;s++)if(!D(c[s],t[s]))return!1;return!0}if(typeof c=="object"&&c!==null&&t!==null){if(typeof t!="object"||Object.keys(c).length!==Object.keys(t).length)return!1;for(const s in c)if(!D(c[s],t[s]))return!1;return!0}return c===t}function G(c,t,s){const h=o.window.document.createElement(c);return t!==void 0&&(h.className=t),s&&s.appendChild(h),h}function J(c,t,s){const h=o.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const m of Object.keys(t))h.setAttributeNS(null,m,t[m]);return s&&s.appendChild(h),h}B.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const xe=o.window.document&&o.window.document.documentElement.style,Pe=xe&&xe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ve;function We(){xe&&Pe&&(ve=xe[Pe],xe[Pe]="none")}function Xe(){xe&&Pe&&(xe[Pe]=ve)}function Ze(c){c.preventDefault(),c.stopPropagation(),o.window.removeEventListener("click",Ze,!0)}function He(){o.window.addEventListener("click",Ze,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Ze,!0)},0)}function je(c,t){const s=c.getBoundingClientRect();return yt(c,s,t)}function Ge(c,t){const s=c.getBoundingClientRect(),h=[];for(let m=0;m<t.length;m++)h.push(yt(c,s,t[m]));return h}function Tt(c){return o.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function yt(c,t,s){const h=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new o.pointGeometry((s.clientX-t.left)*h,(s.clientY-t.top)*h)}function xt(c,t){var s=t[0],h=t[1],m=t[2],_=t[3],x=s*_-m*h;return x?(c[0]=_*(x=1/x),c[1]=-h*x,c[2]=-m*x,c[3]=s*x,c):null}function St(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ie extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:h}of this.requestors)this._notify(s,h);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,s){this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),h=!1),h}_validateStretch(t,s){if(!t)return!0;let h=0;for(const m of t){if(m[0]<h||m[1]<m[0]||s<m[1])return!1;h=m[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){s.version=this.images[t].version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let h=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(h=!1);this.isLoaded()||h?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const h={};for(const m of t){this.images[m]||this.fire(new o.Event("styleimagemissing",{id:m}));const _=this.images[m];_?h[m]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:Boolean(_.userImage&&_.userImage.render)}:o.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,h)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],h=this.getImage(t);if(!h)return null;if(s&&s.position.version===h.version)return s.position;if(s)s.position.version=h.version;else{const m={w:h.data.width+2,h:h.data.height+2,x:0,y:0},_=new o.ImagePosition(m,h);this.patterns[t]={bin:m,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:s,h}=o.potpack(t),m=this.atlasImage;m.resize({width:s||1,height:h||1});for(const _ in this.patterns){const{bin:x}=this.patterns[_],w=x.x+1,A=x.y+1,I=this.images[_].data,z=I.width,R=I.height;o.RGBAImage.copy(I,m,{x:0,y:0},{x:w,y:A},{width:z,height:R}),o.RGBAImage.copy(I,m,{x:0,y:R-1},{x:w,y:A-1},{width:z,height:1}),o.RGBAImage.copy(I,m,{x:0,y:0},{x:w,y:A+R},{width:z,height:1}),o.RGBAImage.copy(I,m,{x:z-1,y:0},{x:w-1,y:A},{width:1,height:R}),o.RGBAImage.copy(I,m,{x:0,y:0},{x:w+z,y:A},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const h=this.images[s];St(h)&&this.updateImage(s,h)}}}const rt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(c,t){return function([s,h,m]){const _=o.degToRad(h+90),x=o.degToRad(m);return{x:s*Math.cos(_)*Math.sin(x),y:s*Math.sin(_)*Math.sin(x),z:s*Math.cos(x),azimuthal:h,polar:m}}(c.expression.evaluate(t))}interpolate(c,t,s){return{x:o.number(c.x,t.x,s),y:o.number(c.y,t.y,s),z:o.number(c.z,t.z,s),azimuthal:o.number(c.azimuthal,t.azimuthal,s),polar:o.number(c.polar,t.polar,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Je="-transition";class vt extends o.Evented{constructor(t){super(),this._transitionable=new o.Transitionable(rt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(o.validateLight,t,s))for(const h in t){const m=t[h];o.endsWith(h,Je)?this._transitionable.setTransition(h.slice(0,-Je.length),m):this._transitionable.setValue(h,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Be=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),mt="-transition";class Pt extends o.Evented{constructor(t,s){super(),this._transitionable=new o.Transitionable(Be),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(t){for(const s in t){const h=t[s];o.endsWith(s,mt)?this._transitionable.setTransition(s.slice(0,-mt.length),h):this._transitionable.setValue(s,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function Rt(c,t,s,h){const m=o.smoothstep(45,65,s),[_,x]=It(c,h),w=o.length(t);let A=1-Math.min(1,Math.exp((w-_)/(x-_)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*m*c.alpha}function It(c,t){const s=.5/Math.tan(.5*t);return[c.range[0]+s,c.range[1]+s]}const Di=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"])}),ri="-transition";class Li extends o.Evented{constructor(t,s){super(),this._transitionable=new o.Transitionable(Di),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=s}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s={}){if(!this._validate(o.validateFog,t,s))for(const h in t){const m=t[h];o.endsWith(h,ri)?this._transitionable.setTransition(h.slice(0,-ri.length),m):this._transitionable.setValue(h,m)}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return o.smoothstep(45,65,t)*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(h,m,_){const x=o.MercatorCoordinate.fromLngLat(m),w=_.elevation?_.elevation.getAtPointOrZero(x):0,A=[x.x,x.y,w];return o.transformMat4(A,A,_.mercatorFogMatrix),Rt(h,A,_.pitch,_._fov)}(this.state,t,s):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?It(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Ct{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const h=this.workerPool.acquire(this.id);for(let m=0;m<h.length;m++){const _=new Ct.Actor(h[m],s,this.id);_.name=`Worker ${m}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,h){o.asyncAll(this.actors,(m,_)=>{m.send(t,s,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Yt(c,t,s){return t*(o.EXTENT/(c.tileSize*Math.pow(2,s-c.tileID.overscaledZ)))}Ct.Actor=o.Actor;class Ai{constructor(t,s,h,m){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(_=>m.pointCoordinate3D(_)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,s){let h,m;if(t instanceof o.pointGeometry||typeof t[0]=="number"){const _=o.pointGeometry.convert(t);h=[o.pointGeometry.convert(t)],m=s.isPointAboveHorizon(_)}else{const _=o.pointGeometry.convert(t[0]),x=o.pointGeometry.convert(t[1]);h=[_,x],m=o.polygonizeBounds(_,x).every(w=>s.isPointAboveHorizon(w))}return new Ai(h,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),o.bufferConvexPolygon(m,t)}containsTile(t,s,h){const m=t.queryPadding+1,_=t.tileID.wrap,x=h?this._bufferedCameraMercator(m,s).map(Z=>o.getTilePoint(t.tileTransform,Z,_)):this._bufferedScreenMercator(m,s).map(Z=>o.getTilePoint(t.tileTransform,Z,_)),w=this.screenGeometryMercator.map(Z=>o.getTileVec3(t.tileTransform,Z,_)),A=w.map(Z=>new o.pointGeometry(Z[0],Z[1])),I=s.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),z=o.getTileVec3(t.tileTransform,I,_),R=w.map(Z=>{const U=o.sub(Z,Z,z);return o.normalize(U,U),new o.Ray(z,U)}),j=Yt(t,1,s.zoom);if(o.polygonIntersectsBox(x,0,0,o.EXTENT,o.EXTENT))return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:R,bufferedTilespaceGeometry:x,bufferedTilespaceBounds:(X=o.getBounds(x),X.min.x=o.clamp(X.min.x,0,o.EXTENT),X.min.y=o.clamp(X.min.y,0,o.EXTENT),X.max.x=o.clamp(X.max.x,0,o.EXTENT),X.max.y=o.clamp(X.max.y,0,o.EXTENT),X),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:j};var X}_bufferedScreenMercator(t,s){const h=Ni(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{const m=this.bufferedScreenGeometry(t).map(_=>s.pointCoordinate3D(_));return this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(t,s){const h=Ni(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{const m=this.bufferedCameraGeometry(t).map(_=>s.pointCoordinate3D(_));return this._cameraRaycastCache[h]=m,m}}}function Ni(c){return 100*c|0}function Bn(c,t,s){const h=function(m,_){if(m)return s(m);if(_){const x=o.pick(o.extend(_,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);_.vector_layers&&(x.vectorLayers=_.vector_layers,x.vectorLayerIds=x.vectorLayers.map(w=>w.id)),x.tiles=t.canonicalizeTileset(x,c.url),s(null,x)}};return c.url?o.getJSON(t.transformRequest(t.normalizeSourceURL(c.url),o.ResourceType.Source),h):o.exported.frame(()=>h(null,c))}class ln{constructor(t,s,h){this.bounds=o.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),h=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),_=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),x=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=h&&t.x<_&&t.y>=m&&t.y<x}}class cr{constructor(t,s,h){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Fn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class On{constructor(t,s,h,m){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let h=0;h<this.attributes.length;h++){const m=s.attributes[this.attributes[h].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,h){for(let m=0;m<this.attributes.length;m++){const _=this.attributes[m],x=s.attributes[_.name];x!==void 0&&t.vertexAttribPointer(x,_.components,t[Fn[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ot{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ur extends Ot{getDefault(){return o.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ws extends Ot{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class $i extends Ot{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ur extends Ot{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $t extends Ot{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class hr extends Ot{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Vr extends Ot{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class cn extends Ot{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class $r extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class go extends Ot{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class es extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class yo extends Ot{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class jr extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class En extends Ot{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Gr extends Ot{getDefault(){return o.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Sn extends Ot{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class An extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class pr extends Ot{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ts extends Ot{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Zr extends Ot{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class xo extends Ot{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class pl extends Ot{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Hs extends Ot{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ys extends Ot{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class vo extends Ot{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ks extends Ot{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class qr extends Ot{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Js extends Ot{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Mn extends Ot{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class dr extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Xr extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Wr extends Ot{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class bo extends Wr{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class is extends Wr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wo extends is{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class K{constructor(t,s,h,m){this.context=t,this.width=s,this.height=h;const _=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new bo(t,_),m&&(this.depthAttachment=new is(t,_))}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const h=this.depthAttachment.get();h&&t.deleteRenderbuffer(h)}t.deleteFramebuffer(this.framebuffer)}}class L{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ur(this),this.clearDepth=new Ws(this),this.clearStencil=new $i(this),this.colorMask=new Ur(this),this.depthMask=new $t(this),this.stencilMask=new hr(this),this.stencilFunc=new Vr(this),this.stencilOp=new cn(this),this.stencilTest=new $r(this),this.depthRange=new go(this),this.depthTest=new es(this),this.depthFunc=new yo(this),this.blend=new jr(this),this.blendFunc=new En(this),this.blendColor=new Gr(this),this.blendEquation=new Sn(this),this.cullFace=new An(this),this.cullFaceSide=new pr(this),this.frontFace=new ts(this),this.program=new Zr(this),this.activeTexture=new xo(this),this.viewport=new pl(this),this.bindFramebuffer=new Hs(this),this.bindRenderbuffer=new Ys(this),this.bindTexture=new vo(this),this.bindVertexBuffer=new Ks(this),this.bindElementBuffer=new qr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Js(this),this.pixelStoreUnpack=new Mn(this),this.pixelStoreUnpackPremultiplyAlpha=new dr(this),this.pixelStoreUnpackFlipY=new Xr(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new cr(this,t,s)}createVertexBuffer(t,s,h){return new On(this,t,s,h)}createRenderbuffer(t,s,h){const m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,t,s,h),this.bindRenderbuffer.set(null),_}createFramebuffer(t,s,h){return new K(this,t,s,h)}clear({color:t,depth:s,stencil:h}){const m=this.gl;let _=0;t&&(_|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(_|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(_|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),m.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){D(t.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class N extends o.Evented{constructor(t,s,h,m){super(),this.id=t,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bn(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new ln(s.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(s.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const h=o.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=o.getImage(this.map._requestManager.transformRequest(m,o.ResourceType.Tile),(_,x,w,A)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):_?(t.state="errored",s(_)):x?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:w,expires:A}),t.setTexture(x,this.map.painter),t.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void s(null)):s(null)))}static loadTileData(t,s,h){t.setTexture(s,h)}static unloadTileData(t,s){t.texture&&s.saveTileTexture(t.texture)}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let W;function ne(c,t,s,h,m,_,x,w){const A=[c,s,m,t,h,_,1,1,1],I=[x,w,1],z=o.adjoint([],A),[R,j,X]=o.transformMat3(I,I,o.transpose(z,z));return o.multiply(A,[R,0,0,0,j,0,0,0,X],A)}class ae extends o.Evented{constructor(t,s,h,m){super(),this.id=t,this.dispatcher=h,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(t){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(s,h)=>{if(this._loaded=!0,s)this.fire(new o.ErrorEvent(s));else if(h){const{HTMLImageElement:m}=o.window;this.image=h instanceof m?o.exported.getImageData(h):h,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const s=t.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(h){let m=1/0,_=1/0,x=-1/0,w=-1/0;for(const R of h)m=Math.min(m,R.x),_=Math.min(_,R.y),x=Math.max(x,R.x),w=Math.max(w,R.y);const A=Math.max(x-m,w-_),I=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,I);return new o.CanonicalTileID(I,Math.floor((m+x)/2*z),Math.floor((_+w)/2*z))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const A in this.tiles){const I=this.tiles[A];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}if(this._boundsArray)return;const s=o.tileTransform(this.tileID,this.map.transform.projection),[h,m,_,x]=this.coordinates.map(A=>{const I=s.projection.project(A[0],A[1]);return o.getTilePoint(s,I)._round()});this.perspectiveTransform=function(A,I,z,R,j,X,Z,U,ie,H){const ee=ne(0,0,A,0,0,I,A,I),te=ne(z,R,j,X,Z,U,ie,H);return o.multiply(te,o.adjoint(ee,ee),te),[te[6]/te[8]*A/o.EXTENT,te[7]/te[8]*I/o.EXTENT]}(this.width,this.height,h.x,h.y,m.x,m.y,x.x,x.y,_.x,_.y);const w=this._boundsArray=new o.StructArrayLayout4i8;w.emplaceBack(h.x,h.y,0,0),w.emplaceBack(m.x,m.y,o.EXTENT,0),w.emplaceBack(x.x,x.y,0,o.EXTENT),w.emplaceBack(_.x,_.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(w,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.texture?this.texture.update(this.image):(this.texture=new o.Texture(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const fe={vector:class extends o.Evented{constructor(c,t,s,h){if(super(),this.id=c,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(t,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bn(this._options,this.map._requestManager,(c,t)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new o.ErrorEvent(c)):t&&(o.extend(this,t),t.bounds&&(this.tileBounds=new ln(t.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c();const t=this.map.style._getSourceCaches(this.id);for(const s of t)s.clearTiles();this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(c,t){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,o.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(h.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=t:c.request=c.actor.send("reloadTile",h,m.bind(this));else if(c.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",h,m.bind(this),void 0,!0);else{const _=o.loadVectorTile.call({deduped:this._deduped},h,(x,w)=>{x||!w?m.call(this,x):(h.data={cacheControl:w.cacheControl,expires:w.expires,rawData:w.rawData.slice(0)},c.actor&&c.actor.send("loadTile",h,m.bind(this),void 0,!0))},!0);c.request={cancel:_}}function m(_,x){return delete c.request,c.aborted?t(null):_&&_.status!==404?t(_):(x&&x.resourceTiming&&(c.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&c.setExpiryData(x),c.loadVectorData(x,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:N,"raster-dem":class extends N{constructor(c,t,s,h){super(c,t,s,h),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,_){m&&(c.state="errored",t(m)),_&&(c.dem=_,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=o.getImage(this.map._requestManager.transformRequest(s,o.ResourceType.Tile),function(m,_,x,w){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(m)c.state="errored",t(m);else if(_){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:x,expires:w});const A=o.window.ImageBitmap&&_ instanceof o.window.ImageBitmap&&(W==null&&(W=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),W),I=1-(_.width-o.prevPowerOfTwo(_.width))/2;I<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const z=A?_:o.exported.getImageData(_,I),R={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:I};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",R,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const t=c.canonical,s=Math.pow(2,t.z),h=(t.x-1+s)%s,m=t.x===0?c.wrap-1:c.wrap,_=(t.x+1+s)%s,x=t.x+1===s?c.wrap+1:c.wrap,w={};return w[new o.OverscaledTileID(c.overscaledZ,m,t.z,h,t.y).key]={backfilled:!1},w[new o.OverscaledTileID(c.overscaledZ,x,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(w[new o.OverscaledTileID(c.overscaledZ,m,t.z,h,t.y-1).key]={backfilled:!1},w[new o.OverscaledTileID(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},w[new o.OverscaledTileID(c.overscaledZ,x,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<s&&(w[new o.OverscaledTileID(c.overscaledZ,m,t.z,h,t.y+1).key]={backfilled:!1},w[new o.OverscaledTileID(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},w[new o.OverscaledTileID(c.overscaledZ,x,t.z,_,t.y+1).key]={backfilled:!1}),w}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends o.Evented{constructor(c,t,s,h){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=t.data,this._options=o.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},t),this}getClusterLeaves(c,t,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:t,offset:s},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=o.extend({},this.workerOptions),t=this._data;typeof t=="string"?(c.request=this.map._requestManager.transformRequest(o.exported.resolveURL(t),o.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(s,h)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.ErrorEvent(s));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(m.resourceTiming=h.resourceTiming[this.id]),this.fire(new o.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,t){const s=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(s,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(h,m)=>(delete c.request,c.unloadVectorData(),c.aborted?t(null):h?t(h):(c.loadVectorData(m,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ae{constructor(c,t,s,h){super(c,t,s,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.ResourceType.Source).url);o.getVideo(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(c,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ae,canvas:class extends ae{constructor(c,t,s,h){super(c,t,s,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(_=>typeof _!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends o.Evented{constructor(c,t,s,h){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ln(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:s,z:h}=c.canonical;return this._implementation.hasTile({x:t,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:s,y:h,z:m}=c.tileID.canonical,_=new o.window.AbortController,x=this._implementation.loadTile({x:s,y:h,z:m},{signal:_.signal});if(!x)return this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null);x.cancel=()=>_.abort(),c.request=x.then(function(w){return delete c.request,c.aborted?(c.state="unloaded",t(null)):w?function(A){return A instanceof o.window.ImageData||A instanceof o.window.ImageBitmap||A instanceof o.window.HTMLCanvasElement}(w)?(this.loadTileData(c,w),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null))}.bind(this)).catch(w=>{w.code!==20&&(c.state="errored",t(w))})}loadTileData(c,t){N.loadTileData(c,t,this._map.painter)}unloadTileData(c){N.unloadTileData(c,this._map.painter)}prepareTile(c){if(!this._implementation.prepareTile)return null;const{x:t,y:s,z:h}=c.tileID.canonical,m=this._implementation.prepareTile({x:t,y:s,z:h});return m?(this.loadTileData(c,m),c.state="loaded",m):null}unloadTile(c,t){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:s,y:h,z:m}=c.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:m})}t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},de=function(c,t,s,h){const m=new fe[t.type](c,t,s,h);if(m.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${m.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],m),m};function ce(c,t){const s=o.identity([]);return o.scale(s,s,[.5*c.width,.5*-c.height,1]),o.translate(s,s,[1,-1,0]),o.multiply$1(s,s,c.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(s)}function ge(c,t,s,h,m,_,x,w=!1){const A=c.tilesIn(h,x,w);A.sort(Ye);const I=[];for(const R of A)I.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(t,s,c._state,R,m,_,ce(c.transform,R.tile.tileID),w)});const z=function(R){const j={},X={};for(const Z of R){const U=Z.queryResults,ie=Z.wrappedTileID,H=X[ie]=X[ie]||{};for(const ee in U){const te=U[ee],re=H[ee]=H[ee]||{},Q=j[ee]=j[ee]||[];for(const se of te)re[se.featureIndex]||(re[se.featureIndex]=!0,Q.push(se))}}return j}(I);for(const R in z)z[R].forEach(j=>{const X=j.feature,Z=X.layer;Z&&Z.type!=="background"&&Z.type!=="sky"&&(X.source=Z.source,Z["source-layer"]&&(X.sourceLayer=Z["source-layer"]),X.state=X.id!==void 0?c.getFeatureState(Z["source-layer"],X.id):{})});return z}function ke(c,t){const s=c.getRenderableIds().map(_=>c.getTileByID(_)),h=[],m={};for(let _=0;_<s.length;_++){const x=s[_],w=x.tileID.canonical.key;m[w]||(m[w]=!0,x.querySourceFeatures(h,t))}return h}function Ye(c,t){const s=c.tileID,h=t.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function Le(){return Fo.workerClass!=null?new Fo.workerClass:new o.window.Worker(Fo.workerUrl)}const dt="mapboxgl_preloaded_worker_pool";class ct{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ct.workerCount;)this.workers.push(new Le);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[dt]}numActive(){return Object.keys(this.active).length}}let ut;function _t(){return ut||(ut=new ct),ut}function ye(c,t){const s={};for(const h in c)h!=="ref"&&(s[h]=c[h]);return o.refProperties.forEach(h=>{h in t&&(s[h]=t[h])}),s}function jt(c){c=c.slice();const t=Object.create(null);for(let s=0;s<c.length;s++)t[c[s].id]=c[s];for(let s=0;s<c.length;s++)"ref"in c[s]&&(c[s]=ye(c[s],t[c[s].ref]));return c}ct.workerCount=2;const st={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ut(c,t,s){s.push({command:st.addSource,args:[c,t[c]]})}function Gt(c,t,s){t.push({command:st.removeSource,args:[c]}),s[c]=!0}function Hr(c,t,s,h){Gt(c,s,h),Ut(c,t,s)}function Xn(c,t,s){let h;for(h in c[s])if(c[s].hasOwnProperty(h)&&h!=="data"&&!D(c[s][h],t[s][h]))return!1;for(h in t[s])if(t[s].hasOwnProperty(h)&&h!=="data"&&!D(c[s][h],t[s][h]))return!1;return!0}function qe(c,t,s,h,m,_){let x;for(x in t=t||{},c=c||{})c.hasOwnProperty(x)&&(D(c[x],t[x])||s.push({command:_,args:[h,x,t[x],m]}));for(x in t)t.hasOwnProperty(x)&&!c.hasOwnProperty(x)&&(D(c[x],t[x])||s.push({command:_,args:[h,x,t[x],m]}))}function Bt(c){return c.id}function zt(c,t){return c[t.id]=t,c}class Nn{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.clamp(t,0,1);let s=1,h=this._distances[s];const m=t*this.paddedLength+this.padding;for(;h<m&&s<this._distances.length;)h=this._distances[++s];const _=s-1,x=this._distances[_],w=h-x,A=w>0?(m-x)/w:0;return this.points[_].mult(1-A).add(this.points[s].mult(A))}}class Yr{constructor(t,s,h){const m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(s/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,h,m,_){this._forEachCell(s,h,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(t,s,h,m){this._forEachCell(s-m,h-m,s+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(h),this.circles.push(m)}_insertBoxCell(t,s,h,m,_,x){this.boxCells[_].push(x)}_insertCircleCell(t,s,h,m,_,x){this.circleCells[_].push(x)}_query(t,s,h,m,_,x){if(h<0||t>this.width||m<0||s>this.height)return!_&&[];const w=[];if(t<=0&&s<=0&&this.width<=h&&this.height<=m){if(_)return!0;for(let A=0;A<this.boxKeys.length;A++)w.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const I=this.circles[3*A],z=this.circles[3*A+1],R=this.circles[3*A+2];w.push({key:this.circleKeys[A],x1:I-R,y1:z-R,x2:I+R,y2:z+R})}return x?w.filter(x):w}return this._forEachCell(t,s,h,m,this._queryCell,w,{hitTest:_,seenUids:{box:{},circle:{}}},x),_?w.length>0:w}_queryCircle(t,s,h,m,_){const x=t-h,w=t+h,A=s-h,I=s+h;if(w<0||x>this.width||I<0||A>this.height)return!m&&[];const z=[];return this._forEachCell(x,A,w,I,this._queryCellCircle,z,{hitTest:m,circle:{x:t,y:s,radius:h},seenUids:{box:{},circle:{}}},_),m?z.length>0:z}query(t,s,h,m,_){return this._query(t,s,h,m,!1,_)}hitTest(t,s,h,m,_){return this._query(t,s,h,m,!0,_)}hitTestCircle(t,s,h,m){return this._queryCircle(t,s,h,!0,m)}_queryCell(t,s,h,m,_,x,w,A){const I=w.seenUids,z=this.boxCells[_];if(z!==null){const j=this.bboxes;for(const X of z)if(!I.box[X]){I.box[X]=!0;const Z=4*X;if(t<=j[Z+2]&&s<=j[Z+3]&&h>=j[Z+0]&&m>=j[Z+1]&&(!A||A(this.boxKeys[X]))){if(w.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[X],x1:j[Z],y1:j[Z+1],x2:j[Z+2],y2:j[Z+3]})}}}const R=this.circleCells[_];if(R!==null){const j=this.circles;for(const X of R)if(!I.circle[X]){I.circle[X]=!0;const Z=3*X;if(this._circleAndRectCollide(j[Z],j[Z+1],j[Z+2],t,s,h,m)&&(!A||A(this.circleKeys[X]))){if(w.hitTest)return x.push(!0),!0;{const U=j[Z],ie=j[Z+1],H=j[Z+2];x.push({key:this.circleKeys[X],x1:U-H,y1:ie-H,x2:U+H,y2:ie+H})}}}}}_queryCellCircle(t,s,h,m,_,x,w,A){const I=w.circle,z=w.seenUids,R=this.boxCells[_];if(R!==null){const X=this.bboxes;for(const Z of R)if(!z.box[Z]){z.box[Z]=!0;const U=4*Z;if(this._circleAndRectCollide(I.x,I.y,I.radius,X[U+0],X[U+1],X[U+2],X[U+3])&&(!A||A(this.boxKeys[Z])))return x.push(!0),!0}}const j=this.circleCells[_];if(j!==null){const X=this.circles;for(const Z of j)if(!z.circle[Z]){z.circle[Z]=!0;const U=3*Z;if(this._circlesCollide(X[U],X[U+1],X[U+2],I.x,I.y,I.radius)&&(!A||A(this.circleKeys[Z])))return x.push(!0),!0}}}_forEachCell(t,s,h,m,_,x,w,A){const I=this._convertToXCellCoord(t),z=this._convertToYCellCoord(s),R=this._convertToXCellCoord(h),j=this._convertToYCellCoord(m);for(let X=I;X<=R;X++)for(let Z=z;Z<=j;Z++)if(_.call(this,t,s,h,m,this.xCellCount*Z+X,x,w,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,h,m,_,x){const w=m-t,A=_-s,I=h+x;return I*I>w*w+A*A}_circleAndRectCollide(t,s,h,m,_,x,w){const A=(x-m)/2,I=Math.abs(t-(m+A));if(I>A+h)return!1;const z=(w-_)/2,R=Math.abs(s-(_+z));if(R>z+h)return!1;if(I<=A||R<=z)return!0;const j=I-A,X=R-z;return j*j+X*X<=h*h}}const Dt=Math.tan(85*Math.PI/180);function Kr(c,t,s,h,m,_){const x=o.create();if(s){if(m.projection.name==="globe")o.multiply$1(x,x,o.calculateGlobeLabelMatrix(m,t));else{const w=xt([],_);x[0]=w[0],x[1]=w[1],x[4]=w[2],x[5]=w[3]}h||o.rotateZ(x,x,m.angle)}else o.multiply$1(x,m.labelPlaneMatrix,c);return x}function To(c,t,s,h,m,_){if(s){if(m.projection.name==="globe"){const x=Kr(c,t,s,h,m,_);return o.invert(x,x),o.multiply$1(x,c,x),x}{const x=o.clone(c),w=o.identity([]);return w[0]=_[0],w[1]=_[1],w[4]=_[2],w[5]=_[3],o.multiply$1(x,x,w),h||o.rotateZ(x,x,-m.angle),x}}return m.glCoordMatrix}function Ui(c,t,s=0){const h=[c.x,c.y,s,1];s?o.transformMat4$1(h,h,t):Yi(h,h,t);const m=h[3];return{point:new o.pointGeometry(h[0]/m,h[1]/m),signedDistanceFromCamera:m}}function un(c,t){const s=[c[0],c[1],c[2],1];o.transformMat4$1(s,s,t);const h=s[3];return{point:new o.pointGeometry(s[0]/h,s[1]/h),signedDistanceFromCamera:h}}function si(c,t){return Math.min(.5+c/t*.5,1.5)}function vp(c,t){const s=c[0]/c[3],h=c[1]/c[3];return s>=-t[0]&&s<=t[0]&&h>=-t[1]&&h<=t[1]}function ns(c,t,s,h,m,_,x,w,A,I){const z=s.transform,R=h?c.textSizeData:c.iconSizeData,j=o.evaluateSizeForZoom(R,s.transform.zoom),X=[256/s.width*2+1,256/s.height*2+1],Z=h?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Z.clear();const U=c.lineVertexArray,ie=h?c.text.placedSymbolArray:c.icon.placedSymbolArray,H=s.transform.width/s.transform.height;let ee=!1;for(let te=0;te<ie.length;te++){const re=ie.get(te);if(re.writingMode!==o.WritingMode.vertical||ee||te!==0&&ie.get(te-1).writingMode===o.WritingMode.horizontal||(ee=!0),(re.hidden||re.writingMode===o.WritingMode.vertical)&&!ee){wi(re.numGlyphs,Z);continue}ee=!1;const Q=new o.pointGeometry(re.tileAnchorX,re.tileAnchorY),se=A?A(Q):[0,0,0],me=z.projection.projectTilePoint(Q.x,Q.y,I.canonical),we=[me.x+se[0],me.y+se[1],me.z+se[2]],Ae=[...we,1];if(o.transformMat4$1(Ae,Ae,t),!vp(Ae,X)){wi(re.numGlyphs,Z);continue}const Ee=si(s.transform.cameraToCenterDistance,Ae[3]),Ne=o.evaluateSizeForFeature(R,j,re),_e=x?Ne/Ee:Ne*Ee,Ue=Ui(new o.pointGeometry(we[0],we[1]),m,we[2]);if(Ue.signedDistanceFromCamera<=0){wi(re.numGlyphs,Z);continue}let Fe={};const ot=x?null:A,Me=ea(re,_e,!1,w,t,m,_,c.glyphOffsetArray,U,Z,Ue.point,Q,Fe,H,ot,z.projection,I);ee=Me.useVertical,ot&&Me.needsFlipping&&(Fe={}),(Me.notEnoughRoom||ee||Me.needsFlipping&&ea(re,_e,!0,w,t,m,_,c.glyphOffsetArray,U,Z,Ue.point,Q,Fe,H,ot,z.projection,I).notEnoughRoom)&&wi(re.numGlyphs,Z)}h?c.text.dynamicLayoutVertexBuffer.updateData(Z):c.icon.dynamicLayoutVertexBuffer.updateData(Z)}function Qs(c,t,s,h,m,_,x,w,A,I,z,R,j,X,Z){const U=w.glyphStartIndex+w.numGlyphs,ie=w.lineStartIndex,H=w.lineStartIndex+w.lineLength,ee=t.getoffsetX(w.glyphStartIndex),te=t.getoffsetX(U-1),re=So(c*ee,s,h,m,_,x,w.segment,ie,H,A,I,z,R,j,!0,X,Z);if(!re)return null;const Q=So(c*te,s,h,m,_,x,w.segment,ie,H,A,I,z,R,j,!0,X,Z);return Q?{first:re,last:Q}:null}function Eo(c,t,s,h){return c.writingMode===o.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*h?{useVertical:!0}:c.writingMode===o.WritingMode.vertical?t.y<s.y?{needsFlipping:!0}:null:c.flipState!==0&&function(m,_,x){const w=(_.x-m.x)*x;return w===0||Math.abs((_.y-m.y)/w)>Dt}(t,s,h)?c.flipState===1?{needsFlipping:!0}:null:t.x>s.x?{needsFlipping:!0}:null}function ea(c,t,s,h,m,_,x,w,A,I,z,R,j,X,Z,U,ie){const H=t/24,ee=c.lineOffsetX*H,te=c.lineOffsetY*H;let re;if(c.numGlyphs>1){const Q=c.glyphStartIndex+c.numGlyphs,se=c.lineStartIndex,me=c.lineStartIndex+c.lineLength,we=Qs(H,w,ee,te,s,z,R,c,A,_,j,Z,!1,U,ie);if(!we)return{notEnoughRoom:!0};const Ae=Ui(we.first.point,x).point,Ee=Ui(we.last.point,x).point;if(h&&!s){const Ne=Eo(c,Ae,Ee,X);if(c.flipState=Ne&&Ne.needsFlipping?1:2,Ne)return Ne}re=[we.first];for(let Ne=c.glyphStartIndex+1;Ne<Q-1;Ne++)re.push(So(H*w.getoffsetX(Ne),ee,te,s,z,R,c.segment,se,me,A,_,j,Z,!1,!1,U,ie));re.push(we.last)}else{if(h&&!s){const se=Ui(R,m).point,me=c.lineStartIndex+c.segment+1,we=new o.pointGeometry(A.getx(me),A.gety(me)),Ae=Ui(we,m),Ee=Eo(c,se,Ae.signedDistanceFromCamera>0?Ae.point:Vt(R,we,se,1,m,void 0,U,ie.canonical),X);if(c.flipState=Ee&&Ee.needsFlipping?1:2,Ee)return Ee}const Q=So(H*w.getoffsetX(c.glyphStartIndex),ee,te,s,z,R,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,A,_,j,Z,!1,!1,U,ie);if(!Q)return{notEnoughRoom:!0};re=[Q]}for(const Q of re)o.addDynamicAttributes(I,Q.point,Q.angle);return{}}function dl(c,t,s,h,m){const _=h.projectTilePoint(c.x,c.y,t);if(!m)return Ui(_,s,_.z);const x=m(c);return Ui(new o.pointGeometry(_.x+x[0],_.y+x[1]),s,_.z+x[2])}function Vt(c,t,s,h,m,_,x,w){const A=dl(c.add(c.sub(t)._unit()),w,m,x,_).point,I=s.sub(A);return s.add(I._mult(h/I.mag()))}function So(c,t,s,h,m,_,x,w,A,I,z,R,j,X,Z,U,ie){const H=h?c-t:c+t;let ee=H>0?1:-1,te=0;h&&(ee*=-1,te=Math.PI),ee<0&&(te+=Math.PI);let re=ee>0?w+x:w+x+1,Q=m,se=m,me=0,we=0;const Ae=Math.abs(H),Ee=[],Ne=[];let _e=_;const Ue=()=>{const it=re-ee;return me===0?_:new o.pointGeometry(I.getx(it),I.gety(it))},Fe=()=>Vt(Ue(),_e,se,Ae-me+1,z,j,U,ie.canonical);for(;me+we<=Ae;){if(re+=ee,re<w||re>=A)return null;if(se=Q,Ee.push(Q),X&&Ne.push(_e||Ue()),Q=R[re],Q===void 0){_e=new o.pointGeometry(I.getx(re),I.gety(re));const it=dl(_e,ie.canonical,z,U,j);Q=it.signedDistanceFromCamera>0?R[re]=it.point:Fe()}else _e=null;me+=we,we=se.dist(Q)}Z&&j&&(_e=_e||new o.pointGeometry(I.getx(re),I.gety(re)),R[re]=Q=R[re]===void 0?Q:Fe(),we=se.dist(Q));const ot=(Ae-me)/we,Me=Q.sub(se),tt=Me.mult(ot)._add(se);s&&tt._add(Me._unit()._perp()._mult(s*ee));const ht=te+Math.atan2(Q.y-se.y,Q.x-se.x);return Ee.push(tt),X&&(_e=_e||new o.pointGeometry(I.getx(re),I.gety(re)),Ne.push(function(it,nt,ft){const At=1-ft;return new o.pointGeometry(it.x*At+nt.x*ft,it.y*At+nt.y*ft)}(Ne.length>0?Ne[Ne.length-1]:_e,_e,ot))),{point:tt,angle:ht,path:Ee,tilePath:Ne}}const fl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function wi(c,t){for(let s=0;s<c;s++){const h=t.length;t.resize(h+4),t.float32.set(fl,3*h)}}function Yi(c,t,s){const h=t[0],m=t[1];return c[0]=s[0]*h+s[4]*m+s[12],c[1]=s[1]*h+s[5]*m+s[13],c[3]=s[3]*h+s[7]*m+s[15],c}const In=100;class ta{constructor(t,s,h=new Yr(t.width+200,t.height+200,25),m=new Yr(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+In,this.screenBottomBoundary=t.height+In,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,h,m,_,x,w){let A=s.projectedAnchorX,I=s.projectedAnchorY,z=s.projectedAnchorZ;const R=s.elevation,j=s.tileID;if(R&&j){const re=this.transform.projection.upVector(j.canonical,s.tileAnchorX,s.tileAnchorY),Q=this.transform.projection.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=re[0]*R*Q,I+=re[1]*R*Q,z+=re[2]*R*Q}const X=this.projectAndGetPerspectiveRatio(x,[A,I,z],s.tileID,this.transform.projection.name==="globe"||!!R||this.transform.pitch>0),Z=_*X.perspectiveRatio,U=(s.x1*t+h.x-s.padding)*Z+X.point.x,ie=(s.y1*t+h.y-s.padding)*Z+X.point.y,H=(s.x2*t+h.x+s.padding)*Z+X.point.x,ee=(s.y2*t+h.y+s.padding)*Z+X.point.y,te=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(U,ie,H,ee)||!m&&this.grid.hitTest(U,ie,H,ee,w)||te?{box:[],offscreen:!1,occluded:X.occluded}:{box:[U,ie,H,ee],offscreen:this.isOffscreen(U,ie,H,ee),occluded:!1}}placeCollisionCircles(t,s,h,m,_,x,w,A,I,z,R,j,X,Z){const U=[],ie=this.transform.elevation,H=ie?ie.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,this.transform.projection):Fe=>[0,0,0],ee=new o.pointGeometry(s.tileAnchorX,s.tileAnchorY),te=this.transform.projection.projectTilePoint(s.tileAnchorX,s.tileAnchorY,Z.canonical),re=H(ee),Q=[te.x+re[0],te.y+re[1],te.z+re[2]],se=this.projectAndGetPerspectiveRatio(x,[Q[0],Q[1],Q[2]],Z,this.transform.projection.name==="globe"||!!ie||this.transform.pitch>0),{perspectiveRatio:me}=se,we=(z?_/me:_*me)/o.ONE_EM,Ae=Ui(new o.pointGeometry(Q[0],Q[1]),w,Q[2]).point,Ee=se.signedDistanceFromCamera>0?Qs(we,m,s.lineOffsetX*we,s.lineOffsetY*we,!1,Ae,ee,s,h,w,{},ie&&!z?H:null,z&&!!ie,this.transform.projection,Z):null;let Ne=!1,_e=!1,Ue=!0;if(Ee&&!se.occluded){const Fe=.5*j*me+X,ot=new o.pointGeometry(-100,-100),Me=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),tt=new Nn,ht=Ee.first,it=Ee.last;let nt=[];for(let lt=ht.path.length-1;lt>=1;lt--)nt.push(ht.path[lt]);for(let lt=1;lt<it.path.length;lt++)nt.push(it.path[lt]);const ft=2.5*Fe;if(A){const lt=nt.map(ie?(gt,Nt)=>{const ai=H(Nt<ht.path.length-1?ht.tilePath[ht.path.length-1-Nt]:it.tilePath[Nt-ht.path.length+2]);return Ui(gt,A,ai[2])}:gt=>Ui(gt,A));nt=lt.some(gt=>gt.signedDistanceFromCamera<=0)?[]:lt.map(gt=>gt.point)}let At=[];if(nt.length>0){const lt=nt[0].clone(),gt=nt[0].clone();for(let Nt=1;Nt<nt.length;Nt++)lt.x=Math.min(lt.x,nt[Nt].x),lt.y=Math.min(lt.y,nt[Nt].y),gt.x=Math.max(gt.x,nt[Nt].x),gt.y=Math.max(gt.y,nt[Nt].y);At=lt.x>=ot.x&&gt.x<=Me.x&&lt.y>=ot.y&&gt.y<=Me.y?[nt]:gt.x<ot.x||lt.x>Me.x||gt.y<ot.y||lt.y>Me.y?[]:o.clipLine([nt],ot.x,ot.y,Me.x,Me.y)}for(const lt of At){tt.reset(lt,.25*Fe);let gt=0;gt=tt.length<=.5*Fe?1:Math.ceil(tt.paddedLength/ft)+1;for(let Nt=0;Nt<gt;Nt++){const ai=Nt/Math.max(gt-1,1),Ri=tt.lerp(ai),Bi=Ri.x+In,tn=Ri.y+In;U.push(Bi,tn,Fe,0);const kn=Bi-Fe,Qn=tn-Fe,Tr=Bi+Fe,er=tn+Fe;if(Ue=Ue&&this.isOffscreen(kn,Qn,Tr,er),_e=_e||this.isInsideGrid(kn,Qn,Tr,er),!t&&this.grid.hitTestCircle(Bi,tn,Fe,R)&&(Ne=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Ne,occluded:!1}}}}return{circles:!I&&Ne||!_e?[]:U,offscreen:Ue,collisionDetected:Ne,occluded:se.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,m=1/0,_=-1/0,x=-1/0;for(const z of t){const R=new o.pointGeometry(z.x+In,z.y+In);h=Math.min(h,R.x),m=Math.min(m,R.y),_=Math.max(_,R.x),x=Math.max(x,R.y),s.push(R)}const w=this.grid.query(h,m,_,x).concat(this.ignoredGrid.query(h,m,_,x)),A={},I={};for(const z of w){const R=z.key;if(A[R.bucketInstanceId]===void 0&&(A[R.bucketInstanceId]={}),A[R.bucketInstanceId][R.featureIndex])continue;const j=[new o.pointGeometry(z.x1,z.y1),new o.pointGeometry(z.x2,z.y1),new o.pointGeometry(z.x2,z.y2),new o.pointGeometry(z.x1,z.y2)];o.polygonIntersectsPolygon(s,j)&&(A[R.bucketInstanceId][R.featureIndex]=!0,I[R.bucketInstanceId]===void 0&&(I[R.bucketInstanceId]=[]),I[R.bucketInstanceId].push(R.featureIndex))}return I}insertCollisionBox(t,s,h,m,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,h,m,_){const x=s?this.ignoredGrid:this.grid,w={bucketInstanceId:h,featureIndex:m,collisionGroupID:_};for(let A=0;A<t.length;A+=4)x.insertCircle(w,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,s,h,m){const _=[s[0],s[1],s[2],1];let x=!1;return s[2]||this.transform.pitch>0?(o.transformMat4$1(_,_,t),this.fogState&&h&&(x=function(w,A,I,z,R,j){const X=j.calculateFogTileMatrix(R),Z=[A,I,z];return o.transformMat4(Z,Z,X),Rt(w,Z,j.pitch,j._fov)}(this.fogState,s[0],s[1],s[2],h.toUnwrapped(),this.transform)>.9)):Yi(_,_,t),{point:new o.pointGeometry((_[0]/_[3]+1)/2*this.transform.width+In,(-_[1]/_[3]+1)/2*this.transform.height+In),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/_[3]*.5,1.5),signedDistanceFromCamera:_[3],occluded:m&&_[2]>_[3]||x}}isOffscreen(t,s,h,m){return h<In||t>=this.screenRightBoundary||m<In||s>this.screenBottomBoundary}isInsideGrid(t,s,h,m){return h>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=o.identity([]);return o.translate(t,t,[-100,-100,0]),t}}class gi{constructor(t,s,h,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Wn{constructor(t,s,h,m,_,x=!1){this.text=new gi(t?t.text:null,s,h,_),this.icon=new gi(t?t.icon:null,s,m,_),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Hn{constructor(t,s,h,m=!1){this.text=t,this.icon=s,this.skipFade=h,this.clipped=m}}class ki{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class ml{constructor(t,s,h,m,_){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=_}}class Cn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[t]}}function Ao(c,t,s,h,m){const{horizontalAlign:_,verticalAlign:x}=o.getAnchorAlignment(c),w=-(_-.5)*t,A=-(x-.5)*s,I=o.evaluateVariableOffset(c,h);return new o.pointGeometry(w+I[0]*m,A+I[1]*m)}function Mo(c,t,s,h,m){const _=new o.pointGeometry(c,t);return s&&_._rotate(h?m:-m),_}class bp{constructor(t,s,h,m,_){this.transform=t.clone(),this.collisionIndex=new ta(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Cn(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,h,m){const _=h.getBucket(s),x=h.latestFeatureIndex;if(!_||!x||s.id!==_.layerIds[0])return;const w=_.layers[0].layout,A=h.collisionBoxArray,I=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),z=h.tileSize/o.EXTENT,R=h.tileID.toUnwrapped(),j=this.transform.calculateProjMatrix(R),X=w.get("text-pitch-alignment")==="map",Z=w.get("text-rotation-alignment")==="map";s.compileFilter();const U=s.dynamicFilter(),ie=s.dynamicFilterNeedsFeature(),H=this.transform.calculatePixelsToTileUnitsMatrix(h),ee=Kr(j,h.tileID.canonical,X,Z,this.transform,H);let te=null;if(X){const se=To(j,h.tileID.canonical,X,Z,this.transform,H);te=o.multiply$1([],this.transform.labelPlaneMatrix,se)}let re=null;U&&h.latestFeatureIndex&&(re={unwrappedTileID:R,dynamicFilter:U,dynamicFilterNeedsFeature:ie,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new ml(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,h.tileID);const Q={bucket:_,layout:w,posMatrix:j,textLabelPlaneMatrix:ee,labelToScreenMatrix:te,clippingData:re,scale:I,textPixelRatio:z,holdingForFade:h.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(m)for(const se of _.sortKeyRanges){const{sortKey:me,symbolInstanceStart:we,symbolInstanceEnd:Ae}=se;t.push({sortKey:me,symbolInstanceStart:we,symbolInstanceEnd:Ae,parameters:Q})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(t,s,h,m,_,x,w,A,I,z,R,j,X,Z,U,ie,H,ee){const te=[j.textOffset0,j.textOffset1],re=Ao(t,h,m,te,_),Q=this.collisionIndex.placeCollisionBox(_,s,Mo(re.x,re.y,x,w,this.transform.angle),R,A,I,z.predicate);if((!ie||this.collisionIndex.placeCollisionBox(Z.getSymbolInstanceIconSize(ee,this.transform.zoom,X),ie,Mo(re.x,re.y,x,w,this.transform.angle),R,A,I,z.predicate).box.length!==0)&&Q.box.length>0){let se;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(se=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:te,width:h,height:m,anchor:t,textScale:_,prevAnchor:se},this.markUsedJustification(Z,t,j,U),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,U,j),this.placedOrientations[j.crossTileID]=U),{shift:re,placedGlyphBoxes:Q}}}placeLayerBucketPart(t,s,h,m){const{bucket:_,layout:x,posMatrix:w,textLabelPlaneMatrix:A,labelToScreenMatrix:I,clippingData:z,textPixelRatio:R,holdingForFade:j,collisionBoxArray:X,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:U,collisionGroup:ie}=t.parameters,H=x.get("text-optional"),ee=x.get("icon-optional"),te=x.get("text-allow-overlap"),re=x.get("icon-allow-overlap"),Q=x.get("text-rotation-alignment")==="map",se=x.get("text-pitch-alignment")==="map",me=x.get("icon-text-fit")!=="none",we=x.get("symbol-z-order")==="viewport-y";let Ae=te&&(re||!_.hasIconData()||ee),Ee=re&&(te||!_.hasTextData()||H);!_.collisionArrays&&X&&_.deserializeCollisionBoxes(X),h&&m&&_.updateCollisionDebugBuffers(this.transform.zoom,X);const Ne=(_e,Ue,Fe)=>{if(z){const ui={zoom:this.transform.zoom,pitch:this.transform.pitch};let di=null;if(z.dynamicFilterNeedsFeature){const Zt=this.retainedQueryData[_.bucketInstanceId];di=z.featureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:Zt.bucketIndex,sourceLayerIndex:Zt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(ui,di,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new o.pointGeometry(_e.tileAnchorX,_e.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[_e.crossTileID]=new Hn(!1,!1,!1,!0),void(s[_e.crossTileID]=!0)}if(s[_e.crossTileID])return;if(j)return void(this.placements[_e.crossTileID]=new Hn(!1,!1,!1));let ot=!1,Me=!1,tt=!0,ht=!1,it=!1,nt=null,ft={box:null,offscreen:null,occluded:null},At={box:null,offscreen:null,occluded:null},lt=null,gt=null,Nt=null,ai=0,Ri=0,Bi=0;Fe.textFeatureIndex?ai=Fe.textFeatureIndex:_e.useRuntimeCollisionCircles&&(ai=_e.featureIndex),Fe.verticalTextFeatureIndex&&(Ri=Fe.verticalTextFeatureIndex);const tn=ui=>{ui.tileID=this.retainedQueryData[_.bucketInstanceId].tileID,(this.transform.elevation||ui.elevation)&&(ui.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[_.bucketInstanceId].tileID,ui.tileAnchorX,ui.tileAnchorY):0)},kn=Fe.textBox;if(kn){tn(kn);const ui=Zt=>{let yi=o.WritingMode.horizontal;if(_.allowVerticalPlacement&&!Zt&&this.prevPlacement){const nn=this.prevPlacement.placedOrientations[_e.crossTileID];nn&&(this.placedOrientations[_e.crossTileID]=nn,yi=nn,this.markUsedOrientation(_,yi,_e))}return yi},di=(Zt,yi)=>{if(_.allowVerticalPlacement&&_e.numVerticalGlyphVertices>0&&Fe.verticalTextBox){for(const nn of _.writingModes)if(nn===o.WritingMode.vertical?(ft=yi(),At=ft):ft=Zt(),ft&&ft.box&&ft.box.length)break}else ft=Zt()};if(x.get("text-variable-anchor")){let Zt=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]){const li=this.prevPlacement.variableOffsets[_e.crossTileID];Zt.indexOf(li.anchor)>0&&(Zt=Zt.filter(dn=>dn!==li.anchor),Zt.unshift(li.anchor))}const yi=(li,dn,Cs)=>{const rn=_.getSymbolInstanceTextSize(Z,_e,this.transform.zoom,Ue),ro=(li.x2-li.x1)*rn+2*li.padding,Xu=(li.y2-li.y1)*rn+2*li.padding,Jl=me&&!re?dn:null;Jl&&tn(Jl);let Oo={box:[],offscreen:!1,occluded:!1};const Op=te?2*Zt.length:Zt.length;for(let Er=0;Er<Op;++Er){const Ql=this.attemptAnchorPlacement(Zt[Er%Zt.length],li,ro,Xu,rn,Q,se,R,w,ie,Er>=Zt.length,_e,Ue,_,Cs,Jl,Z,U);if(Ql&&(Oo=Ql.placedGlyphBoxes,Oo&&Oo.box&&Oo.box.length)){ot=!0,nt=Ql.shift;break}}return Oo};di(()=>yi(kn,Fe.iconBox,o.WritingMode.horizontal),()=>{const li=Fe.verticalTextBox;return li&&tn(li),_.allowVerticalPlacement&&!(ft&&ft.box&&ft.box.length)&&_e.numVerticalGlyphVertices>0&&li?yi(li,Fe.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ft&&(ot=ft.box,tt=ft.offscreen,ht=ft.occluded);const nn=ui(ft&&ft.box);if(!ot&&this.prevPlacement){const li=this.prevPlacement.variableOffsets[_e.crossTileID];li&&(this.variableOffsets[_e.crossTileID]=li,this.markUsedJustification(_,li.anchor,_e,nn))}}else{const Zt=(yi,nn)=>{const li=_.getSymbolInstanceTextSize(Z,_e,this.transform.zoom,Ue),dn=this.collisionIndex.placeCollisionBox(li,yi,new o.pointGeometry(0,0),te,R,w,ie.predicate);return dn&&dn.box&&dn.box.length&&(this.markUsedOrientation(_,nn,_e),this.placedOrientations[_e.crossTileID]=nn),dn};di(()=>Zt(kn,o.WritingMode.horizontal),()=>{const yi=Fe.verticalTextBox;return _.allowVerticalPlacement&&_e.numVerticalGlyphVertices>0&&yi?(tn(yi),Zt(yi,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ui(ft&&ft.box&&ft.box.length)}}if(lt=ft,ot=lt&&lt.box&&lt.box.length>0,tt=lt&&lt.offscreen,ht=lt&&lt.occluded,_e.useRuntimeCollisionCircles){const ui=_.text.placedSymbolArray.get(_e.centerJustifiedTextSymbolIndex>=0?_e.centerJustifiedTextSymbolIndex:_e.verticalPlacedTextSymbolIndex),di=o.evaluateSizeForFeature(_.textSizeData,Z,ui),Zt=x.get("text-padding");gt=this.collisionIndex.placeCollisionCircles(te,ui,_.lineVertexArray,_.glyphOffsetArray,di,w,A,I,h,se,ie.predicate,_e.collisionCircleDiameter*di/o.ONE_EM,Zt,this.retainedQueryData[_.bucketInstanceId].tileID),ot=te||gt.circles.length>0&&!gt.collisionDetected,tt=tt&&gt.offscreen,ht=gt.occluded}if(Fe.iconFeatureIndex&&(Bi=Fe.iconFeatureIndex),Fe.iconBox){const ui=di=>{tn(di);const Zt=me&&nt?Mo(nt.x,nt.y,Q,se,this.transform.angle):new o.pointGeometry(0,0),yi=_.getSymbolInstanceIconSize(U,this.transform.zoom,Ue);return this.collisionIndex.placeCollisionBox(yi,di,Zt,re,R,w,ie.predicate)};At&&At.box&&At.box.length&&Fe.verticalIconBox?(Nt=ui(Fe.verticalIconBox),Me=Nt.box.length>0):(Nt=ui(Fe.iconBox),Me=Nt.box.length>0),tt=tt&&Nt.offscreen,it=Nt.occluded}const Qn=H||_e.numHorizontalGlyphVertices===0&&_e.numVerticalGlyphVertices===0,Tr=ee||_e.numIconVertices===0;if(Qn||Tr?Tr?Qn||(Me=Me&&ot):ot=Me&&ot:Me=ot=Me&&ot,ot&&lt&&lt.box&&this.collisionIndex.insertCollisionBox(lt.box,x.get("text-ignore-placement"),_.bucketInstanceId,At&&At.box&&Ri?Ri:ai,ie.ID),Me&&Nt&&this.collisionIndex.insertCollisionBox(Nt.box,x.get("icon-ignore-placement"),_.bucketInstanceId,Bi,ie.ID),gt&&(ot&&this.collisionIndex.insertCollisionCircles(gt.circles,x.get("text-ignore-placement"),_.bucketInstanceId,ai,ie.ID),h)){const ui=_.bucketInstanceId;let di=this.collisionCircleArrays[ui];di===void 0&&(di=this.collisionCircleArrays[ui]=new ki);for(let Zt=0;Zt<gt.circles.length;Zt+=4)di.circles.push(gt.circles[Zt+0]),di.circles.push(gt.circles[Zt+1]),di.circles.push(gt.circles[Zt+2]),di.circles.push(gt.collisionDetected?1:0)}const er=this.transform.projection.name!=="globe";Ae=Ae&&(er||!ht),Ee=Ee&&(er||!it),this.placements[_e.crossTileID]=new Hn(ot||Ae,Me||Ee,tt||_.justReloaded),s[_e.crossTileID]=!0};if(we){const _e=_.getSortedSymbolIndexes(this.transform.angle);for(let Ue=_e.length-1;Ue>=0;--Ue){const Fe=_e[Ue];Ne(_.symbolInstances.get(Fe),Fe,_.collisionArrays[Fe])}}else for(let _e=t.symbolInstanceStart;_e<t.symbolInstanceEnd;_e++)Ne(_.symbolInstances.get(_e),_e,_.collisionArrays[_e]);if(h&&_.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[_.bucketInstanceId];o.invert(_e.invProjMatrix,w),_e.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,s,h,m){let _;_=m===o.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(s)];const x=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const w of x)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=_>=0&&w!==_?0:h.crossTileID)}markUsedOrientation(t,s,h){const m=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,_=s===o.WritingMode.vertical?s:0,x=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const w of x)t.text.placedSymbolArray.get(w).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,_=s?s.opacities:{},x=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const A in this.placements){const I=this.placements[A],z=_[A];z?(this.opacities[A]=new Wn(z,m,I.text,I.icon,null,I.clipped),h=h||I.text!==z.text.placed||I.icon!==z.icon.placed):(this.opacities[A]=new Wn(null,m,I.text,I.icon,I.skipFade,I.clipped),h=h||I.text||I.icon)}for(const A in _){const I=_[A];if(!this.opacities[A]){const z=new Wn(I,m,!1,!1);z.isHidden()||(this.opacities[A]=z,h=h||I.text.placed||I.icon.placed)}}for(const A in x)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=x[A]);for(const A in w)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=w[A]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const h={};for(const m of s){const _=m.getBucket(t);_&&m.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,h,m.collisionBoxArray)}}updateBucketOpacities(t,s,h){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0].layout,_=!!t.layers[0].dynamicFilter(),x=new Wn(null,0,!1,!1,!0),w=m.get("text-allow-overlap"),A=m.get("icon-allow-overlap"),I=m.get("text-variable-anchor"),z=m.get("text-rotation-alignment")==="map",R=m.get("text-pitch-alignment")==="map",j=m.get("icon-text-fit")!=="none",X=new Wn(null,0,w&&(A||!t.hasIconData()||m.get("icon-optional")),A&&(w||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const Z=(ie,H,ee)=>{for(let te=0;te<H/4;te++)ie.opacityVertexArray.emplaceBack(ee)};let U=0;for(let ie=0;ie<t.symbolInstances.length;ie++){const H=t.symbolInstances.get(ie),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:te,crossTileID:re}=H;let Q=this.opacities[re];s[re]?Q=x:Q||(Q=X,this.opacities[re]=Q),s[re]=!0;const se=ee>0||te>0,me=H.numIconVertices>0,we=this.placedOrientations[H.crossTileID],Ae=we===o.WritingMode.vertical,Ee=we===o.WritingMode.horizontal||we===o.WritingMode.horizontalOnly;if(!se&&!me||Q.isHidden()||U++,se){const Ne=iu(Q.text);Z(t.text,ee,Ae?ra:Ne),Z(t.text,te,Ee?ra:Ne);const _e=Q.text.isHidden();[H.rightJustifiedTextSymbolIndex,H.centerJustifiedTextSymbolIndex,H.leftJustifiedTextSymbolIndex].forEach(ot=>{ot>=0&&(t.text.placedSymbolArray.get(ot).hidden=_e||Ae?1:0)}),H.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(H.verticalPlacedTextSymbolIndex).hidden=_e||Ee?1:0);const Ue=this.variableOffsets[H.crossTileID];Ue&&this.markUsedJustification(t,Ue.anchor,H,we);const Fe=this.placedOrientations[H.crossTileID];Fe&&(this.markUsedJustification(t,"left",H,Fe),this.markUsedOrientation(t,Fe,H))}if(me){const Ne=iu(Q.icon);H.placedIconSymbolIndex>=0&&(Z(t.icon,H.numIconVertices,Ae?ra:Ne),t.icon.placedSymbolArray.get(H.placedIconSymbolIndex).hidden=Q.icon.isHidden()),H.verticalPlacedIconSymbolIndex>=0&&(Z(t.icon,H.numVerticalIconVertices,Ee?ra:Ne),t.icon.placedSymbolArray.get(H.verticalPlacedIconSymbolIndex).hidden=Q.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ne=t.collisionArrays[ie];if(Ne){let _e=new o.pointGeometry(0,0),Ue=!0;if(Ne.textBox||Ne.verticalTextBox){if(I){const ot=this.variableOffsets[re];ot?(_e=Ao(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textScale),z&&_e._rotate(R?this.transform.angle:-this.transform.angle)):Ue=!1}_&&(Ue=!Q.clipped),Ne.textBox&&zn(t.textCollisionBox.collisionVertexArray,Q.text.placed,!Ue||Ae,_e.x,_e.y),Ne.verticalTextBox&&zn(t.textCollisionBox.collisionVertexArray,Q.text.placed,!Ue||Ee,_e.x,_e.y)}const Fe=Ue&&Boolean(!Ee&&Ne.verticalIconBox);Ne.iconBox&&zn(t.iconCollisionBox.collisionVertexArray,Q.icon.placed,Fe,j?_e.x:0,j?_e.y:0),Ne.verticalIconBox&&zn(t.iconCollisionBox.collisionVertexArray,Q.icon.placed,!Fe,j?_e.x:0,j?_e.y:0)}}}if(t.fullyClipped=U===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ie.invProjMatrix,t.placementViewportMatrix=ie.viewportMatrix,t.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function zn(c,t,s,h,m){c.emplaceBack(t?1:0,s?1:0,h||0,m||0),c.emplaceBack(t?1:0,s?1:0,h||0,m||0),c.emplaceBack(t?1:0,s?1:0,h||0,m||0),c.emplaceBack(t?1:0,s?1:0,h||0,m||0)}const wp=Math.pow(2,25),tu=Math.pow(2,24),Ki=Math.pow(2,17),ia=Math.pow(2,16),fr=Math.pow(2,9),_l=Math.pow(2,8),na=Math.pow(2,1);function iu(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,s=Math.floor(127*c.opacity);return s*wp+t*tu+s*Ki+t*ia+s*fr+t*_l+s*na+t}const ra=0;class gl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,h,m,_){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(x,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,A)=>w.sortKey-A.sortKey));this._currentPartIndex<x.length;){const w=x[this._currentPartIndex];if(s.placeLayerBucketPart(w,this._seenCrossTileIDs,h,w.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class Tp{constructor(t,s,h,m,_,x,w,A){this.placement=new bp(t,_,x,w,A),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,h){const m=o.exported.now(),_=()=>{const x=o.exported.now()-m;return!this._forceFullPlacement&&x>2};for(;this._currentPlacementIndex>=0;){const x=s[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new gl(x)),this._inProgressLayer.continuePlacement(h[x.source],this.placement,this._showCollisionBoxes,x,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const nu=512/o.EXTENT/2;class Ep{constructor(t,s,h){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let m=0;m<s.length;m++){const _=s.get(m),x=_.key;this.indexedSymbolInstances[x]||(this.indexedSymbolInstances[x]=[]),this.indexedSymbolInstances[x].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,t)})}}getScaledCoordinates(t,s){const h=nu/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*o.EXTENT+t.tileAnchorX)*h),y:Math.floor((s.canonical.y*o.EXTENT+t.tileAnchorY)*h)}}findMatches(t,s,h){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let _=0;_<t.length;_++){const x=t.get(_);if(x.crossTileID)continue;const w=this.indexedSymbolInstances[x.key];if(!w)continue;const A=this.getScaledCoordinates(x,s);for(const I of w)if(Math.abs(I.coord.x-A.x)<=m&&Math.abs(I.coord.y-A.y)<=m&&!h[I.crossTileID]){h[I.crossTileID]=!0,x.crossTileID=I.crossTileID;break}}}}class ru{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Sp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const h in this.indexes){const m=this.indexes[h],_={};for(const x in m){const w=m[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),_[w.tileID.key]=w}this.indexes[h]=_}this.lng=t}addBucket(t,s,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const x=this.indexes[_];if(Number(_)>t.overscaledZ)for(const w in x){const A=x[w];A.tileID.isChildOf(t)&&A.findMatches(s.symbolInstances,t,m)}else{const w=x[t.scaledTo(Number(_)).key];w&&w.findMatches(s.symbolInstances,t,m)}}for(let _=0;_<s.symbolInstances.length;_++){const x=s.symbolInstances.get(_);x.crossTileID||(x.crossTileID=h.generate(),m[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ep(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const h in s.indexedSymbolInstances)for(const m of s.indexedSymbolInstances[h])delete this.usedCrossTileIDs[t][m.crossTileID]}removeStaleBuckets(t){let s=!1;for(const h in this.indexes){const m=this.indexes[h];for(const _ in m)t[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[_]),delete m[_],s=!0)}return s}}class oa{constructor(){this.layerIndexes={},this.crossTileIDs=new ru,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,h,m){let _=this.layerIndexes[t.id];_===void 0&&(_=this.layerIndexes[t.id]=new Sp);let x=!1;const w={};m.name!=="globe"&&_.handleWrapJump(h);for(const A of s){const I=A.getBucket(t);I&&t.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(A.tileID,I,this.crossTileIDs)&&(x=!0),w[I.bucketInstanceId]=!0)}return _.removeStaleBuckets(w)&&(x=!0),x}pruneUnusedLayers(t){const s={};t.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const rs=(c,t)=>o.emitValidationErrors(c,t&&t.filter(s=>s.identifier!=="source.canvas")),ou=o.pick(st,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),su=o.pick(st,["setCenter","setZoom","setBearing","setPitch"]),au={version:8,layers:[],sources:{}},Jr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ji extends o.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new Ct(_t(),this),this.imageManager=new Ie,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(t._requestManager,s.localFontFamily?o.LocalGlyphMode.all:s.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new oa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const h=this;this._rtlTextPluginCallback=ji.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(_,x)=>{if(o.triggerPluginCompletionEvent(_),x&&x.every(w=>w))for(const w in h._sourceCaches){const A=h._sourceCaches[w],I=A.getSource().type;I!=="vector"&&I!=="geojson"||A.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const _=this.getSource(m.sourceId);if(_&&_.vectorLayerIds)for(const x in this._layers){const w=this._layers[x];w.source===_.id&&this._validateLayer(w)}})}loadURL(t,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!o.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,s.accessToken);const m=this.map._requestManager.transformRequest(t,o.ResourceType.Style);this._request=o.getJSON(m,(_,x)=>{this._request=null,_?this.fire(new o.ErrorEvent(_)):x&&this._load(x,h)})}loadJSON(t,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(au,!1)}_updateLayerCount(t,s){const h=s?1:-1;t.is3D()&&(this._num3DLayers+=h),t.type==="circle"&&(this._numCircleLayers+=h),t.type==="symbol"&&(this._numSymbolLayers+=h)}_load(t,s){if(s&&rs(this,o.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t,this._updateMapProjection();for(const m in t.sources)this.addSource(m,t.sources[m],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const h=jt(this.stylesheet.layers);this._order=h.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of h)m=o.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new vt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(s,h,m){let _,x,w;const A=o.exported.devicePixelRatio>1?"@2x":"";let I=o.getJSON(h.transformRequest(h.normalizeSpriteURL(s,A,".json"),o.ResourceType.SpriteJSON),(j,X)=>{I=null,w||(w=j,_=X,R())}),z=o.getImage(h.transformRequest(h.normalizeSpriteURL(s,A,".png"),o.ResourceType.SpriteImage),(j,X)=>{z=null,w||(w=j,x=X,R())});function R(){if(w)m(w);else if(_&&x){const j=o.exported.getImageData(x),X={};for(const Z in _){const{width:U,height:ie,x:H,y:ee,sdf:te,pixelRatio:re,stretchX:Q,stretchY:se,content:me}=_[Z],we=new o.RGBAImage({width:U,height:ie});o.RGBAImage.copy(j,we,{x:H,y:ee},{x:0,y:0},{width:U,height:ie}),X[Z]={data:we,pixelRatio:re,sdf:te,stretchX:Q,stretchY:se,content:me}}m(null,X)}}return{cancel(){I&&(I.cancel(),I=null),z&&(z.cancel(),z=null)}}}(t,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(h)for(const m in h)this.imageManager.addImage(m,h[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.getSource(t.source);if(!s)return;const h=t.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const h of t){const m=this._layers[h];m.type!=="custom"&&s.push(m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Jr[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(m.length||_.length)&&this._updateWorkerLayers(m,_);for(const x in this._updatedSources){const w=this._updatedSources[x];w==="reload"?this._reloadSource(x):w==="clear"&&this._clearSource(x)}this._updateTilesForChangedImages();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const h={};for(const m in this._sourceCaches){const _=this._sourceCaches[m];h[m]=_.used,_.used=!1}for(const m of this._order){const _=this._layers[m];if(_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)){const w=this._getLayerSourceCache(_);w&&(w.used=!0)}const x=this.map.painter;if(x){const w=_.getProgramIds();if(!w)continue;const A=_.getProgramConfiguration(t.zoom);for(const I of w)x.useProgram(I,A)}}for(const m in h){const _=this._sourceCaches[m];h[m]!==_.used&&_.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),rs(this,o.validateStyle(t)))return!1;(t=o.clone$1(t)).layers=jt(t.layers);const s=function(m,_){if(!m)return[{command:st.setStyle,args:[_]}];let x=[];try{if(!D(m.version,_.version))return[{command:st.setStyle,args:[_]}];D(m.center,_.center)||x.push({command:st.setCenter,args:[_.center]}),D(m.zoom,_.zoom)||x.push({command:st.setZoom,args:[_.zoom]}),D(m.bearing,_.bearing)||x.push({command:st.setBearing,args:[_.bearing]}),D(m.pitch,_.pitch)||x.push({command:st.setPitch,args:[_.pitch]}),D(m.sprite,_.sprite)||x.push({command:st.setSprite,args:[_.sprite]}),D(m.glyphs,_.glyphs)||x.push({command:st.setGlyphs,args:[_.glyphs]}),D(m.transition,_.transition)||x.push({command:st.setTransition,args:[_.transition]}),D(m.light,_.light)||x.push({command:st.setLight,args:[_.light]}),D(m.fog,_.fog)||x.push({command:st.setFog,args:[_.fog]}),D(m.projection,_.projection)||x.push({command:st.setProjection,args:[_.projection]});const w={},A=[];(function(R,j,X,Z){let U;for(U in j=j||{},R=R||{})R.hasOwnProperty(U)&&(j.hasOwnProperty(U)||Gt(U,X,Z));for(U in j)j.hasOwnProperty(U)&&(R.hasOwnProperty(U)?D(R[U],j[U])||(R[U].type==="geojson"&&j[U].type==="geojson"&&Xn(R,j,U)?X.push({command:st.setGeoJSONSourceData,args:[U,j[U].data]}):Hr(U,j,X,Z)):Ut(U,j,X))})(m.sources,_.sources,A,w);const I=[];m.layers&&m.layers.forEach(R=>{R.source&&w[R.source]?x.push({command:st.removeLayer,args:[R.id]}):I.push(R)});let z=m.terrain;z&&w[z.source]&&(x.push({command:st.setTerrain,args:[void 0]}),z=void 0),x=x.concat(A),D(z,_.terrain)||x.push({command:st.setTerrain,args:[_.terrain]}),function(R,j,X){j=j||[];const Z=(R=R||[]).map(Bt),U=j.map(Bt),ie=R.reduce(zt,{}),H=j.reduce(zt,{}),ee=Z.slice(),te=Object.create(null);let re,Q,se,me,we,Ae,Ee;for(re=0,Q=0;re<Z.length;re++)se=Z[re],H.hasOwnProperty(se)?Q++:(X.push({command:st.removeLayer,args:[se]}),ee.splice(ee.indexOf(se,Q),1));for(re=0,Q=0;re<U.length;re++)se=U[U.length-1-re],ee[ee.length-1-re]!==se&&(ie.hasOwnProperty(se)?(X.push({command:st.removeLayer,args:[se]}),ee.splice(ee.lastIndexOf(se,ee.length-Q),1)):Q++,Ae=ee[ee.length-re],X.push({command:st.addLayer,args:[H[se],Ae]}),ee.splice(ee.length-re,0,se),te[se]=!0);for(re=0;re<U.length;re++)if(se=U[re],me=ie[se],we=H[se],!te[se]&&!D(me,we))if(D(me.source,we.source)&&D(me["source-layer"],we["source-layer"])&&D(me.type,we.type)){for(Ee in qe(me.layout,we.layout,X,se,null,st.setLayoutProperty),qe(me.paint,we.paint,X,se,null,st.setPaintProperty),D(me.filter,we.filter)||X.push({command:st.setFilter,args:[se,we.filter]}),D(me.minzoom,we.minzoom)&&D(me.maxzoom,we.maxzoom)||X.push({command:st.setLayerZoomRange,args:[se,we.minzoom,we.maxzoom]}),me)me.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?qe(me[Ee],we[Ee],X,se,Ee.slice(6),st.setPaintProperty):D(me[Ee],we[Ee])||X.push({command:st.setLayerProperty,args:[se,Ee,we[Ee]]}));for(Ee in we)we.hasOwnProperty(Ee)&&!me.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?qe(me[Ee],we[Ee],X,se,Ee.slice(6),st.setPaintProperty):D(me[Ee],we[Ee])||X.push({command:st.setLayerProperty,args:[se,Ee,we[Ee]]}))}else X.push({command:st.removeLayer,args:[se]}),Ae=ee[ee.lastIndexOf(se)+1],X.push({command:st.addLayer,args:[we,Ae]})}(I,_.layers,x)}catch(w){console.warn("Unable to compute style diff:",w),x=[{command:st.setStyle,args:[_]}]}return x}(this.serialize(),t).filter(m=>!(m.command in su));if(s.length===0)return!1;const h=s.filter(m=>!(m.command in ou));if(h.length>0)throw new Error(`Unimplemented: ${h.map(m=>m.command).join(", ")}.`);return s.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,s){return this.getImage(t)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,s),this._afterImageUpdated(t),this)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,s,h={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateSource,`sources.${t}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=de(t,s,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:m.serialize(),sourceId:t}));const _=x=>{const w=(x?"symbol:":"other:")+t,A=this._sourceCaches[w]=new o.SourceCache(w,m,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[t]=A,A.style=this,A.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const s=this.getSource(t);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const h=this._getSourceCaches(t);for(const m of h)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getSource(t).setData(s),this._changed=!0}getSource(t){const s=this._getSourceCache(t);return s&&s.getSource()}addLayer(t,s,h={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let _;if(t.type==="custom"){if(rs(this,o.validateCustomStyleLayer(t)))return;_=o.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=o.clone$1(t),t=o.extend(t,{source:m})),this._validate(o.validateLayer,`layers.${m}`,t,{arrayIndex:-1},h))return;_=o.createStyleLayer(t),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(x,0,m),this._layerOrderChanged=!0,this._layers[m]=_;const w=this._getLayerSourceCache(_);if(this._removedLayers[m]&&_.source&&w&&_.type!=="custom"){const A=this._removedLayers[m];delete this._removedLayers[m],A.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",w.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const h=this._order.indexOf(t);this._order.splice(h,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const h=this._order.indexOf(t);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,h){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===s&&m.maxzoom===h||(s!=null&&(m.minzoom=s),h!=null&&(m.maxzoom=h),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,s,h={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!D(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.validateFilter,`layers.${m.id}.filter`,s,{layerType:m.type},h)||(m.filter=o.clone$1(s),this._updateLayer(m)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const s=this.getLayer(t);return s&&o.clone$1(s.filter)}setLayoutProperty(t,s,h,m={}){this._checkLoaded();const _=this.getLayer(t);_?D(_.getLayoutProperty(s),h)||(_.setLayoutProperty(s,h,m),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,s){const h=this.getLayer(t);if(h)return h.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,s,h,m={}){this._checkLoaded();const _=this.getLayer(t);_?D(_.getPaintProperty(s),h)||(_.setPaintProperty(s,h,m)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,s){const h=this.getLayer(t);return h&&h.getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const h=t.source,m=t.sourceLayer,_=this.getSource(h);if(!_)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const x=_.type;if(x==="geojson"&&m)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!m)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const w=this._getSourceCaches(h);for(const A of w)A.setFeatureState(m,t.id,s)}removeFeatureState(t,s){this._checkLoaded();const h=t.source,m=this.getSource(h);if(!m)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const _=m.type,x=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!x)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const w=this._getSourceCaches(h);for(const A of w)A.removeFeatureState(x,t.id,s)}getFeatureState(t){this._checkLoaded();const s=t.source,h=t.sourceLayer,m=this.getSource(s);if(m){if(m.type!=="vector"||h)return t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(h,t.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();t[h.id]||(t[h.id]=h.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const s=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",s.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=x=>this._layers[x].type==="fill-extrusion",h={},m=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(s(w)){h[w]=x;for(const A of t){const I=A[w];if(I)for(const z of I)m.push(z)}}}m.sort((x,w)=>w.intersectionZ-x.intersectionZ);const _=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(s(w))for(let A=m.length-1;A>=0;A--){const I=m[A].feature;if(h[I.layer.id]<x)break;_.push(I),m.pop()}else for(const A of t){const I=A[w];if(I)for(const z of I)_.push(z.feature)}}return _}queryRenderedFeatures(t,s,h){s&&s.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of s.layers){const I=this._layers[A];if(!I)return this.fire(new o.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];m[I.source]=!0}}const _=[];s.availableImages=this._availableImages;const x=s&&s.layers?s.layers.some(A=>{const I=this.getLayer(A);return I&&I.is3D()}):this.has3DLayers(),w=Ai.createFromScreenPoints(t,h);for(const A in this._sourceCaches){const I=this._sourceCaches[A].getSource().id;s.layers&&!m[I]||_.push(ge(this._sourceCaches[A],this._layers,this._serializedLayers,w,s,h,x,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(A,I,z,R,j,X,Z){const U={},ie=X.queryRenderedSymbols(R),H=[];for(const ee of Object.keys(ie).map(Number))H.push(Z[ee]);H.sort(Ye);for(const ee of H){const te=ee.featureIndex.lookupSymbolFeatures(ie[ee.bucketInstanceId],I,ee.bucketIndex,ee.sourceLayerIndex,j.filter,j.layers,j.availableImages,A);for(const re in te){const Q=U[re]=U[re]||[],se=te[re];se.sort((me,we)=>{const Ae=ee.featureSortOrder;if(Ae){const Ee=Ae.indexOf(me.featureIndex);return Ae.indexOf(we.featureIndex)-Ee}return we.featureIndex-me.featureIndex});for(const me of se)Q.push(me)}}for(const ee in U)U[ee].forEach(te=>{const re=te.feature,Q=z(A[ee]).getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=Q});return U}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),w.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,s){s&&s.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",s.filter,null,s);const h=this._getSourceCaches(t);let m=[];for(const _ of h)m=m.concat(ke(_,s));return m}addSourceType(t,s,h){return ji.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(ji.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const h=this.light.getLight();let m=!1;for(const x in t)if(!D(t[x],h[x])){m=!0;break}if(!m)return;const _={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,s=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(s===1){if(typeof t.source=="object"){const h="terrain-dem-src";this.addSource(h,t.source),t=o.clone$1(t),t=o.extend(t,{source:h})}if(this._validate(o.validateTerrain,"terrain",t))return}if(!this.terrain||this.terrain&&s!==this.terrain.drapeRenderMode)this._createTerrain(t,s);else{const h=this.terrain,m=h.get();for(const _ in t)if(!D(t[_],m[_])){h.set(t),this.stylesheet.terrain=t;const x={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(x);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Li(t,this.map.transform);this.stylesheet.fog=t;const h={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,h=s.get();for(const m in t)if(!D(t[m],h[m])){s.set(t),this.stylesheet.fog=t;const _={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(_);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(h=>this.isLayerDraped(this._layers[h])),s=this._order.filter(h=>!this.isLayerDraped(this._layers[h]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const h=this.terrain=new Pt(t,s);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const m={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,h,m,_={}){return(!_||_.validate!==!1)&&rs(this,t.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:h,styleSpec:o.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const s=this._getSourceCaches(t);for(const h of s)h.clearTiles()}_reloadSource(t){const s=this._getSourceCaches(t);for(const h of s)h.resume(),h.reload()}_updateSources(t){for(const s in this._sourceCaches)this._sourceCaches[s].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,h,m,_=!1){let x=!1,w=!1;const A={};for(const I of this._order){const z=this._layers[I];if(z.type!=="symbol")continue;if(!A[z.source]){const j=this._getLayerSourceCache(z);if(!j)continue;A[z.source]=j.getRenderableIds(!0).map(X=>j.getTileByID(X)).sort((X,Z)=>Z.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(Z.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(z,A[z.source],t.center.lng,t.projection);x=x||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),t.zoom))&&(this.pauseablePlacement=new Tp(t,this._order,_,s,h,m,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(const I of this._order){const z=this._layers[I];z.type==="symbol"&&this.placement.updateLayerOpacities(z,A[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,h){this.imageManager.getImages(s.icons,h),this._updateTilesForChangedImages();const m=_=>{_&&_.setDependencies(s.tileID.key,s.type,s.icons)};m(this._otherSourceCaches[s.source]),m(this._symbolSourceCaches[s.source])}getGlyphs(t,s,h){this.glyphManager.getGlyphs(s.stacks,h)}getResource(t,s,h){return o.makeRequest(s,h)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this._getSourceCaches(t);return s.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ji.getSourceType=function(c){return fe[c]},ji.setSourceType=function(c,t){fe[c]=t},ji.registerForPluginStateChange=o.registerForPluginStateChange;var os=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,ss="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Qr={},mr={};Qr=pt("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),mr=pt(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const sa=pt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),as=os;var ls={background:pt(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:pt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:pt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:pt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:pt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:pt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:pt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:pt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:pt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:pt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:pt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:pt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:pt(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:pt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:pt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:pt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:pt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:pt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:pt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:pt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:pt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:pt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:pt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:pt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ss),skyboxGradient:pt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ss),skyboxCapture:pt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:pt(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:pt(`uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)
discard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function pt(c,t,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,_=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x=c.match(m),w=t.match(m),A=os.match(m);let I=w?w.concat(x):x;s||(Qr.staticUniforms&&(I=Qr.staticUniforms.concat(I)),mr.staticUniforms&&(I=mr.staticUniforms.concat(I))),I&&(I=I.concat(A));const z={};return{fragmentSource:c=c.replace(h,(R,j,X,Z,U)=>(z[U]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${X} ${Z} ${U};
#else
uniform ${X} ${Z} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${X} ${Z} ${U} = u_${U};
#endif
`)),vertexSource:t=t.replace(h,(R,j,X,Z,U)=>{const ie=Z==="float"?"vec2":"vec4",H=U.match(/color/)?"color":ie;return z[U]?j==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${X} ${ie} a_${U};
varying ${X} ${Z} ${U};
#else
uniform ${X} ${Z} u_${U};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${X} ${Z} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${H}(a_${U}, u_${U}_t);
#else
    ${X} ${Z} ${U} = u_${U};
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${X} ${ie} a_${U};
#else
uniform ${X} ${Z} u_${U};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${X} ${Z} ${U} = a_${U};
#else
    ${X} ${Z} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${X} ${Z} ${U} = unpack_mix_${H}(a_${U}, u_${U}_t);
#else
    ${X} ${Z} ${U} = u_${U};
#endif
`}),staticAttributes:_,staticUniforms:I}}class aa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,h,m,_,x,w,A){this.context=t;let I=this.boundPaintVertexBuffers.length!==m.length;for(let z=0;!I&&z<m.length;z++)this.boundPaintVertexBuffers[z]!==m[z]&&(I=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===h&&!I&&this.boundIndexBuffer===_&&this.boundVertexOffset===x&&this.boundDynamicVertexBuffer===w&&this.boundDynamicVertexBuffer2===A?(t.bindVertexArrayOES.set(this.vao),w&&w.bind(),_&&_.dynamicDraw&&_.bind(),A&&A.bind()):this.freshBind(s,h,m,_,x,w,A)}freshBind(t,s,h,m,_,x,w){let A;const I=t.numAttributes,z=this.context,R=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=w;else{A=z.currentNumAttributes||0;for(let j=I;j<A;j++)R.disableVertexAttribArray(j)}s.enableAttributes(R,t);for(const j of h)j.enableAttributes(R,t);x&&x.enableAttributes(R,t),w&&w.enableAttributes(R,t),s.bind(),s.setVertexAttribPointers(R,t,_);for(const j of h)j.bind(),j.setVertexAttribPointers(R,t,_);x&&(x.bind(),x.setVertexAttribPointers(R,t,_)),m&&m.bind(),w&&(w.bind(),w.setVertexAttribPointers(R,t,_)),z.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function lu(c,t){const s=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new o.MercatorCoordinate(0,h/s).toLngLat().lat,new o.MercatorCoordinate(0,(h+1)/s).toLngLat().lat]}function cu(c,t,s,h,m,_,x){const w=c.context,A=w.gl,I=s.fbo;if(!I)return;c.prepareDrawTile();const z=c.useProgram("hillshade");w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get());const R=((U,ie,H,ee)=>{const te=H.paint.get("hillshade-shadow-color"),re=H.paint.get("hillshade-highlight-color"),Q=H.paint.get("hillshade-accent-color");let se=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(se-=U.transform.angle);const me=!U.options.moving;return{u_matrix:ee||U.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),me),u_image:0,u_latrange:lu(0,ie.tileID),u_light:[H.paint.get("hillshade-exaggeration"),se],u_shadow:te,u_highlight:re,u_accent:Q}})(c,s,h,c.terrain?t.projMatrix:null);c.prepareDrawProgram(w,z,t.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:Z}=c.getTileBoundsBuffers(s);z.draw(w,A.TRIANGLES,m,_,x,o.CullFaceMode.disabled,R,h.id,j,X,Z)}function yl(c,t,s){if(!t.needsDEMTextureUpload)return;const h=c.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(s.stride);const _=s.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new o.Texture(h,_,m.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function xl(c,t,s,h,m,_){const x=c.context,w=x.gl;if(!t.dem)return;const A=t.dem;if(x.activeTexture.set(w.TEXTURE1),yl(c,t,A),!t.demTexture)return;t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const I=A.dim;x.activeTexture.set(w.TEXTURE0);let z=t.fbo;if(!z){const Z=new o.Texture(x,{width:I,height:I,data:null},w.RGBA);Z.bind(w.LINEAR,w.CLAMP_TO_EDGE),z=t.fbo=x.createFramebuffer(I,I,!0),z.colorAttachment.set(Z.texture)}x.bindFramebuffer.set(z.framebuffer),x.viewport.set([0,0,I,I]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:j,tileBoundsSegments:X}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,h,m,_,o.CullFaceMode.disabled,((Z,U)=>{const ie=U.stride,H=o.create();return o.ortho(H,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(H,H,[0,-o.EXTENT,0]),{u_matrix:H,u_image:1,u_dimension:[ie,ie],u_zoom:Z.overscaledZ,u_unpack:U.unpackVector}})(t.tileID,A),s.id,R,j,X),t.needsHillshadePrepare=!1}const vl=(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image0:new o.Uniform1i(c,t.u_image0),u_skirt_height:new o.Uniform1f(c,t.u_skirt_height)}),uu=(c,t)=>({u_matrix:c,u_image0:0,u_skirt_height:t}),hu=(c,t,s,h,m,_)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_merc_matrix:s,u_zoom_transition:h,u_merc_center:m,u_image0:0,u_grid_matrix:_?Float32Array.from(_):new Float32Array(9)});function la(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const _r=new class{constructor(){this.operations={}}newMorphing(c,t,s,h,m){if(c in this.operations){const _=this.operations[c];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[c]={startTime:h,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const s=this.operations[t];for(s.phase=(c-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Io={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function bl(c,t){const s=1<<c.z;return!t&&(c.x===0||c.x===s-1)||c.y===0||c.y===s-1}const ca=c=>({u_matrix:c});function wl(c,t,s,h,m){if(m>0){const _=o.exported.now(),x=(_-c.timeAdded)/m,w=t?(_-t.timeAdded)/m:-1,A=s.getSource(),I=h.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),z=!t||Math.abs(t.tileID.overscaledZ-I)>Math.abs(c.tileID.overscaledZ-I),R=z&&c.refreshedUponExpiration?1:o.clamp(z?x:1-w,0,1);return c.refreshedUponExpiration&&x>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}const Ap=2*o.mercatorZfromAltitude(1,0)*o.GLOBE_RADIUS*Math.PI;class cs extends o.SourceCache{constructor(t){const s={type:"raster-dem",maxzoom:t.transform.maxZoom},h=new Ct(_t(),null),m=de("mock-dem",s,h,t.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class us extends o.SourceCache{constructor(t){const s=de("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Ct(_t(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,h){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,x)=>{if(_[x.key]="",!this._tiles[x.key]){const w=new o.Tile(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);w.state="loaded",this._tiles[x.key]=w}return _},{});for(const _ in this._tiles)_ in m||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Tl extends o.OverscaledTileID{constructor(t,s,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class Ji extends o.Elevation{constructor(t,s){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,_]=function(A){const I=new o.StructArrayLayout4i8,z=new o.StructArrayLayout3ui6,R=131;I.reserve(17161),z.reserve(33800);const j=o.EXTENT/128,X=o.EXTENT+j/2,Z=X+j;for(let ie=-j;ie<Z;ie+=j)for(let H=-j;H<Z;H+=j){const ee=H<0||H>X||ie<0||ie>X?24575:0,te=o.clamp(Math.round(H),0,o.EXTENT),re=o.clamp(Math.round(ie),0,o.EXTENT);I.emplaceBack(te+ee,re,te,re)}const U=(ie,H)=>{const ee=H*R+ie;z.emplaceBack(ee+1,ee,ee+R),z.emplaceBack(ee+R,ee+R+1,ee+1)};for(let ie=1;ie<129;ie++)for(let H=1;H<129;H++)U(H,ie);return[0,129].forEach(ie=>{for(let H=0;H<130;H++)U(H,ie),U(ie,H)}),[I,z,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(h,o.boundsAttributes.members),this.gridIndexBuffer=x.createIndexBuffer(m),this.gridSegments=o.SegmentVector.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,h.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new us(s.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const w=x.gl;this._overlapStencilMode=new o.StencilMode({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new cs(s.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,s,h){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const m=t.terrain.properties;this.sourceCache=t.terrain.drapeRenderMode===0?this._mockSourceCache:t._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const _=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const x=this.getScaledDemTileSize();this.sourceCache.update(s,x,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),s.updateElevation(!h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(A=>{const I=s.getTileByID(A).tileID;return I.projMatrix=h.calculateProjMatrix(I.toUnwrapped()),I});(function(A,I){const z=I.transform.pointCoordinate(I.transform.getCameraPoint()),R=new o.pointGeometry(z.x,z.y);A.sort((j,X)=>{if(X.overscaledZ-j.overscaledZ)return X.overscaledZ-j.overscaledZ;const Z=new o.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),U=new o.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ie=R.mult(1<<j.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(Z)-ie.distSqr(U)})})(m,this.painter),this._previousZoom=h.zoom;const _=this.proxyToSource||{};this.proxyToSource={},m.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const x=this._style._sourceCaches;for(const A in x){const I=x[A];if(!I.used||(I!==this.sourceCache&&this.resetTileLookupCache(I.id),this._setupProxiedCoordsForOrtho(I,t[A],_),I.usedForTerrain))continue;const z=t[A];I.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[s.id]=m.map(A=>new Tl(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const w={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const I=this.terrainTileForTile[A.key];if(!I)continue;const z=I.tileID.key;z in w||(this._visibleDemTiles.push(I),w[z]=z)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],_=m.dem;!_||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),yl(this.painter,m,_))}}_prepareDemTileUniforms(t,s,h,m){if(!s||s.demTexture==null)return!1;const _=t.tileID.canonical,x=Math.pow(2,s.tileID.canonical.z-_.z),w=m||"";return h[`u_dem_tl${w}`]=[_.x*x%1,_.y*x%1],h[`u_dem_scale${w}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,s=t.gl;if(!this._emptyDepthBufferTexture){const h=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(t,h,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const s=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const _=m.dem.tree.minimums[0];return _>0&&t++,h+_},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),m=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(h,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(m,{premultiply:!1}):_=this._emptyDEMTexture=new o.Texture(t,m,s.RGBA,{premultiply:!1}),_}setupElevationDraw(t,s,h){const m=this.painter.context,_=m.gl,x=(w=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(w),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var w;x.u_dem_size=this.sourceCache.getSource().tileSize,x.u_exaggeration=this.exaggeration();const A=this.painter.transform,I=A.projection,z=t.tileID.canonical;x.u_tile_tl_up=I.upVector(z,0,0),x.u_tile_tr_up=I.upVector(z,o.EXTENT,0),x.u_tile_br_up=I.upVector(z,o.EXTENT,o.EXTENT),x.u_tile_bl_up=I.upVector(z,0,o.EXTENT),x.u_tile_up_scale=h&&h.useDenormalizedUpVectorScale?Ap:I.upVectorScale(z,A.center.lat,A.worldSize).metersToTile;let R=null,j=null,X=1;if(h&&h.morphing&&this._useVertexMorphing){const Z=h.morphing.srcDemTile,U=h.morphing.dstDemTile;X=h.morphing.phase,Z&&U&&(this._prepareDemTileUniforms(t,Z,x,"_prev")&&(j=Z),this._prepareDemTileUniforms(t,U,x)&&(R=U))}if(j&&R?(m.activeTexture.set(_.TEXTURE2),R.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),m.activeTexture.set(_.TEXTURE4),j.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),x.u_dem_lerp=X):(R=this.terrainTileForTile[t.tileID.key],m.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(t,R,x)?R.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),m.activeTexture.set(_.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(x.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),x.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&R){const Z=(1<<R.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=Z}h&&h.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(m,x)}renderToBackBuffer(t){const s=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),this.renderingToTexture=!1,function(m,_,x,w,A){if(m.transform.projection.name==="globe")(function(I,z,R,j,X){const Z=I.context,U=Z.gl;let ie,H;const ee=I.options.showTerrainWireframe?2:0,te=(Ee,Ne)=>{if(H===Ee)return;const _e=[Io[Ee],"PROJECTION_GLOBE_VIEW"];Ne&&_e.push(Io[ee]),ie=I.useProgram("globeRaster",null,_e),H=Ee},re=I.colorModeForRenderPass(),Q=new o.DepthMode(U.LEQUAL,o.DepthMode.ReadWrite,I.depthRangeFor3D);_r.update(X);const se=I.transform,me=o.calculateGlobeMercatorMatrix(se),we=[o.mercatorXfromLng(se.center.lng),o.mercatorYfromLat(se.center.lat)],Ae=I.globeSharedBuffers;if((ee?[!1,!0]:[!1]).forEach(Ee=>{H=-1;const Ne=Ee?U.LINES:U.TRIANGLES;for(const _e of j){const Ue=R.getTile(_e),Fe=o.StencilMode.disabled,ot=z.prevTerrainTileForTile[_e.key],Me=z.terrainTileForTile[_e.key];la(ot,Me)&&_r.newMorphing(_e.key,ot,Me,X,250),Z.activeTexture.set(U.TEXTURE0),Ue.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const tt=_r.getMorphValuesForProxy(_e.key),ht=tt?1:0,it={useDenormalizedUpVectorScale:!0};tt&&o.extend$1(it,{morphing:{srcDemTile:tt.from,dstDemTile:tt.to,phase:o.easeCubicInOut(tt.phase)}});const nt=Float32Array.from(se.globeMatrix),ft=o.globeTileLatLngCorners(_e.canonical),At=o.getGridMatrix(_e.canonical,ft),lt=hu(se.projMatrix,nt,me,o.globeToMercatorTransition(se.zoom),we,At);if(te(ht,Ee),z.setupElevationDraw(Ue,ie,it),I.prepareDrawProgram(Z,ie,_e.toUnwrapped()),Ae){const[gt,Nt,ai]=Ee?Ae.getWirefameBuffers(I.context):Ae.getGridBuffers();ie.draw(Z,Ne,Q,Fe,re,o.CullFaceMode.backCCW,lt,"globe_raster",gt,Nt,ai)}}}),Ae){ie=I.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const Ee of j){const{x:Ne,y:_e,z:Ue}=Ee.canonical,Fe=_e===0,ot=_e===(1<<Ue)-1,[Me,tt,ht,it]=Ae.getPoleBuffers(Ue);if(it&&(Fe||ot)){const nt=R.getTile(Ee);Z.activeTexture.set(U.TEXTURE0),nt.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let ft=o.globePoleMatrixForTile(Ue,Ne,se);const At=(lt,gt)=>lt.draw(Z,U.TRIANGLES,Q,o.StencilMode.disabled,re,o.CullFaceMode.disabled,hu(se.projMatrix,ft,ft,0,we),"globe_pole_raster",gt,ht,it);z.setupElevationDraw(nt,ie,{}),I.prepareDrawProgram(Z,ie,Ee.toUnwrapped()),Fe&&At(ie,Me),ot&&(ft=o.scale(o.create(),ft,[1,-1,1]),At(ie,tt))}}}})(m,_,x,w,A);else{const I=m.context,z=I.gl;let R,j;const X=m.options.showTerrainWireframe?2:0,Z=(te,re)=>{if(j===te)return;const Q=[Io[te]];re&&Q.push(Io[X]),R=m.useProgram("terrainRaster",null,Q),j=te},U=m.colorModeForRenderPass(),ie=new o.DepthMode(z.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D);_r.update(A);const H=m.transform,ee=6*Math.pow(1.5,22-H.zoom)*_.exaggeration();(X?[!1,!0]:[!1]).forEach(te=>{j=-1;const re=te?z.LINES:z.TRIANGLES,[Q,se]=te?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const me of w){const we=x.getTile(me),Ae=o.StencilMode.disabled,Ee=_.prevTerrainTileForTile[me.key],Ne=_.terrainTileForTile[me.key];la(Ee,Ne)&&_r.newMorphing(me.key,Ee,Ne,A,250),I.activeTexture.set(z.TEXTURE0),we.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const _e=_r.getMorphValuesForProxy(me.key),Ue=_e?1:0;let Fe;_e&&(Fe={morphing:{srcDemTile:_e.from,dstDemTile:_e.to,phase:o.easeCubicInOut(_e.phase)}});const ot=uu(me.projMatrix,bl(me.canonical,H.renderWorldCopies)?ee/10:ee);Z(Ue,te),_.setupElevationDraw(we,R,Fe),m.prepareDrawProgram(I,R,me.toUnwrapped()),R.draw(I,re,ie,Ae,U,o.CullFaceMode.backCCW,ot,"terrain_raster",_.gridBuffer,Q,se)}})}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,m=this.proxySourceCache,_=this.proxiedCoords[m.id],x=this._drapedRenderBatches.shift(),w=[],A=s.style.order;let I=0;for(const z of _){const R=m.getTileByID(z.proxyTileKey),j=m.proxyCachedFBO[z.key]?m.proxyCachedFBO[z.key][t]:void 0,X=j!==void 0?m.renderCache[j]:this.pool[I++],Z=j!==void 0;if(R.texture=X.tex,Z&&!X.dirty){w.push(R.tileID);continue}let U;h.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(h.clear({color:o.Color.transparent,stencil:0}),X.dirty=!1);for(let ie=x.start;ie<=x.end;++ie){const H=s.style._layers[A[ie]];if(H.isHidden(s.transform.zoom))continue;const ee=s.style._getLayerSourceCache(H),te=ee?this.proxyToSource[z.key][ee.id]:[z];if(!te)continue;const re=te;h.viewport.set([0,0,X.fb.width,X.fb.height]),U!==(ee?ee.id:null)&&(this._setupStencil(X,te,H,ee),U=ee?ee.id:null),s.renderLayer(s,ee,H,re)}this.renderedToTile?(X.dirty=!0,w.push(R.tileID)):Z||--I,I===5&&(I=0,this.renderToBackBuffer(w))}return this.renderToBackBuffer(w),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),x.end+1}postRender(){}renderCacheEfficiency(t){const s=t.order.length;if(s===0)return{efficiency:100};let h,m=0,_=0,x=!1;for(let w=0;w<s;++w){const A=t._layers[t.order[w]];this._style.isLayerDraped(A)?(x&&++m,++_):x||(x=!0,h=A.id)}return _===0?{efficiency:100}:{efficiency:100*(1-m/_),firstUndrapedLayer:h}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const x=_.tileID,w=Math.pow(2,x.overscaledZ),{x:A,y:I}=x.canonical,z=A/w,R=(A+1)/w,j=I/w,X=(I+1)/w;return{minx:z,miny:j,maxx:R,maxy:X,t:_.dem.tree.raycastRoot(z,j,R,X,t,s,h),tile:_}});m.sort((_,x)=>(_.t!==null?_.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const _ of m){if(_.t==null)return null;const x=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,s,h);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,s=t.gl,h=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new o.Texture(t,{width:h[0],height:h[1],data:null},s.RGBA);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const _=t.createFramebuffer(h[0],h[1],!1);return _.colorAttachment.set(m.texture),_.depthAttachment=new wo(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._layers[t],h=s.isHidden(this.painter.transform.zoom),m=s.getCrossfadeParameters(),_=!!m&&m.t!==1,x=s.hasTransition();return s.type!=="custom"&&!h&&(_||x)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof N){t=!0;break}if(t)for(let s=0;s<this._style.order.length;++s){const h=this._style._layers[this._style.order[s]],m=h.isHidden(this.painter.transform.zoom),_=this._style._getLayerSourceCache(h);if(h.type!=="raster"||m||!_)continue;const x=h.paint.get("raster-fade-duration");for(const w of this.proxyCoords){const A=this.proxyToSource[w.key][_.id];if(A)for(const I of A){const z=wl(_.getTile(I),_.findLoadedParent(I,0),_,this.painter.transform,x);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(_.id,I)}}}}_setupDrapedRenderBatches(){const t=this._style.order,s=t.length;if(s===0)return;const h=[];let m,_=0,x=this._style._layers[t[_]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++_<s;)x=this._style._layers[t[_]];for(;_<s;++_){const w=this._style._layers[t[_]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?m===void 0&&(m=_):m!==void 0&&(h.push({start:m,end:_-1}),m=void 0))}m!==void 0&&h.push({start:m,end:_-1}),this._drapedRenderBatches=h}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const x=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let w=0;w<x.length;++w){const A=Object.values(x[w]);s.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let x=h.length-1;x>=0;x--){const w=h[x];if(s.getTileByID(w.key),s.proxyCachedFBO[w.key]!==void 0){const A=t[w.key],I=this.proxyToSource[w.key];let z=0;for(const R in I){const j=I[R],X=A[R];if(!X||X.length!==j.length||j.some((Z,U)=>Z!==X[U]||m[R]&&m[R].hasOwnProperty(Z.key))){z=-1;break}++z}for(const R in s.proxyCachedFBO[w.key])s.renderCache[s.proxyCachedFBO[w.key][R]].dirty=z<0||z!==Object.values(A).length}}const _=[...this._drapedRenderBatches];_.sort((x,w)=>w.end-w.start-(x.end-x.start));for(const x of _)for(const w of h){if(s.proxyCachedFBO[w.key])continue;let A=s.renderCachePool.pop();A===void 0&&s.renderCache.length<50&&(A=s.renderCache.length,s.renderCache.push(this._createFBO())),A!==void 0&&(s.proxyCachedFBO[w.key]={},s.proxyCachedFBO[w.key][x.start]=A,s.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,x=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let w;if(h.isTileClipped())w=s.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(t.key)||0),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(t,s){const h=this.painter,m=this.painter.context,_=m.gl;h._tileClippingMaskIDs.clear(),m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const x=h.useProgram("clippingMask");for(const w of t){const A=--s;h._tileClippingMaskIDs.set(w.key,A),x.draw(m,_.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:_.ALWAYS,mask:0},A,255,_.KEEP,_.KEEP,_.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ca(w.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const h=[t.x,t.y,1,1];o.transformMat4$1(h,h,s.pixelMatrixInverse),o.scale$1(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const m=s._camera.position,_=o.mercatorZfromAltitude(1,s.center.lat),x=[m[0],m[1],m[2]/_,0],w=o.subtract([],h.slice(0,3),x);o.normalize(w,w);const A=this.raycast(x,w,this._exaggeration);return A!==null&&A?(o.scaleAndAdd(x,x,w,A),x[3]=x[2],x[2]*=_,x):null}drawDepth(){const t=this.painter,s=t.context,h=this.proxySourceCache,m=Math.ceil(t.width),_=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const x=s.gl,w=s.createFramebuffer(m,_,!0);s.activeTexture.set(x.TEXTURE0);const A=new o.Texture(s,{width:m,height:_,data:null},x.RGBA);A.bind(x.NEAREST,x.CLAMP_TO_EDGE),w.colorAttachment.set(A.texture);const I=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,m,_);w.depthAttachment.set(I),this._depthFBO=w,this._depthTexture=A}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,m,_]),function(x,w,A,I){if(x.transform.projection.name==="globe")return;const z=x.context,R=z.gl;z.clear({depth:1});const j=x.useProgram("terrainDepth"),X=new o.DepthMode(R.LESS,o.DepthMode.ReadWrite,x.depthRangeFor3D);for(const Z of I){const U=A.getTile(Z),ie=uu(Z.projMatrix,0);w.setupElevationDraw(U,j),j.draw(z,R.TRIANGLES,X,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,ie,"terrain_depth",w.gridBuffer,w.gridIndexBuffer,w.gridNoSkirtSegments)}}(t,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,s,h){if(t.getSource()instanceof ae)return this._setupProxiedCoordsForImageSource(t,s,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let w=0;w<_.length;w++){const A=_[w],I=this._findTileCoveringTileID(A,t);if(I){const z=this._createProxiedId(A,I,h[A.key]&&h[A.key][t.id]);m.push(z),this.proxyToSource[A.key][t.id]=[z]}}let x=!1;for(let w=0;w<s.length;w++){const A=t.getTile(s[w]);if(!A||!A.hasData())continue;const I=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==A.tileID.canonical.z){const z=this.proxyToSource[I.tileID.key][t.id],R=this._createProxiedId(I.tileID,A,h[I.tileID.key]&&h[I.tileID.key][t.id]);z?z.splice(z.length-1,0,R):this.proxyToSource[I.tileID.key][t.id]=[R],m.push(R),x=!0}}this._sourceTilesOverlap[t.id]=x}_setupProxiedCoordsForImageSource(t,s,h){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],_=this.proxyCoords,x=t.getSource(),w=new o.pointGeometry(x.tileID.x,x.tileID.y)._div(1<<x.tileID.z),A=x.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((z,R)=>(z.min.x=Math.min(z.min.x,R.x-w.x),z.min.y=Math.min(z.min.y,R.y-w.y),z.max.x=Math.max(z.max.x,R.x-w.x),z.max.y=Math.max(z.max.y,R.y-w.y),z),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(z,R)=>{const j=z.wrap+z.canonical.x/(1<<z.canonical.z),X=z.canonical.y/(1<<z.canonical.z),Z=o.EXTENT/(1<<z.canonical.z),U=R.wrap+R.canonical.x/(1<<R.canonical.z),ie=R.canonical.y/(1<<R.canonical.z);return j+Z<U+A.min.x||j>U+A.max.x||X+Z<ie+A.min.y||X>ie+A.max.y};for(let z=0;z<_.length;z++){const R=_[z];for(let j=0;j<s.length;j++){const X=t.getTile(s[j]);if(!X||!X.hasData()||I(R,X.tileID))continue;const Z=this._createProxiedId(R,X,h[R.key]&&h[R.key][t.id]),U=this.proxyToSource[R.key][t.id];U?U.push(Z):this.proxyToSource[R.key][t.id]=[Z],m.push(Z)}}}_createProxiedId(t,s,h){let m=this.orthoMatrix;if(h){const _=h.find(x=>x.key===s.tileID.key);if(_)return _}if(s.tileID.key!==t.key){const _=t.canonical.z-s.tileID.canonical.z;let x,w,A;m=o.create();const I=s.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(x=o.EXTENT>>_,w=x*((s.tileID.canonical.x<<_)-t.canonical.x+I),A=x*((s.tileID.canonical.y<<_)-t.canonical.y)):(x=o.EXTENT<<-_,w=o.EXTENT*(s.tileID.canonical.x-(t.canonical.x+I<<-_)),A=o.EXTENT*(s.tileID.canonical.y-(t.canonical.y<<-_))),o.ortho(m,0,x,0,x,0,1),o.translate(m,m,[w,A,0])}return new Tl(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let h=s.getTile(t);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[s.id],_=m[t.key];if(h=_?s.getTileByID(_):null,h&&h.hasData()||_===null)return h;let x=h?h.tileID:t,w=x.overscaledZ;const A=s.getSource().minzoom,I=[];if(!_){const R=s.getSource().maxzoom;if(t.canonical.z>=R){const j=t.canonical.z-R;s.getSource().reparseOverscaled?(w=Math.max(t.canonical.z+2,s.transform.tileZoom),x=new o.OverscaledTileID(w,t.wrap,R,t.canonical.x>>j,t.canonical.y>>j)):j!==0&&(w=R,x=new o.OverscaledTileID(w,t.wrap,R,t.canonical.x>>j,t.canonical.y>>j))}x.key!==t.key&&(I.push(x.key),h=s.getTile(x))}const z=R=>{I.forEach(j=>{m[j]=R}),I.length=0};for(w-=1;w>=A&&(!h||!h.hasData());w--){h&&z(h.tileID.key);const R=x.calculateScaledKey(w);if(h=s.getTileByID(R),h&&h.hasData())break;const j=m[R];if(j===null)break;j===void 0?I.push(R):h=s.getTileByID(j)}return z(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(s){let h=0;const m=new o.StructArrayLayout2ui4,_=131;for(let x=1;x<129;x++){for(let w=1;w<129;w++)h=x*_+w,m.emplaceBack(h,h+1),m.emplaceBack(h,h+_),m.emplaceBack(h+1,h+_),x===128&&m.emplaceBack(h+_,h+_+1);m.emplaceBack(h+1,h+1+_)}return m}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function ua(c){const t=[];for(let s=0;s<c.length;s++){if(c[s]===null)continue;const h=c[s].split(" ");t.push(h.pop())}return t}class hs{static cacheKey(t,s,h){let m=`${t}${h?h.cacheKey:""}`;for(const _ of s)m+=`/${_}`;return m}constructor(t,s,h,m,_,x){const w=t.gl;this.program=w.createProgram();const A=ua(h.staticAttributes),I=m?m.getBinderAttributes():[],z=A.concat(I),R=h.staticUniforms?ua(h.staticUniforms):[],j=m?m.getBinderUniforms():[],X=R.concat(j),Z=[];for(const Q of X)Z.indexOf(Q)<0&&Z.push(Q);let U=m?m.defines():[];U=U.concat(x.map(Q=>`#define ${Q}`));const ie=U.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,as,sa.fragmentSource,mr.fragmentSource,h.fragmentSource).join(`
`),H=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,as,sa.vertexSource,mr.vertexSource,Qr.vertexSource,h.vertexSource).join(`
`),ee=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(ee,ie),w.compileShader(ee),w.attachShader(this.program,ee);const te=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(te,H),w.compileShader(te),w.attachShader(this.program,te),this.attributes={};const re={};this.numAttributes=z.length;for(let Q=0;Q<this.numAttributes;Q++)z[Q]&&(w.bindAttribLocation(this.program,Q,z[Q]),this.attributes[z[Q]]=Q);w.linkProgram(this.program),w.deleteShader(te),w.deleteShader(ee);for(let Q=0;Q<Z.length;Q++){const se=Z[Q];if(se&&!re[se]){const me=w.getUniformLocation(this.program,se);me&&(re[se]=me)}}this.fixedUniforms=_(t,re),this.binderUniforms=m?m.getUniforms(t,re):[],x.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((Q,se)=>({u_dem:new o.Uniform1i(Q,se.u_dem),u_dem_prev:new o.Uniform1i(Q,se.u_dem_prev),u_dem_unpack:new o.Uniform4f(Q,se.u_dem_unpack),u_dem_tl:new o.Uniform2f(Q,se.u_dem_tl),u_dem_scale:new o.Uniform1f(Q,se.u_dem_scale),u_dem_tl_prev:new o.Uniform2f(Q,se.u_dem_tl_prev),u_dem_scale_prev:new o.Uniform1f(Q,se.u_dem_scale_prev),u_dem_size:new o.Uniform1f(Q,se.u_dem_size),u_dem_lerp:new o.Uniform1f(Q,se.u_dem_lerp),u_exaggeration:new o.Uniform1f(Q,se.u_exaggeration),u_depth:new o.Uniform1i(Q,se.u_depth),u_depth_size_inv:new o.Uniform2f(Q,se.u_depth_size_inv),u_meter_to_dem:new o.Uniform1f(Q,se.u_meter_to_dem),u_label_plane_matrix_inv:new o.UniformMatrix4f(Q,se.u_label_plane_matrix_inv),u_tile_tl_up:new o.Uniform3f(Q,se.u_tile_tl_up),u_tile_tr_up:new o.Uniform3f(Q,se.u_tile_tr_up),u_tile_br_up:new o.Uniform3f(Q,se.u_tile_br_up),u_tile_bl_up:new o.Uniform3f(Q,se.u_tile_bl_up),u_tile_up_scale:new o.Uniform1f(Q,se.u_tile_up_scale)}))(t,re)),x.indexOf("FOG")!==-1&&(this.fogUniforms=((Q,se)=>({u_fog_matrix:new o.UniformMatrix4f(Q,se.u_fog_matrix),u_fog_range:new o.Uniform2f(Q,se.u_fog_range),u_fog_color:new o.Uniform4f(Q,se.u_fog_color),u_fog_horizon_blend:new o.Uniform1f(Q,se.u_fog_horizon_blend),u_fog_temporal_offset:new o.Uniform1f(Q,se.u_fog_temporal_offset)}))(t,re))}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].location&&h[m].set(s[m])}}draw(t,s,h,m,_,x,w,A,I,z,R,j,X,Z,U,ie){const H=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(h),t.setStencilMode(m),t.setColorMode(_),t.setCullFace(x);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(w[te]);Z&&Z.setUniforms(t,this.binderUniforms,j,{zoom:X});const ee={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[s];for(const te of R.get()){const re=te.vaos||(te.vaos={});(re[A]||(re[A]=new aa)).bind(t,this,I,Z?Z.getPaintVertexBuffers():[],z,te.vertexOffset,U,ie),H.drawElements(s,te.primitiveLength*ee,H.UNSIGNED_SHORT,te.primitiveOffset*ee*2)}}}function ps(c,t,s){const h=1/Yt(s,1,t.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),_=s.tileSize*Math.pow(2,t.transform.tileZoom)/m,x=_*(s.tileID.canonical.x+s.tileID.wrap*m),w=_*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[h,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const El=o.create(),ha=(c,t,s,h,m,_,x,w,A)=>{const I=t.style.light,z=I.properties.get("position"),R=[z.x,z.y,z.z],j=o.create$1();I.properties.get("anchor")==="viewport"&&(o.fromRotation(j,-t.transform.angle),o.transformMat3(R,R,j));const X=I.properties.get("color"),Z=t.transform,U={u_matrix:c,u_lightpos:R,u_lightintensity:I.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:El,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return Z.projection.name==="globe"&&(U.u_tile_id=[m.canonical.x,m.canonical.y,1<<m.canonical.z],U.u_zoom_transition=x,U.u_inv_rot_matrix=A,U.u_merc_center=w,U.u_up_dir=Z.projection.upVector(new o.CanonicalTileID(0,0,0),w[0]*o.EXTENT,w[1]*o.EXTENT),U.u_height_lift=_),U},pa=(c,t,s,h,m,_,x,w,A,I,z)=>{const R=ha(c,t,s,h,m,w,A,I,z),j={u_height_factor:-Math.pow(2,m.overscaledZ)/x.tileSize/8};return o.extend(R,ps(_,t,x),j)},da=c=>({u_matrix:c}),fa=(c,t,s,h)=>o.extend(da(c),ps(s,t,h)),ma=(c,t)=>({u_matrix:c,u_world:t}),pu=(c,t,s,h,m)=>o.extend(fa(c,t,s,h),{u_world:m}),du=o.create(),Co=(c,t,s,h,m,_)=>{const x=c.transform,w=x.projection.name==="globe";let A;if(_.paint.get("circle-pitch-alignment")==="map")if(w){const z=o.globePixelsToTileUnits(x.zoom,t.canonical);A=Float32Array.from([z,0,0,z])}else A=x.calculatePixelsToTileUnitsMatrix(s);else A=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:x.cameraToCenterDistance,u_matrix:c.translatePosMatrix(t.projMatrix,s,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:du,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return w&&(I.u_inv_rot_matrix=h,I.u_merc_center=m,I.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],I.u_zoom_transition=o.globeToMercatorTransition(x.zoom),I.u_up_dir=x.projection.upVector(t.canonical,m[0],m[1])),I},Mp=c=>{const t=[];return c.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},Ip=(c,t,s)=>{const h=o.EXTENT/s.tileSize;return{u_matrix:c,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/h,t.pixelsToGLUnits[1]/h]}},fu=(c,t,s=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:s}),Cp=o.create(),zp=(c,t,s,h,m,_,x)=>{const w=c.transform,A=w.projection.name==="globe",I=A?o.globePixelsToTileUnits(w.zoom,t.canonical):Yt(s,1,_),z={u_matrix:t.projMatrix,u_extrude_scale:I,u_intensity:x,u_inv_rot_matrix:Cp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return A&&(z.u_inv_rot_matrix=h,z.u_merc_center=m,z.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],z.u_zoom_transition=o.globeToMercatorTransition(w.zoom),z.u_up_dir=w.projection.upVector(t.canonical,m[0],m[1])),z},kp=(c,t,s,h,m,_,x)=>{const w=c.transform,A=w.calculatePixelsToTileUnitsMatrix(t),I={u_matrix:eo(c,t,s,m),u_pixels_to_tile_units:A,u_device_pixel_ratio:x,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Al(s)){const z=_a(t,c.transform);I.u_texsize=t.lineAtlasTexture.size,I.u_scale=[z,h.fromScale,h.toScale],I.u_mix=h.t}return I},Sl=(c,t,s,h,m,_)=>{const x=c.transform,w=_a(t,x);return{u_matrix:eo(c,t,s,m),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:_,u_image:0,u_scale:[w,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function _a(c,t){return 1/Yt(c,1,t.tileZoom)}function eo(c,t,s,h){return c.translatePosMatrix(h||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}function Al(c){const t=c.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const mu=(c,t,s,h,m,_)=>{return{u_matrix:c,u_tl_parent:t,u_scale_parent:s,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(w=m.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(x=m.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Ml(m.paint.get("raster-hue-rotate")),u_perspective_transform:_};var x,w};function Ml(c){c*=Math.PI/180;const t=Math.sin(c),s=Math.cos(c);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const gr=o.create(),Il=(c,t,s,h,m,_,x,w,A,I,z,R,j,X)=>{const Z=m.transform,U={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_rotate_symbol:+s,u_aspect_ratio:Z.width/Z.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+A,u_pitch_with_map:+h,u_texsize:I,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:gr};return Z.projection.name==="globe"&&(U.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],U.u_zoom_transition=R,U.u_inv_rot_matrix=X,U.u_merc_center=j,U.u_camera_forward=Z._camera.forward(),U.u_ecef_origin=o.globeECEFOrigin(Z.globeMatrix,z.toUnwrapped()),U.u_tile_matrix=Float32Array.from(Z.globeMatrix)),U},to=(c,t,s,h,m,_,x,w,A,I,z,R,j,X,Z)=>{const{cameraToCenterDistance:U,_pitch:ie}=m.transform;return o.extend(Il(c,t,s,h,m,_,x,w,A,I,R,j,X,Z),{u_gamma_scale:h?U*Math.cos(m.terrain?0:ie):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+z})},zo=(c,t,s,h,m,_,x,w,A,I,z,R,j,X)=>o.extend(to(c,t,s,h,m,_,x,w,!0,A,!0,z,R,j,X),{u_texsize_icon:I,u_texture_icon:1}),_u=(c,t,s)=>({u_matrix:c,u_opacity:t,u_color:s}),Cl=(c,t,s,h,m,_)=>o.extend(function(x,w,A,I){const z=A.imageManager.getPattern(x.from.toString()),R=A.imageManager.getPattern(x.to.toString()),{width:j,height:X}=A.imageManager.getPixelSize(),Z=Math.pow(2,I.tileID.overscaledZ),U=I.tileSize*Math.pow(2,A.transform.tileZoom)/Z,ie=U*(I.tileID.canonical.x+I.tileID.wrap*Z),H=U*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[j,X],u_mix:w.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/Yt(I,1,A.transform.tileZoom),u_pixel_coord_upper:[ie>>16,H>>16],u_pixel_coord_lower:[65535&ie,65535&H]}}(h,_,s,m),{u_matrix:c,u_opacity:t}),Wt={fillExtrusion:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_lightpos:new o.Uniform3f(c,t.u_lightpos),u_lightintensity:new o.Uniform1f(c,t.u_lightintensity),u_lightcolor:new o.Uniform3f(c,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(c,t.u_vertical_gradient),u_opacity:new o.Uniform1f(c,t.u_opacity),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_up_dir:new o.Uniform3f(c,t.u_up_dir),u_height_lift:new o.Uniform1f(c,t.u_height_lift)}),fillExtrusionPattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_lightpos:new o.Uniform3f(c,t.u_lightpos),u_lightintensity:new o.Uniform1f(c,t.u_lightintensity),u_lightcolor:new o.Uniform3f(c,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(c,t.u_vertical_gradient),u_height_factor:new o.Uniform1f(c,t.u_height_factor),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_up_dir:new o.Uniform3f(c,t.u_up_dir),u_height_lift:new o.Uniform1f(c,t.u_height_lift),u_image:new o.Uniform1i(c,t.u_image),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade),u_opacity:new o.Uniform1f(c,t.u_opacity)}),fill:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix)}),fillPattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image:new o.Uniform1i(c,t.u_image),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade)}),fillOutline:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_world:new o.Uniform2f(c,t.u_world)}),fillOutlinePattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_world:new o.Uniform2f(c,t.u_world),u_image:new o.Uniform1i(c,t.u_image),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade)}),circle:(c,t)=>({u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_extrude_scale:new o.UniformMatrix2f(c,t.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_up_dir:new o.Uniform3f(c,t.u_up_dir)}),collisionBox:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_extrude_scale:new o.Uniform2f(c,t.u_extrude_scale)}),collisionCircle:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_inv_matrix:new o.UniformMatrix4f(c,t.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(c,t.u_viewport_size)}),debug:(c,t)=>({u_color:new o.UniformColor(c,t.u_color),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_overlay:new o.Uniform1i(c,t.u_overlay),u_overlay_scale:new o.Uniform1f(c,t.u_overlay_scale)}),clippingMask:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix)}),heatmap:(c,t)=>({u_extrude_scale:new o.Uniform1f(c,t.u_extrude_scale),u_intensity:new o.Uniform1f(c,t.u_intensity),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_up_dir:new o.Uniform3f(c,t.u_up_dir)}),heatmapTexture:(c,t)=>({u_image:new o.Uniform1i(c,t.u_image),u_color_ramp:new o.Uniform1i(c,t.u_color_ramp),u_opacity:new o.Uniform1f(c,t.u_opacity)}),hillshade:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image:new o.Uniform1i(c,t.u_image),u_latrange:new o.Uniform2f(c,t.u_latrange),u_light:new o.Uniform2f(c,t.u_light),u_shadow:new o.UniformColor(c,t.u_shadow),u_highlight:new o.UniformColor(c,t.u_highlight),u_accent:new o.UniformColor(c,t.u_accent)}),hillshadePrepare:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image:new o.Uniform1i(c,t.u_image),u_dimension:new o.Uniform2f(c,t.u_dimension),u_zoom:new o.Uniform1f(c,t.u_zoom),u_unpack:new o.Uniform4f(c,t.u_unpack)}),line:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_pixels_to_tile_units:new o.UniformMatrix2f(c,t.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(c,t.u_units_to_pixels),u_dash_image:new o.Uniform1i(c,t.u_dash_image),u_gradient_image:new o.Uniform1i(c,t.u_gradient_image),u_image_height:new o.Uniform1f(c,t.u_image_height),u_texsize:new o.Uniform2f(c,t.u_texsize),u_scale:new o.Uniform3f(c,t.u_scale),u_mix:new o.Uniform1f(c,t.u_mix),u_alpha_discard_threshold:new o.Uniform1f(c,t.u_alpha_discard_threshold)}),linePattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixels_to_tile_units:new o.UniformMatrix2f(c,t.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_image:new o.Uniform1i(c,t.u_image),u_units_to_pixels:new o.Uniform2f(c,t.u_units_to_pixels),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade),u_alpha_discard_threshold:new o.Uniform1f(c,t.u_alpha_discard_threshold)}),raster:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_tl_parent:new o.Uniform2f(c,t.u_tl_parent),u_scale_parent:new o.Uniform1f(c,t.u_scale_parent),u_fade_t:new o.Uniform1f(c,t.u_fade_t),u_opacity:new o.Uniform1f(c,t.u_opacity),u_image0:new o.Uniform1i(c,t.u_image0),u_image1:new o.Uniform1i(c,t.u_image1),u_brightness_low:new o.Uniform1f(c,t.u_brightness_low),u_brightness_high:new o.Uniform1f(c,t.u_brightness_high),u_saturation_factor:new o.Uniform1f(c,t.u_saturation_factor),u_contrast_factor:new o.Uniform1f(c,t.u_contrast_factor),u_spin_weights:new o.Uniform3f(c,t.u_spin_weights),u_perspective_transform:new o.Uniform2f(c,t.u_perspective_transform)}),symbolIcon:(c,t)=>({u_is_size_zoom_constant:new o.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,t.u_size_t),u_size:new o.Uniform1f(c,t.u_size),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,t.u_fade_change),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new o.Uniform1i(c,t.u_is_text),u_pitch_with_map:new o.Uniform1i(c,t.u_pitch_with_map),u_texsize:new o.Uniform2f(c,t.u_texsize),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_camera_forward:new o.Uniform3f(c,t.u_camera_forward),u_tile_matrix:new o.UniformMatrix4f(c,t.u_tile_matrix),u_ecef_origin:new o.Uniform3f(c,t.u_ecef_origin),u_texture:new o.Uniform1i(c,t.u_texture)}),symbolSDF:(c,t)=>({u_is_size_zoom_constant:new o.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,t.u_size_t),u_size:new o.Uniform1f(c,t.u_size),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,t.u_fade_change),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new o.Uniform1i(c,t.u_is_text),u_pitch_with_map:new o.Uniform1i(c,t.u_pitch_with_map),u_texsize:new o.Uniform2f(c,t.u_texsize),u_texture:new o.Uniform1i(c,t.u_texture),u_gamma_scale:new o.Uniform1f(c,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_camera_forward:new o.Uniform3f(c,t.u_camera_forward),u_tile_matrix:new o.UniformMatrix4f(c,t.u_tile_matrix),u_ecef_origin:new o.Uniform3f(c,t.u_ecef_origin),u_is_halo:new o.Uniform1i(c,t.u_is_halo)}),symbolTextAndIcon:(c,t)=>({u_is_size_zoom_constant:new o.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,t.u_size_t),u_size:new o.Uniform1f(c,t.u_size),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,t.u_fade_change),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new o.Uniform1i(c,t.u_is_text),u_pitch_with_map:new o.Uniform1i(c,t.u_pitch_with_map),u_texsize:new o.Uniform2f(c,t.u_texsize),u_texsize_icon:new o.Uniform2f(c,t.u_texsize_icon),u_texture:new o.Uniform1i(c,t.u_texture),u_texture_icon:new o.Uniform1i(c,t.u_texture_icon),u_gamma_scale:new o.Uniform1f(c,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(c,t.u_is_halo)}),background:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_opacity:new o.Uniform1f(c,t.u_opacity),u_color:new o.UniformColor(c,t.u_color)}),backgroundPattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_opacity:new o.Uniform1f(c,t.u_opacity),u_image:new o.Uniform1i(c,t.u_image),u_pattern_tl_a:new o.Uniform2f(c,t.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(c,t.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(c,t.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(c,t.u_pattern_br_b),u_texsize:new o.Uniform2f(c,t.u_texsize),u_mix:new o.Uniform1f(c,t.u_mix),u_pattern_size_a:new o.Uniform2f(c,t.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(c,t.u_pattern_size_b),u_scale_a:new o.Uniform1f(c,t.u_scale_a),u_scale_b:new o.Uniform1f(c,t.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(c,t.u_tile_units_to_pixels)}),terrainRaster:vl,terrainDepth:vl,skybox:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_sun_direction:new o.Uniform3f(c,t.u_sun_direction),u_cubemap:new o.Uniform1i(c,t.u_cubemap),u_opacity:new o.Uniform1f(c,t.u_opacity),u_temporal_offset:new o.Uniform1f(c,t.u_temporal_offset)}),skyboxGradient:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_color_ramp:new o.Uniform1i(c,t.u_color_ramp),u_center_direction:new o.Uniform3f(c,t.u_center_direction),u_radius:new o.Uniform1f(c,t.u_radius),u_opacity:new o.Uniform1f(c,t.u_opacity),u_temporal_offset:new o.Uniform1f(c,t.u_temporal_offset)}),skyboxCapture:(c,t)=>({u_matrix_3f:new o.UniformMatrix3f(c,t.u_matrix_3f),u_sun_direction:new o.Uniform3f(c,t.u_sun_direction),u_sun_intensity:new o.Uniform1f(c,t.u_sun_intensity),u_color_tint_r:new o.Uniform4f(c,t.u_color_tint_r),u_color_tint_m:new o.Uniform4f(c,t.u_color_tint_m),u_luminance:new o.Uniform1f(c,t.u_luminance)}),globeRaster:(c,t)=>({u_proj_matrix:new o.UniformMatrix4f(c,t.u_proj_matrix),u_globe_matrix:new o.UniformMatrix4f(c,t.u_globe_matrix),u_merc_matrix:new o.UniformMatrix4f(c,t.u_merc_matrix),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_image0:new o.Uniform1i(c,t.u_image0),u_grid_matrix:new o.UniformMatrix3f(c,t.u_grid_matrix)}),globeAtmosphere:(c,t)=>({u_frustum_tl:new o.Uniform3f(c,t.u_frustum_tl),u_frustum_tr:new o.Uniform3f(c,t.u_frustum_tr),u_frustum_br:new o.Uniform3f(c,t.u_frustum_br),u_frustum_bl:new o.Uniform3f(c,t.u_frustum_bl),u_globe_pos:new o.Uniform3f(c,t.u_globe_pos),u_globe_radius:new o.Uniform1f(c,t.u_globe_radius),u_opacity:new o.Uniform1f(c,t.u_opacity),u_fadeout_range:new o.Uniform1f(c,t.u_fadeout_range),u_start_color:new o.Uniform3f(c,t.u_start_color),u_end_color:new o.Uniform3f(c,t.u_end_color)})};let io;function gu(c,t,s,h,m,_,x){const w=c.context,A=w.gl,I=c.useProgram("collisionBox"),z=[];let R=0,j=0;for(let te=0;te<h.length;te++){const re=h[te],Q=t.getTile(re),se=Q.getBucket(s);if(!se)continue;let me=re.projMatrix;m[0]===0&&m[1]===0||(me=c.translatePosMatrix(re.projMatrix,Q,m,_));const we=x?se.textCollisionBox:se.iconCollisionBox,Ae=se.collisionCircleArray;if(Ae.length>0){const Ee=o.create(),Ne=me;o.mul(Ee,se.placementInvProjMatrix,c.transform.glCoordMatrix),o.mul(Ee,Ee,se.placementViewportMatrix),z.push({circleArray:Ae,circleOffset:j,transform:Ne,invTransform:Ee}),R+=Ae.length/4,j=R}we&&(c.terrain&&c.terrain.setupElevationDraw(Q,I),I.draw(w,A.LINES,o.DepthMode.disabled,o.StencilMode.disabled,c.colorModeForRenderPass(),o.CullFaceMode.disabled,Ip(me,c.transform,Q),s.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,c.transform.zoom,null,we.collisionVertexBuffer,we.collisionVertexBufferExt))}if(!x||!z.length)return;const X=c.useProgram("collisionCircle"),Z=new o.StructArrayLayout2f1f2i16;Z.resize(4*R),Z._trim();let U=0;for(const te of z)for(let re=0;re<te.circleArray.length/4;re++){const Q=4*re,se=te.circleArray[Q+0],me=te.circleArray[Q+1],we=te.circleArray[Q+2],Ae=te.circleArray[Q+3];Z.emplace(U++,se,me,we,Ae,0),Z.emplace(U++,se,me,we,Ae,1),Z.emplace(U++,se,me,we,Ae,2),Z.emplace(U++,se,me,we,Ae,3)}(!io||io.length<2*R)&&(io=function(te){const re=2*te,Q=new o.StructArrayLayout3ui6;Q.resize(re),Q._trim();for(let se=0;se<re;se++){const me=6*se;Q.uint16[me+0]=4*se+0,Q.uint16[me+1]=4*se+1,Q.uint16[me+2]=4*se+2,Q.uint16[me+3]=4*se+2,Q.uint16[me+4]=4*se+3,Q.uint16[me+5]=4*se+0}return Q}(R));const ie=w.createIndexBuffer(io,!0),H=w.createVertexBuffer(Z,o.collisionCircleLayout.members,!0);for(const te of z){const re={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(ee=c.transform).cameraToCenterDistance,u_viewport_size:[ee.width,ee.height]};X.draw(w,A.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,c.colorModeForRenderPass(),o.CullFaceMode.disabled,re,s.id,H,ie,o.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,c.transform.zoom,null,null,null)}var ee;H.destroy(),ie.destroy()}const zl=o.create();function ds(c,t,s,h,m,_){const{horizontalAlign:x,verticalAlign:w}=o.getAnchorAlignment(c),A=-(x-.5)*t,I=-(w-.5)*s,z=o.evaluateVariableOffset(c,h);return new o.pointGeometry((A/m+z[0])*_,(I/m+z[1])*_)}function Pp(c,t,s,h,m,_,x,w,A,I,z,R){const j=c.text.placedSymbolArray,X=c.text.dynamicLayoutVertexArray,Z=c.icon.dynamicLayoutVertexArray,U={},ie=w.projMatrix,H=_.elevation,ee=R.upVectorScale(w.canonical,_.center.lat,_.worldSize);X.clear();for(let te=0;te<j.length;te++){const re=j.get(te),Q=c.allowVerticalPlacement&&!re.placedOrientation,se=re.hidden||!re.crossTileID||Q?null:h[re.crossTileID];if(se){const me=new o.pointGeometry(re.tileAnchorX,re.tileAnchorY),we=R.upVector(w.canonical,me.x,me.y),Ae=H?H.getAtTileOffset(w,me.x,me.y):0,Ee=un([re.projectedAnchorX+Ae*we[0]*ee.metersToTile,re.projectedAnchorY+Ae*we[1]*ee.metersToTile,re.projectedAnchorZ+Ae*we[2]*ee.metersToTile],s?ie:x),Ne=si(_.cameraToCenterDistance,Ee.signedDistanceFromCamera);let _e=m.evaluateSizeForFeature(c.textSizeData,I,re)*Ne/o.ONE_EM;s&&(_e*=c.tilePixelRatio/A);const{width:Ue,height:Fe,anchor:ot,textOffset:Me,textScale:tt}=se,ht=ds(ot,Ue,Fe,Me,tt,_e),it=s?Ui(me.add(ht),x,Ae*ee.metersToLabelSpace).point:Ee.point.add(t?ht.rotate(-_.angle):ht),nt=c.allowVerticalPlacement&&re.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let ft=0;ft<re.numGlyphs;ft++)o.addDynamicAttributes(X,it,nt);z&&re.associatedIconIndex>=0&&(U[re.associatedIconIndex]={shiftedAnchor:it,angle:nt})}else wi(re.numGlyphs,X)}if(z){Z.clear();const te=c.icon.placedSymbolArray;for(let re=0;re<te.length;re++){const Q=te.get(re);if(Q.hidden)wi(Q.numGlyphs,Z);else{const se=U[re];if(se)for(let me=0;me<Q.numGlyphs;me++)o.addDynamicAttributes(Z,se.shiftedAnchor,se.angle);else wi(Q.numGlyphs,Z)}}c.icon.dynamicLayoutVertexBuffer.updateData(Z)}c.text.dynamicLayoutVertexBuffer.updateData(X)}function Dp(c,t,s){return s.iconsInText&&t?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function kl(c,t,s,h,m,_,x,w,A,I,z,R){const j=c.context,X=j.gl,Z=c.transform,U=w==="map",ie=A==="map",H=U&&s.layout.get("symbol-placement")!=="point",ee=U&&!ie&&!H,te=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let re=!1;const Q=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),se=[o.mercatorXfromLng(Z.center.lng),o.mercatorYfromLat(Z.center.lat)],me=s.layout.get("text-variable-anchor"),we=Z.projection.name==="globe",Ae=we?o.globeToMercatorTransition(Z.zoom):0,Ee=[],Ne=[];c.terrain&&ie&&Ne.push("PITCH_WITH_MAP_TERRAIN"),we&&Ne.push("PROJECTION_GLOBE_VIEW");for(const _e of h){const Ue=t.getTile(_e),Fe=Ue.getBucket(s);if(!Fe||Fe.projection!==Z.projection.name)continue;const ot=m?Fe.text:Fe.icon;if(!ot||Fe.fullyClipped||!ot.segments.get().length)continue;const Me=ot.programConfigurations.get(s.id),tt=m||Fe.sdfIcons,ht=m?Fe.textSizeData:Fe.iconSizeData,it=ie||Z.pitch!==0,nt=o.evaluateSizeForZoom(ht,Z.zoom);let ft,At,lt,gt,Nt=[0,0],ai=null;if(m){if(At=Ue.glyphAtlasTexture,lt=X.LINEAR,ft=Ue.glyphAtlasTexture.size,Fe.iconsInText){Nt=Ue.imageAtlasTexture.size,ai=Ue.imageAtlasTexture;const rn=ht.kind==="composite"||ht.kind==="camera";gt=it||c.options.rotating||c.options.zooming||rn?X.LINEAR:X.NEAREST}}else{const rn=s.layout.get("icon-size").constantOr(0)!==1||Fe.iconsNeedLinear;At=Ue.imageAtlasTexture,lt=tt||c.options.rotating||c.options.zooming||rn||it?X.LINEAR:X.NEAREST,ft=Ue.imageAtlasTexture.size}const Ri=c.transform.calculatePixelsToTileUnitsMatrix(Ue),Bi=Kr(_e.projMatrix,Ue.tileID.canonical,ie,U,c.transform,Ri),tn=c.terrain&&ie&&H?o.invert(o.create(),Bi):zl,kn=To(_e.projMatrix,Ue.tileID.canonical,ie,U,c.transform,Ri),Qn=me&&Fe.hasTextData(),Tr=s.layout.get("icon-text-fit")!=="none"&&Qn&&Fe.hasIconData();if(H){const rn=Z.elevation,ro=rn?rn.getAtTileOffsetFunc(_e,Z.center.lat,Z.worldSize,Z.projection):Xu=>[0,0,0];ns(Fe,_e.projMatrix,c,m,Bi,kn,ie,I,ro,_e)}const er=H||m&&me||Tr,ui=c.translatePosMatrix(_e.projMatrix,Ue,_,x),di=er?zl:Bi,Zt=c.translatePosMatrix(kn,Ue,_,x,!0),yi=Z.projection.createInversionMatrix(Z,_e.canonical),nn=er?Ne.concat(["PROJECTED_POS_ON_VIEWPORT"]):Ne,li=tt&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let dn;dn=tt?Fe.iconsInText?zo(ht.kind,nt,ee,ie,c,ui,di,Zt,ft,Nt,_e,Ae,se,yi):to(ht.kind,nt,ee,ie,c,ui,di,Zt,m,ft,!0,_e,Ae,se,yi):Il(ht.kind,nt,ee,ie,c,ui,di,Zt,m,ft,_e,Ae,se,yi);const Cs={program:c.useProgram(Dp(tt,m,Fe),Me,nn),buffers:ot,uniformValues:dn,atlasTexture:At,atlasTextureIcon:ai,atlasInterpolation:lt,atlasInterpolationIcon:gt,isSDF:tt,hasHalo:li,tile:Ue,labelPlaneMatrixInv:tn};if(te&&Fe.canOverlap){re=!0;const rn=ot.segments.get();for(const ro of rn)Ee.push({segments:new o.SegmentVector([ro]),sortKey:ro.sortKey,state:Cs})}else Ee.push({segments:ot.segments,sortKey:0,state:Cs})}re&&Ee.sort((_e,Ue)=>_e.sortKey-Ue.sortKey);for(const _e of Ee){const Ue=_e.state;if(c.terrain&&c.terrain.setupElevationDraw(Ue.tile,Ue.program,{useDepthForOcclusion:!we,labelPlaneMatrixInv:Ue.labelPlaneMatrixInv}),j.activeTexture.set(X.TEXTURE0),Ue.atlasTexture.bind(Ue.atlasInterpolation,X.CLAMP_TO_EDGE),Ue.atlasTextureIcon&&(j.activeTexture.set(X.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Ue.isSDF){const Fe=Ue.uniformValues;Ue.hasHalo&&(Fe.u_is_halo=1,yu(Ue.buffers,_e.segments,s,c,Ue.program,Q,z,R,Fe)),Fe.u_is_halo=0}yu(Ue.buffers,_e.segments,s,c,Ue.program,Q,z,R,Ue.uniformValues)}}function yu(c,t,s,h,m,_,x,w,A){const I=h.context;m.draw(I,I.gl.TRIANGLES,_,x,w,o.CullFaceMode.disabled,A,s.id,c.layoutVertexBuffer,c.indexBuffer,t,s.paint,h.transform.zoom,c.programConfigurations.get(s.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function ga(c,t,s,h,m,_,x){const w=c.context.gl,A=s.paint.get("fill-pattern"),I=A&&A.constantOr(1),z=s.getCrossfadeParameters();let R,j,X,Z,U;x?(j=I&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=w.LINES):(j=I?"fillPattern":"fill",R=w.TRIANGLES);for(const ie of h){const H=t.getTile(ie);if(I&&!H.patternsLoaded())continue;const ee=H.getBucket(s);if(!ee)continue;c.prepareDrawTile();const te=ee.programConfigurations.get(s.id),re=c.useProgram(j,te);I&&(c.context.activeTexture.set(w.TEXTURE0),H.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),te.updatePaintBuffers(z));const Q=A.constantOr(null);if(Q&&H.imageAtlas){const me=H.imageAtlas,we=me.patternPositions[Q.to.toString()],Ae=me.patternPositions[Q.from.toString()];we&&Ae&&te.setConstantPatternPositions(we,Ae)}const se=c.translatePosMatrix(ie.projMatrix,H,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(x){Z=ee.indexBuffer2,U=ee.segments2;const me=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[w.drawingBufferWidth,w.drawingBufferHeight];X=j==="fillOutlinePattern"&&I?pu(se,c,z,H,me):ma(se,me)}else Z=ee.indexBuffer,U=ee.segments,X=I?fa(se,c,z,H):da(se);c.prepareDrawProgram(c.context,re,ie.toUnwrapped()),re.draw(c.context,R,m,c.stencilModeForClipping(ie),_,o.CullFaceMode.disabled,X,s.id,ee.layoutVertexBuffer,Z,U,s.paint,c.transform.zoom,te)}}function ko(c,t,s,h,m,_,x){const w=c.context,A=w.gl,I=c.transform,z=s.paint.get("fill-extrusion-pattern"),R=z.constantOr(1),j=s.getCrossfadeParameters(),X=s.paint.get("fill-extrusion-opacity"),Z=function(te){if(te.projection.name!=="globe")return 0;const re=Math.PI/32,Q=Math.tan(re),se=o.earthRadius;return se*Math.sqrt(1+2*Q*Q)-se}(I),U=I.projection.name==="globe",ie=U?o.globeToMercatorTransition(I.zoom):0,H=[o.mercatorXfromLng(I.center.lng),o.mercatorYfromLat(I.center.lat)],ee=[];U&&ee.push("PROJECTION_GLOBE_VIEW");for(const te of h){const re=t.getTile(te),Q=re.getBucket(s);if(!Q||Q.projection!==I.projection.name)continue;const se=Q.programConfigurations.get(s.id),me=c.useProgram(R?"fillExtrusionPattern":"fillExtrusion",se,ee);if(c.terrain){const Ue=c.terrain;if(c.style.terrainSetForDrapingOnly())Ue.setupElevationDraw(re,me,{useMeterToDem:!0});else{if(!Q.enableTerrain)continue;if(Ue.setupElevationDraw(re,me,{useMeterToDem:!0}),fs(w,t,te,Q,s,Ue),!Q.centroidVertexBuffer){const Fe=me.attributes.a_centroid_pos;Fe!==void 0&&A.vertexAttrib2f(Fe,0,0)}}}R&&(c.context.activeTexture.set(A.TEXTURE0),re.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),se.updatePaintBuffers(j));const we=z.constantOr(null);if(we&&re.imageAtlas){const Ue=re.imageAtlas,Fe=Ue.patternPositions[we.to.toString()],ot=Ue.patternPositions[we.from.toString()];Fe&&ot&&se.setConstantPatternPositions(Fe,ot)}const Ae=c.translatePosMatrix(te.projMatrix,re,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ee=I.projection.createInversionMatrix(I,te.canonical),Ne=s.paint.get("fill-extrusion-vertical-gradient"),_e=R?pa(Ae,c,Ne,X,te,j,re,Z,ie,H,Ee):ha(Ae,c,Ne,X,te,Z,ie,H,Ee);c.prepareDrawProgram(w,me,te.toUnwrapped()),me.draw(w,w.gl.TRIANGLES,m,_,x,o.CullFaceMode.backCCW,_e,s.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,s.paint,c.transform.zoom,se,c.terrain?Q.centroidVertexBuffer:null,U?Q.layoutVertexExtBuffer:null)}}function fs(c,t,s,h,m,_){const x=[H=>{let ee=H.canonical.x-1,te=H.wrap;return ee<0&&(ee=(1<<H.canonical.z)-1,te--),new o.OverscaledTileID(H.overscaledZ,te,H.canonical.z,ee,H.canonical.y)},H=>{let ee=H.canonical.x+1,te=H.wrap;return ee===1<<H.canonical.z&&(ee=0,te++),new o.OverscaledTileID(H.overscaledZ,te,H.canonical.z,ee,H.canonical.y)},H=>new o.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,(H.canonical.y===0?1<<H.canonical.z:H.canonical.y)-1),H=>new o.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y===(1<<H.canonical.z)-1?0:H.canonical.y+1)],w=H=>{const ee=t.getSource().minzoom,te=Q=>{const se=t.getTileByID(Q);if(se&&se.hasData())return se.getBucket(m)},re=[0,-1,1];for(const Q of re){if(H.overscaledZ+Q<ee)continue;const se=te(H.calculateScaledKey(H.overscaledZ+Q));if(se)return se}},A=[0,0,0],I=(H,ee)=>(A[0]=Math.min(H.min.y,ee.min.y),A[1]=Math.max(H.max.y,ee.max.y),A[2]=o.EXTENT-ee.min.x>H.max.x?ee.min.x-o.EXTENT:H.max.x,A),z=(H,ee)=>(A[0]=Math.min(H.min.x,ee.min.x),A[1]=Math.max(H.max.x,ee.max.x),A[2]=o.EXTENT-ee.min.y>H.max.y?ee.min.y-o.EXTENT:H.max.y,A),R=[(H,ee)=>I(H,ee),(H,ee)=>I(ee,H),(H,ee)=>z(H,ee),(H,ee)=>z(ee,H)],j=new o.pointGeometry(0,0);let X,Z,U;const ie=(H,ee,te,re,Q)=>{const se=[[re?te:H,re?H:te,0],[re?te:ee,re?ee:te,0]],me=Q<0?o.EXTENT+Q:Q,we=[re?me:(H+ee)/2,re?(H+ee)/2:me,0];return te===0&&Q<0||te!==0&&Q>0?_.getForTilePoints(U,[we],!0,Z):se.push(we),_.getForTilePoints(s,se,!0,X),Math.max(se[0][2],se[1][2],we[2])/_.exaggeration()};for(let H=0;H<4;H++){const ee=(H<2?1:5)-H,te=h.borders[H];if(te.length===0)continue;const re=U=x[H](s),Q=w(re);if(!(Q&&Q instanceof o.FillExtrusionBucket&&Q.enableTerrain)||h.borderDoneWithNeighborZ[H]===Q.canonical.z&&Q.borderDoneWithNeighborZ[ee]===h.canonical.z||(Z=_.findDEMTileFor(re),!Z||!Z.dem))continue;if(!X){const Ae=_.findDEMTileFor(s);if(!Ae||!Ae.dem)return;X=Ae}const se=Q.borders[ee];let me=0;const we=Q.borderDoneWithNeighborZ[ee]!==h.canonical.z;if(h.canonical.z===Q.canonical.z){for(let Ae=0;Ae<te.length;Ae++){const Ee=h.featuresOnBorder[te[Ae]],Ne=Ee.borders[H];let _e;for(;me<se.length&&(_e=Q.featuresOnBorder[se[me]],!(_e.borders[ee][1]>Ne[0]+3));)we&&Q.encodeCentroid(void 0,_e,!1),me++;if(_e&&me<se.length){const Ue=me;let Fe=0;for(;!(_e.borders[ee][0]>Ne[1]-3)&&(Fe++,++me!==se.length);)_e=Q.featuresOnBorder[se[me]];if(_e=Q.featuresOnBorder[se[Ue]],Ee.intersectsCount()>1||_e.intersectsCount()>1||Fe!==1){Fe!==1&&(me=Ue),h.encodeCentroid(void 0,Ee,!1),we&&Q.encodeCentroid(void 0,_e,!1);continue}const ot=R[H](Ee,_e),Me=H%2?o.EXTENT-1:0;j.x=ie(ot[0],Math.min(o.EXTENT-1,ot[1]),Me,H<2,ot[2]),j.y=0,h.encodeCentroid(j,Ee,!1),we&&Q.encodeCentroid(j,_e,!1)}else h.encodeCentroid(void 0,Ee,!1)}h.borderDoneWithNeighborZ[H]=Q.canonical.z,h.needsCentroidUpdate=!0,we&&(Q.borderDoneWithNeighborZ[ee]=h.canonical.z,Q.needsCentroidUpdate=!0)}else{for(const Ae of te)h.encodeCentroid(void 0,h.featuresOnBorder[Ae],!1);if(we){for(const Ae of se)Q.encodeCentroid(void 0,Q.featuresOnBorder[Ae],!1);Q.borderDoneWithNeighborZ[ee]=h.canonical.z,Q.needsCentroidUpdate=!0}h.borderDoneWithNeighborZ[H]=Q.canonical.z,h.needsCentroidUpdate=!0}}(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(c)}const Pl=new o.Color(1,0,0,1),Dl=new o.Color(0,1,0,1),xu=new o.Color(0,0,1,1),ya=new o.Color(1,0,1,1),xa=new o.Color(0,1,1,1);function Ke(c,t,s,h){ms(c,0,t+s/2,c.transform.width,s,h)}function hn(c,t,s,h){ms(c,t-s/2,0,s,c.transform.height,h)}function ms(c,t,s,h,m,_){const x=c.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*o.exported.devicePixelRatio,s*o.exported.devicePixelRatio,h*o.exported.devicePixelRatio,m*o.exported.devicePixelRatio),x.clear({color:_}),w.disable(w.SCISSOR_TEST)}function vu(c,t,s){const h=c.context,m=h.gl,_=c.transform.projection.name==="globe",x=s.projMatrix,w=c.useProgram("debug",null,_?["PROJECTION_GLOBE_VIEW"]:null),A=t.getTileByID(s.key);c.terrain&&c.terrain.setupElevationDraw(A,w);const I=o.DepthMode.disabled,z=o.StencilMode.disabled,R=c.colorModeForRenderPass(),j="$debug";h.activeTexture.set(m.TEXTURE0),c.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),_?A._makeGlobeTileDebugBuffers(c.context,c.transform.projection):A._makeDebugTileBoundsBuffers(c.context,c.transform.projection);const X=A._tileDebugBuffer||c.debugBuffer,Z=A._tileDebugIndexBuffer||c.debugIndexBuffer,U=A._tileDebugSegments||c.debugSegments;w.draw(h,m.LINE_STRIP,I,z,R,o.CullFaceMode.disabled,fu(x,o.Color.red),j,X,Z,U,null,null,null,A._globeTileDebugBorderBuffer);const ie=A.latestRawTileData,H=Math.floor((ie&&ie.byteLength||0)/1024),ee=t.getTile(s).tileSize,te=512/Math.min(ee,512)*(s.overscaledZ/c.transform.zoom)*.5;let re=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(re+=` => ${s.overscaledZ}`),function(we,Ae){we.initDebugOverlayCanvas();const Ee=we.debugOverlayCanvas,Ne=we.context.gl,_e=we.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,Ee.width,Ee.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(Ae,5,5),_e.strokeText(Ae,5,5),we.debugOverlayTexture.update(Ee),we.debugOverlayTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)}(c,`${re} ${H}kb`);const Q=A._tileDebugTextBuffer||c.debugBuffer,se=A._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,me=A._tileDebugTextSegments||c.debugSegments;w.draw(h,m.TRIANGLES,I,z,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,fu(x,o.Color.transparent,te),j,Q,se,me,null,null,null,A._globeTileDebugTextBuffer)}const bu=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Po}=bu;function Yn(c,t,s,h){c.emplaceBack(t,s,h)}class _s{constructor(t){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Yn(this.vertexArray,-1,-1,1),Yn(this.vertexArray,1,-1,1),Yn(this.vertexArray,-1,1,1),Yn(this.vertexArray,1,1,1),Yn(this.vertexArray,-1,-1,-1),Yn(this.vertexArray,1,-1,-1),Yn(this.vertexArray,-1,1,-1),Yn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Po),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function yr(c,t,s,h,m,_){const x=c.gl,w=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),I=t.paint.get("sky-atmosphere-sun-intensity"),z=((R,j,X,Z,U)=>({u_matrix_3f:R,u_sun_direction:j,u_sun_intensity:X,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),h),m,I,w,A);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),s.draw(c,x.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,z,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}function xr(c,t){return o.transformMat4(c,c,t)}const Ll={symbol:function(c,t,s,h,m){if(c.renderPass!=="translucent")return;const _=o.StencilMode.disabled,x=c.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(w,A,I,z,R,j,X){const Z=A.transform,U=R==="map",ie=j==="map";for(const H of w){const ee=z.getTile(H),te=ee.getBucket(I);if(!te||te.projection!==Z.projection.name||!te.text||!te.text.segments.get().length)continue;const re=o.evaluateSizeForZoom(te.textSizeData,Z.zoom),Q=A.transform.calculatePixelsToTileUnitsMatrix(ee),se=Kr(H.projMatrix,ee.tileID.canonical,ie,U,A.transform,Q),me=I.layout.get("icon-text-fit")!=="none"&&te.hasIconData();if(re){const we=Math.pow(2,Z.zoom-ee.tileID.overscaledZ);Pp(te,U,ie,X,o.symbolSize,Z,se,H,we,re,me,Z.projection)}}}(h,c,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m),s.paint.get("icon-opacity").constantOr(1)!==0&&kl(c,t,s,h,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),_,x),s.paint.get("text-opacity").constantOr(1)!==0&&kl(c,t,s,h,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),_,x),t.map.showCollisionBoxes&&(gu(c,t,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),gu(c,t,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,s,h){if(c.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),w=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(_.constantOr(1)===0||x.constantOr(1)===0))return;const A=c.context,I=A.gl,z=c.transform,R=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),j=o.StencilMode.disabled,X=c.colorModeForRenderPass(),Z=z.projection.name==="globe",U=[o.mercatorXfromLng(z.center.lng),o.mercatorYfromLat(z.center.lat)],ie=[];for(let ee=0;ee<h.length;ee++){const te=h[ee],re=t.getTile(te),Q=re.getBucket(s);if(!Q)continue;const se=Q.programConfigurations.get(s.id),me=Mp(s);Z&&me.push("PROJECTION_GLOBE_VIEW");const we=c.useProgram("circle",se,me),Ae=Q.layoutVertexBuffer,Ee=Q.globeExtVertexBuffer,Ne=Q.indexBuffer,_e=z.projection.createInversionMatrix(z,te.canonical),Ue={programConfiguration:se,program:we,layoutVertexBuffer:Ae,globeExtVertexBuffer:Ee,indexBuffer:Ne,uniformValues:Co(c,te,re,_e,U,s),tile:re};if(w){const Fe=Q.segments.get();for(const ot of Fe)ie.push({segments:new o.SegmentVector([ot]),sortKey:ot.sortKey,state:Ue})}else ie.push({segments:Q.segments,sortKey:0,state:Ue})}w&&ie.sort((ee,te)=>ee.sortKey-te.sortKey);const H={useDepthForOcclusion:!Z};for(const ee of ie){const{programConfiguration:te,program:re,layoutVertexBuffer:Q,globeExtVertexBuffer:se,indexBuffer:me,uniformValues:we,tile:Ae}=ee.state,Ee=ee.segments;c.terrain&&c.terrain.setupElevationDraw(Ae,re,H),c.prepareDrawProgram(A,re,Ae.tileID.toUnwrapped()),re.draw(A,I.TRIANGLES,R,j,X,o.CullFaceMode.disabled,we,s.id,Q,me,Ee,s.paint,z.zoom,te,Z?se:null)}},heatmap:function(c,t,s,h){if(s.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const m=c.context,_=m.gl,x=o.StencilMode.disabled,w=new o.ColorMode([_.ONE,_.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(j,X,Z){const U=j.gl;j.activeTexture.set(U.TEXTURE1),j.viewport.set([0,0,X.width/4,X.height/4]);let ie=Z.heatmapFbo;if(ie)U.bindTexture(U.TEXTURE_2D,ie.colorAttachment.get()),j.bindFramebuffer.set(ie.framebuffer);else{const H=U.createTexture();U.bindTexture(U.TEXTURE_2D,H),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),ie=Z.heatmapFbo=j.createFramebuffer(X.width/4,X.height/4,!1),function(ee,te,re,Q){const se=ee.gl;se.texImage2D(se.TEXTURE_2D,0,se.RGBA,te.width/4,te.height/4,0,se.RGBA,ee.extRenderToTextureHalfFloat?ee.extTextureHalfFloat.HALF_FLOAT_OES:se.UNSIGNED_BYTE,null),Q.colorAttachment.set(re)}(j,X,H,ie)}})(m,c,s),m.clear({color:o.Color.transparent});const A=c.transform,I=A.projection.name==="globe",z=I?["PROJECTION_GLOBE_VIEW"]:null,R=[o.mercatorXfromLng(A.center.lng),o.mercatorYfromLat(A.center.lat)];for(let j=0;j<h.length;j++){const X=h[j];if(t.hasRenderableParent(X))continue;const Z=t.getTile(X),U=Z.getBucket(s);if(!U)continue;const ie=U.programConfigurations.get(s.id),H=c.useProgram("heatmap",ie,z),{zoom:ee}=c.transform;c.terrain&&c.terrain.setupElevationDraw(Z,H),c.prepareDrawProgram(m,H,X.toUnwrapped());const te=A.projection.createInversionMatrix(A,X.canonical);H.draw(m,_.TRIANGLES,o.DepthMode.disabled,x,w,o.CullFaceMode.disabled,zp(c,X,Z,te,R,ee,s.paint.get("heatmap-intensity")),s.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,s.paint,c.transform.zoom,ie,I?U.globeExtVertexBuffer:null)}m.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(m,_){const x=m.context,w=x.gl,A=_.heatmapFbo;if(!A)return;x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,A.colorAttachment.get()),x.activeTexture.set(w.TEXTURE1);let I=_.colorRampTexture;I||(I=_.colorRampTexture=new o.Texture(x,_.colorRamp,w.RGBA)),I.bind(w.LINEAR,w.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(x,w.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,((z,R,j,X)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,_),_.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,_.paint,m.transform.zoom)}(c,s))},line:function(c,t,s,h){if(c.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(m.constantOr(1)===0||_.constantOr(1)===0)return;const x=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),w=c.colorModeForRenderPass(),A=c.terrain&&c.terrain.renderingToTexture?1:o.exported.devicePixelRatio,I=s.paint.get("line-dasharray"),z=I.constantOr(1),R=s.layout.get("line-cap"),j=s.paint.get("line-pattern"),X=j.constantOr(1),Z=s.paint.get("line-gradient"),U=s.getCrossfadeParameters(),ie=X?"linePattern":"line",H=c.context,ee=H.gl,te=(Q=>{const se=[];Al(Q)&&se.push("RENDER_LINE_DASH"),Q.paint.get("line-gradient")&&se.push("RENDER_LINE_GRADIENT");const me=Q.paint.get("line-pattern").constantOr(1),we=Q.paint.get("line-opacity").constantOr(1)!==1;return!me&&we&&se.push("RENDER_LINE_ALPHA_DISCARD"),se})(s);let re=te.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(re=!1);for(const Q of h){const se=t.getTile(Q);if(X&&!se.patternsLoaded())continue;const me=se.getBucket(s);if(!me)continue;c.prepareDrawTile();const we=me.programConfigurations.get(s.id),Ae=c.useProgram(ie,we,te),Ee=j.constantOr(null);if(Ee&&se.imageAtlas){const Me=se.imageAtlas,tt=Me.patternPositions[Ee.to.toString()],ht=Me.patternPositions[Ee.from.toString()];tt&&ht&&we.setConstantPatternPositions(tt,ht)}const Ne=I.constantOr(null),_e=R.constantOr(null);if(!X&&Ne&&_e&&se.lineAtlas){const Me=se.lineAtlas,tt=Me.getDash(Ne.to,_e),ht=Me.getDash(Ne.from,_e);tt&&ht&&we.setConstantPatternPositions(tt,ht)}const Ue=c.terrain?Q.projMatrix:null,Fe=X?Sl(c,se,s,U,Ue,A):kp(c,se,s,U,Ue,me.lineClipsArray.length,A);if(Z){const Me=me.gradients[s.id];let tt=Me.texture;if(s.gradientVersion!==Me.version){let ht=256;if(s.stepInterpolant){const it=t.getSource().maxzoom,nt=Q.canonical.z===it?Math.ceil(1<<c.transform.maxZoom-Q.canonical.z):1;ht=o.clamp(o.nextPowerOfTwo(me.maxLineLength/o.EXTENT*1024*nt),256,H.maxTextureSize)}Me.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:ht,image:Me.gradient||void 0,clips:me.lineClipsArray}),Me.texture?Me.texture.update(Me.gradient):Me.texture=new o.Texture(H,Me.gradient,ee.RGBA),Me.version=s.gradientVersion,tt=Me.texture}H.activeTexture.set(ee.TEXTURE1),tt.bind(s.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}z&&(H.activeTexture.set(ee.TEXTURE0),se.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),we.updatePaintBuffers(U)),X&&(H.activeTexture.set(ee.TEXTURE0),se.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),we.updatePaintBuffers(U)),c.prepareDrawProgram(H,Ae,Q.toUnwrapped());const ot=Me=>{Ae.draw(H,ee.TRIANGLES,x,Me,w,o.CullFaceMode.disabled,Fe,s.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,s.paint,c.transform.zoom,we,me.layoutVertexBuffer2)};if(re){const Me=c.stencilModeForClipping(Q).ref;Me===0&&c.terrain&&H.clear({stencil:0});const tt={func:ee.EQUAL,mask:255};Fe.u_alpha_discard_threshold=.8,ot(new o.StencilMode(tt,Me,255,ee.KEEP,ee.KEEP,ee.INVERT)),Fe.u_alpha_discard_threshold=0,ot(new o.StencilMode(tt,Me,255,ee.KEEP,ee.KEEP,ee.KEEP))}else ot(c.stencilModeForClipping(Q))}re&&(c.resetStencilClippingMasks(),c.terrain&&H.clear({stencil:0}))},fill:function(c,t,s,h){const m=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const x=c.colorModeForRenderPass(),w=s.paint.get("fill-pattern"),A=c.opaquePassEnabledForLayer()&&!w.constantOr(1)&&m.constantOr(o.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===A){const I=c.depthModeForSublayer(1,c.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);ga(c,t,s,h,I,x,!1)}if(c.renderPass==="translucent"&&s.paint.get("fill-antialias")){const I=c.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);ga(c,t,s,h,I,x,!0)}},"fill-extrusion":function(c,t,s,h){const m=s.paint.get("fill-extrusion-opacity");if(m!==0&&c.renderPass==="translucent"){const _=new o.DepthMode(c.context.gl.LEQUAL,o.DepthMode.ReadWrite,c.depthRangeFor3D);if(m!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))ko(c,t,s,h,_,o.StencilMode.disabled,o.ColorMode.disabled),ko(c,t,s,h,_,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const x=c.colorModeForRenderPass();ko(c,t,s,h,_,o.StencilMode.disabled,x)}}},hillshade:function(c,t,s,h){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const m=c.context,_=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),x=c.colorModeForRenderPass(),w=c.terrain&&c.terrain.renderingToTexture,[A,I]=c.renderPass!=="translucent"||w?[{},h]:c.stencilConfigForOverlap(h);for(const z of I){const R=t.getTile(z);if(R.needsHillshadePrepare&&c.renderPass==="offscreen")xl(c,R,s,_,o.StencilMode.disabled,x);else if(c.renderPass==="translucent"){const j=w&&c.terrain?c.terrain.stencilModeForRTTOverlap(z):A[z.overscaledZ];cu(c,z,R,s,_,j,x)}}m.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,s,h,m,_){if(c.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!h.length)return;const x=c.context,w=x.gl,A=t.getSource(),I=c.useProgram("raster"),z=c.colorModeForRenderPass(),R=c.terrain&&c.terrain.renderingToTexture,[j,X]=A instanceof ae||R?[{},h]:c.stencilConfigForOverlap(h),Z=X[X.length-1].overscaledZ,U=!c.options.moving;for(const ie of X){const H=R?o.DepthMode.disabled:c.depthModeForSublayer(ie.overscaledZ-Z,s.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,w.LESS),ee=ie.toUnwrapped(),te=t.getTile(ie);if(R&&(!te||!te.hasData()))continue;const re=R?ie.projMatrix:c.transform.calculateProjMatrix(ee,U),Q=c.terrain&&R?c.terrain.stencilModeForRTTOverlap(ie):j[ie.overscaledZ],se=_?0:s.paint.get("raster-fade-duration");te.registerFadeDuration(se);const me=t.findLoadedParent(ie,0),we=wl(te,me,t,c.transform,se);let Ae,Ee;c.terrain&&c.terrain.prepareDrawTile();const Ne=s.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;x.activeTexture.set(w.TEXTURE0),te.texture.bind(Ne,w.CLAMP_TO_EDGE),x.activeTexture.set(w.TEXTURE1),me?(me.texture.bind(Ne,w.CLAMP_TO_EDGE),Ae=Math.pow(2,me.tileID.overscaledZ-te.tileID.overscaledZ),Ee=[te.tileID.canonical.x*Ae%1,te.tileID.canonical.y*Ae%1]):te.texture.bind(Ne,w.CLAMP_TO_EDGE);const _e=mu(re,Ee||[0,0],Ae||1,we,s,A instanceof ae?A.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(x,I,ee),A instanceof ae)A.boundsBuffer&&A.boundsSegments&&I.draw(x,w.TRIANGLES,H,o.StencilMode.disabled,z,o.CullFaceMode.disabled,_e,s.id,A.boundsBuffer,c.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:Fe,tileBoundsSegments:ot}=c.getTileBoundsBuffers(te);I.draw(x,w.TRIANGLES,H,Q,z,o.CullFaceMode.disabled,_e,s.id,Ue,Fe,ot)}}c.resetStencilClippingMasks()},background:function(c,t,s,h){const m=s.paint.get("background-color"),_=s.paint.get("background-opacity");if(_===0)return;const x=c.context,w=x.gl,A=c.transform,I=A.tileSize,z=s.paint.get("background-pattern");if(c.isPatternMissing(z))return;const R=!z&&m.a===1&&_===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==R)return;const j=o.StencilMode.disabled,X=c.depthModeForSublayer(0,R==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Z=c.colorModeForRenderPass(),U=c.useProgram(z?"backgroundPattern":"background");let ie,H=h;H||(ie=c.getBackgroundTiles(),H=Object.values(ie).map(te=>te.tileID)),z&&(x.activeTexture.set(w.TEXTURE0),c.imageManager.bind(c.context));const ee=s.getCrossfadeParameters();for(const te of H){const re=te.toUnwrapped(),Q=h?te.projMatrix:c.transform.calculateProjMatrix(re);c.prepareDrawTile();const se=t?t.getTile(te):ie?ie[te.key]:new o.Tile(te,I,A.zoom,c),me=z?Cl(Q,_,c,z,{tileID:te,tileSize:I},ee):_u(Q,_,m);c.prepareDrawProgram(x,U,re);const{tileBoundsBuffer:we,tileBoundsIndexBuffer:Ae,tileBoundsSegments:Ee}=c.getTileBoundsBuffers(se);U.draw(x,w.TRIANGLES,X,j,Z,o.CullFaceMode.disabled,me,s.id,we,Ae,Ee)}},sky:function(c,t,s){const h=c.transform,m=h.projection.name==="mercator"||h.projection.name==="globe"?1:o.smoothstep(7,8,h.zoom),_=s.paint.get("sky-opacity")*m;if(_===0)return;const x=c.context,w=s.paint.get("sky-type"),A=new o.DepthMode(x.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),I=c.frameCounter/1e3%1;w==="atmosphere"?c.renderPass==="offscreen"?s.needsSkyboxCapture(c)&&(function(z,R,j,X){const Z=z.context,U=Z.gl;let ie=R.skyboxFbo;if(!ie){ie=R.skyboxFbo=Z.createFramebuffer(32,32,!1),R.skyboxGeometry=new _s(Z),R.skyboxTexture=Z.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,R.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let re=0;re<6;++re)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(ie.framebuffer),Z.viewport.set([0,0,32,32]);const H=R.getCenter(z,!0),ee=z.useProgram("skyboxCapture"),te=new Float64Array(16);o.identity(te),o.rotateY(te,te,.5*-Math.PI),yr(Z,R,ee,te,H,0),o.identity(te),o.rotateY(te,te,.5*Math.PI),yr(Z,R,ee,te,H,1),o.identity(te),o.rotateX(te,te,.5*-Math.PI),yr(Z,R,ee,te,H,2),o.identity(te),o.rotateX(te,te,.5*Math.PI),yr(Z,R,ee,te,H,3),o.identity(te),yr(Z,R,ee,te,H,4),o.identity(te),o.rotateY(te,te,Math.PI),yr(Z,R,ee,te,H,5),Z.viewport.set([0,0,z.width,z.height])}(c,s),s.markSkyboxValid(c)):c.renderPass==="sky"&&function(z,R,j,X,Z){const U=z.context,ie=U.gl,H=z.transform,ee=z.useProgram("skybox");U.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,R.skyboxTexture);const te=((re,Q,se,me,we)=>({u_matrix:re,u_sun_direction:Q,u_cubemap:0,u_opacity:me,u_temporal_offset:we}))(H.skyboxMatrix,R.getCenter(z,!1),0,X,Z);z.prepareDrawProgram(U,ee),ee.draw(U,ie.TRIANGLES,j,o.StencilMode.disabled,z.colorModeForRenderPass(),o.CullFaceMode.backCW,te,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,s,A,_,I):w==="gradient"&&c.renderPass==="sky"&&function(z,R,j,X,Z){const U=z.context,ie=U.gl,H=z.transform,ee=z.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new _s(U)),U.activeTexture.set(ie.TEXTURE0);let te=R.colorRampTexture;te||(te=R.colorRampTexture=new o.Texture(U,R.colorRamp,ie.RGBA)),te.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const re=((Q,se,me,we,Ae)=>({u_matrix:Q,u_color_ramp:0,u_center_direction:se,u_radius:o.degToRad(me),u_opacity:we,u_temporal_offset:Ae}))(H.skyboxMatrix,R.getCenter(z,!1),R.paint.get("sky-gradient-radius"),X,Z);z.prepareDrawProgram(U,ee),ee.draw(U,ie.TRIANGLES,j,o.StencilMode.disabled,z.colorModeForRenderPass(),o.CullFaceMode.backCW,re,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,s,A,_,I)},debug:function(c,t,s){for(let h=0;h<s.length;h++)vu(c,t,s[h])},custom:function(c,t,s){const h=c.context,m=s.implementation;if(c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(c.renderPass==="offscreen"){const _=m.prerender;_&&(c.setCustomLayerDefaults(),h.setColorMode(c.colorModeForRenderPass()),_.call(m,h.gl,c.transform.customLayerMatrix()),h.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),h.setColorMode(c.colorModeForRenderPass()),h.setStencilMode(o.StencilMode.disabled);const _=m.renderingMode==="3d"?new o.DepthMode(c.context.gl.LEQUAL,o.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,o.DepthMode.ReadOnly);h.setDepthMode(_),m.render(h.gl,c.transform.customLayerMatrix()),h.setDirty(),c.setBaseState(),h.bindFramebuffer.set(null)}}};class wu{constructor(t,s){this.context=new L(t),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new oa,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(t,s){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ji(this,t));const m=this._terrain;this.transform.elevation=h?m:null,m.update(t,this.transform,s)}_updateFog(t){const s=t.fog;if(!s||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=s.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const _=h+.78*(m-h);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,s){if(this.width=t*o.exported.devicePixelRatio,this.height=s*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._layers[h].resize()}setup(){const t=this.context,s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const h=new o.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(o.EXTENT,0),h.emplaceBack(0,o.EXTENT),h.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=t.createVertexBuffer(h,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const m=new o.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const _=new o.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(o.EXTENT,0,o.EXTENT,0),_.emplaceBack(0,o.EXTENT,0,o.EXTENT),_.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(_,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const x=new o.StructArrayLayout3ui6;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const w=new o.StructArrayLayout1ui2;for(const I of[0,1,3,2,0])w.emplaceBack(I);this.debugIndexBuffer=t.createIndexBuffer(w),this.emptyTexture=new o.Texture(t,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=o.create();const A=this.context.gl;this.stencilClearMode=new o.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(o.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(t,s.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,ca(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(t,s,h){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!h||h.length===0)return;const m=[];let _=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const z of h)if(this._tileClippingMaskIDs.has(z.key)||(_=!0),this._skippedStencilTileIDs.has(z.key)){if(!s.getTile(z).getBucket(t))continue;this._skippedStencilTileIDs.delete(z.key),m.push(z)}if(!_&&m.length===0)return}const x=this.context,w=x.gl;x.setColorMode(o.ColorMode.disabled),x.setDepthMode(o.DepthMode.disabled);const A=this.useProgram("clippingMask"),I=z=>{const R=s.getTile(z),{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:Z}=this.getTileBoundsBuffers(R);A.draw(x,w.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:w.GREATER,mask:255},this._tileClippingMaskIDs.get(z.key)||0,255,w.KEEP,w.KEEP,w.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ca(z.projMatrix),"$clipping",j,X,Z)};if(!_&&m.length>0)for(const z of m)I(z);else{(this._tileClippingMaskIDs.size===0||this.nextStencilID+h.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const z of h)this._tileClippingMaskIDs.set(z.key,this.nextStencilID++),s.getTile(z).getBucket(t)?I(z):this._skippedStencilTileIDs.add(z.key)}this._skippedStencilTileIDs.size===0&&(this.currentStencilSource=s.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new o.StencilMode({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new o.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs.get(t.key)||0,0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,h=t.sort((x,w)=>w.overscaledZ-x.overscaledZ),m=h[h.length-1].overscaledZ,_=h[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const x={};for(let w=0;w<_;w++)x[w+m]=new o.StencilMode({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[x,h]}return[{[m]:o.StencilMode.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([t.CONSTANT_COLOR,t.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(t,s,h){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new o.DepthMode(h||this.context.gl.LEQUAL,s,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const h=this.style.order,m=this.style._sourceCaches;for(const I in m){const z=m[I];z.used&&z.prepare(this.context)}const _={},x={},w={};for(const I in m){const z=m[I];_[I]=z.getVisibleCoordinates(),x[I]=_[I].slice().reverse(),w[I]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<h.length;I++)if(this.style._layers[h[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(w),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const I of h){const z=this.style._layers[I],R=t._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const j=R?x[R.id]:void 0;(z.type==="custom"||z.isSky()||j&&j.length)&&this.renderLayer(this,R,z,j)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let A=o.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(A=this.style.fog.properties.get("color")),this.context.clear({color:s.showOverdrawInspector?o.Color.black:A,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[h[this.currentLayer]],z=t._getLayerSourceCache(I);if(I.isSky())continue;const R=z?x[z.id]:void 0;this._renderTileClippingMasks(I,z,R),this.renderLayer(this,z,I,R)}if(this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const I=this.style._layers[h[this.currentLayer]],z=t._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,z,I,z?x[z.id]:void 0)}for(this.transform.projection.name==="globe"&&function(I){const z=I.context,R=z.gl,j=I.transform,X=new o.DepthMode(R.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Z=I.useProgram("globeAtmosphere"),U=j.centerOffset,ie=j._camera.getCameraToClipPerspective(j._fov,j.width/j.height,j._nearZ,j._farZ);ie[8]=2*-U.x/j.width,ie[9]=2*U.y/j.height;const H=o.invert([],ie),ee=o.mul([],H,j.projMatrix),te={u_frustum_tl:xr([-1,1,1],H),u_frustum_tr:xr([1,1,1],H),u_frustum_br:xr([1,-1,1],H),u_frustum_bl:xr([-1,-1,1],H),u_globe_pos:xr([j.globeMatrix[12],j.globeMatrix[13],j.globeMatrix[14]],ee),u_globe_radius:j.worldSize/2/Math.PI-1,u_opacity:1-o.globeToMercatorTransition(j.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};I.prepareDrawProgram(z,Z);const re=I.globeSharedBuffers;re&&Z.draw(z,R.TRIANGLES,X,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,te,"skybox",re.atmosphereVertexBuffer,re.atmosphereIndexBuffer,re.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;){const I=this.style._layers[h[this.currentLayer]],z=t._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=z?(I.type==="symbol"?w:x)[z.id]:void 0;this._renderTileClippingMasks(I,z,z?_[z.id]:void 0),this.renderLayer(this,z,I,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let I=null;o.values(this.style._layers).forEach(z=>{const R=t._getLayerSourceCache(z);R&&!z.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<R.getSource().maxzoom)&&(I=R)}),I&&this.options.showTileBoundaries&&Ll.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const z=I.transform.padding;Ke(I,I.transform.height-(z.top||0),3,Pl),Ke(I,z.bottom||0,3,Dl),hn(I,z.left||0,3,xu),hn(I,I.transform.width-(z.right||0),3,ya);const R=I.transform.centerPoint;(function(j,X,Z,U){ms(j,X-1,Z-10,2,20,U),ms(j,X-10,Z-1,20,2,U)})(I,R.x,I.transform.height-R.y,xa)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,s,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)||Ll[h.type](t,s,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let h=this.gpuTimers[t.id];h||(h=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),h.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,h.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const h in t){const m=t[h],_=this.context.extTimerQuery,x=_.getQueryObjectEXT(m.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(m.query),s[h]=x}return s}translatePosMatrix(t,s,h,m,_){if(!h[0]&&!h[1])return t;const x=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(x){const I=Math.sin(x),z=Math.cos(x);h=[h[0]*z-h[1]*I,h[0]*I+h[1]*z]}const w=[_?h[0]:Yt(s,h[0],this.transform.zoom),_?h[1]:Yt(s,h[1],this.transform.zoom),0],A=new Float32Array(16);return o.translate(A,t,w),A}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),h=this.imageManager.getPattern(t.to.toString());return!s||!h}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,s=this.style&&this.style.fog,h=[];return this.terrain&&!this.terrain.renderingToTexture&&h.push("TERRAIN"),s&&!t&&s.getOpacity(this.transform.pitch)!==0&&h.push("FOG"),t&&h.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&h.push("OVERDRAW_INSPECTOR"),h}useProgram(t,s,h){this.cache=this.cache||{};const m=h||[],_=this.currentGlobalDefines().concat(m),x=hs.cacheKey(t,_,s);return this.cache[x]||(this.cache[x]=new hs(this.context,t,ls[t],s,Wt[t],_)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,s,h){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const _=m.getOpacity(this.transform.pitch);_!==0&&s.setFogUniformValues(t,((x,w,A,I)=>{const z=w.properties.get("color"),R=x.frameCounter/1e3%1,j=[z.r/z.a,z.g/z.a,z.b/z.a,I];return{u_fog_matrix:A?x.transform.calculateFogTileMatrix(A):x.identityMat,u_fog_range:w.getFovAdjustedRange(x.transform._fov),u_fog_color:j,u_fog_horizon_blend:w.properties.get("horizon-blend"),u_fog_temporal_offset:R}})(this,m,h,_))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const m of h)s[m.key]=t[m.key]||new o.Tile(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class vr{constructor(t=0,s=0,h=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=h,this.right=m}interpolate(t,s,h){return s.top!=null&&t.top!=null&&(this.top=o.number(t.top,s.top,h)),s.bottom!=null&&t.bottom!=null&&(this.bottom=o.number(t.bottom,s.bottom,h)),s.left!=null&&t.left!=null&&(this.left=o.number(t.left,s.left,h)),s.right!=null&&t.right!=null&&(this.right=o.number(t.right,s.right,h)),this}getCenter(t,s){const h=o.clamp((this.left+t-this.right)/2,0,t),m=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.pointGeometry(h,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new vr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Tu(c,t){const s=o.getColumn(c,3);o.fromQuat(c,t),o.setColumn(c,3,s)}function Rl(c,t){const s=o.identity$1([]);return o.rotateZ$1(s,s,-t),o.rotateX$1(s,s,-c),s}function va(c,t){const s=[c[0],c[1],0],h=[t[0],t[1],0];if(o.length(s)>=1e-15){const x=o.normalize([],s);o.scale$2(h,x,o.dot(h,x)),t[0]=h[0],t[1]=h[1]}const m=o.cross([],t,c);if(o.len(m)<1e-15)return null;const _=Math.atan2(-m[1],m[0]);return Rl(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),_)}class gs{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof o.MercatorCoordinate?t:new o.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=o.wrap(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const h=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(t)):0,m=this.position,_=o.MercatorCoordinate.fromLngLat(t,h),x=[_.x-m.x,_.y-m.y,_.z-m.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=va(x,s)}setPitchBearing(t,s){this.orientation=Rl(o.degToRad(t),o.degToRad(-s))}}class ys{constructor(t,s){this._transform=o.identity([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new o.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=o.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&o.setColumn(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.identity$1([]),t&&Tu(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=Rl(t,s),Tu(this._transform,this._orientation)}forward(){const t=o.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const h=new Float64Array(16);return o.invert(h,this.getWorldToCamera(t,s)),h}getWorldToCameraPosition(t,s,h){const m=this.position;o.scale$2(m,m,-t);const _=new Float64Array(16);return o.fromScaling(_,[h,h,h]),o.translate(_,_,m),_[10]*=s,_}getWorldToCamera(t,s){const h=new Float64Array(16),m=new Float64Array(4),_=this.position;return o.conjugate(m,this._orientation),o.scale$2(_,_,-t),o.fromQuat(h,m),o.translate(h,h,_),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(t,s,h,m){const _=new Float64Array(16);return o.perspective(_,t,s,h,m),_}getDistanceToElevation(t){const s=t===0?0:o.mercatorZfromAltitude(t,this.position[1]),h=this.forward();return(s-this.position[2])/h[2]}clone(){return new ys([...this.position],[...this.orientation])}}function Bl(c,t){const s=xs(c),h=function(_,x,w,A,I){const z=new o.LngLat(w.lng-180*br,w.lat),R=new o.LngLat(w.lng+180*br,w.lat),j=_.project(z.lng,z.lat),X=_.project(R.lng,R.lat),Z=-Math.atan2(X.y-j.y,X.x-j.x),U=o.MercatorCoordinate.fromLngLat(w);U.y=o.clamp(U.y,-.999975,.999975);const ie=U.toLngLat(),H=_.project(ie.lng,ie.lat),ee=o.MercatorCoordinate.fromLngLat(ie);ee.x+=br;const te=ee.toLngLat(),re=_.project(te.lng,te.lat),Q=Nl(re.x-H.x,re.y-H.y,Z),se=o.MercatorCoordinate.fromLngLat(ie);se.y+=br;const me=se.toLngLat(),we=_.project(me.lng,me.lat),Ae=Nl(we.x-H.x,we.y-H.y,Z),Ee=Math.abs(Q.x)/Math.abs(Ae.y),Ne=o.identity([]);o.rotateZ(Ne,Ne,-Z*(1-(I?0:A)));const _e=o.identity([]);return o.scale(_e,_e,[1,1-(1-Ee)*A,1]),_e[4]=-Ae.x/Ae.y*A,o.rotateZ(_e,_e,Z),o.multiply$1(_e,Ne,_e),_e}(c.projection,0,c.center,s,t),m=Fl(c);return o.scale(h,h,[m,m,1]),h}function Fl(c){const t=c.projection,s=xs(c),h=Ol(t,c.center),m=Ol(t,o.LngLat.convert(t.center));return Math.pow(2,h*s+(1-s)*m)}function xs(c){const t=c.projection.range;if(!t)return 0;const s=Math.max(c.width,c.height),h=Math.log(s/1024)/Math.LN2;return o.smoothstep(t[0]+h,t[1]+h,c.zoom)}const br=1/4e4;function Ol(c,t){const s=o.clamp(t.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=new o.LngLat(t.lng-180*br,s),m=new o.LngLat(t.lng+180*br,s),_=c.project(h.lng,s),x=c.project(m.lng,s),w=o.MercatorCoordinate.fromLngLat(h),A=o.MercatorCoordinate.fromLngLat(m),I=x.x-_.x,z=x.y-_.y,R=A.x-w.x,j=A.y-w.y,X=Math.sqrt((R*R+j*j)/(I*I+z*z));return Math.log(X)/Math.LN2}function Nl(c,t,s){const h=Math.cos(s),m=Math.sin(s);return{x:c*h-t*m,y:c*m+t*h}}class ba{constructor(t,s,h,m,_,x,w){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=h==null?0:h,this._maxPitch=m==null?60:m,this.setProjection(x),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new vr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ys,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const t=new ba(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const s=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||s)&&this._updateCameraOnTerrain(),(t||s)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(t){t==null&&(t={name:"mercator"}),this.projectionOptions=t;const s=this.projection?this.getProjection():void 0;this.projection=o.getProjection(t);const h=this.getProjection();return D(s,h)?null:(this._calcMatrices(),h)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;var h;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(h=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(m,_,x){var w=_[0],A=_[1],I=_[2],z=_[3],R=Math.sin(x),j=Math.cos(x);m[0]=w*j+I*R,m[1]=A*j+z*R,m[2]=w*-R+I*j,m[3]=A*-R+z*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=o.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,_=0;for(let x=0;x<s.length;x++){const w=new o.pointGeometry(s[x][0]*this.width,h+s[x][1]*(this.height-h)),A=t.pointCoordinate(w);if(!A)continue;const I=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);m+=A[3]*I,_+=I}return _===0?NaN:m/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),x=Math.max(m-h,_);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=o.length(o.sub([],this._camera.position,h));return o.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!o.exactEquals(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];o.exactEquals$1(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new gs;return s.position=new o.MercatorCoordinate(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!o.length$1(t))return!1;o.normalize$1(t,t);const s=o.transformQuat([],[0,0,-1],t),h=o.transformQuat([],[0,-1,0],t);if(h[2]<0)return!1;const m=va(s,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=o.clamp(t[2],m/h,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,h){this._unmodified=!1,this._edgeInsets.interpolate(t,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new o.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new o.pointGeometry(0,0)),m=this.pointCoordinate(new o.pointGeometry(this.width,0)),_=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),x=this.pointCoordinate(new o.pointGeometry(0,this.height)),w=Math.floor(Math.min(h.x,m.x,_.x,x.x)),A=Math.floor(Math.max(h.x,m.x,_.x,x.x)),I=1;for(let z=w-I;z<=A+I;z++)z!==0&&s.push(new o.UnwrappedTileID(z,t))}return s}coveringTiles(t){let s=this.coveringZoomLevel(t);const h=s,m=this.elevation&&!t.isTerrainDEM,_=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const x=this.locationCoordinate(this.center),w=this.center.lat,A=1<<s,I=[A*x.x,A*x.y,0],z=this.projection.name==="globe",R=!z,j=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,R),X=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=A*o.mercatorZfromAltitude(1,this.center.lat),U=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),ie=[A*X.x,A*X.y,U*(R?1:Z)],H=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ee=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?s:0,te=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,re=t.isTerrainDEM?-te:this._elevation?this._elevation.getMinElevationBelowMSL():0,Q=this.projection.isReprojectedInTileSpace?Fl(this):1,se=Me=>{const ht=new o.MercatorCoordinate(Me.x+25e-6,Me.y,Me.z),it=new o.MercatorCoordinate(Me.x,Me.y+25e-6,Me.z),nt=Me.toLngLat(),ft=ht.toLngLat(),At=it.toLngLat(),lt=this.locationCoordinate(nt),gt=this.locationCoordinate(ft),Nt=this.locationCoordinate(At),ai=Math.hypot(gt.x-lt.x,gt.y-lt.y),Ri=Math.hypot(Nt.x-lt.x,Nt.y-lt.y);return Math.sqrt(ai*Ri)*Q/25e-6},me=Me=>{const tt=te,ht=re;return{aabb:o.tileAABB(this,A,0,0,0,Me,ht,tt,this.projection),zoom:0,x:0,y:0,minZ:ht,maxZ:tt,wrap:Me,fullyVisible:!1}},we=[];let Ae=[];const Ee=s,Ne=t.reparseOverscaled?h:s,_e=Me=>Me*Me,Ue=_e((U-this._centerAltitude)*Z),Fe=Me=>{if(!this._elevation||!Me.tileID||!_)return;const tt=this._elevation.getMinMaxForTile(Me.tileID),ht=Me.aabb;tt?(ht.min[2]=tt.min,ht.max[2]=tt.max,ht.center[2]=(ht.min[2]+ht.max[2])/2):(Me.shouldSplit=ot(Me),Me.shouldSplit||(ht.min[2]=ht.max[2]=ht.center[2]=this._centerAltitude))},ot=Me=>{if(Me.zoom<ee)return!0;if(Me.zoom===Ee)return!1;if(Me.shouldSplit!=null)return Me.shouldSplit;const tt=Me.aabb.distanceX(ie),ht=Me.aabb.distanceY(ie);let it=Ue,nt=1;if(z){it=_e(Me.aabb.distanceZ(ie));const At=Math.pow(2,Me.zoom),lt=o.latFromMercatorY((Me.y+1)/At),gt=o.latFromMercatorY(Me.y/At),Nt=Math.min(Math.max(w,lt),gt),ai=o.circumferenceAtLatitude(Nt)/o.circumferenceAtLatitude(w);nt=Math.min(ai,1)}else if(m&&(it=_e(Me.aabb.distanceZ(ie)*Z)),this.projection.isReprojectedInTileSpace&&h<=5){const At=Math.pow(2,Me.zoom),lt=se(new o.MercatorCoordinate((Me.x+.5)/At,(Me.y+.5)/At));nt=lt>.85?1:lt}const ft=tt*tt+ht*ht+it;return ft<_e((1<<Ee-Me.zoom)*H*nt*((At,lt)=>{if(lt*_e(.707)<At)return 1;const gt=Math.sqrt(lt/At);return gt/(1.4144271570014144+(Math.pow(1.1,gt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(it,Ue),ft))};if(this.renderWorldCopies)for(let Me=1;Me<=3;Me++)we.push(me(-Me)),we.push(me(Me));for(we.push(me(0));we.length>0;){const Me=we.pop(),tt=Me.x,ht=Me.y;let it=Me.fullyVisible;if(!it){const nt=Me.aabb.intersects(j);if(nt===0)continue;it=nt===2}if(Me.zoom!==Ee&&ot(Me))for(let nt=0;nt<4;nt++){const ft=(tt<<1)+nt%2,At=(ht<<1)+(nt>>1),lt={aabb:_?Me.aabb.quadrant(nt):o.tileAABB(this,A,Me.zoom+1,ft,At,Me.wrap,Me.minZ,Me.maxZ,this.projection),zoom:Me.zoom+1,x:ft,y:At,wrap:Me.wrap,fullyVisible:it,tileID:void 0,shouldSplit:void 0,minZ:Me.minZ,maxZ:Me.maxZ};m&&!z&&(lt.tileID=new o.OverscaledTileID(Me.zoom+1===Ee?Ne:Me.zoom+1,Me.wrap,Me.zoom+1,ft,At),Fe(lt)),we.push(lt)}else{const nt=Me.zoom===Ee?Ne:Me.zoom;if(t.minzoom&&t.minzoom>nt)continue;const ft=I[0]-(.5+tt+(Me.wrap<<Me.zoom))*(1<<s-Me.zoom),At=I[1]-.5-ht,lt=Me.tileID?Me.tileID:new o.OverscaledTileID(nt,Me.wrap,Me.zoom,tt,ht);Ae.push({tileID:lt,distanceSq:ft*ft+At*At})}}if(this.fogCullDistSq){const Me=this.fogCullDistSq,tt=this.horizonLineFromTop();Ae=Ae.filter(ht=>{const it=[0,0,0,1],nt=[o.EXTENT,o.EXTENT,0,1],ft=this.calculateFogTileMatrix(ht.tileID.toUnwrapped());o.transformMat4$1(it,it,ft),o.transformMat4$1(nt,nt,ft);const At=o.getAABBPointSquareDist(it,nt);if(At===0)return!0;let lt=!1;const gt=this._elevation;if(gt&&At>Me&&tt!==0){const Nt=this.calculateProjMatrix(ht.tileID.toUnwrapped());let ai;t.isTerrainDEM||(ai=gt.getMinMaxForTile(ht.tileID)),ai||(ai={min:re,max:te});const Ri=o.furthestTileCorner(this.rotation),Bi=[Ri[0]*o.EXTENT,Ri[1]*o.EXTENT,ai.max];o.transformMat4(Bi,Bi,Nt),lt=(1-Bi[1])*this.height*.5<tt}return At<Me||lt})}return Ae.sort((Me,tt)=>Me.distanceSq-tt.distanceSq).map(Me=>Me.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=o.clamp(t.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=this.projection.project(t.lng,s);return new o.pointGeometry(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,s){let h,m;const _=this.centerPoint;if(this.projection.name==="globe"){const w=this.worldSize;h=(s.x-_.x)/w,m=(s.y-_.y)/w}else{const w=this.pointCoordinate(s),A=this.pointCoordinate(_);h=w.x-A.x,m=w.y-A.y}const x=this.locationCoordinate(t);this.setLocation(new o.MercatorCoordinate(x.x-h,x.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,s){const h=s?o.mercatorZfromAltitude(s,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new o.MercatorCoordinate(m.x,m.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const h=s!=null?s:this._centerAltitude,m=[t.x,t.y,0,1],_=[t.x,t.y,1,1];o.transformMat4$1(m,m,this.pixelMatrixInverse),o.transformMat4$1(_,_,this.pixelMatrixInverse);const x=_[3];o.scale$1(m,m,1/m[3]),o.scale$1(_,_,1/x);const w=m[2],A=_[2];return{p0:m,p1:_,t:w===A?0:(h-w)/(A-w)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return o.transformMat4$1(s,s,this.pixelMatrixInverse),o.transformMat4$1(h,h,this.pixelMatrixInverse),o.scale$1(s,s,1/s[3]),o.scale$1(h,h,1/h[3]),s[2]=o.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,h[2]=o.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,o.scale$1(s,s,1/this.worldSize),o.scale$1(h,h,1/this.worldSize),new o.Ray([s[0],s[1],s[2]],o.normalize([],o.sub([],h,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:h,t:m}=t,_=o.mercatorZfromAltitude(s[2],this._center.lat),x=o.mercatorZfromAltitude(h[2],this._center.lat);return new o.MercatorCoordinate(o.number(s[0],h[0],m)/this.worldSize,o.number(s[1],h[1],m)/this.worldSize,o.number(_,x,m))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const s=this.elevation;let h=this.elevation.pointCoordinate(t);if(h)return new o.MercatorCoordinate(h[0],h[1],h[2]);let m=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t);const x=.02*_,w=t.clone();for(let A=0;A<10&&_-m>x;A++){w.y=o.number(m,_,.66);const I=s.pointCoordinate(w);I?(_=w.y,h=I):m=w.y}return h?new o.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const s=this.horizonLineFromTop();return t.y<s}}_coordinatePoint(t,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return o.transformMat4$1(m,m,this.pixelMatrix),m[3]>0?new o.pointGeometry(m[0]/m[3],m[1]/m[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,s){const h=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),_=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),x=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let w=this.pointCoordinate(h,t),A=this.pointCoordinate(m,t);const I=this.pointCoordinate(_,s),z=this.pointCoordinate(x,s),R=(j,X)=>(X.y-j.y)/(X.x-j.x);return w.y>1&&A.y>=0?w=new o.MercatorCoordinate((1-z.y)/R(z,w)+z.x,1):w.y<0&&A.y<=1&&(w=new o.MercatorCoordinate(-z.y/R(z,w)+z.x,0)),A.y>1&&w.y>=0?A=new o.MercatorCoordinate((1-I.y)/R(I,A)+I.x,1):A.y<0&&w.y<=1&&(A=new o.MercatorCoordinate(-I.y/R(I,A)+I.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(w)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(I))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const s=t.visibleDemTiles.reduce((h,m)=>{if(m.dem){const _=m.dem.tree;h.min=Math.min(h.min,_.minimums[0]),h.max=Math.max(h.max,_.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBounds(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,h=this._distanceTileDataCache;if(h[s])return h[s];const m=t.canonical,_=1/this.height,x=this.cameraWorldSize/this.zoomScale(m.z),w=(m.x+Math.pow(2,m.z)*t.wrap)*x,A=m.y*x,I=this.point,z=this.angle,R=Math.sin(-z),j=-Math.cos(-z);return h[s]={bearing:[R,j],center:[(I.x-w)*_,(I.y-A)*_],scale:x/o.EXTENT*_},h[s]}calculateFogTileMatrix(t){const s=t.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const m=this.calculatePosMatrix(t,this.cameraWorldSize);return o.multiply$1(m,this.worldToFogMatrix,m),h[s]=new Float32Array(m),h[s]}calculateProjMatrix(t,s=!1){const h=t.key,m=s?this._alignedProjMatrixCache:this._projMatrixCache;if(m[h])return m[h];const _=this.calculatePosMatrix(t,this.worldSize);return o.multiply$1(_,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.alignedProjMatrix:this.projMatrix,_),m[h]=new Float32Array(_),m[h]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const m=function(_,x){const{scale:w}=_.tileTransform,A=w*o.EXTENT/(_.tileSize*Math.pow(2,x.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return I=new Float32Array(4),j=(z=x.inverseAdjustmentMatrix)[1],X=z[2],Z=z[3],ie=(R=[A,A])[1],I[0]=z[0]*(U=R[0]),I[1]=j*U,I[2]=X*ie,I[3]=Z*ie,I;var I,z,R,j,X,Z,U,ie}(t,this);return h[s]=m,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=this._camera.forward(),_=o.mercatorZfromAltitude(1,this._center.lat);h[2]/=_,m[2]/=_,o.normalize(m,m);const x=t.raycast(h,m,t.exaggeration());if(x){const w=o.scaleAndAdd([],h,m,x),A=new o.MercatorCoordinate(w[0],w[1],o.mercatorZfromAltitude(w[2],o.latFromMercatorY(w[1]))),I=(A.z+o.length([A.x-h[0],A.y-h[1],A.z-h[2]*_]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(I),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=t.getAtPointOrZero(new o.MercatorCoordinate(...h)),_=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),x=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*m;if(x<_){const w=this.locationCoordinate(this._center,this._centerAltitude),A=[w.x-h[0],w.y-h[1],w.z-h[2]],I=o.length(A);A[2]-=(_-x)/this._projectionScaler;const z=o.length(A);if(z===0)return;o.scale$2(A,A,I/z*this._projectionScaler),this._camera.position=[w.x-A[0],w.y-A[1],w.z*this._projectionScaler-A[2]],this._camera.orientation=va(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const R=this.center;return R.lat=o.clamp(R.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(R.lng=o.clamp(R.lng,this.minLng,this.maxLng)),this.center=R,void(this._constraining=!1)}const t=this._unmodified,{x:s,y:h}=this.point;let m=0,_=s,x=h;const w=this.width/2,A=this.height/2,I=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(h-A<I&&(x=I+A),h+A>z&&(x=z-A),z-I<this.height&&(m=Math.max(m,this.height/(z-I)),x=(z+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const R=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,X=this.worldSize/2-(R+j)/2;_=(s+X+this.worldSize)%this.worldSize-X,_-w<R&&(_=R+w),_+w>j&&(_=j-w),j-R<this.width&&(m=Math.max(m,this.width/(j-R)),_=(j+R)/2)}_===s&&x===h||(this.center=this.unproject(new o.pointGeometry(_,x))),m&&(this.zoom+=this.scaleZoom(m)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this._fov/2,s=this.centerOffset,h=this.pixelsPerMeter;this._projectionScaler=h/(o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(t)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?h:1),_=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);_[8]=2*-s.x/this.width,_[9]=2*s.y/this.height;let x=o.mul([],_,m);if(this.projection.isReprojectedInTileSpace){const re=this.locationCoordinate(this.center),Q=o.identity([]);o.translate(Q,Q,[re.x*this.worldSize,re.y*this.worldSize,0]),o.multiply$1(Q,Q,Bl(this)),o.translate(Q,Q,[-re.x*this.worldSize,-re.y*this.worldSize,0]),o.multiply$1(x,x,Q),this.inverseAdjustmentMatrix=function(se){const me=Bl(se,!0);return xt([],[me[0],me[1],me[4],me[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],x,[this.worldSize,this.worldSize,this.worldSize/h,1]),this.projMatrix=x,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const w=new Float32Array(16);o.identity(w),o.scale(w,w,[1,-1,1]),o.rotateX(w,w,this._pitch),o.rotateZ(w,w,this.angle);const A=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),I=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;A[8]=2*-s.x/this.width,A[9]=2*(s.y+I)/this.height,this.skyboxMatrix=o.multiply$1(w,A,w);const z=this.point,R=z.x,j=z.y,X=this.width%2/2,Z=this.height%2/2,U=Math.cos(this.angle),ie=Math.sin(this.angle),H=R-Math.round(R)+U*X+ie*Z,ee=j-Math.round(j)+U*Z+ie*X,te=new Float64Array(x);if(o.translate(te,te,[H>.5?H-1:H,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=te,x=o.create(),o.scale(x,x,[this.width/2,-this.height/2,1]),o.translate(x,x,[1,-1,0]),this.labelPlaneMatrix=x,x=o.create(),o.scale(x,x,[1,-1,1]),o.translate(x,x,[-1,-1,0]),o.scale(x,x,[2/this.width,2/this.height,1]),this.glCoordMatrix=x,this.pixelMatrix=o.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},x=o.invert(new Float64Array(16),this.pixelMatrix),!x)throw new Error("failed to invert matrix");this.pixelMatrixInverse=x,this.globeMatrix=this.projection.name==="globe"?o.calculateGlobeMatrix(this):x,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,s=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height,_=[t,t,s];o.scale$2(_,_,m),o.scale$2(h,h,-1),o.multiply$2(h,h,_);const x=o.create();o.translate(x,x,h),o.scale(x,x,_),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),m=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-h[0]*_,m.y/this.worldSize-h[1]*_,t/this.worldSize*this._centerAltitude-h[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=t[2];let m=1;h>0&&(m=Math.min((s-this._camera.position[2])/h,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,t,m),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),_=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),w=Math.max((t[2]-_)/Math.cos(h),x),A=this._zoomFromMercatorZ(w);o.scaleAndAdd(t,t,s,w),this._pitch=o.clamp(h,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(m,-Math.PI,Math.PI),this._setZoom(o.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(t,s){const h=Math.min(t.x,s.x),m=Math.max(t.x,s.x),_=Math.min(t.y,s.y),x=Math.max(t.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const w=[new o.pointGeometry(h,_),new o.pointGeometry(m,x),new o.pointGeometry(h,x),new o.pointGeometry(m,_)],A=this.renderWorldCopies?-3:0,I=this.renderWorldCopies?4:1;for(const z of w){const R=this.pointRayIntersection(z);if(R.t<0)return!0;const j=this.rayIntersectionCoordinate(R);if(j.x<A||j.y<0||j.x>I||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,s){const h=o.length(o.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(m)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,t))}}function Ul(c,t){let s=!1,h=null;const m=()=>{h=null,s&&(c(),h=setTimeout(m,t),s=!1)};return()=>(s=!0,h||m(),h)}class Eu{constructor(t){this._hashName=t&&encodeURIComponent(t),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ul(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,o.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const s=this._map;if(!s)return"";const h=s.getCenter(),m=Math.round(100*s.getZoom())/100,_=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),w=Math.round(h.lng*x)/x,A=Math.round(h.lat*x)/x,I=s.getBearing(),z=s.getPitch();let R="";if(R+=t?`/${w}/${A}/${m}`:`${m}/${A}/${w}`,(I||z)&&(R+="/"+Math.round(10*I)/10),z&&(R+=`/${Math.round(z)}`),this._hashName){const j=this._hashName;let X=!1;const Z=o.window.location.hash.slice(1).split("&").map(U=>{const ie=U.split("=")[0];return ie===j?(X=!0,`${ie}=${R}`):U}).filter(U=>U);return X||Z.push(`${j}=${R}`),`#${Z.join("&")}`}return`#${R}`}_getCurrentHash(){const t=o.window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,t)}}const Kn={linearity:.3,easing:o.bezier(0,0,.3,1)},Su=o.extend({deceleration:2500,maxSpeed:1400},Kn),Au=o.extend({deceleration:20,maxSpeed:1400},Kn),Mu=o.extend({deceleration:1e3,maxSpeed:360},Kn),Iu=o.extend({deceleration:1e3,maxSpeed:90},Kn);class Cu{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=o.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const _=Mi(s.pan.mag(),h,o.extend({},Su,t||{}));m.offset=s.pan.mult(_.amount/s.pan.mag()),m.center=this._map.transform.center,vs(m,_)}if(s.zoom){const _=Mi(s.zoom,h,Au);m.zoom=this._map.transform.zoom+_.amount,vs(m,_)}if(s.bearing){const _=Mi(s.bearing,h,Mu);m.bearing=this._map.transform.bearing+o.clamp(_.amount,-179,179),vs(m,_)}if(s.pitch){const _=Mi(s.pitch,h,Iu);m.pitch=this._map.transform.pitch+_.amount,vs(m,_)}if(m.zoom||m.bearing){const _=s.pinchAround===void 0?s.around:s.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function vs(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function Mi(c,t,s){const{maxSpeed:h,linearity:m,deceleration:_}=s,x=o.clamp(c*m/(t/1e3),-h,h),w=Math.abs(x)/(_*m);return{easing:s.easing,duration:1e3*w,amount:x*(w/2)}}class Qi extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h,m={}){const _=je(s.getCanvasContainer(),h),x=s.unproject(_);super(t,o.extend({point:_,lngLat:x,originalEvent:h},m)),this._defaultPrevented=!1,this.target=s}}class bs extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){const m=t==="touchend"?h.changedTouches:h.touches,_=Ge(s.getCanvasContainer(),m),x=_.map(A=>s.unproject(A)),w=_.reduce((A,I,z,R)=>A.add(I.div(R.length)),new o.pointGeometry(0,0));super(t,{points:_,point:w,lngLats:x,lngLat:s.unproject(w),originalEvent:h}),this._defaultPrevented=!1}}class Lp extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){super(t,{originalEvent:h}),this._defaultPrevented=!1}}class Rp{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Lp(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Qi(t.type,this._map,t))}mouseup(t){this._map.fire(new Qi(t.type,this._map,t))}preclick(t){const s=o.extend({},t);s.type="preclick",this._map.fire(new Qi(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Qi(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Qi(t.type,this._map,t))}mouseover(t){this._map.fire(new Qi(t.type,this._map,t))}mouseout(t){this._map.fire(new Qi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new bs(t.type,this._map,t))}touchmove(t){this._map.fire(new bs(t.type,this._map,t))}touchend(t){this._map.fire(new bs(t.type,this._map,t))}touchcancel(t){this._map.fire(new bs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Qi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Qi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zu{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(We(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const h=s;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=h,this._box||(this._box=G("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(m.x,h.x),x=Math.max(m.x,h.x),w=Math.min(m.y,h.y),A=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${_}px,${w}px)`,this._box.style.width=x-_+"px",this._box.style.height=A-w+"px")})}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const h=this._startPos,m=s;if(this.reset(),He(),h.x!==m.x||h.y!==m.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Xe(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new o.Event(t,{originalEvent:s}))}}function wr(c,t){const s={};for(let h=0;h<c.length;h++)s[c[h].identifier]=t[h];return s}class Un{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const _=new o.pointGeometry(0,0);for(const x of m)_._add(x);return _.div(m.length)}(s),this.touches=wr(h,s)))}touchmove(t,s,h){if(this.aborted||!this.centroid)return;const m=wr(h,s);for(const _ in this.touches){const x=this.touches[_],w=m[_];(!w||w.dist(x)>30)&&(this.aborted=!0)}}touchend(t,s,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Do{constructor(t){this.singleTap=new Un(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,h){this.singleTap.touchstart(t,s,h)}touchmove(t,s,h){this.singleTap.touchmove(t,s,h)}touchend(t,s,h){const m=this.singleTap.touchend(t,s,h);if(m){const _=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(m)<30;if(_&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class et{constructor(){this._zoomIn=new Do({numTouches:1,numTaps:2}),this._zoomOut=new Do({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,h){this._zoomIn.touchstart(t,s,h),this._zoomOut.touchstart(t,s,h)}touchmove(t,s,h){this._zoomIn.touchmove(t,s,h),this._zoomOut.touchmove(t,s,h)}touchend(t,s,h){const m=this._zoomIn.touchend(t,s,h),_=this._zoomOut.touchend(t,s,h);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(m)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ku={0:1,2:2};class wa{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const h=Tt(t);this._correctButton(t,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(t,s){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(m,_){const x=ku[_];return m.buttons===void 0||(m.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(t){this._lastPoint&&Tt(t)===this._eventButton&&(this._moved&&He(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ws extends wa{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Lo extends wa{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const h=.8*(s.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){t.preventDefault()}}class Vl extends wa{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const h=-.5*(s.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){t.preventDefault()}}class Pu{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(t,s,h){return this._calculateTransform(t,s,h)}touchmove(t,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,s,h)}}touchend(t,s,h){this._calculateTransform(t,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,h){h.length>0&&(this._active=!0);const m=wr(h,s),_=new o.pointGeometry(0,0),x=new o.pointGeometry(0,0);let w=0;for(const I in m){const z=m[I],R=this._touches[I];R&&(_._add(z),x._add(z.sub(R)),w++,m[I]=z)}if(this._touches=m,w<this._minTouches||!x.mag())return;const A=x.div(w);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(w),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Ta{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,h){return{}}touchstart(t,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,h){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[_,x]=m,w=Ts(h,s,_),A=Ts(h,s,x);if(!w||!A)return;const I=this._aroundCenter?null:w.add(A).div(2);return this._move([w,A],I,t)}touchend(t,s,h){if(!this._firstTwoTouches)return;const[m,_]=this._firstTwoTouches,x=Ts(h,s,m),w=Ts(h,s,_);x&&w||(this._active&&He(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ts(c,t,s){for(let h=0;h<c.length;h++)if(c[h].identifier===s)return t[h]}function $l(c,t){return Math.log(c/t)/Math.LN2}class Du extends Ta{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs($l(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$l(this._distance,h),pinchAround:s}}}function jl(c,t){return 180*c.angleWith(t)/Math.PI}class Ea extends Ta{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:jl(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,h=jl(t,this._startVector);return Math.abs(h)<s}}function Es(c){return Math.abs(c.y)>Math.abs(c.x)}class Sa extends Ta{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Es(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,h){const m=this._lastPoints;if(!m)return;const _=t[0].sub(m[0]),x=t[1].sub(m[1]);return this._map._cooperativeGestures&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(_,x,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5})}gestureBeginsVertically(t,s,h){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,_=s.mag()>=2;if(!m&&!_)return;if(!m||!_)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return Es(t)&&Es(s)&&x}}const Lu={panStep:100,bearingStep:15,pitchStep:10};class Ru{constructor(){const t=Lu;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,h=0,m=0,_=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:w=>{const A=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:Bu,zoom:s?Math.round(A)+s*(t.shiftKey?2:1):A,bearing:w.getBearing()+h*this._bearingStep,pitch:w.getPitch()+m*this._pitchStep,offset:[-_*this._panStep,-x*this._panStep],center:w.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bu(c){return c*(2-c)}const Gl=4.000244140625;class Fu{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=o.exported.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%Gl==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=je(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>Gl?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&I!==0&&(I=1/I);const z=s(),R=Math.pow(2,z),j=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(j*I))),this._type==="wheel"&&(this._startZoom=s(),this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,_=this._easing;let x,w=!1;if(this._type==="wheel"&&m&&_){const A=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),I=_(A);x=o.number(m,h,I),A<1?this._frameId||(this._frameId=!0):w=!0}else x=h,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:x-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=o.ease;if(this._prevEase){const h=this._prevEase,m=(o.exported.now()-h.start)/h.duration,_=h.easing(m+.01)-h.easing(m),x=.27/Math.sqrt(_*_+1e-4)*.01,w=Math.sqrt(.0729-x*x);s=o.bezier(x,w,.25,1)}return this._prevEase={start:o.exported.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!o.window.document.fullscreenElement||!!o.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ou{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zl{constructor(){this._tap=new Do({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,s,h))}touchmove(t,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=s[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,s,h)}touchend(t,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,s,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uu{constructor(t,s,h){this._el=t,this._mousePan=s,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vu{constructor(t,s,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $u{constructor(t,s,h,m){this._el=t,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ss=c=>c.zoom||c.drag||c.pitch||c.rotate;class ql extends o.Event{}class ju{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const h=o.sub([],s,t);this.radius=o.length(h[2]<0?o.div([],h,this.constants):[h[0],h[1],0])}projectRay(t){o.div(t,t,this.constants),o.normalize(t,t),o.mul$1(t,t,this.constants);const s=o.scale$2([],t,this.radius);if(s[2]>0){const h=o.scale$2([],[0,0,1],o.dot(s,[0,0,1])),m=o.scale$2([],o.normalize([],[s[0],s[1],0]),this.radius),_=o.add([],s,o.scale$2([],o.sub([],o.add([],m,h),s),2));s[0]=_[0],s[1]=_[1]}return s}}function Ro(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Gu{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cu(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ju,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[m,_,x]of this._listeners)m.addEventListener(_,m===o.window.document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,s,h]of this._listeners)t.removeEventListener(s,t===o.window.document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(t){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Rp(s,t));const m=s.boxZoom=new zu(s,t);this._add("boxZoom",m);const _=new et,x=new Nu;s.doubleClickZoom=new Ou(x,_),this._add("tapZoom",_),this._add("clickZoom",x);const w=new Zl;this._add("tapDragZoom",w);const A=s.touchPitch=new Sa(s);this._add("touchPitch",A);const I=new Lo(t),z=new Vl(t);s.dragRotate=new Vu(t,I,z),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const R=new ws(t),j=new Pu(s,t);s.dragPan=new Uu(h,R,j),this._add("mousePan",R),this._add("touchPan",j,["touchZoom","touchRotate"]);const X=new Ea,Z=new Du;s.touchZoomRotate=new $u(h,Z,X,w),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Jn(s));const U=s.scrollZoom=new Fu(s,this);this._add("scrollZoom",U,["mousePan"]);const ie=s.keyboard=new Ru;this._add("keyboard",ie);for(const H of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[H]&&s[H].enable(t[H])}_add(t,s,h){this._handlers.push({handlerName:t,handler:s,allowed:h}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ss(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,h){for(const m in t)if(m!==h&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const h of t)this._el.contains(h.target)&&s.push(h);return s}handleEvent(t,s){this._updatingCamera=!0;const h=t.type==="renderFrame",m=h?void 0:t,_={needsRenderFrame:!1},x={},w={},A=t.touches?this._getMapTouches(t.touches):void 0,I=A?Ge(this._el,A):h?void 0:je(this._el,t);for(const{handlerName:j,handler:X,allowed:Z}of this._handlers){if(!X.isEnabled())continue;let U;this._blockedByActive(w,Z,j)?X.reset():X[s||t.type]&&(U=X[s||t.type](t,I,A),this.mergeHandlerResult(_,x,U,j,m),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||X.isActive())&&(w[j]=X)}const z={};for(const j in this._previousActiveHandlers)w[j]||(z[j]=m);this._previousActiveHandlers=w,(Object.keys(z).length||Ro(_))&&(this._changes.push([_,x,z]),this._triggerRenderFrame()),(Object.keys(w).length||Ro(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=_;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(t,s,h,m,_){if(!h)return;o.extend(t,h);const x={handlerName:m,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(s.zoom=x),h.panDelta!==void 0&&(s.drag=x),h.pitchDelta!==void 0&&(s.pitch=x),h.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},h={};for(const[m,_,x]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new o.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),o.extend(s,_),o.extend(h,x);this._updateMapTransform(t,s,h),this._changes=[]}_updateMapTransform(t,s,h){const m=this._map,_=m.transform,x=ee=>[ee.x,ee.y,ee.z];if((ee=>{const te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!Ro(t)){const ee=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",ee!==_.zoom&&this._map._update(!0)}if(!Ro(t))return void this._fireEvents(s,h,!0);let{panDelta:w,zoomDelta:A,bearingDelta:I,pitchDelta:z,around:R,aroundCoord:j,pinchAround:X}=t;X!==void 0&&(R=X),(ee=>s.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=x(_.pointCoordinate3D(R)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",m._stop(!0),R=R||m.transform.centerPoint,I&&(_.bearing+=I),z&&(_.pitch+=z),_._updateCameraState();const Z=[0,0,0];if(w){const ee=_.pointCoordinate(R);if(_.projection.name==="globe"){const te=o.latFromMercatorY(ee.y),re=_.center.lat,Q=Math.min(o.mercatorZfromAltitude(1,te)/o.mercatorZfromAltitude(1,re),2);w=w.rotate(-_.angle),Z[0]=-w.x/_.worldSize*Q,Z[1]=-w.y/_.worldSize*Q}else{const te=_.pointCoordinate(R.sub(w));ee&&te&&(Z[0]=te.x-ee.x,Z[1]=te.y-ee.y)}}const U=_.zoom,ie=[0,0,0];if(A){const ee=x(j||_.pointCoordinate3D(R)),te={dir:o.normalize([],o.sub([],ee,_._camera.position))};if(te.dir[2]<0){const re=_.zoomDeltaToMovement(ee,A);o.scale$2(ie,te.dir,re)}}const H=o.add(Z,Z,ie);_._translateCameraConstrained(H),A&&Math.abs(_.zoom-U)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,h,!0)}_fireEvents(t,s,h){const m=Ss(this._eventsInProgress),_=Ss(t),x={};for(const z in t){const{originalEvent:R}=t[z];this._eventsInProgress[z]||(x[`${z}start`]=R),this._eventsInProgress[z]=t[z]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(const z in x)this._fireEvent(z,x[z]);_&&this._fireEvent("move",_.originalEvent);for(const z in t){const{originalEvent:R}=t[z];this._fireEvent(z,R)}const w={};let A;for(const z in this._eventsInProgress){const{handlerName:R,originalEvent:j}=this._eventsInProgress[z];this._handlersById[R].isActive()||(delete this._eventsInProgress[z],A=s[R]||j,w[`${z}end`]=A)}for(const z in w)this._fireEvent(z,w[z]);const I=Ss(this._eventsInProgress);if(h&&(m||_)&&!I){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;z?(R(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:A})):(this._map.fire(new o.Event("moveend",{originalEvent:A})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new o.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new ql("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Aa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Xl extends o.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,h){return t=o.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,o.extend({offset:t},s),h)}panTo(t,s,h){return this.easeTo(o.extend({center:t},s),h)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,h){return this.easeTo(o.extend({zoom:t},s),h)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,h){return this.easeTo(o.extend({bearing:t},s),h)}resetNorth(t,s){return this.rotateTo(0,o.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=o.LngLatBounds.convert(t);const h=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),h,s)}_extendCameraOptions(t){const s={top:0,bottom:0,right:0,left:0};if(typeof(t=o.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const h=t.padding;t.padding={top:h,bottom:h,right:h,left:h}}return t.padding=o.extend(s,t.padding),t}_cameraForBoxAndBearing(t,s,h,m){const _=this._extendCameraOptions(m),x=this.transform,w=x.padding,A=x.project(o.LngLat.convert(t)),I=x.project(o.LngLat.convert(s)),z=new o.pointGeometry(A.x,I.y),R=new o.pointGeometry(I.x,A.y),j=-o.degToRad(h),X=A.rotate(j),Z=I.rotate(j),U=z.rotate(j),ie=R.rotate(j),H=new o.pointGeometry(Math.max(X.x,Z.x,U.x,ie.x),Math.max(X.y,Z.y,U.y,ie.y)),ee=new o.pointGeometry(Math.min(X.x,Z.x,U.x,ie.x),Math.min(X.y,Z.y,U.y,ie.y)),te=H.sub(ee),re=(x.width-((w.left||0)+(w.right||0)+_.padding.left+_.padding.right))/te.x,Q=(x.height-((w.top||0)+(w.bottom||0)+_.padding.top+_.padding.bottom))/te.y;if(Q<0||re<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const se=Math.min(x.scaleZoom(x.scale*Math.min(re,Q)),_.maxZoom),me=typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new o.pointGeometry(_.offset.x,_.offset.y):o.pointGeometry.convert(_.offset),we=new o.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(h*Math.PI/180),Ae=me.add(we).mult(x.scale/x.zoomScale(se));return{center:x.unproject(A.add(I).div(2).sub(Ae)),zoom:se,bearing:h}}_cameraForBox(t,s,h,m,_){const x=this._extendCameraOptions(_);h=h||0,m=m||0,t=o.LngLat.convert(t),s=o.LngLat.convert(s);const w=this.transform.clone();w.padding=x.padding;const A=this.getFreeCameraOptions(),I=new o.LngLat(.5*(t.lng+s.lng),.5*(t.lat+s.lat)),z=.5*(h+m);if(w._camera.position[2]<o.mercatorZfromAltitude(z,I.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(I),w.setFreeCameraOptions(A);const R=o.MercatorCoordinate.fromLngLat(t),j=o.MercatorCoordinate.fromLngLat(s),X=w.pointRayIntersection(w.centerPoint,z),Z=[(U=w.rayIntersectionCoordinate(X)).x,U.y,U.z];var U;const ie=w.screenPointToMercatorRay(w.centerPoint),H=w.projection.name!=="globe";let ee,te=0;do{const re=Math.floor(w.zoom),Q=1<<re,se=Math.min(Q*R.x,Q*j.x),me=Math.min(Q*R.y,Q*j.y),we=Math.max(Q*R.x,Q*j.x),Ae=Math.max(Q*R.y,Q*j.y),Ee=new o.Aabb([se,me,h],[we,Ae,m]),Ne=o.Frustum.fromInvProjectionMatrix(w.invProjMatrix,w.worldSize,re,H);if(Ee.intersects(Ne)!==2){ee&&(w._camera.position=o.scaleAndAdd([],w._camera.position,ie.dir,-ee),w._updateStateFromCamera());break}const _e=o.sub([],w._camera.position,Z);ee=.5*o.length(_e),w._camera.position=o.scaleAndAdd([],w._camera.position,ie.dir,ee);try{w._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++te<10);return{center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}}fitBounds(t,s,h){return this._fitInternal(this.cameraForBounds(t,s),s,h)}_raycastElevationBox(t,s){const h=this.transform.elevation;if(!h)return;const m=new o.pointGeometry(t.x,s.y),_=new o.pointGeometry(s.x,t.y),x=h.pointCoordinate(t);if(!x)return;const w=h.pointCoordinate(s);if(!w)return;const A=h.pointCoordinate(m);if(!A)return;const I=h.pointCoordinate(_);if(!I)return;const z=new o.MercatorCoordinate(x[0],x[1]).toLngLat(),R=new o.MercatorCoordinate(w[0],w[1]).toLngLat(),j=new o.MercatorCoordinate(A[0],A[1]).toLngLat(),X=new o.MercatorCoordinate(I[0],I[1]).toLngLat(),Z=Math.min(z.lng,Math.min(R.lng,Math.min(j.lng,X.lng))),U=Math.min(z.lat,Math.min(R.lat,Math.min(j.lat,X.lat))),ie=Math.max(z.lng,Math.max(R.lng,Math.max(j.lng,X.lng))),H=Math.max(z.lat,Math.max(R.lat,Math.max(j.lat,X.lat))),ee=Math.min(x[3],Math.min(w[3],Math.min(A[3],I[3]))),te=Math.max(x[3],Math.max(w[3],Math.max(A[3],I[3])));return{minLngLat:new o.LngLat(Z,U),maxLngLat:new o.LngLat(ie,H),minAltitude:ee,maxAltitude:te}}fitScreenCoordinates(t,s,h,m,_){let x,w,A,I;const z=o.pointGeometry.convert(t),R=o.pointGeometry.convert(s),j=this._raycastElevationBox(z,R);if(j)x=j.minLngLat,w=j.maxLngLat,A=j.minAltitude,I=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(z,R))return this;x=this.transform.pointLocation(z),w=this.transform.pointLocation(R)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(t)),this.transform.pointLocation(o.pointGeometry.convert(s)),h,m):this._cameraForBox(x,w,A,I,m),m,_)}_fitInternal(t,s,h){return t?(delete(s=o.extend(t,s)).padding,s.linear?this.easeTo(s,h):this.flyTo(s,h)):this}jumpTo(t,s){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let m=!1,_=!1,x=!1;return"zoom"in t&&h.zoom!==+t.zoom&&(m=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=o.LngLat.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(_=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(x=!0,h.pitch=+t.pitch),t.padding==null||h.isPaddingEqual(t.padding)||(h.padding=t.padding),t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),m&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),_&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),x&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Aa),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return o.warnOnce(Aa),this;this.stop();const m=h.zoom,_=h.pitch,x=h.bearing;h.setFreeCameraOptions(t);const w=m!==h.zoom,A=_!==h.pitch,I=x!==h.bearing;return this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),w&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),I&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),A&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=o.extend({offset:[0,0],duration:500,easing:o.ease},t)).animate===!1||!t.essential&&o.exported.prefersReducedMotion)&&(t.duration=0);const h=this.transform,m=this.getZoom(),_=this.getBearing(),x=this.getPitch(),w=this.getPadding(),A="zoom"in t?+t.zoom:m,I="bearing"in t?this._normalizeBearing(t.bearing,_):_,z="pitch"in t?+t.pitch:x,R="padding"in t?t.padding:h.padding,j=o.pointGeometry.convert(t.offset);let X,Z,U;if(h.projection.name==="globe"){const Ae=o.MercatorCoordinate.fromLngLat(h.center),Ee=j.rotate(-h.angle);Ae.x+=Ee.x/h.worldSize,Ae.y+=Ee.y/h.worldSize;const Ne=Ae.toLngLat(),_e=o.LngLat.convert(t.center||Ne);this._normalizeCenter(_e),X=h.centerPoint.add(Ee),Z=new o.pointGeometry(Ae.x,Ae.y).mult(h.worldSize),U=new o.pointGeometry(o.mercatorXfromLng(_e.lng),o.mercatorYfromLat(_e.lat)).mult(h.worldSize).sub(Z)}else{X=h.centerPoint.add(j);const Ae=h.pointLocation(X),Ee=o.LngLat.convert(t.center||Ae);this._normalizeCenter(Ee),Z=h.project(Ae),U=h.project(Ee).sub(Z)}const ie=h.zoomScale(A-m);let H,ee;t.around&&(H=o.LngLat.convert(t.around),ee=h.locationPoint(H));const te=this._zooming||A!==m,re=this._rotating||_!==I,Q=this._pitching||z!==x,se=!h.isPaddingEqual(R),me=Ae=>Ee=>{if(te&&(Ae.zoom=o.number(m,A,Ee)),re&&(Ae.bearing=o.number(_,I,Ee)),Q&&(Ae.pitch=o.number(x,z,Ee)),se&&(Ae.interpolatePadding(w,R,Ee),X=Ae.centerPoint.add(j)),H)Ae.setLocationAtPoint(H,ee);else{const Ne=Ae.zoomScale(Ae.zoom-m),_e=A>m?Math.min(2,ie):Math.max(.5,ie),Ue=Math.pow(_e,1-Ee),Fe=Ae.unproject(Z.add(U.mult(Ee*Ue)).mult(Ne));Ae.setLocationAtPoint(Ae.renderWorldCopies?Fe.wrap():Fe,X)}return t.preloadOnly||this._fireMoveEvents(s),Ae};if(t.preloadOnly){const Ae=this._emulate(me,t.duration,h);return this._preloadTiles(Ae),this}const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=re,this._pitching=Q,this._padding=se,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,we),this._ease(me(h),Ae=>{h.recenterOnTerrain(),this._afterEase(s,Ae)},t),this}_prepareEase(t,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||h.moving||this.fire(new o.Event("movestart",t)),this._zooming&&!h.zooming&&this.fire(new o.Event("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new o.Event("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new o.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.Event("move",t)),this._zooming&&this.fire(new o.Event("zoom",t)),this._rotating&&this.fire(new o.Event("rotate",t)),this._pitching&&this.fire(new o.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new o.Event("zoomend",t)),m&&this.fire(new o.Event("rotateend",t)),_&&this.fire(new o.Event("pitchend",t)),this.fire(new o.Event("moveend",t))}flyTo(t,s){if(!t.essential&&o.exported.prefersReducedMotion){const it=o.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(it,s)}this.stop(),t=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},t);const h=this.transform,m=this.getZoom(),_=this.getBearing(),x=this.getPitch(),w=this.getPadding(),A="zoom"in t?o.clamp(+t.zoom,h.minZoom,h.maxZoom):m,I="bearing"in t?this._normalizeBearing(t.bearing,_):_,z="pitch"in t?+t.pitch:x,R="padding"in t?t.padding:h.padding,j=h.zoomScale(A-m),X=o.pointGeometry.convert(t.offset);let Z=h.centerPoint.add(X);const U=h.pointLocation(Z),ie=o.LngLat.convert(t.center||U);this._normalizeCenter(ie);const H=h.project(U),ee=h.project(ie).sub(H);let te=t.curve;const re=Math.max(h.width,h.height),Q=re/j,se=ee.mag();if("minZoom"in t){const it=o.clamp(Math.min(t.minZoom,m,A),h.minZoom,h.maxZoom),nt=re/h.zoomScale(it-m);te=Math.sqrt(nt/se*2)}const me=te*te;function we(it){const nt=(Q*Q-re*re+(it?-1:1)*me*me*se*se)/(2*(it?Q:re)*me*se);return Math.log(Math.sqrt(nt*nt+1)-nt)}function Ae(it){return(Math.exp(it)-Math.exp(-it))/2}function Ee(it){return(Math.exp(it)+Math.exp(-it))/2}const Ne=we(0);let _e=function(it){return Ee(Ne)/Ee(Ne+te*it)},Ue=function(it){return re*((Ee(Ne)*(Ae(nt=Ne+te*it)/Ee(nt))-Ae(Ne))/me)/se;var nt},Fe=(we(1)-Ne)/te;if(Math.abs(se)<1e-6||!isFinite(Fe)){if(Math.abs(re-Q)<1e-6)return this.easeTo(t,s);const it=Q<re?-1:1;Fe=Math.abs(Math.log(Q/re))/te,Ue=function(){return 0},_e=function(nt){return Math.exp(it*te*nt)}}t.duration="duration"in t?+t.duration:1e3*Fe/("screenSpeed"in t?+t.screenSpeed/te:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ot=_!==I,Me=z!==x,tt=!h.isPaddingEqual(R),ht=it=>nt=>{const ft=nt*Fe,At=1/_e(ft);it.zoom=nt===1?A:m+it.scaleZoom(At),ot&&(it.bearing=o.number(_,I,nt)),Me&&(it.pitch=o.number(x,z,nt)),tt&&(it.interpolatePadding(w,R,nt),Z=it.centerPoint.add(X));const lt=nt===1?ie:it.unproject(H.add(ee.mult(Ue(ft))).mult(At));return it.setLocationAtPoint(it.renderWorldCopies?lt.wrap():lt,Z),it._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),it};if(t.preloadOnly){const it=this._emulate(ht,t.duration,h);return this._preloadTiles(it),this}return this._zooming=!0,this._rotating=ot,this._pitching=Me,this._padding=tt,this._prepareEase(s,!1),this._ease(ht(h),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,s,h){h.animate===!1||h.duration===0?(t(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=o.wrap(t,-180,180);const h=Math.abs(t-s);return Math.abs(t-360-s)<h&&(t-=360),Math.abs(t+360-s)<h&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;const h=t.lng-s.center.lng;t.lng+=h>180?-360:h<-180?360:0}_emulate(t,s,h){const m=Math.ceil(15*s/1e3),_=[],x=t(h.clone());for(let w=0;w<=m;w++){const A=x(w/m);_.push(A.clone())}return _}}class Ma{constructor(t={}){this.options=t,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact;return this._map=t,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G("button","mapboxgl-ctrl-attrib-button",this._container),G("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const h=this._map._getUIString(`AttributionControl.${s}`);t.setAttribute("aria-label",h),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(t){const h=s.reduce((m,_,x)=>(_.value&&(m+=`${_.key}=${_.value}${x<s.length-1?"&":""}`),m),"?");t.href=`${o.config.FEEDBACK_URL}/${h}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._sourceCaches;for(const m in s){const _=s[m];if(_.used){const x=_.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((m,_)=>m.length-_.length),t=t.filter((m,_)=>{for(let x=_+1;x<t.length;x++)if(t[x].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Zu{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=G("div","mapboxgl-ctrl");const s=G("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const h=t[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class qu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const m of h)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ia(c,t,s){if(c=new o.LngLat(c.lng,c.lat),t){const h=new o.LngLat(c.lng-360,c.lat),m=new o.LngLat(c.lng+360,c.lat),_=360*Math.ceil(Math.abs(c.lng-s.center.lng)/360),x=s.locationPoint(c).distSqr(t),w=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint(h).distSqr(t)<x&&(w||Math.abs(h.lng-s.center.lng)<_)?c=h:s.locationPoint(m).distSqr(t)<x&&(w||Math.abs(m.lng-s.center.lng)<_)&&(c=m)}for(;Math.abs(c.lng-s.center.lng)>180;){const h=s.locationPoint(c);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;c.lng>s.center.lng?c.lng-=360:c.lng+=360}return c}const Ca={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class za extends o.Evented{constructor(t,s){if(super(),(t instanceof o.window.HTMLElement||s)&&(t=o.extend({element:t},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=o.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=G("div");const m=41,_=27,x=J("svg",{display:"block",height:m*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${m}`},this._element),w=J("radialGradient",{id:"shadowGradient"},J("defs",{},x));J("stop",{offset:"10%","stop-opacity":.4},w),J("stop",{offset:"100%","stop-opacity":.05},w),J("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},x),J("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},x),J("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},x),J("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},x),this._offset=o.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const h=this._element.classList;for(const m in Ca)h.remove(`mapboxgl-marker-anchor-${m}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,h=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(s);let m=!1;if(t.transform._terrainEnabled()&&t.getTerrain()){const x=t.getFreeCameraOptions();if(x.position){const w=x.position.toLngLat();m=w.distanceTo(h)<.9*w.distanceTo(this._lngLat)}}const _=(1-t._queryFogOpacity(h))*(m?.2:1);this._element.style.opacity=`${_}`,this._popup&&this._popup._setOpacity(`${_}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t)return;const s=this._offset.mult(this._scale),h=this._calculatePitch(),m=this._calculateRotation();this._element.style.transform=`
            translate(${t.x}px, ${t.y}px) ${Ca[this._anchor]}
            rotateX(${h}deg) rotateZ(${m}deg)
            translate(${s.x}px, ${s.y}px)
        `}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._map&&this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._map&&this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(t){o.window.cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=Ia(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),t===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!s.getTerrain()&&!s.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=o.pointGeometry.convert(t),this._update(),this}_onMove(t){const s=this._map;if(s){if(!this._isDragging){const h=this._clickTolerance||s._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map;s&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Bp{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=o.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,h){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+h}}const Fp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Wl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function As(c){c.parentNode&&c.parentNode.removeChild(c)}const Hl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yl{constructor(t,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Lo({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new Vl({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),We()}move(t,s){const h=this.map,m=this.mouseRotate.mousemoveWindow(t,s),_=m&&m.bearingDelta;if(_&&h.setBearing(h.getBearing()+_),this.mousePitch){const x=this.mousePitch.mousemoveWindow(t,s),w=x&&x.pitchDelta;w&&h.setPitch(h.getPitch()+w)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Xe(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(o.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),je(this.element,t)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,je(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ge(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Ge(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Gi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let en,Ms=0,no=!1;const Kl={maxWidth:100,unit:"metric"};function ka(c,t,s){const h=s&&s.maxWidth||100,m=c._containerHeight/2,_=c._containerWidth/2-h/2,x=c.unproject([_,m]),w=c.unproject([_+h,m]),A=x.distanceTo(w);if(s&&s.unit==="imperial"){const I=3.2808*A;I>5280?Bo(t,h,I/5280,c._getUIString("ScaleControl.Miles"),c):Bo(t,h,I,c._getUIString("ScaleControl.Feet"),c)}else s&&s.unit==="nautical"?Bo(t,h,A/1852,c._getUIString("ScaleControl.NauticalMiles"),c):A>=1e3?Bo(t,h,A/1e3,c._getUIString("ScaleControl.Kilometers"),c):Bo(t,h,A,c._getUIString("ScaleControl.Meters"),c)}function Bo(c,t,s,h,m){const _=function(w){const A=Math.pow(10,`${Math.floor(w)}`.length-1);let I=w/A;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(z){const R=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*R)/R}(I),A*I}(s),x=_/s;m._requestDomTask(()=>{c.style.width=t*x+"px",c.innerHTML=`${_}&nbsp;${h}`})}const pn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ti=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Is(c=new o.pointGeometry(0,0),t="bottom"){if(typeof c=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new o.pointGeometry(0,c);case"top-left":return new o.pointGeometry(s,s);case"top-right":return new o.pointGeometry(-s,s);case"bottom":return new o.pointGeometry(0,-c);case"bottom-left":return new o.pointGeometry(s,-s);case"bottom-right":return new o.pointGeometry(-s,-s);case"left":return new o.pointGeometry(c,0);case"right":return new o.pointGeometry(-c,0)}return new o.pointGeometry(0,0)}return c instanceof o.pointGeometry||Array.isArray(c)?o.pointGeometry.convert(c):o.pointGeometry.convert(c[t]||[0,0])}const Fo={version:o.version,supported:O,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Xl{constructor(c){if((c=o.extend({},Wl,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(c.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ba(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._renderTaskQueue=new qu,this._domRenderTaskQueue=new qu,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Fp,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bp(0),this._explicitProjection=null,this._requestManager=new o.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=o.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Gu(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new Eu(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new Ma({customAttribution:c.customAttribution})),this._logoControl=new Zu,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new o.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new o.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=c.onAdd(this);this._controls.push(c);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.Event("movestart",c)).fire(new o.Event("move",c)),this.fire(new o.Event("resize",c)),t&&this.fire(new o.Event("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(o.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?85:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._updateProjection(c)}_updateProjection(c){c===null&&(this._explicitProjection=null);const t=c||this.getProjection(),s=this.transform.setProjection(t);if(c&&(this._explicitProjection=this.transform.getProjection()),s){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(c){return this.transform.locationPoint3D(o.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(o.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(c,t,s){if(c==="mouseenter"||c==="mouseover"){let h=!1;const m=x=>{const w=t.filter(I=>this.getLayer(I)),A=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];A.length?h||(h=!0,s.call(this,new Qi(c,this,x.originalEvent,{features:A}))):h=!1},_=()=>{h=!1};return{layers:new Set(t),listener:s,delegates:{mousemove:m,mouseout:_}}}if(c==="mouseleave"||c==="mouseout"){let h=!1;const m=x=>{const w=t.filter(A=>this.getLayer(A));(w.length?this.queryRenderedFeatures(x.point,{layers:w}):[]).length?h=!0:h&&(h=!1,s.call(this,new Qi(c,this,x.originalEvent)))},_=x=>{h&&(h=!1,s.call(this,new Qi(c,this,x.originalEvent)))};return{layers:new Set(t),listener:s,delegates:{mousemove:m,mouseout:_}}}{const h=m=>{const _=t.filter(w=>this.getLayer(w)),x=_.length?this.queryRenderedFeatures(m.point,{layers:_}):[];x.length&&(m.features=x,s.call(this,m),delete m.features)};return{layers:new Set(t),listener:s,delegates:{[c]:h}}}}on(c,t,s){if(s===void 0)return super.on(c,t);Array.isArray(t)||(t=[t]);const h=this._createDelegatedListener(c,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(c,t,s){if(s===void 0)return super.once(c,t);Array.isArray(t)||(t=[t]);const h=this._createDelegatedListener(c,t,s);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(c,t,s){if(s===void 0)return super.off(c,t);t=new Set(Array.isArray(t)?t:[t]);const h=(_,x)=>{if(_.size!==x.size)return!1;for(const w of _)if(!x.has(w))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[c]:void 0;return m&&(_=>{for(let x=0;x<_.length;x++){const w=_[x];if(w.listener===s&&h(w.layers,t)){for(const A in w.delegates)this.off(A,w.delegates[A]);return _.splice(x,1),this}}})(m),this}queryRenderedFeatures(c,t){return this.style?(t!==void 0||c===void 0||c instanceof o.pointGeometry||Array.isArray(c)||(t=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(c,t){return this.style.querySourceFeatures(c,t)}queryTerrainElevation(c,t){const s=this.transform.elevation;return s?(t=o.extend({},{exaggerated:!0},t),s.getAtPoint(o.MercatorCoordinate.fromLngLat(c),null,t.exaggerated)):null}setStyle(c,t){return(t=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new ji(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ji(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,t){if(typeof c=="string"){const s=this._requestManager.normalizeStyleURL(c),h=this._requestManager.transformRequest(s,o.ResourceType.Style);o.getJSON(h,(m,_)=>{m?this.fire(new o.ErrorEvent(m)):_&&this._updateDiff(_,t)})}else typeof c=="object"&&this._updateDiff(c,t)}_updateDiff(c,t){try{this.style.setState(c)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(c,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(c,t){return this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const t in c){const s=c[t]._tiles;for(const h in s){const m=s[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(c,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,s)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,t,{pixelRatio:s=1,sdf:h=!1,stretchX:m,stretchY:_,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&t instanceof o.window.ImageBitmap){const{width:w,height:A,data:I}=o.exported.getImageData(t);this.style.addImage(c,{data:new o.RGBAImage({width:w,height:A},I),pixelRatio:s,stretchX:m,stretchY:_,content:x,sdf:h,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:w,height:A}=t,I=t;this.style.addImage(c,{data:new o.RGBAImage({width:w,height:A},new Uint8Array(I.data)),pixelRatio:s,stretchX:m,stretchY:_,content:x,sdf:h,version:0,userImage:I}),I.onAdd&&I.onAdd(this,c)}}updateImage(c,t){const s=this.style.getImage(c);if(!s)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=t instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&t instanceof o.window.ImageBitmap?o.exported.getImageData(t):t,{width:m,height:_}=h;m!==void 0&&_!==void 0?m===s.data.width&&_===s.data.height?(s.data.replace(h.data,!(t instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&t instanceof o.window.ImageBitmap)),this.style.updateImage(c,s)):this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,t){o.getImage(this._requestManager.transformRequest(c,o.ResourceType.Image),(s,h)=>{t(s,h instanceof o.window.HTMLImageElement?o.exported.getImageData(h):h)})}listImages(){return this.style.listImages()}addLayer(c,t){return this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)}moveLayer(c,t){return this.style.moveLayer(c,t),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,t,s){return this.style.setLayerZoomRange(c,t,s),this._update(!0)}setFilter(c,t,s={}){return this.style.setFilter(c,t,s),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,t,s,h={}){return this.style.setPaintProperty(c,t,s,h),this._update(!0)}getPaintProperty(c,t){return this.style.getPaintProperty(c,t)}setLayoutProperty(c,t,s,h={}){return this.style.setLayoutProperty(c,t,s,h),this._update(!0)}getLayoutProperty(c,t){return this.style.getLayoutProperty(c,t)}setLight(c,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(c),this.transform):0}setFeatureState(c,t){return this.style.setFeatureState(c,t),this._update()}removeFeatureState(c,t){return this.style.removeFeatureState(c,t),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,h,m,_=this._container;for(;_&&(!h||!m);){const x=o.window.getComputedStyle(_).transform;x&&x!=="none"&&(s=x.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),_=_.parentElement}this._containerWidth=h?Math.abs(c/h):c,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=G("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=G("div","mapboxgl-canvas-container",c);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=G("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=G("div","mapboxgl-control-container",c),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{h[m]=G("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const s=o.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(c),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const c=o.extend({},O.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);t?(o.storeAuthState(t,!0),this.painter=new wu(t,this.transform),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(t)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;const s=this.painter.context.extTimerQuery,h=o.exported.now();if(this.listens("gpu-timing-frame")&&(t=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;let m=!1;const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,I=this.transform.pitch,z=o.exported.now();this.style.zoomHistory.update(A,z);const R=new o.EvaluationParameters(A,{now:z,fadeDuration:_,pitch:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=R.crossFadingFactor();j===1&&j===this._crossFadingFactor||(m=!0,this._crossFadingFactor=j),this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(h),this.style._updateSources(this.transform),this._forceMarkerUpdate()):x=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const A=o.exported.now()-h;s.endQueryEXT(s.TIME_ELAPSED_EXT,t),setTimeout(()=>{const I=s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(t),this.fire(new o.Event("gpu-timing-frame",{cpuTime:A,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(A);this.fire(new o.Event("gpu-timing-layer",{layerTimes:I}))},50)}const w=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(w||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(x=this._updateAverageElevation(h,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||w||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const c of this._markers)c._update()}_updateAverageElevation(c,t=!1){const s=h=>(this.transform.averageElevation=h,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const h=this.transform.averageElevation;let m=this.transform.sampleAverageElevation(),_=!1;this.transform.elevation&&(_=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=c;const x=Math.abs(h-m);if(x>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(m),s(m);this._averageElevation.easeTo(m,c,300)}else if(x>1e-4)return this._averageElevation.jumpTo(m),s(m)}return!!this._averageElevation.isEasing(c)&&s(this._averageElevation.getValue(c))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===o.AUTH_ERR_MSG||c.status===401)){const t=this.painter.context.gl;o.storeAuthState(t,!1),this._logoControl instanceof Zu&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function m(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);const x=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,x),x}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(m(c),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(c,t,s){let h=s[1]-s[0];const m=c.length/4;for(let _=0;_<t.length;_++){const x=t[_];let w=0;for(let A=0;A<x.length;A+=4)x[A]===c[A]&&x[A+1]===c[A+1]&&x[A+2]===c[A+2]&&x[A+3]===c[A+3]&&(w+=1);h+=(s[_+2]-s[_+1])*(1-w/m)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),As(this._canvasContainer),As(this._controlContainer),As(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=o.exported.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(c){const t=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(t,(s,h)=>s._preloadTiles(c,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,t){o.setCacheLimits(c,t)}get version(){return o.version}},NavigationControl:class{constructor(c){this.options=o.extend({},Hl,c),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),G("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),G("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=G("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),s=t===c.getMaxZoom(),h=t===c.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yl(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const s=G("button",c,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(c,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",s),c.firstElementChild&&c.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.Evented{constructor(c){super(),this.options=o.extend({},Gi,c),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ul(this._updateMarkerRotation,20)}onAdd(c){var t;return this._map=c,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,en!==void 0?t(en):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(s=>{en=s.state!=="denied",t(en)}):(en=!!o.window.navigator.geolocation,t(en)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Ms=0,no=!1}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),s=c.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",c)),this._finish()}}_updateCamera(c){const t=new o.LngLat(c.coords.longitude,c.coords.latitude),s=c.coords.accuracy,h=this._map.getBearing(),m=o.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new o.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map._containerHeight/2,t=this._map.unproject([0,c]),s=this._map.unproject([100,c]),h=t.distanceTo(s)/100,m=Math.ceil(2*this._accuracy/h);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&no)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=G("button","mapboxgl-ctrl-geolocate",this._container),G("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G("div","mapboxgl-user-location"),this._dotElement.appendChild(G("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(G("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new za({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=G("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new za({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ms--,no=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ms++,Ms>1?(c={maximumAge:6e5,timeout:0},no=!0):(c=this.options.positionOptions,no=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&c()}).catch(console.error):c()}_clearWatch(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ma,ScaleControl:class{constructor(c){this.options=o.extend({},Kl,c),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){ka(this._map,this._container,this.options)}onAdd(c){return this._map=c,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(c){this.options.unit=c,ka(this._map,this._container,this.options)}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof o.window.HTMLElement?this._container=c.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=G("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(c){super(),this.options=o.extend(Object.create(pn),c),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=o.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(o.window.document.createTextNode(c))}setHTML(c){const t=o.window.document.createDocumentFragment(),s=o.window.document.createElement("body");let h;for(s.innerHTML=c;h=s.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=G("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const s=this._closeButton=G("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,h=this._pos;if(!t||!s||!h)return"bottom";const m=s.offsetWidth,_=s.offsetHeight,x=h.x<m/2,w=h.x>t.transform.width-m/2;if(h.y+c<_)return x?"top-left":w?"top-right":"top";if(h.y>t.transform.height-_){if(x)return"bottom-left";if(w)return"bottom-right"}return x?"left":w?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=G("div","mapboxgl-popup",t.getContainer()),this._tip=G("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ia(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const m=this._pos=this._trackPointer&&c?c:t.project(this._lngLat),_=Is(this.options.offset),x=this._anchor=this._getAnchor(_.y),w=Is(this.options.offset,x),A=m.add(w).round();t._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${Ca[x]} translate(${A.x}px,${A.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(ti);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._content&&(this._content.style.opacity=c),this._tip&&(this._tip.style.opacity=c)}},Marker:za,Style:ji,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:gs,Evented:o.Evented,config:o.config,prewarm:function(){_t().acquire(dt)},clearPrewarmedResources:function(){const c=ut;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(dt),ut=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(c){o.config.ACCESS_TOKEN=c},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(c){o.config.API_URL=c},get workerCount(){return ct.workerCount},set workerCount(c){ct.workerCount=c},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){o.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){o.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Fo});var k=E;return k})})(Ey);var dA=Ey.exports;function Uh(l,d){return l==null||d==null?NaN:l<d?-1:l>d?1:l>=d?0:NaN}function b1(l,d){return l==null||d==null?NaN:d<l?-1:d>l?1:d>=l?0:NaN}function Ay(l){let d,y,b;l.length!==2?(d=Uh,y=(o,O)=>Uh(l(o),O),b=(o,O)=>l(o)-O):(d=l===Uh||l===b1?l:w1,y=l,b=l);function E(o,O,B=0,$=o.length){if(B<$){if(d(O,O)!==0)return $;do{const D=B+$>>>1;y(o[D],O)<0?B=D+1:$=D}while(B<$)}return B}function C(o,O,B=0,$=o.length){if(B<$){if(d(O,O)!==0)return $;do{const D=B+$>>>1;y(o[D],O)<=0?B=D+1:$=D}while(B<$)}return B}function k(o,O,B=0,$=o.length){const D=E(o,O,B,$-1);return D>B&&b(o[D-1],O)>-b(o[D],O)?D-1:D}return{left:E,center:k,right:C}}function w1(){return 0}function T1(l){return l===null?NaN:+l}const E1=Ay(Uh),S1=E1.right;Ay(T1).center;var A1=S1;function fA(l,d){let y,b;if(d===void 0)for(const E of l)E!=null&&(y===void 0?E>=E&&(y=b=E):(y>E&&(y=E),b<E&&(b=E)));else{let E=-1;for(let C of l)(C=d(C,++E,l))!=null&&(y===void 0?C>=C&&(y=b=C):(y>C&&(y=C),b<C&&(b=C)))}return[y,b]}class js{constructor(){this._partials=new Float64Array(32),this._n=0}add(d){const y=this._partials;let b=0;for(let E=0;E<this._n&&E<32;E++){const C=y[E],k=d+C,o=Math.abs(d)<Math.abs(C)?d-(k-C):C-(k-d);o&&(y[b++]=o),d=k}return y[b]=d,this._n=b+1,this}valueOf(){const d=this._partials;let y=this._n,b,E,C,k=0;if(y>0){for(k=d[--y];y>0&&(b=k,E=d[--y],k=b+E,C=E-(k-b),!C););y>0&&(C<0&&d[y-1]<0||C>0&&d[y-1]>0)&&(E=C*2,b=k+E,E==b-k&&(k=b))}return k}}var rf=Math.sqrt(50),of=Math.sqrt(10),sf=Math.sqrt(2);function M1(l,d,y){var b,E=-1,C,k,o;if(d=+d,l=+l,y=+y,l===d&&y>0)return[l];if((b=d<l)&&(C=l,l=d,d=C),(o=My(l,d,y))===0||!isFinite(o))return[];if(o>0){let O=Math.round(l/o),B=Math.round(d/o);for(O*o<l&&++O,B*o>d&&--B,k=new Array(C=B-O+1);++E<C;)k[E]=(O+E)*o}else{o=-o;let O=Math.round(l*o),B=Math.round(d*o);for(O/o<l&&++O,B/o>d&&--B,k=new Array(C=B-O+1);++E<C;)k[E]=(O+E)/o}return b&&k.reverse(),k}function My(l,d,y){var b=(d-l)/Math.max(0,y),E=Math.floor(Math.log(b)/Math.LN10),C=b/Math.pow(10,E);return E>=0?(C>=rf?10:C>=of?5:C>=sf?2:1)*Math.pow(10,E):-Math.pow(10,-E)/(C>=rf?10:C>=of?5:C>=sf?2:1)}function I1(l,d,y){var b=Math.abs(d-l)/Math.max(0,y),E=Math.pow(10,Math.floor(Math.log(b)/Math.LN10)),C=b/E;return C>=rf?E*=10:C>=of?E*=5:C>=sf&&(E*=2),d<l?-E:E}function*C1(l){for(const d of l)yield*d}function Iy(l){return Array.from(C1(l))}var ci=1e-6,z1=1e-12,Ht=Math.PI,Gn=Ht/2,ug=Ht/4,qn=Ht*2,rr=180/Ht,an=Ht/180,_i=Math.abs,k1=Math.atan,nl=Math.atan2,bi=Math.cos,pi=Math.sin,Vh=Math.sign||function(l){return l>0?1:l<0?-1:0},mo=Math.sqrt;function P1(l){return l>1?0:l<-1?Ht:Math.acos(l)}function Gs(l){return l>1?Gn:l<-1?-Gn:Math.asin(l)}function Zn(){}function Xh(l,d){l&&pg.hasOwnProperty(l.type)&&pg[l.type](l,d)}var hg={Feature:function(l,d){Xh(l.geometry,d)},FeatureCollection:function(l,d){for(var y=l.features,b=-1,E=y.length;++b<E;)Xh(y[b].geometry,d)}},pg={Sphere:function(l,d){d.sphere()},Point:function(l,d){l=l.coordinates,d.point(l[0],l[1],l[2])},MultiPoint:function(l,d){for(var y=l.coordinates,b=-1,E=y.length;++b<E;)l=y[b],d.point(l[0],l[1],l[2])},LineString:function(l,d){af(l.coordinates,d,0)},MultiLineString:function(l,d){for(var y=l.coordinates,b=-1,E=y.length;++b<E;)af(y[b],d,0)},Polygon:function(l,d){dg(l.coordinates,d)},MultiPolygon:function(l,d){for(var y=l.coordinates,b=-1,E=y.length;++b<E;)dg(y[b],d)},GeometryCollection:function(l,d){for(var y=l.geometries,b=-1,E=y.length;++b<E;)Xh(y[b],d)}};function af(l,d,y){var b=-1,E=l.length-y,C;for(d.lineStart();++b<E;)C=l[b],d.point(C[0],C[1],C[2]);d.lineEnd()}function dg(l,d){var y=-1,b=l.length;for(d.polygonStart();++y<b;)af(l[y],d,1);d.polygonEnd()}function Ka(l,d){l&&hg.hasOwnProperty(l.type)?hg[l.type](l,d):Xh(l,d)}function lf(l){return[nl(l[1],l[0]),Gs(l[2])]}function rl(l){var d=l[0],y=l[1],b=bi(y);return[b*bi(d),b*pi(d),pi(y)]}function Mh(l,d){return l[0]*d[0]+l[1]*d[1]+l[2]*d[2]}function Wh(l,d){return[l[1]*d[2]-l[2]*d[1],l[2]*d[0]-l[0]*d[2],l[0]*d[1]-l[1]*d[0]]}function Gd(l,d){l[0]+=d[0],l[1]+=d[1],l[2]+=d[2]}function Ih(l,d){return[l[0]*d,l[1]*d,l[2]*d]}function cf(l){var d=mo(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);l[0]/=d,l[1]/=d,l[2]/=d}function uf(l,d){function y(b,E){return b=l(b,E),d(b[0],b[1])}return l.invert&&d.invert&&(y.invert=function(b,E){return b=d.invert(b,E),b&&l.invert(b[0],b[1])}),y}function hf(l,d){return[_i(l)>Ht?l+Math.round(-l/qn)*qn:l,d]}hf.invert=hf;function D1(l,d,y){return(l%=qn)?d||y?uf(mg(l),_g(d,y)):mg(l):d||y?_g(d,y):hf}function fg(l){return function(d,y){return d+=l,[d>Ht?d-qn:d<-Ht?d+qn:d,y]}}function mg(l){var d=fg(l);return d.invert=fg(-l),d}function _g(l,d){var y=bi(l),b=pi(l),E=bi(d),C=pi(d);function k(o,O){var B=bi(O),$=bi(o)*B,D=pi(o)*B,G=pi(O),J=G*y+$*b;return[nl(D*E-J*C,$*y-G*b),Gs(J*E+D*C)]}return k.invert=function(o,O){var B=bi(O),$=bi(o)*B,D=pi(o)*B,G=pi(O),J=G*E-D*C;return[nl(D*E+G*C,$*y+J*b),Gs(J*y-$*b)]},k}function L1(l,d,y,b,E,C){if(!!y){var k=bi(d),o=pi(d),O=b*y;E==null?(E=d+b*qn,C=d-O/2):(E=gg(k,E),C=gg(k,C),(b>0?E<C:E>C)&&(E+=b*qn));for(var B,$=E;b>0?$>C:$<C;$-=O)B=lf([k,-o*bi($),-o*pi($)]),l.point(B[0],B[1])}}function gg(l,d){d=rl(d),d[0]-=l,cf(d);var y=P1(-d[1]);return((-d[2]<0?-y:y)+qn-ci)%qn}function Cy(){var l=[],d;return{point:function(y,b,E){d.push([y,b,E])},lineStart:function(){l.push(d=[])},lineEnd:Zn,rejoin:function(){l.length>1&&l.push(l.pop().concat(l.shift()))},result:function(){var y=l;return l=[],d=null,y}}}function $h(l,d){return _i(l[0]-d[0])<ci&&_i(l[1]-d[1])<ci}function Ch(l,d,y,b){this.x=l,this.z=d,this.o=y,this.e=b,this.v=!1,this.n=this.p=null}function zy(l,d,y,b,E){var C=[],k=[],o,O;if(l.forEach(function(xe){if(!((Pe=xe.length-1)<=0)){var Pe,ve=xe[0],We=xe[Pe],Xe;if($h(ve,We)){if(!ve[2]&&!We[2]){for(E.lineStart(),o=0;o<Pe;++o)E.point((ve=xe[o])[0],ve[1]);E.lineEnd();return}We[0]+=2*ci}C.push(Xe=new Ch(ve,xe,null,!0)),k.push(Xe.o=new Ch(ve,null,Xe,!1)),C.push(Xe=new Ch(We,xe,null,!1)),k.push(Xe.o=new Ch(We,null,Xe,!0))}}),!!C.length){for(k.sort(d),yg(C),yg(k),o=0,O=k.length;o<O;++o)k[o].e=y=!y;for(var B=C[0],$,D;;){for(var G=B,J=!0;G.v;)if((G=G.n)===B)return;$=G.z,E.lineStart();do{if(G.v=G.o.v=!0,G.e){if(J)for(o=0,O=$.length;o<O;++o)E.point((D=$[o])[0],D[1]);else b(G.x,G.n.x,1,E);G=G.n}else{if(J)for($=G.p.z,o=$.length-1;o>=0;--o)E.point((D=$[o])[0],D[1]);else b(G.x,G.p.x,-1,E);G=G.p}G=G.o,$=G.z,J=!J}while(!G.v);E.lineEnd()}}}function yg(l){if(!!(d=l.length)){for(var d,y=0,b=l[0],E;++y<d;)b.n=E=l[y],E.p=b,b=E;b.n=E=l[0],E.p=b}}function Zd(l){return _i(l[0])<=Ht?l[0]:Vh(l[0])*((_i(l[0])+Ht)%qn-Ht)}function R1(l,d){var y=Zd(d),b=d[1],E=pi(b),C=[pi(y),-bi(y),0],k=0,o=0,O=new js;E===1?b=Gn+ci:E===-1&&(b=-Gn-ci);for(var B=0,$=l.length;B<$;++B)if(!!(G=(D=l[B]).length))for(var D,G,J=D[G-1],xe=Zd(J),Pe=J[1]/2+ug,ve=pi(Pe),We=bi(Pe),Xe=0;Xe<G;++Xe,xe=He,ve=Ge,We=Tt,J=Ze){var Ze=D[Xe],He=Zd(Ze),je=Ze[1]/2+ug,Ge=pi(je),Tt=bi(je),yt=He-xe,xt=yt>=0?1:-1,St=xt*yt,Ie=St>Ht,rt=ve*Ge;if(O.add(nl(rt*xt*pi(St),We*Tt+rt*bi(St))),k+=Ie?yt+xt*qn:yt,Ie^xe>=y^He>=y){var Je=Wh(rl(J),rl(Ze));cf(Je);var vt=Wh(C,Je);cf(vt);var Be=(Ie^yt>=0?-1:1)*Gs(vt[2]);(b>Be||b===Be&&(Je[0]||Je[1]))&&(o+=Ie^yt>=0?1:-1)}}return(k<-ci||k<ci&&O<-z1)^o&1}function ky(l,d,y,b){return function(E){var C=d(E),k=Cy(),o=d(k),O=!1,B,$,D,G={point:J,lineStart:Pe,lineEnd:ve,polygonStart:function(){G.point=We,G.lineStart=Xe,G.lineEnd=Ze,$=[],B=[]},polygonEnd:function(){G.point=J,G.lineStart=Pe,G.lineEnd=ve,$=Iy($);var He=R1(B,b);$.length?(O||(E.polygonStart(),O=!0),zy($,F1,He,y,E)):He&&(O||(E.polygonStart(),O=!0),E.lineStart(),y(null,null,1,E),E.lineEnd()),O&&(E.polygonEnd(),O=!1),$=B=null},sphere:function(){E.polygonStart(),E.lineStart(),y(null,null,1,E),E.lineEnd(),E.polygonEnd()}};function J(He,je){l(He,je)&&E.point(He,je)}function xe(He,je){C.point(He,je)}function Pe(){G.point=xe,C.lineStart()}function ve(){G.point=J,C.lineEnd()}function We(He,je){D.push([He,je]),o.point(He,je)}function Xe(){o.lineStart(),D=[]}function Ze(){We(D[0][0],D[0][1]),o.lineEnd();var He=o.clean(),je=k.result(),Ge,Tt=je.length,yt,xt,St;if(D.pop(),B.push(D),D=null,!!Tt){if(He&1){if(xt=je[0],(yt=xt.length-1)>0){for(O||(E.polygonStart(),O=!0),E.lineStart(),Ge=0;Ge<yt;++Ge)E.point((St=xt[Ge])[0],St[1]);E.lineEnd()}return}Tt>1&&He&2&&je.push(je.pop().concat(je.shift())),$.push(je.filter(B1))}}return G}}function B1(l){return l.length>1}function F1(l,d){return((l=l.x)[0]<0?l[1]-Gn-ci:Gn-l[1])-((d=d.x)[0]<0?d[1]-Gn-ci:Gn-d[1])}var xg=ky(function(){return!0},O1,U1,[-Ht,-Gn]);function O1(l){var d=NaN,y=NaN,b=NaN,E;return{lineStart:function(){l.lineStart(),E=1},point:function(C,k){var o=C>0?Ht:-Ht,O=_i(C-d);_i(O-Ht)<ci?(l.point(d,y=(y+k)/2>0?Gn:-Gn),l.point(b,y),l.lineEnd(),l.lineStart(),l.point(o,y),l.point(C,y),E=0):b!==o&&O>=Ht&&(_i(d-b)<ci&&(d-=b*ci),_i(C-o)<ci&&(C-=o*ci),y=N1(d,y,C,k),l.point(b,y),l.lineEnd(),l.lineStart(),l.point(o,y),E=0),l.point(d=C,y=k),b=o},lineEnd:function(){l.lineEnd(),d=y=NaN},clean:function(){return 2-E}}}function N1(l,d,y,b){var E,C,k=pi(l-y);return _i(k)>ci?k1((pi(d)*(C=bi(b))*pi(y)-pi(b)*(E=bi(d))*pi(l))/(E*C*k)):(d+b)/2}function U1(l,d,y,b){var E;if(l==null)E=y*Gn,b.point(-Ht,E),b.point(0,E),b.point(Ht,E),b.point(Ht,0),b.point(Ht,-E),b.point(0,-E),b.point(-Ht,-E),b.point(-Ht,0),b.point(-Ht,E);else if(_i(l[0]-d[0])>ci){var C=l[0]<d[0]?Ht:-Ht;E=y*C/2,b.point(-C,E),b.point(0,E),b.point(C,E)}else b.point(d[0],d[1])}function V1(l){var d=bi(l),y=6*an,b=d>0,E=_i(d)>ci;function C($,D,G,J){L1(J,l,y,G,$,D)}function k($,D){return bi($)*bi(D)>d}function o($){var D,G,J,xe,Pe;return{lineStart:function(){xe=J=!1,Pe=1},point:function(ve,We){var Xe=[ve,We],Ze,He=k(ve,We),je=b?He?0:B(ve,We):He?B(ve+(ve<0?Ht:-Ht),We):0;if(!D&&(xe=J=He)&&$.lineStart(),He!==J&&(Ze=O(D,Xe),(!Ze||$h(D,Ze)||$h(Xe,Ze))&&(Xe[2]=1)),He!==J)Pe=0,He?($.lineStart(),Ze=O(Xe,D),$.point(Ze[0],Ze[1])):(Ze=O(D,Xe),$.point(Ze[0],Ze[1],2),$.lineEnd()),D=Ze;else if(E&&D&&b^He){var Ge;!(je&G)&&(Ge=O(Xe,D,!0))&&(Pe=0,b?($.lineStart(),$.point(Ge[0][0],Ge[0][1]),$.point(Ge[1][0],Ge[1][1]),$.lineEnd()):($.point(Ge[1][0],Ge[1][1]),$.lineEnd(),$.lineStart(),$.point(Ge[0][0],Ge[0][1],3)))}He&&(!D||!$h(D,Xe))&&$.point(Xe[0],Xe[1]),D=Xe,J=He,G=je},lineEnd:function(){J&&$.lineEnd(),D=null},clean:function(){return Pe|(xe&&J)<<1}}}function O($,D,G){var J=rl($),xe=rl(D),Pe=[1,0,0],ve=Wh(J,xe),We=Mh(ve,ve),Xe=ve[0],Ze=We-Xe*Xe;if(!Ze)return!G&&$;var He=d*We/Ze,je=-d*Xe/Ze,Ge=Wh(Pe,ve),Tt=Ih(Pe,He),yt=Ih(ve,je);Gd(Tt,yt);var xt=Ge,St=Mh(Tt,xt),Ie=Mh(xt,xt),rt=St*St-Ie*(Mh(Tt,Tt)-1);if(!(rt<0)){var Je=mo(rt),vt=Ih(xt,(-St-Je)/Ie);if(Gd(vt,Tt),vt=lf(vt),!G)return vt;var Be=$[0],mt=D[0],Pt=$[1],Rt=D[1],It;mt<Be&&(It=Be,Be=mt,mt=It);var Di=mt-Be,ri=_i(Di-Ht)<ci,Li=ri||Di<ci;if(!ri&&Rt<Pt&&(It=Pt,Pt=Rt,Rt=It),Li?ri?Pt+Rt>0^vt[1]<(_i(vt[0]-Be)<ci?Pt:Rt):Pt<=vt[1]&&vt[1]<=Rt:Di>Ht^(Be<=vt[0]&&vt[0]<=mt)){var Ct=Ih(xt,(-St+Je)/Ie);return Gd(Ct,Tt),[vt,lf(Ct)]}}}function B($,D){var G=b?l:Ht-l,J=0;return $<-G?J|=1:$>G&&(J|=2),D<-G?J|=4:D>G&&(J|=8),J}return ky(k,o,C,b?[0,-l]:[-Ht,l-Ht])}function $1(l,d,y,b,E,C){var k=l[0],o=l[1],O=d[0],B=d[1],$=0,D=1,G=O-k,J=B-o,xe;if(xe=y-k,!(!G&&xe>0)){if(xe/=G,G<0){if(xe<$)return;xe<D&&(D=xe)}else if(G>0){if(xe>D)return;xe>$&&($=xe)}if(xe=E-k,!(!G&&xe<0)){if(xe/=G,G<0){if(xe>D)return;xe>$&&($=xe)}else if(G>0){if(xe<$)return;xe<D&&(D=xe)}if(xe=b-o,!(!J&&xe>0)){if(xe/=J,J<0){if(xe<$)return;xe<D&&(D=xe)}else if(J>0){if(xe>D)return;xe>$&&($=xe)}if(xe=C-o,!(!J&&xe<0)){if(xe/=J,J<0){if(xe>D)return;xe>$&&($=xe)}else if(J>0){if(xe<$)return;xe<D&&(D=xe)}return $>0&&(l[0]=k+$*G,l[1]=o+$*J),D<1&&(d[0]=k+D*G,d[1]=o+D*J),!0}}}}}var Pc=1e9,zh=-Pc;function j1(l,d,y,b){function E(B,$){return l<=B&&B<=y&&d<=$&&$<=b}function C(B,$,D,G){var J=0,xe=0;if(B==null||(J=k(B,D))!==(xe=k($,D))||O(B,$)<0^D>0)do G.point(J===0||J===3?l:y,J>1?b:d);while((J=(J+D+4)%4)!==xe);else G.point($[0],$[1])}function k(B,$){return _i(B[0]-l)<ci?$>0?0:3:_i(B[0]-y)<ci?$>0?2:1:_i(B[1]-d)<ci?$>0?1:0:$>0?3:2}function o(B,$){return O(B.x,$.x)}function O(B,$){var D=k(B,1),G=k($,1);return D!==G?D-G:D===0?$[1]-B[1]:D===1?B[0]-$[0]:D===2?B[1]-$[1]:$[0]-B[0]}return function(B){var $=B,D=Cy(),G,J,xe,Pe,ve,We,Xe,Ze,He,je,Ge,Tt={point:yt,lineStart:rt,lineEnd:Je,polygonStart:St,polygonEnd:Ie};function yt(Be,mt){E(Be,mt)&&$.point(Be,mt)}function xt(){for(var Be=0,mt=0,Pt=J.length;mt<Pt;++mt)for(var Rt=J[mt],It=1,Di=Rt.length,ri=Rt[0],Li,Ct,Yt=ri[0],Ai=ri[1];It<Di;++It)Li=Yt,Ct=Ai,ri=Rt[It],Yt=ri[0],Ai=ri[1],Ct<=b?Ai>b&&(Yt-Li)*(b-Ct)>(Ai-Ct)*(l-Li)&&++Be:Ai<=b&&(Yt-Li)*(b-Ct)<(Ai-Ct)*(l-Li)&&--Be;return Be}function St(){$=D,G=[],J=[],Ge=!0}function Ie(){var Be=xt(),mt=Ge&&Be,Pt=(G=Iy(G)).length;(mt||Pt)&&(B.polygonStart(),mt&&(B.lineStart(),C(null,null,1,B),B.lineEnd()),Pt&&zy(G,o,Be,C,B),B.polygonEnd()),$=B,G=J=xe=null}function rt(){Tt.point=vt,J&&J.push(xe=[]),je=!0,He=!1,Xe=Ze=NaN}function Je(){G&&(vt(Pe,ve),We&&He&&D.rejoin(),G.push(D.result())),Tt.point=yt,He&&$.lineEnd()}function vt(Be,mt){var Pt=E(Be,mt);if(J&&xe.push([Be,mt]),je)Pe=Be,ve=mt,We=Pt,je=!1,Pt&&($.lineStart(),$.point(Be,mt));else if(Pt&&He)$.point(Be,mt);else{var Rt=[Xe=Math.max(zh,Math.min(Pc,Xe)),Ze=Math.max(zh,Math.min(Pc,Ze))],It=[Be=Math.max(zh,Math.min(Pc,Be)),mt=Math.max(zh,Math.min(Pc,mt))];$1(Rt,It,l,d,y,b)?(He||($.lineStart(),$.point(Rt[0],Rt[1])),$.point(It[0],It[1]),Pt||$.lineEnd(),Ge=!1):Pt&&($.lineStart(),$.point(Be,mt),Ge=!1)}Xe=Be,Ze=mt,He=Pt}return Tt}}var pf=l=>l,qd=new js,df=new js,Py,Dy,ff,mf,Qo={point:Zn,lineStart:Zn,lineEnd:Zn,polygonStart:function(){Qo.lineStart=G1,Qo.lineEnd=q1},polygonEnd:function(){Qo.lineStart=Qo.lineEnd=Qo.point=Zn,qd.add(_i(df)),df=new js},result:function(){var l=qd/2;return qd=new js,l}};function G1(){Qo.point=Z1}function Z1(l,d){Qo.point=Ly,Py=ff=l,Dy=mf=d}function Ly(l,d){df.add(mf*l-ff*d),ff=l,mf=d}function q1(){Ly(Py,Dy)}var vg=Qo,ol=1/0,Hh=ol,Vc=-ol,Yh=Vc,X1={point:W1,lineStart:Zn,lineEnd:Zn,polygonStart:Zn,polygonEnd:Zn,result:function(){var l=[[ol,Hh],[Vc,Yh]];return Vc=Yh=-(Hh=ol=1/0),l}};function W1(l,d){l<ol&&(ol=l),l>Vc&&(Vc=l),d<Hh&&(Hh=d),d>Yh&&(Yh=d)}var Kh=X1,_f=0,gf=0,Dc=0,Jh=0,Qh=0,Ja=0,yf=0,xf=0,Lc=0,Ry,By,Dr,Lr,sr={point:Zs,lineStart:bg,lineEnd:wg,polygonStart:function(){sr.lineStart=K1,sr.lineEnd=J1},polygonEnd:function(){sr.point=Zs,sr.lineStart=bg,sr.lineEnd=wg},result:function(){var l=Lc?[yf/Lc,xf/Lc]:Ja?[Jh/Ja,Qh/Ja]:Dc?[_f/Dc,gf/Dc]:[NaN,NaN];return _f=gf=Dc=Jh=Qh=Ja=yf=xf=Lc=0,l}};function Zs(l,d){_f+=l,gf+=d,++Dc}function bg(){sr.point=H1}function H1(l,d){sr.point=Y1,Zs(Dr=l,Lr=d)}function Y1(l,d){var y=l-Dr,b=d-Lr,E=mo(y*y+b*b);Jh+=E*(Dr+l)/2,Qh+=E*(Lr+d)/2,Ja+=E,Zs(Dr=l,Lr=d)}function wg(){sr.point=Zs}function K1(){sr.point=Q1}function J1(){Fy(Ry,By)}function Q1(l,d){sr.point=Fy,Zs(Ry=Dr=l,By=Lr=d)}function Fy(l,d){var y=l-Dr,b=d-Lr,E=mo(y*y+b*b);Jh+=E*(Dr+l)/2,Qh+=E*(Lr+d)/2,Ja+=E,E=Lr*l-Dr*d,yf+=E*(Dr+l),xf+=E*(Lr+d),Lc+=E*3,Zs(Dr=l,Lr=d)}var Tg=sr;function Oy(l){this._context=l}Oy.prototype={_radius:4.5,pointRadius:function(l){return this._radius=l,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(l,d){switch(this._point){case 0:{this._context.moveTo(l,d),this._point=1;break}case 1:{this._context.lineTo(l,d);break}default:{this._context.moveTo(l+this._radius,d),this._context.arc(l,d,this._radius,0,qn);break}}},result:Zn};var vf=new js,Xd,Ny,Uy,Rc,Bc,ep={point:Zn,lineStart:function(){ep.point=eb},lineEnd:function(){Xd&&Vy(Ny,Uy),ep.point=Zn},polygonStart:function(){Xd=!0},polygonEnd:function(){Xd=null},result:function(){var l=+vf;return vf=new js,l}};function eb(l,d){ep.point=Vy,Ny=Rc=l,Uy=Bc=d}function Vy(l,d){Rc-=l,Bc-=d,vf.add(mo(Rc*Rc+Bc*Bc)),Rc=l,Bc=d}var Eg=ep;function $y(){this._string=[]}$y.prototype={_radius:4.5,_circle:Sg(4.5),pointRadius:function(l){return(l=+l)!==this._radius&&(this._radius=l,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(l,d){switch(this._point){case 0:{this._string.push("M",l,",",d),this._point=1;break}case 1:{this._string.push("L",l,",",d);break}default:{this._circle==null&&(this._circle=Sg(this._radius)),this._string.push("M",l,",",d,this._circle);break}}},result:function(){if(this._string.length){var l=this._string.join("");return this._string=[],l}else return null}};function Sg(l){return"m0,"+l+"a"+l+","+l+" 0 1,1 0,"+-2*l+"a"+l+","+l+" 0 1,1 0,"+2*l+"z"}function mA(l,d){var y=4.5,b,E;function C(k){return k&&(typeof y=="function"&&E.pointRadius(+y.apply(this,arguments)),Ka(k,b(E))),E.result()}return C.area=function(k){return Ka(k,b(vg)),vg.result()},C.measure=function(k){return Ka(k,b(Eg)),Eg.result()},C.bounds=function(k){return Ka(k,b(Kh)),Kh.result()},C.centroid=function(k){return Ka(k,b(Tg)),Tg.result()},C.projection=function(k){return arguments.length?(b=k==null?(l=null,pf):(l=k).stream,C):l},C.context=function(k){return arguments.length?(E=k==null?(d=null,new $y):new Oy(d=k),typeof y!="function"&&E.pointRadius(y),C):d},C.pointRadius=function(k){return arguments.length?(y=typeof k=="function"?k:(E.pointRadius(+k),+k),C):y},C.projection(l).context(d)}function Vf(l){return function(d){var y=new bf;for(var b in l)y[b]=l[b];return y.stream=d,y}}function bf(){}bf.prototype={constructor:bf,point:function(l,d){this.stream.point(l,d)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function $f(l,d,y){var b=l.clipExtent&&l.clipExtent();return l.scale(150).translate([0,0]),b!=null&&l.clipExtent(null),Ka(y,l.stream(Kh)),d(Kh.result()),b!=null&&l.clipExtent(b),l}function jy(l,d,y){return $f(l,function(b){var E=d[1][0]-d[0][0],C=d[1][1]-d[0][1],k=Math.min(E/(b[1][0]-b[0][0]),C/(b[1][1]-b[0][1])),o=+d[0][0]+(E-k*(b[1][0]+b[0][0]))/2,O=+d[0][1]+(C-k*(b[1][1]+b[0][1]))/2;l.scale(150*k).translate([o,O])},y)}function tb(l,d,y){return jy(l,[[0,0],d],y)}function ib(l,d,y){return $f(l,function(b){var E=+d,C=E/(b[1][0]-b[0][0]),k=(E-C*(b[1][0]+b[0][0]))/2,o=-C*b[0][1];l.scale(150*C).translate([k,o])},y)}function nb(l,d,y){return $f(l,function(b){var E=+d,C=E/(b[1][1]-b[0][1]),k=-C*b[0][0],o=(E-C*(b[1][1]+b[0][1]))/2;l.scale(150*C).translate([k,o])},y)}var Ag=16,rb=bi(30*an);function Mg(l,d){return+d?sb(l,d):ob(l)}function ob(l){return Vf({point:function(d,y){d=l(d,y),this.stream.point(d[0],d[1])}})}function sb(l,d){function y(b,E,C,k,o,O,B,$,D,G,J,xe,Pe,ve){var We=B-b,Xe=$-E,Ze=We*We+Xe*Xe;if(Ze>4*d&&Pe--){var He=k+G,je=o+J,Ge=O+xe,Tt=mo(He*He+je*je+Ge*Ge),yt=Gs(Ge/=Tt),xt=_i(_i(Ge)-1)<ci||_i(C-D)<ci?(C+D)/2:nl(je,He),St=l(xt,yt),Ie=St[0],rt=St[1],Je=Ie-b,vt=rt-E,Be=Xe*Je-We*vt;(Be*Be/Ze>d||_i((We*Je+Xe*vt)/Ze-.5)>.3||k*G+o*J+O*xe<rb)&&(y(b,E,C,k,o,O,Ie,rt,xt,He/=Tt,je/=Tt,Ge,Pe,ve),ve.point(Ie,rt),y(Ie,rt,xt,He,je,Ge,B,$,D,G,J,xe,Pe,ve))}}return function(b){var E,C,k,o,O,B,$,D,G,J,xe,Pe,ve={point:We,lineStart:Xe,lineEnd:He,polygonStart:function(){b.polygonStart(),ve.lineStart=je},polygonEnd:function(){b.polygonEnd(),ve.lineStart=Xe}};function We(yt,xt){yt=l(yt,xt),b.point(yt[0],yt[1])}function Xe(){D=NaN,ve.point=Ze,b.lineStart()}function Ze(yt,xt){var St=rl([yt,xt]),Ie=l(yt,xt);y(D,G,$,J,xe,Pe,D=Ie[0],G=Ie[1],$=yt,J=St[0],xe=St[1],Pe=St[2],Ag,b),b.point(D,G)}function He(){ve.point=We,b.lineEnd()}function je(){Xe(),ve.point=Ge,ve.lineEnd=Tt}function Ge(yt,xt){Ze(E=yt,xt),C=D,k=G,o=J,O=xe,B=Pe,ve.point=Ze}function Tt(){y(D,G,$,J,xe,Pe,C,k,E,o,O,B,Ag,b),ve.lineEnd=He,He()}return ve}}var ab=Vf({point:function(l,d){this.stream.point(l*an,d*an)}});function lb(l){return Vf({point:function(d,y){var b=l(d,y);return this.stream.point(b[0],b[1])}})}function cb(l,d,y,b,E){function C(k,o){return k*=b,o*=E,[d+l*k,y-l*o]}return C.invert=function(k,o){return[(k-d)/l*b,(y-o)/l*E]},C}function Ig(l,d,y,b,E,C){if(!C)return cb(l,d,y,b,E);var k=bi(C),o=pi(C),O=k*l,B=o*l,$=k/l,D=o/l,G=(o*y-k*d)/l,J=(o*d+k*y)/l;function xe(Pe,ve){return Pe*=b,ve*=E,[O*Pe-B*ve+d,y-B*Pe-O*ve]}return xe.invert=function(Pe,ve){return[b*($*Pe-D*ve+G),E*(J-D*Pe-$*ve)]},xe}function ub(l){var d,y=150,b=480,E=250,C=0,k=0,o=0,O=0,B=0,$,D=0,G=1,J=1,xe=null,Pe=xg,ve=null,We,Xe,Ze,He=pf,je=.5,Ge,Tt,yt,xt,St;function Ie(Be){return yt(Be[0]*an,Be[1]*an)}function rt(Be){return Be=yt.invert(Be[0],Be[1]),Be&&[Be[0]*rr,Be[1]*rr]}Ie.stream=function(Be){return xt&&St===Be?xt:xt=ab(lb($)(Pe(Ge(He(St=Be)))))},Ie.preclip=function(Be){return arguments.length?(Pe=Be,xe=void 0,vt()):Pe},Ie.postclip=function(Be){return arguments.length?(He=Be,ve=We=Xe=Ze=null,vt()):He},Ie.clipAngle=function(Be){return arguments.length?(Pe=+Be?V1(xe=Be*an):(xe=null,xg),vt()):xe*rr},Ie.clipExtent=function(Be){return arguments.length?(He=Be==null?(ve=We=Xe=Ze=null,pf):j1(ve=+Be[0][0],We=+Be[0][1],Xe=+Be[1][0],Ze=+Be[1][1]),vt()):ve==null?null:[[ve,We],[Xe,Ze]]},Ie.scale=function(Be){return arguments.length?(y=+Be,Je()):y},Ie.translate=function(Be){return arguments.length?(b=+Be[0],E=+Be[1],Je()):[b,E]},Ie.center=function(Be){return arguments.length?(C=Be[0]%360*an,k=Be[1]%360*an,Je()):[C*rr,k*rr]},Ie.rotate=function(Be){return arguments.length?(o=Be[0]%360*an,O=Be[1]%360*an,B=Be.length>2?Be[2]%360*an:0,Je()):[o*rr,O*rr,B*rr]},Ie.angle=function(Be){return arguments.length?(D=Be%360*an,Je()):D*rr},Ie.reflectX=function(Be){return arguments.length?(G=Be?-1:1,Je()):G<0},Ie.reflectY=function(Be){return arguments.length?(J=Be?-1:1,Je()):J<0},Ie.precision=function(Be){return arguments.length?(Ge=Mg(Tt,je=Be*Be),vt()):mo(je)},Ie.fitExtent=function(Be,mt){return jy(Ie,Be,mt)},Ie.fitSize=function(Be,mt){return tb(Ie,Be,mt)},Ie.fitWidth=function(Be,mt){return ib(Ie,Be,mt)},Ie.fitHeight=function(Be,mt){return nb(Ie,Be,mt)};function Je(){var Be=Ig(y,0,0,G,J,D).apply(null,d(C,k)),mt=Ig(y,b-Be[0],E-Be[1],G,J,D);return $=D1(o,O,B),Tt=uf(d,mt),yt=uf($,Tt),Ge=Mg(Tt,je),vt()}function vt(){return xt=St=null,Ie}return function(){return d=l.apply(this,arguments),Ie.invert=d.invert&&rt,Je()}}function hb(l){var d=0,y=Ht/3,b=ub(l),E=b(d,y);return E.parallels=function(C){return arguments.length?b(d=C[0]*an,y=C[1]*an):[d*rr,y*rr]},E}function pb(l){var d=bi(l);function y(b,E){return[b*d,pi(E)/d]}return y.invert=function(b,E){return[b/d,Gs(E*d)]},y}function db(l,d){var y=pi(l),b=(y+pi(d))/2;if(_i(b)<ci)return pb(l);var E=1+y*(2*b-y),C=mo(E)/b;function k(o,O){var B=mo(E-2*b*pi(O))/b;return[B*pi(o*=b),C-B*bi(o)]}return k.invert=function(o,O){var B=C-O,$=nl(o,_i(B))*Vh(B);return B*b<0&&($-=Ht*Vh(o)*Vh(B)),[$/b,Gs((E-(o*o+B*B)*b*b)/(2*b))]},k}function fb(){return hb(db).scale(155.424).center([0,33.6442])}function _A(){return fb().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function ul(l){for(var d=l.length/6|0,y=new Array(d),b=0;b<d;)y[b]="#"+l.slice(b*6,++b*6);return y}function jf(l,d,y){l.prototype=d.prototype=y,y.constructor=l}function Gy(l,d){var y=Object.create(l.prototype);for(var b in d)y[b]=d[b];return y}function Kc(){}var $c=.7,tp=1/$c,tl="\\s*([+-]?\\d+)\\s*",jc="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Fr="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",mb=/^#([0-9a-f]{3,8})$/,_b=new RegExp("^rgb\\("+[tl,tl,tl]+"\\)$"),gb=new RegExp("^rgb\\("+[Fr,Fr,Fr]+"\\)$"),yb=new RegExp("^rgba\\("+[tl,tl,tl,jc]+"\\)$"),xb=new RegExp("^rgba\\("+[Fr,Fr,Fr,jc]+"\\)$"),vb=new RegExp("^hsl\\("+[jc,Fr,Fr]+"\\)$"),bb=new RegExp("^hsla\\("+[jc,Fr,Fr,jc]+"\\)$"),Cg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};jf(Kc,qs,{copy:function(l){return Object.assign(new this.constructor,this,l)},displayable:function(){return this.rgb().displayable()},hex:zg,formatHex:zg,formatHsl:wb,formatRgb:kg,toString:kg});function zg(){return this.rgb().formatHex()}function wb(){return Zy(this).formatHsl()}function kg(){return this.rgb().formatRgb()}function qs(l){var d,y;return l=(l+"").trim().toLowerCase(),(d=mb.exec(l))?(y=d[1].length,d=parseInt(d[1],16),y===6?Pg(d):y===3?new Ln(d>>8&15|d>>4&240,d>>4&15|d&240,(d&15)<<4|d&15,1):y===8?kh(d>>24&255,d>>16&255,d>>8&255,(d&255)/255):y===4?kh(d>>12&15|d>>8&240,d>>8&15|d>>4&240,d>>4&15|d&240,((d&15)<<4|d&15)/255):null):(d=_b.exec(l))?new Ln(d[1],d[2],d[3],1):(d=gb.exec(l))?new Ln(d[1]*255/100,d[2]*255/100,d[3]*255/100,1):(d=yb.exec(l))?kh(d[1],d[2],d[3],d[4]):(d=xb.exec(l))?kh(d[1]*255/100,d[2]*255/100,d[3]*255/100,d[4]):(d=vb.exec(l))?Rg(d[1],d[2]/100,d[3]/100,1):(d=bb.exec(l))?Rg(d[1],d[2]/100,d[3]/100,d[4]):Cg.hasOwnProperty(l)?Pg(Cg[l]):l==="transparent"?new Ln(NaN,NaN,NaN,0):null}function Pg(l){return new Ln(l>>16&255,l>>8&255,l&255,1)}function kh(l,d,y,b){return b<=0&&(l=d=y=NaN),new Ln(l,d,y,b)}function Tb(l){return l instanceof Kc||(l=qs(l)),l?(l=l.rgb(),new Ln(l.r,l.g,l.b,l.opacity)):new Ln}function ip(l,d,y,b){return arguments.length===1?Tb(l):new Ln(l,d,y,b==null?1:b)}function Ln(l,d,y,b){this.r=+l,this.g=+d,this.b=+y,this.opacity=+b}jf(Ln,ip,Gy(Kc,{brighter:function(l){return l=l==null?tp:Math.pow(tp,l),new Ln(this.r*l,this.g*l,this.b*l,this.opacity)},darker:function(l){return l=l==null?$c:Math.pow($c,l),new Ln(this.r*l,this.g*l,this.b*l,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Dg,formatHex:Dg,formatRgb:Lg,toString:Lg}));function Dg(){return"#"+Wd(this.r)+Wd(this.g)+Wd(this.b)}function Lg(){var l=this.opacity;return l=isNaN(l)?1:Math.max(0,Math.min(1,l)),(l===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(l===1?")":", "+l+")")}function Wd(l){return l=Math.max(0,Math.min(255,Math.round(l)||0)),(l<16?"0":"")+l.toString(16)}function Rg(l,d,y,b){return b<=0?l=d=y=NaN:y<=0||y>=1?l=d=NaN:d<=0&&(l=NaN),new Rr(l,d,y,b)}function Zy(l){if(l instanceof Rr)return new Rr(l.h,l.s,l.l,l.opacity);if(l instanceof Kc||(l=qs(l)),!l)return new Rr;if(l instanceof Rr)return l;l=l.rgb();var d=l.r/255,y=l.g/255,b=l.b/255,E=Math.min(d,y,b),C=Math.max(d,y,b),k=NaN,o=C-E,O=(C+E)/2;return o?(d===C?k=(y-b)/o+(y<b)*6:y===C?k=(b-d)/o+2:k=(d-y)/o+4,o/=O<.5?C+E:2-C-E,k*=60):o=O>0&&O<1?0:k,new Rr(k,o,O,l.opacity)}function Eb(l,d,y,b){return arguments.length===1?Zy(l):new Rr(l,d,y,b==null?1:b)}function Rr(l,d,y,b){this.h=+l,this.s=+d,this.l=+y,this.opacity=+b}jf(Rr,Eb,Gy(Kc,{brighter:function(l){return l=l==null?tp:Math.pow(tp,l),new Rr(this.h,this.s,this.l*l,this.opacity)},darker:function(l){return l=l==null?$c:Math.pow($c,l),new Rr(this.h,this.s,this.l*l,this.opacity)},rgb:function(){var l=this.h%360+(this.h<0)*360,d=isNaN(l)||isNaN(this.s)?0:this.s,y=this.l,b=y+(y<.5?y:1-y)*d,E=2*y-b;return new Ln(Hd(l>=240?l-240:l+120,E,b),Hd(l,E,b),Hd(l<120?l+240:l-120,E,b),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var l=this.opacity;return l=isNaN(l)?1:Math.max(0,Math.min(1,l)),(l===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(l===1?")":", "+l+")")}}));function Hd(l,d,y){return(l<60?d+(y-d)*l/60:l<180?y:l<240?d+(y-d)*(240-l)/60:d)*255}function Sb(l,d,y,b,E){var C=l*l,k=C*l;return((1-3*l+3*C-k)*d+(4-6*C+3*k)*y+(1+3*l+3*C-3*k)*b+k*E)/6}function Ab(l){var d=l.length-1;return function(y){var b=y<=0?y=0:y>=1?(y=1,d-1):Math.floor(y*d),E=l[b],C=l[b+1],k=b>0?l[b-1]:2*E-C,o=b<d-1?l[b+2]:2*C-E;return Sb((y-b/d)*d,k,E,C,o)}}var Gf=l=>()=>l;function Mb(l,d){return function(y){return l+y*d}}function Ib(l,d,y){return l=Math.pow(l,y),d=Math.pow(d,y)-l,y=1/y,function(b){return Math.pow(l+b*d,y)}}function Cb(l){return(l=+l)==1?qy:function(d,y){return y-d?Ib(d,y,l):Gf(isNaN(d)?y:d)}}function qy(l,d){var y=d-l;return y?Mb(l,y):Gf(isNaN(l)?d:l)}var np=function l(d){var y=Cb(d);function b(E,C){var k=y((E=ip(E)).r,(C=ip(C)).r),o=y(E.g,C.g),O=y(E.b,C.b),B=qy(E.opacity,C.opacity);return function($){return E.r=k($),E.g=o($),E.b=O($),E.opacity=B($),E+""}}return b.gamma=l,b}(1);function zb(l){return function(d){var y=d.length,b=new Array(y),E=new Array(y),C=new Array(y),k,o;for(k=0;k<y;++k)o=ip(d[k]),b[k]=o.r||0,E[k]=o.g||0,C[k]=o.b||0;return b=l(b),E=l(E),C=l(C),o.opacity=1,function(O){return o.r=b(O),o.g=E(O),o.b=C(O),o+""}}}var kb=zb(Ab);function Pb(l,d){d||(d=[]);var y=l?Math.min(d.length,l.length):0,b=d.slice(),E;return function(C){for(E=0;E<y;++E)b[E]=l[E]*(1-C)+d[E]*C;return b}}function Db(l){return ArrayBuffer.isView(l)&&!(l instanceof DataView)}function Lb(l,d){var y=d?d.length:0,b=l?Math.min(y,l.length):0,E=new Array(b),C=new Array(y),k;for(k=0;k<b;++k)E[k]=Zf(l[k],d[k]);for(;k<y;++k)C[k]=d[k];return function(o){for(k=0;k<b;++k)C[k]=E[k](o);return C}}function Rb(l,d){var y=new Date;return l=+l,d=+d,function(b){return y.setTime(l*(1-b)+d*b),y}}function or(l,d){return l=+l,d=+d,function(y){return l*(1-y)+d*y}}function Bb(l,d){var y={},b={},E;(l===null||typeof l!="object")&&(l={}),(d===null||typeof d!="object")&&(d={});for(E in d)E in l?y[E]=Zf(l[E],d[E]):b[E]=d[E];return function(C){for(E in y)b[E]=y[E](C);return b}}var wf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yd=new RegExp(wf.source,"g");function Fb(l){return function(){return l}}function Ob(l){return function(d){return l(d)+""}}function Xy(l,d){var y=wf.lastIndex=Yd.lastIndex=0,b,E,C,k=-1,o=[],O=[];for(l=l+"",d=d+"";(b=wf.exec(l))&&(E=Yd.exec(d));)(C=E.index)>y&&(C=d.slice(y,C),o[k]?o[k]+=C:o[++k]=C),(b=b[0])===(E=E[0])?o[k]?o[k]+=E:o[++k]=E:(o[++k]=null,O.push({i:k,x:or(b,E)})),y=Yd.lastIndex;return y<d.length&&(C=d.slice(y),o[k]?o[k]+=C:o[++k]=C),o.length<2?O[0]?Ob(O[0].x):Fb(d):(d=O.length,function(B){for(var $=0,D;$<d;++$)o[(D=O[$]).i]=D.x(B);return o.join("")})}function Zf(l,d){var y=typeof d,b;return d==null||y==="boolean"?Gf(d):(y==="number"?or:y==="string"?(b=qs(d))?(d=b,np):Xy:d instanceof qs?np:d instanceof Date?Rb:Db(d)?Pb:Array.isArray(d)?Lb:typeof d.valueOf!="function"&&typeof d.toString!="function"||isNaN(d)?Bb:or)(l,d)}function Nb(l,d){return l=+l,d=+d,function(y){return Math.round(l*(1-y)+d*y)}}var Bg=180/Math.PI,Tf={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Wy(l,d,y,b,E,C){var k,o,O;return(k=Math.sqrt(l*l+d*d))&&(l/=k,d/=k),(O=l*y+d*b)&&(y-=l*O,b-=d*O),(o=Math.sqrt(y*y+b*b))&&(y/=o,b/=o,O/=o),l*b<d*y&&(l=-l,d=-d,O=-O,k=-k),{translateX:E,translateY:C,rotate:Math.atan2(d,l)*Bg,skewX:Math.atan(O)*Bg,scaleX:k,scaleY:o}}var Ph;function Ub(l){const d=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(l+"");return d.isIdentity?Tf:Wy(d.a,d.b,d.c,d.d,d.e,d.f)}function Vb(l){return l==null||(Ph||(Ph=document.createElementNS("http://www.w3.org/2000/svg","g")),Ph.setAttribute("transform",l),!(l=Ph.transform.baseVal.consolidate()))?Tf:(l=l.matrix,Wy(l.a,l.b,l.c,l.d,l.e,l.f))}function Hy(l,d,y,b){function E(B){return B.length?B.pop()+" ":""}function C(B,$,D,G,J,xe){if(B!==D||$!==G){var Pe=J.push("translate(",null,d,null,y);xe.push({i:Pe-4,x:or(B,D)},{i:Pe-2,x:or($,G)})}else(D||G)&&J.push("translate("+D+d+G+y)}function k(B,$,D,G){B!==$?(B-$>180?$+=360:$-B>180&&(B+=360),G.push({i:D.push(E(D)+"rotate(",null,b)-2,x:or(B,$)})):$&&D.push(E(D)+"rotate("+$+b)}function o(B,$,D,G){B!==$?G.push({i:D.push(E(D)+"skewX(",null,b)-2,x:or(B,$)}):$&&D.push(E(D)+"skewX("+$+b)}function O(B,$,D,G,J,xe){if(B!==D||$!==G){var Pe=J.push(E(J)+"scale(",null,",",null,")");xe.push({i:Pe-4,x:or(B,D)},{i:Pe-2,x:or($,G)})}else(D!==1||G!==1)&&J.push(E(J)+"scale("+D+","+G+")")}return function(B,$){var D=[],G=[];return B=l(B),$=l($),C(B.translateX,B.translateY,$.translateX,$.translateY,D,G),k(B.rotate,$.rotate,D,G),o(B.skewX,$.skewX,D,G),O(B.scaleX,B.scaleY,$.scaleX,$.scaleY,D,G),B=$=null,function(J){for(var xe=-1,Pe=G.length,ve;++xe<Pe;)D[(ve=G[xe]).i]=ve.x(J);return D.join("")}}}var $b=Hy(Ub,"px, ","px)","deg)"),jb=Hy(Vb,", ",")",")"),hl=l=>kb(l[l.length-1]),Gb=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(ul),gA=hl(Gb),Zb=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(ul),yA=hl(Zb),qb=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(ul),xA=hl(qb),Xb=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(ul),vA=hl(Xb),Wb=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(ul),bA=hl(Wb),Hb=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(ul),wA=hl(Hb);function Yb(l,d){switch(arguments.length){case 0:break;case 1:this.range(l);break;default:this.range(d).domain(l);break}return this}function Kb(l,d){switch(arguments.length){case 0:break;case 1:{typeof l=="function"?this.interpolator(l):this.range(l);break}default:{this.domain(l),typeof d=="function"?this.interpolator(d):this.range(d);break}}return this}function qf(l,d,y){l.prototype=d.prototype=y,y.constructor=l}function Yy(l,d){var y=Object.create(l.prototype);for(var b in d)y[b]=d[b];return y}function Jc(){}var Gc=.7,rp=1/Gc,il="\\s*([+-]?\\d+)\\s*",Zc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Or="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Jb=/^#([0-9a-f]{3,8})$/,Qb=new RegExp(`^rgb\\(${il},${il},${il}\\)$`),ew=new RegExp(`^rgb\\(${Or},${Or},${Or}\\)$`),tw=new RegExp(`^rgba\\(${il},${il},${il},${Zc}\\)$`),iw=new RegExp(`^rgba\\(${Or},${Or},${Or},${Zc}\\)$`),nw=new RegExp(`^hsl\\(${Zc},${Or},${Or}\\)$`),rw=new RegExp(`^hsla\\(${Zc},${Or},${Or},${Zc}\\)$`),Fg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};qf(Jc,qc,{copy(l){return Object.assign(new this.constructor,this,l)},displayable(){return this.rgb().displayable()},hex:Og,formatHex:Og,formatHex8:ow,formatHsl:sw,formatRgb:Ng,toString:Ng});function Og(){return this.rgb().formatHex()}function ow(){return this.rgb().formatHex8()}function sw(){return Ky(this).formatHsl()}function Ng(){return this.rgb().formatRgb()}function qc(l){var d,y;return l=(l+"").trim().toLowerCase(),(d=Jb.exec(l))?(y=d[1].length,d=parseInt(d[1],16),y===6?Ug(d):y===3?new Tn(d>>8&15|d>>4&240,d>>4&15|d&240,(d&15)<<4|d&15,1):y===8?Dh(d>>24&255,d>>16&255,d>>8&255,(d&255)/255):y===4?Dh(d>>12&15|d>>8&240,d>>8&15|d>>4&240,d>>4&15|d&240,((d&15)<<4|d&15)/255):null):(d=Qb.exec(l))?new Tn(d[1],d[2],d[3],1):(d=ew.exec(l))?new Tn(d[1]*255/100,d[2]*255/100,d[3]*255/100,1):(d=tw.exec(l))?Dh(d[1],d[2],d[3],d[4]):(d=iw.exec(l))?Dh(d[1]*255/100,d[2]*255/100,d[3]*255/100,d[4]):(d=nw.exec(l))?jg(d[1],d[2]/100,d[3]/100,1):(d=rw.exec(l))?jg(d[1],d[2]/100,d[3]/100,d[4]):Fg.hasOwnProperty(l)?Ug(Fg[l]):l==="transparent"?new Tn(NaN,NaN,NaN,0):null}function Ug(l){return new Tn(l>>16&255,l>>8&255,l&255,1)}function Dh(l,d,y,b){return b<=0&&(l=d=y=NaN),new Tn(l,d,y,b)}function aw(l){return l instanceof Jc||(l=qc(l)),l?(l=l.rgb(),new Tn(l.r,l.g,l.b,l.opacity)):new Tn}function Ef(l,d,y,b){return arguments.length===1?aw(l):new Tn(l,d,y,b==null?1:b)}function Tn(l,d,y,b){this.r=+l,this.g=+d,this.b=+y,this.opacity=+b}qf(Tn,Ef,Yy(Jc,{brighter(l){return l=l==null?rp:Math.pow(rp,l),new Tn(this.r*l,this.g*l,this.b*l,this.opacity)},darker(l){return l=l==null?Gc:Math.pow(Gc,l),new Tn(this.r*l,this.g*l,this.b*l,this.opacity)},rgb(){return this},clamp(){return new Tn($s(this.r),$s(this.g),$s(this.b),op(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Vg,formatHex:Vg,formatHex8:lw,formatRgb:$g,toString:$g}));function Vg(){return`#${Vs(this.r)}${Vs(this.g)}${Vs(this.b)}`}function lw(){return`#${Vs(this.r)}${Vs(this.g)}${Vs(this.b)}${Vs((isNaN(this.opacity)?1:this.opacity)*255)}`}function $g(){const l=op(this.opacity);return`${l===1?"rgb(":"rgba("}${$s(this.r)}, ${$s(this.g)}, ${$s(this.b)}${l===1?")":`, ${l})`}`}function op(l){return isNaN(l)?1:Math.max(0,Math.min(1,l))}function $s(l){return Math.max(0,Math.min(255,Math.round(l)||0))}function Vs(l){return l=$s(l),(l<16?"0":"")+l.toString(16)}function jg(l,d,y,b){return b<=0?l=d=y=NaN:y<=0||y>=1?l=d=NaN:d<=0&&(l=NaN),new ar(l,d,y,b)}function Ky(l){if(l instanceof ar)return new ar(l.h,l.s,l.l,l.opacity);if(l instanceof Jc||(l=qc(l)),!l)return new ar;if(l instanceof ar)return l;l=l.rgb();var d=l.r/255,y=l.g/255,b=l.b/255,E=Math.min(d,y,b),C=Math.max(d,y,b),k=NaN,o=C-E,O=(C+E)/2;return o?(d===C?k=(y-b)/o+(y<b)*6:y===C?k=(b-d)/o+2:k=(d-y)/o+4,o/=O<.5?C+E:2-C-E,k*=60):o=O>0&&O<1?0:k,new ar(k,o,O,l.opacity)}function cw(l,d,y,b){return arguments.length===1?Ky(l):new ar(l,d,y,b==null?1:b)}function ar(l,d,y,b){this.h=+l,this.s=+d,this.l=+y,this.opacity=+b}qf(ar,cw,Yy(Jc,{brighter(l){return l=l==null?rp:Math.pow(rp,l),new ar(this.h,this.s,this.l*l,this.opacity)},darker(l){return l=l==null?Gc:Math.pow(Gc,l),new ar(this.h,this.s,this.l*l,this.opacity)},rgb(){var l=this.h%360+(this.h<0)*360,d=isNaN(l)||isNaN(this.s)?0:this.s,y=this.l,b=y+(y<.5?y:1-y)*d,E=2*y-b;return new Tn(Kd(l>=240?l-240:l+120,E,b),Kd(l,E,b),Kd(l<120?l+240:l-120,E,b),this.opacity)},clamp(){return new ar(Gg(this.h),Lh(this.s),Lh(this.l),op(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const l=op(this.opacity);return`${l===1?"hsl(":"hsla("}${Gg(this.h)}, ${Lh(this.s)*100}%, ${Lh(this.l)*100}%${l===1?")":`, ${l})`}`}}));function Gg(l){return l=(l||0)%360,l<0?l+360:l}function Lh(l){return Math.max(0,Math.min(1,l||0))}function Kd(l,d,y){return(l<60?d+(y-d)*l/60:l<180?y:l<240?d+(y-d)*(240-l)/60:d)*255}var Xf=l=>()=>l;function uw(l,d){return function(y){return l+y*d}}function hw(l,d,y){return l=Math.pow(l,y),d=Math.pow(d,y)-l,y=1/y,function(b){return Math.pow(l+b*d,y)}}function pw(l){return(l=+l)==1?Jy:function(d,y){return y-d?hw(d,y,l):Xf(isNaN(d)?y:d)}}function Jy(l,d){var y=d-l;return y?uw(l,y):Xf(isNaN(l)?d:l)}var Zg=function l(d){var y=pw(d);function b(E,C){var k=y((E=Ef(E)).r,(C=Ef(C)).r),o=y(E.g,C.g),O=y(E.b,C.b),B=Jy(E.opacity,C.opacity);return function($){return E.r=k($),E.g=o($),E.b=O($),E.opacity=B($),E+""}}return b.gamma=l,b}(1);function dw(l,d){d||(d=[]);var y=l?Math.min(d.length,l.length):0,b=d.slice(),E;return function(C){for(E=0;E<y;++E)b[E]=l[E]*(1-C)+d[E]*C;return b}}function fw(l){return ArrayBuffer.isView(l)&&!(l instanceof DataView)}function mw(l,d){var y=d?d.length:0,b=l?Math.min(y,l.length):0,E=new Array(b),C=new Array(y),k;for(k=0;k<b;++k)E[k]=Qc(l[k],d[k]);for(;k<y;++k)C[k]=d[k];return function(o){for(k=0;k<b;++k)C[k]=E[k](o);return C}}function _w(l,d){var y=new Date;return l=+l,d=+d,function(b){return y.setTime(l*(1-b)+d*b),y}}function sp(l,d){return l=+l,d=+d,function(y){return l*(1-y)+d*y}}function gw(l,d){var y={},b={},E;(l===null||typeof l!="object")&&(l={}),(d===null||typeof d!="object")&&(d={});for(E in d)E in l?y[E]=Qc(l[E],d[E]):b[E]=d[E];return function(C){for(E in y)b[E]=y[E](C);return b}}var Sf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Jd=new RegExp(Sf.source,"g");function yw(l){return function(){return l}}function xw(l){return function(d){return l(d)+""}}function vw(l,d){var y=Sf.lastIndex=Jd.lastIndex=0,b,E,C,k=-1,o=[],O=[];for(l=l+"",d=d+"";(b=Sf.exec(l))&&(E=Jd.exec(d));)(C=E.index)>y&&(C=d.slice(y,C),o[k]?o[k]+=C:o[++k]=C),(b=b[0])===(E=E[0])?o[k]?o[k]+=E:o[++k]=E:(o[++k]=null,O.push({i:k,x:sp(b,E)})),y=Jd.lastIndex;return y<d.length&&(C=d.slice(y),o[k]?o[k]+=C:o[++k]=C),o.length<2?O[0]?xw(O[0].x):yw(d):(d=O.length,function(B){for(var $=0,D;$<d;++$)o[(D=O[$]).i]=D.x(B);return o.join("")})}function Qc(l,d){var y=typeof d,b;return d==null||y==="boolean"?Xf(d):(y==="number"?sp:y==="string"?(b=qc(d))?(d=b,Zg):vw:d instanceof qc?Zg:d instanceof Date?_w:fw(d)?dw:Array.isArray(d)?mw:typeof d.valueOf!="function"&&typeof d.toString!="function"||isNaN(d)?gw:sp)(l,d)}function Qy(l,d){return l=+l,d=+d,function(y){return Math.round(l*(1-y)+d*y)}}function bw(l,d){d===void 0&&(d=l,l=Qc);for(var y=0,b=d.length-1,E=d[0],C=new Array(b<0?0:b);y<b;)C[y]=l(E,E=d[++y]);return function(k){var o=Math.max(0,Math.min(b-1,Math.floor(k*=b)));return C[o](k-o)}}function ww(l){return function(){return l}}function Tw(l){return+l}var qg=[0,1];function Br(l){return l}function Af(l,d){return(d-=l=+l)?function(y){return(y-l)/d}:ww(isNaN(d)?NaN:.5)}function Ew(l,d){var y;return l>d&&(y=l,l=d,d=y),function(b){return Math.max(l,Math.min(d,b))}}function Sw(l,d,y){var b=l[0],E=l[1],C=d[0],k=d[1];return E<b?(b=Af(E,b),C=y(k,C)):(b=Af(b,E),C=y(C,k)),function(o){return C(b(o))}}function Aw(l,d,y){var b=Math.min(l.length,d.length)-1,E=new Array(b),C=new Array(b),k=-1;for(l[b]<l[0]&&(l=l.slice().reverse(),d=d.slice().reverse());++k<b;)E[k]=Af(l[k],l[k+1]),C[k]=y(d[k],d[k+1]);return function(o){var O=A1(l,o,1,b)-1;return C[O](E[O](o))}}function Mw(l,d){return d.domain(l.domain()).range(l.range()).interpolate(l.interpolate()).clamp(l.clamp()).unknown(l.unknown())}function Iw(){var l=qg,d=qg,y=Qc,b,E,C,k=Br,o,O,B;function $(){var G=Math.min(l.length,d.length);return k!==Br&&(k=Ew(l[0],l[G-1])),o=G>2?Aw:Sw,O=B=null,D}function D(G){return G==null||isNaN(G=+G)?C:(O||(O=o(l.map(b),d,y)))(b(k(G)))}return D.invert=function(G){return k(E((B||(B=o(d,l.map(b),sp)))(G)))},D.domain=function(G){return arguments.length?(l=Array.from(G,Tw),$()):l.slice()},D.range=function(G){return arguments.length?(d=Array.from(G),$()):d.slice()},D.rangeRound=function(G){return d=Array.from(G),y=Qy,$()},D.clamp=function(G){return arguments.length?(k=G?!0:Br,$()):k!==Br},D.interpolate=function(G){return arguments.length?(y=G,$()):y},D.unknown=function(G){return arguments.length?(C=G,D):C},function(G,J){return b=G,E=J,$()}}function Cw(l){return Math.abs(l=Math.round(l))>=1e21?l.toLocaleString("en").replace(/,/g,""):l.toString(10)}function ap(l,d){if((y=(l=d?l.toExponential(d-1):l.toExponential()).indexOf("e"))<0)return null;var y,b=l.slice(0,y);return[b.length>1?b[0]+b.slice(2):b,+l.slice(y+1)]}function sl(l){return l=ap(Math.abs(l)),l?l[1]:NaN}function zw(l,d){return function(y,b){for(var E=y.length,C=[],k=0,o=l[0],O=0;E>0&&o>0&&(O+o+1>b&&(o=Math.max(1,b-O)),C.push(y.substring(E-=o,E+o)),!((O+=o+1)>b));)o=l[k=(k+1)%l.length];return C.reverse().join(d)}}function kw(l){return function(d){return d.replace(/[0-9]/g,function(y){return l[+y]})}}var Pw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function lp(l){if(!(d=Pw.exec(l)))throw new Error("invalid format: "+l);var d;return new Wf({fill:d[1],align:d[2],sign:d[3],symbol:d[4],zero:d[5],width:d[6],comma:d[7],precision:d[8]&&d[8].slice(1),trim:d[9],type:d[10]})}lp.prototype=Wf.prototype;function Wf(l){this.fill=l.fill===void 0?" ":l.fill+"",this.align=l.align===void 0?">":l.align+"",this.sign=l.sign===void 0?"-":l.sign+"",this.symbol=l.symbol===void 0?"":l.symbol+"",this.zero=!!l.zero,this.width=l.width===void 0?void 0:+l.width,this.comma=!!l.comma,this.precision=l.precision===void 0?void 0:+l.precision,this.trim=!!l.trim,this.type=l.type===void 0?"":l.type+""}Wf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Dw(l){e:for(var d=l.length,y=1,b=-1,E;y<d;++y)switch(l[y]){case".":b=E=y;break;case"0":b===0&&(b=y),E=y;break;default:if(!+l[y])break e;b>0&&(b=0);break}return b>0?l.slice(0,b)+l.slice(E+1):l}var e0;function Lw(l,d){var y=ap(l,d);if(!y)return l+"";var b=y[0],E=y[1],C=E-(e0=Math.max(-8,Math.min(8,Math.floor(E/3)))*3)+1,k=b.length;return C===k?b:C>k?b+new Array(C-k+1).join("0"):C>0?b.slice(0,C)+"."+b.slice(C):"0."+new Array(1-C).join("0")+ap(l,Math.max(0,d+C-1))[0]}function Xg(l,d){var y=ap(l,d);if(!y)return l+"";var b=y[0],E=y[1];return E<0?"0."+new Array(-E).join("0")+b:b.length>E+1?b.slice(0,E+1)+"."+b.slice(E+1):b+new Array(E-b.length+2).join("0")}var Wg={"%":(l,d)=>(l*100).toFixed(d),b:l=>Math.round(l).toString(2),c:l=>l+"",d:Cw,e:(l,d)=>l.toExponential(d),f:(l,d)=>l.toFixed(d),g:(l,d)=>l.toPrecision(d),o:l=>Math.round(l).toString(8),p:(l,d)=>Xg(l*100,d),r:Xg,s:Lw,X:l=>Math.round(l).toString(16).toUpperCase(),x:l=>Math.round(l).toString(16)};function Hg(l){return l}var Yg=Array.prototype.map,Kg=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Rw(l){var d=l.grouping===void 0||l.thousands===void 0?Hg:zw(Yg.call(l.grouping,Number),l.thousands+""),y=l.currency===void 0?"":l.currency[0]+"",b=l.currency===void 0?"":l.currency[1]+"",E=l.decimal===void 0?".":l.decimal+"",C=l.numerals===void 0?Hg:kw(Yg.call(l.numerals,String)),k=l.percent===void 0?"%":l.percent+"",o=l.minus===void 0?"\u2212":l.minus+"",O=l.nan===void 0?"NaN":l.nan+"";function B(D){D=lp(D);var G=D.fill,J=D.align,xe=D.sign,Pe=D.symbol,ve=D.zero,We=D.width,Xe=D.comma,Ze=D.precision,He=D.trim,je=D.type;je==="n"?(Xe=!0,je="g"):Wg[je]||(Ze===void 0&&(Ze=12),He=!0,je="g"),(ve||G==="0"&&J==="=")&&(ve=!0,G="0",J="=");var Ge=Pe==="$"?y:Pe==="#"&&/[boxX]/.test(je)?"0"+je.toLowerCase():"",Tt=Pe==="$"?b:/[%p]/.test(je)?k:"",yt=Wg[je],xt=/[defgprs%]/.test(je);Ze=Ze===void 0?6:/[gprs]/.test(je)?Math.max(1,Math.min(21,Ze)):Math.max(0,Math.min(20,Ze));function St(Ie){var rt=Ge,Je=Tt,vt,Be,mt;if(je==="c")Je=yt(Ie)+Je,Ie="";else{Ie=+Ie;var Pt=Ie<0||1/Ie<0;if(Ie=isNaN(Ie)?O:yt(Math.abs(Ie),Ze),He&&(Ie=Dw(Ie)),Pt&&+Ie==0&&xe!=="+"&&(Pt=!1),rt=(Pt?xe==="("?xe:o:xe==="-"||xe==="("?"":xe)+rt,Je=(je==="s"?Kg[8+e0/3]:"")+Je+(Pt&&xe==="("?")":""),xt){for(vt=-1,Be=Ie.length;++vt<Be;)if(mt=Ie.charCodeAt(vt),48>mt||mt>57){Je=(mt===46?E+Ie.slice(vt+1):Ie.slice(vt))+Je,Ie=Ie.slice(0,vt);break}}}Xe&&!ve&&(Ie=d(Ie,1/0));var Rt=rt.length+Ie.length+Je.length,It=Rt<We?new Array(We-Rt+1).join(G):"";switch(Xe&&ve&&(Ie=d(It+Ie,It.length?We-Je.length:1/0),It=""),J){case"<":Ie=rt+Ie+Je+It;break;case"=":Ie=rt+It+Ie+Je;break;case"^":Ie=It.slice(0,Rt=It.length>>1)+rt+Ie+Je+It.slice(Rt);break;default:Ie=It+rt+Ie+Je;break}return C(Ie)}return St.toString=function(){return D+""},St}function $(D,G){var J=B((D=lp(D),D.type="f",D)),xe=Math.max(-8,Math.min(8,Math.floor(sl(G)/3)))*3,Pe=Math.pow(10,-xe),ve=Kg[8+xe/3];return function(We){return J(Pe*We)+ve}}return{format:B,formatPrefix:$}}var Rh,t0,i0;Bw({thousands:",",grouping:[3],currency:["$",""]});function Bw(l){return Rh=Rw(l),t0=Rh.format,i0=Rh.formatPrefix,Rh}function Fw(l){return Math.max(0,-sl(Math.abs(l)))}function Ow(l,d){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(sl(d)/3)))*3-sl(Math.abs(l)))}function Nw(l,d){return l=Math.abs(l),d=Math.abs(d)-l,Math.max(0,sl(d)-sl(l))+1}function Uw(l,d,y,b){var E=I1(l,d,y),C;switch(b=lp(b==null?",f":b),b.type){case"s":{var k=Math.max(Math.abs(l),Math.abs(d));return b.precision==null&&!isNaN(C=Ow(E,k))&&(b.precision=C),i0(b,k)}case"":case"e":case"g":case"p":case"r":{b.precision==null&&!isNaN(C=Nw(E,Math.max(Math.abs(l),Math.abs(d))))&&(b.precision=C-(b.type==="e"));break}case"f":case"%":{b.precision==null&&!isNaN(C=Fw(E))&&(b.precision=C-(b.type==="%")*2);break}}return t0(b)}function n0(l){var d=l.domain;return l.ticks=function(y){var b=d();return M1(b[0],b[b.length-1],y==null?10:y)},l.tickFormat=function(y,b){var E=d();return Uw(E[0],E[E.length-1],y==null?10:y,b)},l.nice=function(y){y==null&&(y=10);var b=d(),E=0,C=b.length-1,k=b[E],o=b[C],O,B,$=10;for(o<k&&(B=k,k=o,o=B,B=E,E=C,C=B);$-- >0;){if(B=My(k,o,y),B===O)return b[E]=k,b[C]=o,d(b);if(B>0)k=Math.floor(k/B)*B,o=Math.ceil(o/B)*B;else if(B<0)k=Math.ceil(k*B)/B,o=Math.floor(o*B)/B;else break;O=B}return l},l}function Jg(l){return function(d){return d<0?-Math.pow(-d,l):Math.pow(d,l)}}function Vw(l){return l<0?-Math.sqrt(-l):Math.sqrt(l)}function $w(l){return l<0?-l*l:l*l}function jw(l){var d=l(Br,Br),y=1;function b(){return y===1?l(Br,Br):y===.5?l(Vw,$w):l(Jg(y),Jg(1/y))}return d.exponent=function(E){return arguments.length?(y=+E,b()):y},n0(d)}function Gw(){var l=jw(Iw());return l.copy=function(){return Mw(l,Gw()).exponent(l.exponent())},Yb.apply(l,arguments),l}function Zw(l,d){return d.domain(l.domain()).interpolator(l.interpolator()).clamp(l.clamp()).unknown(l.unknown())}function qw(){var l=0,d=.5,y=1,b=1,E,C,k,o,O,B=Br,$,D=!1,G;function J(Pe){return isNaN(Pe=+Pe)?G:(Pe=.5+((Pe=+$(Pe))-C)*(b*Pe<b*C?o:O),B(D?Math.max(0,Math.min(1,Pe)):Pe))}J.domain=function(Pe){return arguments.length?([l,d,y]=Pe,E=$(l=+l),C=$(d=+d),k=$(y=+y),o=E===C?0:.5/(C-E),O=C===k?0:.5/(k-C),b=C<E?-1:1,J):[l,d,y]},J.clamp=function(Pe){return arguments.length?(D=!!Pe,J):D},J.interpolator=function(Pe){return arguments.length?(B=Pe,J):B};function xe(Pe){return function(ve){var We,Xe,Ze;return arguments.length?([We,Xe,Ze]=ve,B=bw(Pe,[We,Xe,Ze]),J):[B(0),B(.5),B(1)]}}return J.range=xe(Qc),J.rangeRound=xe(Qy),J.unknown=function(Pe){return arguments.length?(G=Pe,J):G},function(Pe){return $=Pe,E=Pe(l),C=Pe(d),k=Pe(y),o=E===C?0:.5/(C-E),O=C===k?0:.5/(k-C),b=C<E?-1:1,J}}function Xw(){var l=n0(qw()(Br));return l.copy=function(){return Zw(l,Xw())},Kb.apply(l,arguments)}function Ww(l){return l}function Hw(l){if(l==null)return Ww;var d,y,b=l.scale[0],E=l.scale[1],C=l.translate[0],k=l.translate[1];return function(o,O){O||(d=y=0);var B=2,$=o.length,D=new Array($);for(D[0]=(d+=o[0])*b+C,D[1]=(y+=o[1])*E+k;B<$;)D[B]=o[B],++B;return D}}function Yw(l,d){for(var y,b=l.length,E=b-d;E<--b;)y=l[E],l[E++]=l[b],l[b]=y}function TA(l,d){return typeof d=="string"&&(d=l.objects[d]),d.type==="GeometryCollection"?{type:"FeatureCollection",features:d.geometries.map(function(y){return Qg(l,y)})}:Qg(l,d)}function Qg(l,d){var y=d.id,b=d.bbox,E=d.properties==null?{}:d.properties,C=Kw(l,d);return y==null&&b==null?{type:"Feature",properties:E,geometry:C}:b==null?{type:"Feature",id:y,properties:E,geometry:C}:{type:"Feature",id:y,bbox:b,properties:E,geometry:C}}function Kw(l,d){var y=Hw(l.transform),b=l.arcs;function E($,D){D.length&&D.pop();for(var G=b[$<0?~$:$],J=0,xe=G.length;J<xe;++J)D.push(y(G[J],J));$<0&&Yw(D,xe)}function C($){return y($)}function k($){for(var D=[],G=0,J=$.length;G<J;++G)E($[G],D);return D.length<2&&D.push(D[0]),D}function o($){for(var D=k($);D.length<4;)D.push(D[0]);return D}function O($){return $.map(o)}function B($){var D=$.type,G;switch(D){case"GeometryCollection":return{type:D,geometries:$.geometries.map(B)};case"Point":G=C($.coordinates);break;case"MultiPoint":G=$.coordinates.map(C);break;case"LineString":G=k($.arcs);break;case"MultiLineString":G=$.arcs.map(k);break;case"Polygon":G=O($.arcs);break;case"MultiPolygon":G=$.arcs.map(O);break;default:return null}return{type:D,coordinates:G}}return B(d)}var Jw={exports:{}};(function(l,d){(function(y,b){l.exports=b()})(Ty,function(){var y={};y.states={},y.STATES=[],y.TERRITORIES=[],y.STATES_AND_TERRITORIES=[],y.State=function(o){for(var O in o)o.hasOwnProperty(O)&&(this[O]=o[O])},y.State.prototype.toString=function(){return this.name},y.State.prototype.shapefile_urls=function(o){var O="http://www2.census.gov/geo/tiger/TIGER2010",B={tract:O+"/TRACT/2010/tl_2010_"+this.fips.toString()+"_tract10.zip",cd:O+"/CD/111/tl_2010_"+this.fips.toString()+"_cd111.zip",county:O+"/COUNTY/2010/tl_2010_"+this.fips.toString()+"_county10.zip",state:O+"/STATE/2010/tl_2010_"+this.fips.toString()+"_state10.zip",zcta:O+"/ZCTA5/2010/tl_2010_"+this.fips.toString()+"_zcta510.zip",block:O+"/TABBLOCK/2010/tl_2010_"+this.fips.toString()+"_tabblock10.zip",blockgroup:O+"/BG/2010/tl_2010_"+this.fips.toString()+"_bg10.zip"};return o&&o in B?B[o]:B};var b=/^\d{2}$/,E=/^[a-zA-Z]{2}$/,C={};y.lookup=function(o,O,B){O==null&&(o.match(b)?O="fips":o.match(E)?(o=o.toUpperCase(),O="abbr"):(o=y._metaphone(o),O="metaphones"));var $=O+":"+o;if(!B&&$ in C)return C[$];for(var D=0;D<y.STATES_AND_TERRITORIES.length;D++){var G=y.STATES_AND_TERRITORIES[D];if(Array.isArray(G[O])){if(G[O].indexOf(o)!==-1)return C[$]=G,G}else if(o===G[O])return C[$]=G,G}},y.mapping=function(o,O,B){(typeof B=="undefined"||B==null)&&(B=y.STATES_AND_TERRITORIES);for(var $={},D=0;D<B.length;D++){var G=B[D];$[G[o]]=G[O]}return $},y._metaphone=function(o,O){o=(o==null?"":o+"").toUpperCase();function B(Xe){return"AEIOU".indexOf(Xe)!==-1}function $(Xe){for(var Ze=Xe.length,He=Xe.charAt(0),je,Ge=He,Tt=1;Tt<Ze;Tt++)je=Xe.charAt(Tt),(je!==He||je==="C"||je==="G")&&(Ge+=je),He=je;return Ge}o=$(o);var D=o.length,G=0,J="";o.substr(0,2)==="WH"&&(o="W"+o.substr(2));var xe=o.charAt(0),Pe="",ve=o.charAt(1),We="";if(1<=D)switch(xe){case"A":ve==="E"?J+="E":J+="A",G+=1;break;case"E":case"I":case"O":case"U":J+=xe,G+=1;break;case"G":case"K":case"P":ve==="N"&&(G+=1);break;case"W":ve==="R"&&(G+=1);break}for(;G<D;G++)if(xe=o.charAt(G),Pe=o.charAt(G-1),ve=o.charAt(G+1),We=o.charAt(G+2),!B(xe))switch(xe){case"B":Pe!=="M"&&(J+="B");break;case"C":G+1<=D?o.substr(G-1,3)!=="SCH"?G===0&&G+2<=D&&B(We)?J+="K":J+="X":o.substr(G+1,2)==="IA"?J+="X":"IEY".indexOf(ve)!==-1?G>0?Pe!=="S"&&(J+="S"):J+="S":J+="K":J+="K";break;case"D":G+2<=D&&ve==="G"&&"EIY".indexOf(We)!==-1?(J+="J",G+=2):J+="T";break;case"F":J+="F";break;case"G":if(G<D){if(ve==="N"&&G+1===D-1||ve==="N"&&We==="S"&&G+2===D-1||o.substr(G+1,3)==="NED"&&G+3===D-1||o.substr(G-2,3)==="ING"&&G===D-1)break;if(G+1<=D-1&&o.substr(G-2,4)==="OUGH"){J+="F";break}ve==="H"&&G+2<=D?B(We)&&(J+="K"):G+1===D?ve!=="N"&&(J+="K"):G+3===D?o.substr(G+1,3)!=="NED"&&(J+="K"):G+1<=D?"EIY".indexOf(ve)!==-1?Pe!=="G"&&(J+="J"):(G===0||Pe!=="D"||"EIY".indexOf(ve)===-1)&&(J+="K"):J+="K"}else J+="K";break;case"M":case"J":case"N":case"R":case"L":J+=xe;break;case"Q":J+="K";break;case"V":J+="F";break;case"Z":J+="S";break;case"X":J+=G===0?"S":"KS";break;case"K":(G===0||Pe!=="C")&&(J+="K");break;case"P":G+1<=D&&ve==="H"?J+="F":J+="P";break;case"Y":(G+1>D||B(ve))&&(J+="Y");break;case"H":(G===0||"CSPTG".indexOf(Pe)===-1)&&B(ve)===!0&&(J+="H");break;case"S":G+1<=D&&(ve==="H"||G+2<=D&&ve==="I"&&"AO".indexOf(We)!==-1)?J+="X":J+="S";break;case"T":G+1<=D?ve==="H"?J+="0":G+2<=D&&ve==="I"&&"AO".indexOf(We)!==-1?J+="X":J+="T":J+="T";break;case"W":G+1<=D&&B(ve)&&(J+="W");break}return O=parseInt(O,10),J.length>O?J.substr(0,O):J};var k=function(){for(var o=0;o<k.DATA.length;o++){var O=k.DATA[o],B=new y.State(O);B.is_territory?y.TERRITORIES.push(B):y.STATES.push(B),y.STATES_AND_TERRITORIES.push(B),y.states[B.abbr]=B}};return k.DATA=[{name:"Alabama",metaphones:["ALBM"],statehood_year:1819,ap_abbr:"Ala.",is_territory:!1,fips:"01",abbr:"AL",capital:"Montgomery",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"Alaska",metaphones:["ALSK"],statehood_year:1959,ap_abbr:"Alaska",is_territory:!1,fips:"02",abbr:"AK",capital:"Juneau",capital_tz:"America/Anchorage",time_zones:["America/Anchorage","America/Adak"]},{name:"American Samoa",metaphones:["AMRXNSM"],statehood_year:null,ap_abbr:null,is_territory:!0,fips:"60",abbr:"AS",capital:"Pago Pago",capital_tz:"Pacific/Samoa",time_zones:["Pacific/Samoa"]},{name:"Arizona",metaphones:["ARSN"],statehood_year:1912,ap_abbr:"Ariz.",is_territory:!1,fips:"04",abbr:"AZ",capital:"Phoenix",capital_tz:"America/Denver",time_zones:["America/Denver"]},{name:"Arkansas",metaphones:["ARKNSS"],statehood_year:1836,ap_abbr:"Ark.",is_territory:!1,fips:"05",abbr:"AR",capital:"Little Rock",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"California",metaphones:["XLFRN"],statehood_year:1850,ap_abbr:"Calif.",is_territory:!1,fips:"06",abbr:"CA",capital:"Sacramento",capital_tz:"America/Los_Angeles",time_zones:["America/Los_Angeles"]},{name:"Colorado",metaphones:["XLRT"],statehood_year:1876,ap_abbr:"Colo.",is_territory:!1,fips:"08",abbr:"CO",capital:"Denver",capital_tz:"America/Denver",time_zones:["America/Denver"]},{name:"Connecticut",metaphones:["XNTXT","XNXTXT"],statehood_year:1788,ap_abbr:"Conn.",is_territory:!1,fips:"09",abbr:"CT",capital:"Hartford",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Delaware",metaphones:["TLWR"],statehood_year:1787,ap_abbr:"Del.",is_territory:!1,fips:"10",abbr:"DE",capital:"Dover",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"District of Columbia",metaphones:["TSTRXTFXLM"],statehood_year:null,ap_abbr:"D.C.",is_territory:!1,fips:"11",abbr:"DC",capital:null,capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Florida",metaphones:["FLRT","FLRTS"],statehood_year:1845,ap_abbr:"Fla.",is_territory:!1,fips:"12",abbr:"FL",capital:"Tallahassee",capital_tz:"America/New_York",time_zones:["America/New_York","America/Chicago"]},{name:"Georgia",metaphones:["JRJ","JRK"],statehood_year:1788,ap_abbr:"Ga.",is_territory:!1,fips:"13",abbr:"GA",capital:"Atlanta",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Guam",metaphones:["KM"],statehood_year:null,ap_abbr:null,is_territory:!0,fips:"66",abbr:"GU",capital:"Hag\\u00e5t\\u00f1a",capital_tz:"Pacific/Guam",time_zones:["Pacific/Guam"]},{name:"Hawaii",metaphones:["HW"],statehood_year:1959,ap_abbr:"Hawaii",is_territory:!1,fips:"15",abbr:"HI",capital:"Honolulu",capital_tz:"Pacific/Honolulu",time_zones:["Pacific/Honolulu"]},{name:"Idaho",metaphones:["ITH"],statehood_year:1890,ap_abbr:"Idaho",is_territory:!1,fips:"16",abbr:"ID",capital:"Boise",capital_tz:"America/Denver",time_zones:["America/Denver","America/Los_Angeles"]},{name:"Illinois",metaphones:["ILNS"],statehood_year:1818,ap_abbr:"Ill.",is_territory:!1,fips:"17",abbr:"IL",capital:"Springfield",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"Indiana",metaphones:["INTN"],statehood_year:1816,ap_abbr:"Ind.",is_territory:!1,fips:"18",abbr:"IN",capital:"Indianapolis",capital_tz:"America/Indiana/Indianapolis",time_zones:["America/Indiana/Indianapolis","America/Indianapolis","America/Indiana/Winamac","America/Indiana/Vincennes","America/Indiana/Vevay","America/Indiana/Tell_City","America/Indiana/Petersburg","America/Indiana/Marengo","America/Indiana/Knox","America/Knox_IN"]},{name:"Iowa",metaphones:["IW","IH"],statehood_year:1846,ap_abbr:"Iowa",is_territory:!1,fips:"19",abbr:"IA",capital:"Des Moines",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"Kansas",metaphones:["KNSS"],statehood_year:1861,ap_abbr:"Kan.",is_territory:!1,fips:"20",abbr:"KS",capital:"Topeka",capital_tz:"America/Chicago",time_zones:["America/Chicago","America/Denver"]},{name:"Kentucky",metaphones:["KNTXY","KNTKY"],statehood_year:1792,ap_abbr:"Ky.",is_territory:!1,fips:"21",abbr:"KY",capital:"Frankfort",capital_tz:"America/New_York",time_zones:["America/New_York","America/Kentucky/Louisville","America/Kentucky/Monticello","America/Louisville"]},{name:"Louisiana",metaphones:["LXN","LSN"],statehood_year:1812,ap_abbr:"La.",is_territory:!1,fips:"22",abbr:"LA",capital:"Baton Rouge",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"Maine",metaphones:["MN"],statehood_year:1820,ap_abbr:"Maine",is_territory:!1,fips:"23",abbr:"ME",capital:"Augusta",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Maryland",metaphones:["MRLNT"],statehood_year:1788,ap_abbr:"Md.",is_territory:!1,fips:"24",abbr:"MD",capital:"Annapolis",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Massachusetts",metaphones:["MSXSTS"],statehood_year:1788,ap_abbr:"Mass.",is_territory:!1,fips:"25",abbr:"MA",capital:"Boston",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Michigan",metaphones:["MXKN"],statehood_year:1837,ap_abbr:"Mich.",is_territory:!1,fips:"26",abbr:"MI",capital:"Lansing",capital_tz:"America/New_York",time_zones:["America/New_York","America/Chicago"]},{name:"Minnesota",metaphones:["MNST"],statehood_year:1858,ap_abbr:"Minn.",is_territory:!1,fips:"27",abbr:"MN",capital:"Saint Paul",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"Mississippi",metaphones:["MSSP"],statehood_year:1817,ap_abbr:"Miss.",is_territory:!1,fips:"28",abbr:"MS",capital:"Jackson",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"Missouri",metaphones:["MSR","MSRY"],statehood_year:1821,ap_abbr:"Mo.",is_territory:!1,fips:"29",abbr:"MO",capital:"Jefferson City",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"Montana",metaphones:["MNTN"],statehood_year:1889,ap_abbr:"Mont.",is_territory:!1,fips:"30",abbr:"MT",capital:"Helena",capital_tz:"America/Denver",time_zones:["America/Denver"]},{name:"Nebraska",metaphones:["NBRSK","NBRSX"],statehood_year:1867,ap_abbr:"Neb.",is_territory:!1,fips:"31",abbr:"NE",capital:"Lincoln",capital_tz:"America/Chicago",time_zones:["America/Chicago","America/Denver"]},{name:"Nevada",metaphones:["NFT"],statehood_year:1864,ap_abbr:"Nev.",is_territory:!1,fips:"32",abbr:"NV",capital:"Carson City",capital_tz:"America/Los_Angeles",time_zones:["America/Los_Angeles","America/Denver"]},{name:"New Hampshire",metaphones:["NHMPXR"],statehood_year:1788,ap_abbr:"N.H.",is_territory:!1,fips:"33",abbr:"NH",capital:"Concord",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"New Jersey",metaphones:["NJRSY"],statehood_year:1787,ap_abbr:"N.J.",is_territory:!1,fips:"34",abbr:"NJ",capital:"Trenton",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"New Mexico",metaphones:["NMKSX"],statehood_year:1912,ap_abbr:"N.M.",is_territory:!1,fips:"35",abbr:"NM",capital:"Santa Fe",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"New York",metaphones:["NYRK"],statehood_year:1788,ap_abbr:"N.Y.",is_territory:!1,fips:"36",abbr:"NY",capital:"Albany",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"North Carolina",metaphones:["NR0XRLN"],statehood_year:1789,ap_abbr:"N.C.",is_territory:!1,fips:"37",abbr:"NC",capital:"Raleigh",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"North Dakota",metaphones:["NR0TKT","NTK"],statehood_year:1889,ap_abbr:"N.D.",is_territory:!1,fips:"38",abbr:"ND",capital:"Bismarck",capital_tz:"America/North_Dakota/Center",time_zones:["America/North_Dakota/Center","America/North_Dakota/Beulah","America/North_Dakota/Center","America/North_Dakota/New_Salem"]},{name:"Northern Mariana Islands",metaphones:["NR0RNMRNSLNTS"],statehood_year:null,ap_abbr:null,is_territory:!0,fips:"69",abbr:"MP",capital:"Saipan",capital_tz:"Pacific/Guam",time_zones:["Pacific/Guam"]},{name:"Ohio",metaphones:["OH"],statehood_year:1803,ap_abbr:"Ohio",is_territory:!1,fips:"39",abbr:"OH",capital:"Columbus",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Oklahoma",metaphones:["OKLHM"],statehood_year:1907,ap_abbr:"Okla.",is_territory:!1,fips:"40",abbr:"OK",capital:"Oklahoma City",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"Oregon",metaphones:["ORKN"],statehood_year:1859,ap_abbr:"Ore.",is_territory:!1,fips:"41",abbr:"OR",capital:"Salem",capital_tz:"America/Los_Angeles",time_zones:["America/Los_Angeles","America/Boise"]},{name:"Pennsylvania",metaphones:["PNSLFN"],statehood_year:1787,ap_abbr:"Pa.",is_territory:!1,fips:"42",abbr:"PA",capital:"Harrisburg",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Puerto Rico",metaphones:["PRTRX"],statehood_year:null,ap_abbr:null,is_territory:!0,fips:"72",abbr:"PR",capital:"San Juan",capital_tz:"America/Puerto_Rico",time_zones:["America/Puerto_Rico"]},{name:"Rhode Island",metaphones:["RHTSLNT","RTSLNT"],statehood_year:1790,ap_abbr:"R.I.",is_territory:!1,fips:"44",abbr:"RI",capital:"Providence",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"South Carolina",metaphones:["S0XRLN","STXRLN","SXRL"],statehood_year:1788,ap_abbr:"S.C.",is_territory:!1,fips:"45",abbr:"SC",capital:"Columbia",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"South Dakota",metaphones:["S0TKT"],statehood_year:1889,ap_abbr:"S.D.",is_territory:!1,fips:"46",abbr:"SD",capital:"Pierre",capital_tz:"America/Chicago",time_zones:["America/Chicago","America/Denver"]},{name:"Tennessee",metaphones:["TNS"],statehood_year:1796,ap_abbr:"Tenn.",is_territory:!1,fips:"47",abbr:"TN",capital:"Nashville",capital_tz:"America/Chicago",time_zones:["America/Chicago","America/New_York"]},{name:"Texas",metaphones:["TKSS"],statehood_year:1845,ap_abbr:"Texas",is_territory:!1,fips:"48",abbr:"TX",capital:"Austin",capital_tz:"America/Chicago",time_zones:["America/Chicago","America/Denver"]},{name:"Utah",metaphones:["UTH","UTS","UTR"],statehood_year:1896,ap_abbr:"Utah",is_territory:!1,fips:"49",abbr:"UT",capital:"Salt Lake City",capital_tz:"America/Denver",time_zones:["America/Denver"]},{name:"Vermont",metaphones:["FRMNT"],statehood_year:1791,ap_abbr:"Vt.",is_territory:!1,fips:"50",abbr:"VT",capital:"Montpelier",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Virgin Islands",metaphones:["FRJNSLNTS"],statehood_year:null,ap_abbr:null,is_territory:!0,fips:"78",abbr:"VI",capital:"Charlotte Amalie",capital_tz:"America/Puerto_Rico",time_zones:["America/Puerto_Rico"]},{name:"Virginia",metaphones:["FRJN"],statehood_year:1788,ap_abbr:"Va.",is_territory:!1,fips:"51",abbr:"VA",capital:"Richmond",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Washington",metaphones:["WXNKTN"],statehood_year:1889,ap_abbr:"Wash.",is_territory:!1,fips:"53",abbr:"WA",capital:"Olympia",capital_tz:"America/Los_Angeles",time_zones:["America/Los_Angeles"]},{name:"West Virginia",metaphones:["WSTFRJN","WSTFRKN"],statehood_year:1863,ap_abbr:"W.Va.",is_territory:!1,fips:"54",abbr:"WV",capital:"Charleston",capital_tz:"America/New_York",time_zones:["America/New_York"]},{name:"Wisconsin",metaphones:["WSXNSN"],statehood_year:1848,ap_abbr:"Wis.",is_territory:!1,fips:"55",abbr:"WI",capital:"Madison",capital_tz:"America/Chicago",time_zones:["America/Chicago"]},{name:"Wyoming",metaphones:["YMN","YMNJ","WMN"],statehood_year:1890,ap_abbr:"Wyo.",is_territory:!1,fips:"56",abbr:"WY",capital:"Cheyenne",capital_tz:"America/Denver",time_zones:["America/Denver"]}],k(),y})})(Jw);function Mf(l,d){return l==null||d==null?NaN:l<d?-1:l>d?1:l>=d?0:NaN}function r0(l){let d=l,y=l,b=l;l.length!==2&&(d=(o,O)=>l(o)-O,y=Mf,b=(o,O)=>Mf(l(o),O));function E(o,O,B=0,$=o.length){if(B<$){if(y(O,O)!==0)return $;do{const D=B+$>>>1;b(o[D],O)<0?B=D+1:$=D}while(B<$)}return B}function C(o,O,B=0,$=o.length){if(B<$){if(y(O,O)!==0)return $;do{const D=B+$>>>1;b(o[D],O)<=0?B=D+1:$=D}while(B<$)}return B}function k(o,O,B=0,$=o.length){const D=E(o,O,B,$-1);return D>B&&d(o[D-1],O)>-d(o[D],O)?D-1:D}return{left:E,center:k,right:C}}function Qw(l){return l===null?NaN:+l}const e2=r0(Mf),t2=e2.right;r0(Qw).center;var i2=t2,If=Math.sqrt(50),Cf=Math.sqrt(10),zf=Math.sqrt(2);function n2(l,d,y){var b,E=-1,C,k,o;if(d=+d,l=+l,y=+y,l===d&&y>0)return[l];if((b=d<l)&&(C=l,l=d,d=C),(o=o0(l,d,y))===0||!isFinite(o))return[];if(o>0){let O=Math.round(l/o),B=Math.round(d/o);for(O*o<l&&++O,B*o>d&&--B,k=new Array(C=B-O+1);++E<C;)k[E]=(O+E)*o}else{o=-o;let O=Math.round(l*o),B=Math.round(d*o);for(O/o<l&&++O,B/o>d&&--B,k=new Array(C=B-O+1);++E<C;)k[E]=(O+E)/o}return b&&k.reverse(),k}function o0(l,d,y){var b=(d-l)/Math.max(0,y),E=Math.floor(Math.log(b)/Math.LN10),C=b/Math.pow(10,E);return E>=0?(C>=If?10:C>=Cf?5:C>=zf?2:1)*Math.pow(10,E):-Math.pow(10,-E)/(C>=If?10:C>=Cf?5:C>=zf?2:1)}function r2(l,d,y){var b=Math.abs(d-l)/Math.max(0,y),E=Math.pow(10,Math.floor(Math.log(b)/Math.LN10)),C=b/E;return C>=If?E*=10:C>=Cf?E*=5:C>=zf&&(E*=2),d<l?-E:E}var o2={value:()=>{}};function s0(){for(var l=0,d=arguments.length,y={},b;l<d;++l){if(!(b=arguments[l]+"")||b in y||/[\s.]/.test(b))throw new Error("illegal type: "+b);y[b]=[]}return new jh(y)}function jh(l){this._=l}function s2(l,d){return l.trim().split(/^|\s+/).map(function(y){var b="",E=y.indexOf(".");if(E>=0&&(b=y.slice(E+1),y=y.slice(0,E)),y&&!d.hasOwnProperty(y))throw new Error("unknown type: "+y);return{type:y,name:b}})}jh.prototype=s0.prototype={constructor:jh,on:function(l,d){var y=this._,b=s2(l+"",y),E,C=-1,k=b.length;if(arguments.length<2){for(;++C<k;)if((E=(l=b[C]).type)&&(E=a2(y[E],l.name)))return E;return}if(d!=null&&typeof d!="function")throw new Error("invalid callback: "+d);for(;++C<k;)if(E=(l=b[C]).type)y[E]=ey(y[E],l.name,d);else if(d==null)for(E in y)y[E]=ey(y[E],l.name,null);return this},copy:function(){var l={},d=this._;for(var y in d)l[y]=d[y].slice();return new jh(l)},call:function(l,d){if((E=arguments.length-2)>0)for(var y=new Array(E),b=0,E,C;b<E;++b)y[b]=arguments[b+2];if(!this._.hasOwnProperty(l))throw new Error("unknown type: "+l);for(C=this._[l],b=0,E=C.length;b<E;++b)C[b].value.apply(d,y)},apply:function(l,d,y){if(!this._.hasOwnProperty(l))throw new Error("unknown type: "+l);for(var b=this._[l],E=0,C=b.length;E<C;++E)b[E].value.apply(d,y)}};function a2(l,d){for(var y=0,b=l.length,E;y<b;++y)if((E=l[y]).name===d)return E.value}function ey(l,d,y){for(var b=0,E=l.length;b<E;++b)if(l[b].name===d){l[b]=o2,l=l.slice(0,b).concat(l.slice(b+1));break}return y!=null&&l.push({name:d,value:y}),l}var kf="http://www.w3.org/1999/xhtml",ty={svg:"http://www.w3.org/2000/svg",xhtml:kf,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function gp(l){var d=l+="",y=d.indexOf(":");return y>=0&&(d=l.slice(0,y))!=="xmlns"&&(l=l.slice(y+1)),ty.hasOwnProperty(d)?{space:ty[d],local:l}:l}function l2(l){return function(){var d=this.ownerDocument,y=this.namespaceURI;return y===kf&&d.documentElement.namespaceURI===kf?d.createElement(l):d.createElementNS(y,l)}}function c2(l){return function(){return this.ownerDocument.createElementNS(l.space,l.local)}}function a0(l){var d=gp(l);return(d.local?c2:l2)(d)}function u2(){}function Hf(l){return l==null?u2:function(){return this.querySelector(l)}}function h2(l){typeof l!="function"&&(l=Hf(l));for(var d=this._groups,y=d.length,b=new Array(y),E=0;E<y;++E)for(var C=d[E],k=C.length,o=b[E]=new Array(k),O,B,$=0;$<k;++$)(O=C[$])&&(B=l.call(O,O.__data__,$,C))&&("__data__"in O&&(B.__data__=O.__data__),o[$]=B);return new Rn(b,this._parents)}function p2(l){return l==null?[]:Array.isArray(l)?l:Array.from(l)}function d2(){return[]}function l0(l){return l==null?d2:function(){return this.querySelectorAll(l)}}function f2(l){return function(){return p2(l.apply(this,arguments))}}function m2(l){typeof l=="function"?l=f2(l):l=l0(l);for(var d=this._groups,y=d.length,b=[],E=[],C=0;C<y;++C)for(var k=d[C],o=k.length,O,B=0;B<o;++B)(O=k[B])&&(b.push(l.call(O,O.__data__,B,k)),E.push(O));return new Rn(b,E)}function c0(l){return function(){return this.matches(l)}}function u0(l){return function(d){return d.matches(l)}}var _2=Array.prototype.find;function g2(l){return function(){return _2.call(this.children,l)}}function y2(){return this.firstElementChild}function x2(l){return this.select(l==null?y2:g2(typeof l=="function"?l:u0(l)))}var v2=Array.prototype.filter;function b2(){return Array.from(this.children)}function w2(l){return function(){return v2.call(this.children,l)}}function T2(l){return this.selectAll(l==null?b2:w2(typeof l=="function"?l:u0(l)))}function E2(l){typeof l!="function"&&(l=c0(l));for(var d=this._groups,y=d.length,b=new Array(y),E=0;E<y;++E)for(var C=d[E],k=C.length,o=b[E]=[],O,B=0;B<k;++B)(O=C[B])&&l.call(O,O.__data__,B,C)&&o.push(O);return new Rn(b,this._parents)}function h0(l){return new Array(l.length)}function S2(){return new Rn(this._enter||this._groups.map(h0),this._parents)}function cp(l,d){this.ownerDocument=l.ownerDocument,this.namespaceURI=l.namespaceURI,this._next=null,this._parent=l,this.__data__=d}cp.prototype={constructor:cp,appendChild:function(l){return this._parent.insertBefore(l,this._next)},insertBefore:function(l,d){return this._parent.insertBefore(l,d)},querySelector:function(l){return this._parent.querySelector(l)},querySelectorAll:function(l){return this._parent.querySelectorAll(l)}};function A2(l){return function(){return l}}function M2(l,d,y,b,E,C){for(var k=0,o,O=d.length,B=C.length;k<B;++k)(o=d[k])?(o.__data__=C[k],b[k]=o):y[k]=new cp(l,C[k]);for(;k<O;++k)(o=d[k])&&(E[k]=o)}function I2(l,d,y,b,E,C,k){var o,O,B=new Map,$=d.length,D=C.length,G=new Array($),J;for(o=0;o<$;++o)(O=d[o])&&(G[o]=J=k.call(O,O.__data__,o,d)+"",B.has(J)?E[o]=O:B.set(J,O));for(o=0;o<D;++o)J=k.call(l,C[o],o,C)+"",(O=B.get(J))?(b[o]=O,O.__data__=C[o],B.delete(J)):y[o]=new cp(l,C[o]);for(o=0;o<$;++o)(O=d[o])&&B.get(G[o])===O&&(E[o]=O)}function C2(l){return l.__data__}function z2(l,d){if(!arguments.length)return Array.from(this,C2);var y=d?I2:M2,b=this._parents,E=this._groups;typeof l!="function"&&(l=A2(l));for(var C=E.length,k=new Array(C),o=new Array(C),O=new Array(C),B=0;B<C;++B){var $=b[B],D=E[B],G=D.length,J=k2(l.call($,$&&$.__data__,B,b)),xe=J.length,Pe=o[B]=new Array(xe),ve=k[B]=new Array(xe),We=O[B]=new Array(G);y($,D,Pe,ve,We,J,d);for(var Xe=0,Ze=0,He,je;Xe<xe;++Xe)if(He=Pe[Xe]){for(Xe>=Ze&&(Ze=Xe+1);!(je=ve[Ze])&&++Ze<xe;);He._next=je||null}}return k=new Rn(k,b),k._enter=o,k._exit=O,k}function k2(l){return typeof l=="object"&&"length"in l?l:Array.from(l)}function P2(){return new Rn(this._exit||this._groups.map(h0),this._parents)}function D2(l,d,y){var b=this.enter(),E=this,C=this.exit();return typeof l=="function"?(b=l(b),b&&(b=b.selection())):b=b.append(l+""),d!=null&&(E=d(E),E&&(E=E.selection())),y==null?C.remove():y(C),b&&E?b.merge(E).order():E}function L2(l){for(var d=l.selection?l.selection():l,y=this._groups,b=d._groups,E=y.length,C=b.length,k=Math.min(E,C),o=new Array(E),O=0;O<k;++O)for(var B=y[O],$=b[O],D=B.length,G=o[O]=new Array(D),J,xe=0;xe<D;++xe)(J=B[xe]||$[xe])&&(G[xe]=J);for(;O<E;++O)o[O]=y[O];return new Rn(o,this._parents)}function R2(){for(var l=this._groups,d=-1,y=l.length;++d<y;)for(var b=l[d],E=b.length-1,C=b[E],k;--E>=0;)(k=b[E])&&(C&&k.compareDocumentPosition(C)^4&&C.parentNode.insertBefore(k,C),C=k);return this}function B2(l){l||(l=F2);function d(D,G){return D&&G?l(D.__data__,G.__data__):!D-!G}for(var y=this._groups,b=y.length,E=new Array(b),C=0;C<b;++C){for(var k=y[C],o=k.length,O=E[C]=new Array(o),B,$=0;$<o;++$)(B=k[$])&&(O[$]=B);O.sort(d)}return new Rn(E,this._parents).order()}function F2(l,d){return l<d?-1:l>d?1:l>=d?0:NaN}function O2(){var l=arguments[0];return arguments[0]=this,l.apply(null,arguments),this}function N2(){return Array.from(this)}function U2(){for(var l=this._groups,d=0,y=l.length;d<y;++d)for(var b=l[d],E=0,C=b.length;E<C;++E){var k=b[E];if(k)return k}return null}function V2(){let l=0;for(const d of this)++l;return l}function $2(){return!this.node()}function j2(l){for(var d=this._groups,y=0,b=d.length;y<b;++y)for(var E=d[y],C=0,k=E.length,o;C<k;++C)(o=E[C])&&l.call(o,o.__data__,C,E);return this}function G2(l){return function(){this.removeAttribute(l)}}function Z2(l){return function(){this.removeAttributeNS(l.space,l.local)}}function q2(l,d){return function(){this.setAttribute(l,d)}}function X2(l,d){return function(){this.setAttributeNS(l.space,l.local,d)}}function W2(l,d){return function(){var y=d.apply(this,arguments);y==null?this.removeAttribute(l):this.setAttribute(l,y)}}function H2(l,d){return function(){var y=d.apply(this,arguments);y==null?this.removeAttributeNS(l.space,l.local):this.setAttributeNS(l.space,l.local,y)}}function Y2(l,d){var y=gp(l);if(arguments.length<2){var b=this.node();return y.local?b.getAttributeNS(y.space,y.local):b.getAttribute(y)}return this.each((d==null?y.local?Z2:G2:typeof d=="function"?y.local?H2:W2:y.local?X2:q2)(y,d))}function p0(l){return l.ownerDocument&&l.ownerDocument.defaultView||l.document&&l||l.defaultView}function K2(l){return function(){this.style.removeProperty(l)}}function J2(l,d,y){return function(){this.style.setProperty(l,d,y)}}function Q2(l,d,y){return function(){var b=d.apply(this,arguments);b==null?this.style.removeProperty(l):this.style.setProperty(l,b,y)}}function eT(l,d,y){return arguments.length>1?this.each((d==null?K2:typeof d=="function"?Q2:J2)(l,d,y==null?"":y)):al(this.node(),l)}function al(l,d){return l.style.getPropertyValue(d)||p0(l).getComputedStyle(l,null).getPropertyValue(d)}function tT(l){return function(){delete this[l]}}function iT(l,d){return function(){this[l]=d}}function nT(l,d){return function(){var y=d.apply(this,arguments);y==null?delete this[l]:this[l]=y}}function rT(l,d){return arguments.length>1?this.each((d==null?tT:typeof d=="function"?nT:iT)(l,d)):this.node()[l]}function d0(l){return l.trim().split(/^|\s+/)}function Yf(l){return l.classList||new f0(l)}function f0(l){this._node=l,this._names=d0(l.getAttribute("class")||"")}f0.prototype={add:function(l){var d=this._names.indexOf(l);d<0&&(this._names.push(l),this._node.setAttribute("class",this._names.join(" ")))},remove:function(l){var d=this._names.indexOf(l);d>=0&&(this._names.splice(d,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(l){return this._names.indexOf(l)>=0}};function m0(l,d){for(var y=Yf(l),b=-1,E=d.length;++b<E;)y.add(d[b])}function _0(l,d){for(var y=Yf(l),b=-1,E=d.length;++b<E;)y.remove(d[b])}function oT(l){return function(){m0(this,l)}}function sT(l){return function(){_0(this,l)}}function aT(l,d){return function(){(d.apply(this,arguments)?m0:_0)(this,l)}}function lT(l,d){var y=d0(l+"");if(arguments.length<2){for(var b=Yf(this.node()),E=-1,C=y.length;++E<C;)if(!b.contains(y[E]))return!1;return!0}return this.each((typeof d=="function"?aT:d?oT:sT)(y,d))}function cT(){this.textContent=""}function uT(l){return function(){this.textContent=l}}function hT(l){return function(){var d=l.apply(this,arguments);this.textContent=d==null?"":d}}function pT(l){return arguments.length?this.each(l==null?cT:(typeof l=="function"?hT:uT)(l)):this.node().textContent}function dT(){this.innerHTML=""}function fT(l){return function(){this.innerHTML=l}}function mT(l){return function(){var d=l.apply(this,arguments);this.innerHTML=d==null?"":d}}function _T(l){return arguments.length?this.each(l==null?dT:(typeof l=="function"?mT:fT)(l)):this.node().innerHTML}function gT(){this.nextSibling&&this.parentNode.appendChild(this)}function yT(){return this.each(gT)}function xT(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function vT(){return this.each(xT)}function bT(l){var d=typeof l=="function"?l:a0(l);return this.select(function(){return this.appendChild(d.apply(this,arguments))})}function wT(){return null}function TT(l,d){var y=typeof l=="function"?l:a0(l),b=d==null?wT:typeof d=="function"?d:Hf(d);return this.select(function(){return this.insertBefore(y.apply(this,arguments),b.apply(this,arguments)||null)})}function ET(){var l=this.parentNode;l&&l.removeChild(this)}function ST(){return this.each(ET)}function AT(){var l=this.cloneNode(!1),d=this.parentNode;return d?d.insertBefore(l,this.nextSibling):l}function MT(){var l=this.cloneNode(!0),d=this.parentNode;return d?d.insertBefore(l,this.nextSibling):l}function IT(l){return this.select(l?MT:AT)}function CT(l){return arguments.length?this.property("__data__",l):this.node().__data__}function zT(l){return function(d){l.call(this,d,this.__data__)}}function kT(l){return l.trim().split(/^|\s+/).map(function(d){var y="",b=d.indexOf(".");return b>=0&&(y=d.slice(b+1),d=d.slice(0,b)),{type:d,name:y}})}function PT(l){return function(){var d=this.__on;if(!!d){for(var y=0,b=-1,E=d.length,C;y<E;++y)C=d[y],(!l.type||C.type===l.type)&&C.name===l.name?this.removeEventListener(C.type,C.listener,C.options):d[++b]=C;++b?d.length=b:delete this.__on}}}function DT(l,d,y){return function(){var b=this.__on,E,C=zT(d);if(b){for(var k=0,o=b.length;k<o;++k)if((E=b[k]).type===l.type&&E.name===l.name){this.removeEventListener(E.type,E.listener,E.options),this.addEventListener(E.type,E.listener=C,E.options=y),E.value=d;return}}this.addEventListener(l.type,C,y),E={type:l.type,name:l.name,value:d,listener:C,options:y},b?b.push(E):this.__on=[E]}}function LT(l,d,y){var b=kT(l+""),E,C=b.length,k;if(arguments.length<2){var o=this.node().__on;if(o){for(var O=0,B=o.length,$;O<B;++O)for(E=0,$=o[O];E<C;++E)if((k=b[E]).type===$.type&&k.name===$.name)return $.value}return}for(o=d?DT:PT,E=0;E<C;++E)this.each(o(b[E],d,y));return this}function g0(l,d,y){var b=p0(l),E=b.CustomEvent;typeof E=="function"?E=new E(d,y):(E=b.document.createEvent("Event"),y?(E.initEvent(d,y.bubbles,y.cancelable),E.detail=y.detail):E.initEvent(d,!1,!1)),l.dispatchEvent(E)}function RT(l,d){return function(){return g0(this,l,d)}}function BT(l,d){return function(){return g0(this,l,d.apply(this,arguments))}}function FT(l,d){return this.each((typeof d=="function"?BT:RT)(l,d))}function*OT(){for(var l=this._groups,d=0,y=l.length;d<y;++d)for(var b=l[d],E=0,C=b.length,k;E<C;++E)(k=b[E])&&(yield k)}var y0=[null];function Rn(l,d){this._groups=l,this._parents=d}function eu(){return new Rn([[document.documentElement]],y0)}function NT(){return this}Rn.prototype=eu.prototype={constructor:Rn,select:h2,selectAll:m2,selectChild:x2,selectChildren:T2,filter:E2,data:z2,enter:S2,exit:P2,join:D2,merge:L2,selection:NT,order:R2,sort:B2,call:O2,nodes:N2,node:U2,size:V2,empty:$2,each:j2,attr:Y2,style:eT,property:rT,classed:lT,text:pT,html:_T,raise:yT,lower:vT,append:bT,insert:TT,remove:ST,clone:IT,datum:CT,on:LT,dispatch:FT,[Symbol.iterator]:OT};function EA(l){return typeof l=="string"?new Rn([[document.querySelector(l)]],[document.documentElement]):new Rn([[l]],y0)}var ll=0,Fc=0,zc=0,x0=1e3,up,Oc,hp=0,Xs=0,yp=0,Xc=typeof performance=="object"&&performance.now?performance:Date,v0=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(l){setTimeout(l,17)};function Kf(){return Xs||(v0(UT),Xs=Xc.now()+yp)}function UT(){Xs=0}function pp(){this._call=this._time=this._next=null}pp.prototype=b0.prototype={constructor:pp,restart:function(l,d,y){if(typeof l!="function")throw new TypeError("callback is not a function");y=(y==null?Kf():+y)+(d==null?0:+d),!this._next&&Oc!==this&&(Oc?Oc._next=this:up=this,Oc=this),this._call=l,this._time=y,Pf()},stop:function(){this._call&&(this._call=null,this._time=1/0,Pf())}};function b0(l,d,y){var b=new pp;return b.restart(l,d,y),b}function VT(){Kf(),++ll;for(var l=up,d;l;)(d=Xs-l._time)>=0&&l._call.call(void 0,d),l=l._next;--ll}function iy(){Xs=(hp=Xc.now())+yp,ll=Fc=0;try{VT()}finally{ll=0,jT(),Xs=0}}function $T(){var l=Xc.now(),d=l-hp;d>x0&&(yp-=d,hp=l)}function jT(){for(var l,d=up,y,b=1/0;d;)d._call?(b>d._time&&(b=d._time),l=d,d=d._next):(y=d._next,d._next=null,d=l?l._next=y:up=y);Oc=l,Pf(b)}function Pf(l){if(!ll){Fc&&(Fc=clearTimeout(Fc));var d=l-Xs;d>24?(l<1/0&&(Fc=setTimeout(iy,l-Xc.now()-yp)),zc&&(zc=clearInterval(zc))):(zc||(hp=Xc.now(),zc=setInterval($T,x0)),ll=1,v0(iy))}}function ny(l,d,y){var b=new pp;return d=d==null?0:+d,b.restart(E=>{b.stop(),l(E+d)},d,y),b}var GT=s0("start","end","cancel","interrupt"),ZT=[],w0=0,ry=1,Df=2,Gh=3,oy=4,Lf=5,Zh=6;function xp(l,d,y,b,E,C){var k=l.__transition;if(!k)l.__transition={};else if(y in k)return;qT(l,y,{name:d,index:b,group:E,on:GT,tween:ZT,time:C.time,delay:C.delay,duration:C.duration,ease:C.ease,timer:null,state:w0})}function Jf(l,d){var y=lr(l,d);if(y.state>w0)throw new Error("too late; already scheduled");return y}function Nr(l,d){var y=lr(l,d);if(y.state>Gh)throw new Error("too late; already running");return y}function lr(l,d){var y=l.__transition;if(!y||!(y=y[d]))throw new Error("transition not found");return y}function qT(l,d,y){var b=l.__transition,E;b[d]=y,y.timer=b0(C,0,y.time);function C(B){y.state=ry,y.timer.restart(k,y.delay,y.time),y.delay<=B&&k(B-y.delay)}function k(B){var $,D,G,J;if(y.state!==ry)return O();for($ in b)if(J=b[$],J.name===y.name){if(J.state===Gh)return ny(k);J.state===oy?(J.state=Zh,J.timer.stop(),J.on.call("interrupt",l,l.__data__,J.index,J.group),delete b[$]):+$<d&&(J.state=Zh,J.timer.stop(),J.on.call("cancel",l,l.__data__,J.index,J.group),delete b[$])}if(ny(function(){y.state===Gh&&(y.state=oy,y.timer.restart(o,y.delay,y.time),o(B))}),y.state=Df,y.on.call("start",l,l.__data__,y.index,y.group),y.state===Df){for(y.state=Gh,E=new Array(G=y.tween.length),$=0,D=-1;$<G;++$)(J=y.tween[$].value.call(l,l.__data__,y.index,y.group))&&(E[++D]=J);E.length=D+1}}function o(B){for(var $=B<y.duration?y.ease.call(null,B/y.duration):(y.timer.restart(O),y.state=Lf,1),D=-1,G=E.length;++D<G;)E[D].call(l,$);y.state===Lf&&(y.on.call("end",l,l.__data__,y.index,y.group),O())}function O(){y.state=Zh,y.timer.stop(),delete b[d];for(var B in b)return;delete l.__transition}}function XT(l,d){var y=l.__transition,b,E,C=!0,k;if(!!y){d=d==null?null:d+"";for(k in y){if((b=y[k]).name!==d){C=!1;continue}E=b.state>Df&&b.state<Lf,b.state=Zh,b.timer.stop(),b.on.call(E?"interrupt":"cancel",l,l.__data__,b.index,b.group),delete y[k]}C&&delete l.__transition}}function WT(l){return this.each(function(){XT(this,l)})}function HT(l,d){var y,b;return function(){var E=Nr(this,l),C=E.tween;if(C!==y){b=y=C;for(var k=0,o=b.length;k<o;++k)if(b[k].name===d){b=b.slice(),b.splice(k,1);break}}E.tween=b}}function YT(l,d,y){var b,E;if(typeof y!="function")throw new Error;return function(){var C=Nr(this,l),k=C.tween;if(k!==b){E=(b=k).slice();for(var o={name:d,value:y},O=0,B=E.length;O<B;++O)if(E[O].name===d){E[O]=o;break}O===B&&E.push(o)}C.tween=E}}function KT(l,d){var y=this._id;if(l+="",arguments.length<2){for(var b=lr(this.node(),y).tween,E=0,C=b.length,k;E<C;++E)if((k=b[E]).name===l)return k.value;return null}return this.each((d==null?HT:YT)(y,l,d))}function Qf(l,d,y){var b=l._id;return l.each(function(){var E=Nr(this,b);(E.value||(E.value={}))[d]=y.apply(this,arguments)}),function(E){return lr(E,b).value[d]}}function T0(l,d){var y;return(typeof d=="number"?or:d instanceof qs?np:(y=qs(d))?(d=y,np):Xy)(l,d)}function JT(l){return function(){this.removeAttribute(l)}}function QT(l){return function(){this.removeAttributeNS(l.space,l.local)}}function eE(l,d,y){var b,E=y+"",C;return function(){var k=this.getAttribute(l);return k===E?null:k===b?C:C=d(b=k,y)}}function tE(l,d,y){var b,E=y+"",C;return function(){var k=this.getAttributeNS(l.space,l.local);return k===E?null:k===b?C:C=d(b=k,y)}}function iE(l,d,y){var b,E,C;return function(){var k,o=y(this),O;return o==null?void this.removeAttribute(l):(k=this.getAttribute(l),O=o+"",k===O?null:k===b&&O===E?C:(E=O,C=d(b=k,o)))}}function nE(l,d,y){var b,E,C;return function(){var k,o=y(this),O;return o==null?void this.removeAttributeNS(l.space,l.local):(k=this.getAttributeNS(l.space,l.local),O=o+"",k===O?null:k===b&&O===E?C:(E=O,C=d(b=k,o)))}}function rE(l,d){var y=gp(l),b=y==="transform"?jb:T0;return this.attrTween(l,typeof d=="function"?(y.local?nE:iE)(y,b,Qf(this,"attr."+l,d)):d==null?(y.local?QT:JT)(y):(y.local?tE:eE)(y,b,d))}function oE(l,d){return function(y){this.setAttribute(l,d.call(this,y))}}function sE(l,d){return function(y){this.setAttributeNS(l.space,l.local,d.call(this,y))}}function aE(l,d){var y,b;function E(){var C=d.apply(this,arguments);return C!==b&&(y=(b=C)&&sE(l,C)),y}return E._value=d,E}function lE(l,d){var y,b;function E(){var C=d.apply(this,arguments);return C!==b&&(y=(b=C)&&oE(l,C)),y}return E._value=d,E}function cE(l,d){var y="attr."+l;if(arguments.length<2)return(y=this.tween(y))&&y._value;if(d==null)return this.tween(y,null);if(typeof d!="function")throw new Error;var b=gp(l);return this.tween(y,(b.local?aE:lE)(b,d))}function uE(l,d){return function(){Jf(this,l).delay=+d.apply(this,arguments)}}function hE(l,d){return d=+d,function(){Jf(this,l).delay=d}}function pE(l){var d=this._id;return arguments.length?this.each((typeof l=="function"?uE:hE)(d,l)):lr(this.node(),d).delay}function dE(l,d){return function(){Nr(this,l).duration=+d.apply(this,arguments)}}function fE(l,d){return d=+d,function(){Nr(this,l).duration=d}}function mE(l){var d=this._id;return arguments.length?this.each((typeof l=="function"?dE:fE)(d,l)):lr(this.node(),d).duration}function _E(l,d){if(typeof d!="function")throw new Error;return function(){Nr(this,l).ease=d}}function gE(l){var d=this._id;return arguments.length?this.each(_E(d,l)):lr(this.node(),d).ease}function yE(l,d){return function(){var y=d.apply(this,arguments);if(typeof y!="function")throw new Error;Nr(this,l).ease=y}}function xE(l){if(typeof l!="function")throw new Error;return this.each(yE(this._id,l))}function vE(l){typeof l!="function"&&(l=c0(l));for(var d=this._groups,y=d.length,b=new Array(y),E=0;E<y;++E)for(var C=d[E],k=C.length,o=b[E]=[],O,B=0;B<k;++B)(O=C[B])&&l.call(O,O.__data__,B,C)&&o.push(O);return new _o(b,this._parents,this._name,this._id)}function bE(l){if(l._id!==this._id)throw new Error;for(var d=this._groups,y=l._groups,b=d.length,E=y.length,C=Math.min(b,E),k=new Array(b),o=0;o<C;++o)for(var O=d[o],B=y[o],$=O.length,D=k[o]=new Array($),G,J=0;J<$;++J)(G=O[J]||B[J])&&(D[J]=G);for(;o<b;++o)k[o]=d[o];return new _o(k,this._parents,this._name,this._id)}function wE(l){return(l+"").trim().split(/^|\s+/).every(function(d){var y=d.indexOf(".");return y>=0&&(d=d.slice(0,y)),!d||d==="start"})}function TE(l,d,y){var b,E,C=wE(d)?Jf:Nr;return function(){var k=C(this,l),o=k.on;o!==b&&(E=(b=o).copy()).on(d,y),k.on=E}}function EE(l,d){var y=this._id;return arguments.length<2?lr(this.node(),y).on.on(l):this.each(TE(y,l,d))}function SE(l){return function(){var d=this.parentNode;for(var y in this.__transition)if(+y!==l)return;d&&d.removeChild(this)}}function AE(){return this.on("end.remove",SE(this._id))}function ME(l){var d=this._name,y=this._id;typeof l!="function"&&(l=Hf(l));for(var b=this._groups,E=b.length,C=new Array(E),k=0;k<E;++k)for(var o=b[k],O=o.length,B=C[k]=new Array(O),$,D,G=0;G<O;++G)($=o[G])&&(D=l.call($,$.__data__,G,o))&&("__data__"in $&&(D.__data__=$.__data__),B[G]=D,xp(B[G],d,y,G,B,lr($,y)));return new _o(C,this._parents,d,y)}function IE(l){var d=this._name,y=this._id;typeof l!="function"&&(l=l0(l));for(var b=this._groups,E=b.length,C=[],k=[],o=0;o<E;++o)for(var O=b[o],B=O.length,$,D=0;D<B;++D)if($=O[D]){for(var G=l.call($,$.__data__,D,O),J,xe=lr($,y),Pe=0,ve=G.length;Pe<ve;++Pe)(J=G[Pe])&&xp(J,d,y,Pe,G,xe);C.push(G),k.push($)}return new _o(C,k,d,y)}var CE=eu.prototype.constructor;function zE(){return new CE(this._groups,this._parents)}function kE(l,d){var y,b,E;return function(){var C=al(this,l),k=(this.style.removeProperty(l),al(this,l));return C===k?null:C===y&&k===b?E:E=d(y=C,b=k)}}function E0(l){return function(){this.style.removeProperty(l)}}function PE(l,d,y){var b,E=y+"",C;return function(){var k=al(this,l);return k===E?null:k===b?C:C=d(b=k,y)}}function DE(l,d,y){var b,E,C;return function(){var k=al(this,l),o=y(this),O=o+"";return o==null&&(O=o=(this.style.removeProperty(l),al(this,l))),k===O?null:k===b&&O===E?C:(E=O,C=d(b=k,o))}}function LE(l,d){var y,b,E,C="style."+d,k="end."+C,o;return function(){var O=Nr(this,l),B=O.on,$=O.value[C]==null?o||(o=E0(d)):void 0;(B!==y||E!==$)&&(b=(y=B).copy()).on(k,E=$),O.on=b}}function RE(l,d,y){var b=(l+="")=="transform"?$b:T0;return d==null?this.styleTween(l,kE(l,b)).on("end.style."+l,E0(l)):typeof d=="function"?this.styleTween(l,DE(l,b,Qf(this,"style."+l,d))).each(LE(this._id,l)):this.styleTween(l,PE(l,b,d),y).on("end.style."+l,null)}function BE(l,d,y){return function(b){this.style.setProperty(l,d.call(this,b),y)}}function FE(l,d,y){var b,E;function C(){var k=d.apply(this,arguments);return k!==E&&(b=(E=k)&&BE(l,k,y)),b}return C._value=d,C}function OE(l,d,y){var b="style."+(l+="");if(arguments.length<2)return(b=this.tween(b))&&b._value;if(d==null)return this.tween(b,null);if(typeof d!="function")throw new Error;return this.tween(b,FE(l,d,y==null?"":y))}function NE(l){return function(){this.textContent=l}}function UE(l){return function(){var d=l(this);this.textContent=d==null?"":d}}function VE(l){return this.tween("text",typeof l=="function"?UE(Qf(this,"text",l)):NE(l==null?"":l+""))}function $E(l){return function(d){this.textContent=l.call(this,d)}}function jE(l){var d,y;function b(){var E=l.apply(this,arguments);return E!==y&&(d=(y=E)&&$E(E)),d}return b._value=l,b}function GE(l){var d="text";if(arguments.length<1)return(d=this.tween(d))&&d._value;if(l==null)return this.tween(d,null);if(typeof l!="function")throw new Error;return this.tween(d,jE(l))}function ZE(){for(var l=this._name,d=this._id,y=S0(),b=this._groups,E=b.length,C=0;C<E;++C)for(var k=b[C],o=k.length,O,B=0;B<o;++B)if(O=k[B]){var $=lr(O,d);xp(O,l,y,B,k,{time:$.time+$.delay+$.duration,delay:0,duration:$.duration,ease:$.ease})}return new _o(b,this._parents,l,y)}function qE(){var l,d,y=this,b=y._id,E=y.size();return new Promise(function(C,k){var o={value:k},O={value:function(){--E===0&&C()}};y.each(function(){var B=Nr(this,b),$=B.on;$!==l&&(d=(l=$).copy(),d._.cancel.push(o),d._.interrupt.push(o),d._.end.push(O)),B.on=d}),E===0&&C()})}var XE=0;function _o(l,d,y,b){this._groups=l,this._parents=d,this._name=y,this._id=b}function S0(){return++XE}var po=eu.prototype;_o.prototype={constructor:_o,select:ME,selectAll:IE,selectChild:po.selectChild,selectChildren:po.selectChildren,filter:vE,merge:bE,selection:zE,transition:ZE,call:po.call,nodes:po.nodes,node:po.node,size:po.size,empty:po.empty,each:po.each,on:EE,attr:rE,attrTween:cE,style:RE,styleTween:OE,text:VE,textTween:GE,remove:AE,tween:KT,delay:pE,duration:mE,ease:gE,easeVarying:xE,end:qE,[Symbol.iterator]:po[Symbol.iterator]};function WE(l){return((l*=2)<=1?l*l*l:(l-=2)*l*l+2)/2}var HE={time:null,delay:0,duration:250,ease:WE};function YE(l,d){for(var y;!(y=l.__transition)||!(y=y[d]);)if(!(l=l.parentNode))throw new Error(`transition ${d} not found`);return y}function KE(l){var d,y;l instanceof _o?(d=l._id,l=l._name):(d=S0(),(y=HE).time=Kf(),l=l==null?null:l+"");for(var b=this._groups,E=b.length,C=0;C<E;++C)for(var k=b[C],o=k.length,O,B=0;B<o;++B)(O=k[B])&&xp(O,l,d,B,k,y||YE(O,d));return new _o(b,this._parents,l,d)}eu.prototype.interrupt=WT;eu.prototype.transition=KE;const Rf=Math.PI,Bf=2*Rf,Ns=1e-6,JE=Bf-Ns;function Ff(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function A0(){return new Ff}Ff.prototype=A0.prototype={constructor:Ff,moveTo:function(l,d){this._+="M"+(this._x0=this._x1=+l)+","+(this._y0=this._y1=+d)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(l,d){this._+="L"+(this._x1=+l)+","+(this._y1=+d)},quadraticCurveTo:function(l,d,y,b){this._+="Q"+ +l+","+ +d+","+(this._x1=+y)+","+(this._y1=+b)},bezierCurveTo:function(l,d,y,b,E,C){this._+="C"+ +l+","+ +d+","+ +y+","+ +b+","+(this._x1=+E)+","+(this._y1=+C)},arcTo:function(l,d,y,b,E){l=+l,d=+d,y=+y,b=+b,E=+E;var C=this._x1,k=this._y1,o=y-l,O=b-d,B=C-l,$=k-d,D=B*B+$*$;if(E<0)throw new Error("negative radius: "+E);if(this._x1===null)this._+="M"+(this._x1=l)+","+(this._y1=d);else if(D>Ns)if(!(Math.abs($*o-O*B)>Ns)||!E)this._+="L"+(this._x1=l)+","+(this._y1=d);else{var G=y-C,J=b-k,xe=o*o+O*O,Pe=G*G+J*J,ve=Math.sqrt(xe),We=Math.sqrt(D),Xe=E*Math.tan((Rf-Math.acos((xe+D-Pe)/(2*ve*We)))/2),Ze=Xe/We,He=Xe/ve;Math.abs(Ze-1)>Ns&&(this._+="L"+(l+Ze*B)+","+(d+Ze*$)),this._+="A"+E+","+E+",0,0,"+ +($*G>B*J)+","+(this._x1=l+He*o)+","+(this._y1=d+He*O)}},arc:function(l,d,y,b,E,C){l=+l,d=+d,y=+y,C=!!C;var k=y*Math.cos(b),o=y*Math.sin(b),O=l+k,B=d+o,$=1^C,D=C?b-E:E-b;if(y<0)throw new Error("negative radius: "+y);this._x1===null?this._+="M"+O+","+B:(Math.abs(this._x1-O)>Ns||Math.abs(this._y1-B)>Ns)&&(this._+="L"+O+","+B),!!y&&(D<0&&(D=D%Bf+Bf),D>JE?this._+="A"+y+","+y+",0,1,"+$+","+(l-k)+","+(d-o)+"A"+y+","+y+",0,1,"+$+","+(this._x1=O)+","+(this._y1=B):D>Ns&&(this._+="A"+y+","+y+",0,"+ +(D>=Rf)+","+$+","+(this._x1=l+y*Math.cos(E))+","+(this._y1=d+y*Math.sin(E))))},rect:function(l,d,y,b){this._+="M"+(this._x0=this._x1=+l)+","+(this._y0=this._y1=+d)+"h"+ +y+"v"+ +b+"h"+-y+"Z"},toString:function(){return this._}};function QE(l){return Math.abs(l=Math.round(l))>=1e21?l.toLocaleString("en").replace(/,/g,""):l.toString(10)}function dp(l,d){if((y=(l=d?l.toExponential(d-1):l.toExponential()).indexOf("e"))<0)return null;var y,b=l.slice(0,y);return[b.length>1?b[0]+b.slice(2):b,+l.slice(y+1)]}function cl(l){return l=dp(Math.abs(l)),l?l[1]:NaN}function eS(l,d){return function(y,b){for(var E=y.length,C=[],k=0,o=l[0],O=0;E>0&&o>0&&(O+o+1>b&&(o=Math.max(1,b-O)),C.push(y.substring(E-=o,E+o)),!((O+=o+1)>b));)o=l[k=(k+1)%l.length];return C.reverse().join(d)}}function tS(l){return function(d){return d.replace(/[0-9]/g,function(y){return l[+y]})}}var iS=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function fp(l){if(!(d=iS.exec(l)))throw new Error("invalid format: "+l);var d;return new em({fill:d[1],align:d[2],sign:d[3],symbol:d[4],zero:d[5],width:d[6],comma:d[7],precision:d[8]&&d[8].slice(1),trim:d[9],type:d[10]})}fp.prototype=em.prototype;function em(l){this.fill=l.fill===void 0?" ":l.fill+"",this.align=l.align===void 0?">":l.align+"",this.sign=l.sign===void 0?"-":l.sign+"",this.symbol=l.symbol===void 0?"":l.symbol+"",this.zero=!!l.zero,this.width=l.width===void 0?void 0:+l.width,this.comma=!!l.comma,this.precision=l.precision===void 0?void 0:+l.precision,this.trim=!!l.trim,this.type=l.type===void 0?"":l.type+""}em.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function nS(l){e:for(var d=l.length,y=1,b=-1,E;y<d;++y)switch(l[y]){case".":b=E=y;break;case"0":b===0&&(b=y),E=y;break;default:if(!+l[y])break e;b>0&&(b=0);break}return b>0?l.slice(0,b)+l.slice(E+1):l}var M0;function rS(l,d){var y=dp(l,d);if(!y)return l+"";var b=y[0],E=y[1],C=E-(M0=Math.max(-8,Math.min(8,Math.floor(E/3)))*3)+1,k=b.length;return C===k?b:C>k?b+new Array(C-k+1).join("0"):C>0?b.slice(0,C)+"."+b.slice(C):"0."+new Array(1-C).join("0")+dp(l,Math.max(0,d+C-1))[0]}function sy(l,d){var y=dp(l,d);if(!y)return l+"";var b=y[0],E=y[1];return E<0?"0."+new Array(-E).join("0")+b:b.length>E+1?b.slice(0,E+1)+"."+b.slice(E+1):b+new Array(E-b.length+2).join("0")}var ay={"%":(l,d)=>(l*100).toFixed(d),b:l=>Math.round(l).toString(2),c:l=>l+"",d:QE,e:(l,d)=>l.toExponential(d),f:(l,d)=>l.toFixed(d),g:(l,d)=>l.toPrecision(d),o:l=>Math.round(l).toString(8),p:(l,d)=>sy(l*100,d),r:sy,s:rS,X:l=>Math.round(l).toString(16).toUpperCase(),x:l=>Math.round(l).toString(16)};function ly(l){return l}var cy=Array.prototype.map,uy=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function oS(l){var d=l.grouping===void 0||l.thousands===void 0?ly:eS(cy.call(l.grouping,Number),l.thousands+""),y=l.currency===void 0?"":l.currency[0]+"",b=l.currency===void 0?"":l.currency[1]+"",E=l.decimal===void 0?".":l.decimal+"",C=l.numerals===void 0?ly:tS(cy.call(l.numerals,String)),k=l.percent===void 0?"%":l.percent+"",o=l.minus===void 0?"\u2212":l.minus+"",O=l.nan===void 0?"NaN":l.nan+"";function B(D){D=fp(D);var G=D.fill,J=D.align,xe=D.sign,Pe=D.symbol,ve=D.zero,We=D.width,Xe=D.comma,Ze=D.precision,He=D.trim,je=D.type;je==="n"?(Xe=!0,je="g"):ay[je]||(Ze===void 0&&(Ze=12),He=!0,je="g"),(ve||G==="0"&&J==="=")&&(ve=!0,G="0",J="=");var Ge=Pe==="$"?y:Pe==="#"&&/[boxX]/.test(je)?"0"+je.toLowerCase():"",Tt=Pe==="$"?b:/[%p]/.test(je)?k:"",yt=ay[je],xt=/[defgprs%]/.test(je);Ze=Ze===void 0?6:/[gprs]/.test(je)?Math.max(1,Math.min(21,Ze)):Math.max(0,Math.min(20,Ze));function St(Ie){var rt=Ge,Je=Tt,vt,Be,mt;if(je==="c")Je=yt(Ie)+Je,Ie="";else{Ie=+Ie;var Pt=Ie<0||1/Ie<0;if(Ie=isNaN(Ie)?O:yt(Math.abs(Ie),Ze),He&&(Ie=nS(Ie)),Pt&&+Ie==0&&xe!=="+"&&(Pt=!1),rt=(Pt?xe==="("?xe:o:xe==="-"||xe==="("?"":xe)+rt,Je=(je==="s"?uy[8+M0/3]:"")+Je+(Pt&&xe==="("?")":""),xt){for(vt=-1,Be=Ie.length;++vt<Be;)if(mt=Ie.charCodeAt(vt),48>mt||mt>57){Je=(mt===46?E+Ie.slice(vt+1):Ie.slice(vt))+Je,Ie=Ie.slice(0,vt);break}}}Xe&&!ve&&(Ie=d(Ie,1/0));var Rt=rt.length+Ie.length+Je.length,It=Rt<We?new Array(We-Rt+1).join(G):"";switch(Xe&&ve&&(Ie=d(It+Ie,It.length?We-Je.length:1/0),It=""),J){case"<":Ie=rt+Ie+Je+It;break;case"=":Ie=rt+It+Ie+Je;break;case"^":Ie=It.slice(0,Rt=It.length>>1)+rt+Ie+Je+It.slice(Rt);break;default:Ie=It+rt+Ie+Je;break}return C(Ie)}return St.toString=function(){return D+""},St}function $(D,G){var J=B((D=fp(D),D.type="f",D)),xe=Math.max(-8,Math.min(8,Math.floor(cl(G)/3)))*3,Pe=Math.pow(10,-xe),ve=uy[8+xe/3];return function(We){return J(Pe*We)+ve}}return{format:B,formatPrefix:$}}var Bh,I0,C0;sS({thousands:",",grouping:[3],currency:["$",""]});function sS(l){return Bh=oS(l),I0=Bh.format,C0=Bh.formatPrefix,Bh}function aS(l){return Math.max(0,-cl(Math.abs(l)))}function lS(l,d){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(cl(d)/3)))*3-cl(Math.abs(l)))}function cS(l,d){return l=Math.abs(l),d=Math.abs(d)-l,Math.max(0,cl(d)-cl(l))+1}function uS(l,d){switch(arguments.length){case 0:break;case 1:this.range(l);break;default:this.range(d).domain(l);break}return this}function hS(l){return function(){return l}}function pS(l){return+l}var hy=[0,1];function Qa(l){return l}function Of(l,d){return(d-=l=+l)?function(y){return(y-l)/d}:hS(isNaN(d)?NaN:.5)}function dS(l,d){var y;return l>d&&(y=l,l=d,d=y),function(b){return Math.max(l,Math.min(d,b))}}function fS(l,d,y){var b=l[0],E=l[1],C=d[0],k=d[1];return E<b?(b=Of(E,b),C=y(k,C)):(b=Of(b,E),C=y(C,k)),function(o){return C(b(o))}}function mS(l,d,y){var b=Math.min(l.length,d.length)-1,E=new Array(b),C=new Array(b),k=-1;for(l[b]<l[0]&&(l=l.slice().reverse(),d=d.slice().reverse());++k<b;)E[k]=Of(l[k],l[k+1]),C[k]=y(d[k],d[k+1]);return function(o){var O=i2(l,o,1,b)-1;return C[O](E[O](o))}}function _S(l,d){return d.domain(l.domain()).range(l.range()).interpolate(l.interpolate()).clamp(l.clamp()).unknown(l.unknown())}function gS(){var l=hy,d=hy,y=Zf,b,E,C,k=Qa,o,O,B;function $(){var G=Math.min(l.length,d.length);return k!==Qa&&(k=dS(l[0],l[G-1])),o=G>2?mS:fS,O=B=null,D}function D(G){return G==null||isNaN(G=+G)?C:(O||(O=o(l.map(b),d,y)))(b(k(G)))}return D.invert=function(G){return k(E((B||(B=o(d,l.map(b),or)))(G)))},D.domain=function(G){return arguments.length?(l=Array.from(G,pS),$()):l.slice()},D.range=function(G){return arguments.length?(d=Array.from(G),$()):d.slice()},D.rangeRound=function(G){return d=Array.from(G),y=Nb,$()},D.clamp=function(G){return arguments.length?(k=G?!0:Qa,$()):k!==Qa},D.interpolate=function(G){return arguments.length?(y=G,$()):y},D.unknown=function(G){return arguments.length?(C=G,D):C},function(G,J){return b=G,E=J,$()}}function yS(){return gS()(Qa,Qa)}function xS(l,d,y,b){var E=r2(l,d,y),C;switch(b=fp(b==null?",f":b),b.type){case"s":{var k=Math.max(Math.abs(l),Math.abs(d));return b.precision==null&&!isNaN(C=lS(E,k))&&(b.precision=C),C0(b,k)}case"":case"e":case"g":case"p":case"r":{b.precision==null&&!isNaN(C=cS(E,Math.max(Math.abs(l),Math.abs(d))))&&(b.precision=C-(b.type==="e"));break}case"f":case"%":{b.precision==null&&!isNaN(C=aS(E))&&(b.precision=C-(b.type==="%")*2);break}}return I0(b)}function vS(l){var d=l.domain;return l.ticks=function(y){var b=d();return n2(b[0],b[b.length-1],y==null?10:y)},l.tickFormat=function(y,b){var E=d();return xS(E[0],E[E.length-1],y==null?10:y,b)},l.nice=function(y){y==null&&(y=10);var b=d(),E=0,C=b.length-1,k=b[E],o=b[C],O,B,$=10;for(o<k&&(B=k,k=o,o=B,B=E,E=C,C=B);$-- >0;){if(B=o0(k,o,y),B===O)return b[E]=k,b[C]=o,d(b);if(B>0)k=Math.floor(k/B)*B,o=Math.ceil(o/B)*B;else if(B<0)k=Math.ceil(k*B)/B,o=Math.floor(o*B)/B;else break;O=B}return l},l}function bS(){var l=yS();return l.copy=function(){return _S(l,bS())},uS.apply(l,arguments),vS(l)}function Jo(l){return function(){return l}}const py=Math.abs,Hi=Math.atan2,Os=Math.cos,wS=Math.max,Qd=Math.min,Pr=Math.sin,el=Math.sqrt,wn=1e-12,Wc=Math.PI,mp=Wc/2,TS=2*Wc;function ES(l){return l>1?0:l<-1?Wc:Math.acos(l)}function dy(l){return l>=1?mp:l<=-1?-mp:Math.asin(l)}function SS(l){return l.innerRadius}function AS(l){return l.outerRadius}function MS(l){return l.startAngle}function IS(l){return l.endAngle}function CS(l){return l&&l.padAngle}function zS(l,d,y,b,E,C,k,o){var O=y-l,B=b-d,$=k-E,D=o-C,G=D*O-$*B;if(!(G*G<wn))return G=($*(d-C)-D*(l-E))/G,[l+G*O,d+G*B]}function Fh(l,d,y,b,E,C,k){var o=l-y,O=d-b,B=(k?C:-C)/el(o*o+O*O),$=B*O,D=-B*o,G=l+$,J=d+D,xe=y+$,Pe=b+D,ve=(G+xe)/2,We=(J+Pe)/2,Xe=xe-G,Ze=Pe-J,He=Xe*Xe+Ze*Ze,je=E-C,Ge=G*Pe-xe*J,Tt=(Ze<0?-1:1)*el(wS(0,je*je*He-Ge*Ge)),yt=(Ge*Ze-Xe*Tt)/He,xt=(-Ge*Xe-Ze*Tt)/He,St=(Ge*Ze+Xe*Tt)/He,Ie=(-Ge*Xe+Ze*Tt)/He,rt=yt-ve,Je=xt-We,vt=St-ve,Be=Ie-We;return rt*rt+Je*Je>vt*vt+Be*Be&&(yt=St,xt=Ie),{cx:yt,cy:xt,x01:-$,y01:-D,x11:yt*(E/je-1),y11:xt*(E/je-1)}}function SA(){var l=SS,d=AS,y=Jo(0),b=null,E=MS,C=IS,k=CS,o=null;function O(){var B,$,D=+l.apply(this,arguments),G=+d.apply(this,arguments),J=E.apply(this,arguments)-mp,xe=C.apply(this,arguments)-mp,Pe=py(xe-J),ve=xe>J;if(o||(o=B=A0()),G<D&&($=G,G=D,D=$),!(G>wn))o.moveTo(0,0);else if(Pe>TS-wn)o.moveTo(G*Os(J),G*Pr(J)),o.arc(0,0,G,J,xe,!ve),D>wn&&(o.moveTo(D*Os(xe),D*Pr(xe)),o.arc(0,0,D,xe,J,ve));else{var We=J,Xe=xe,Ze=J,He=xe,je=Pe,Ge=Pe,Tt=k.apply(this,arguments)/2,yt=Tt>wn&&(b?+b.apply(this,arguments):el(D*D+G*G)),xt=Qd(py(G-D)/2,+y.apply(this,arguments)),St=xt,Ie=xt,rt,Je;if(yt>wn){var vt=dy(yt/D*Pr(Tt)),Be=dy(yt/G*Pr(Tt));(je-=vt*2)>wn?(vt*=ve?1:-1,Ze+=vt,He-=vt):(je=0,Ze=He=(J+xe)/2),(Ge-=Be*2)>wn?(Be*=ve?1:-1,We+=Be,Xe-=Be):(Ge=0,We=Xe=(J+xe)/2)}var mt=G*Os(We),Pt=G*Pr(We),Rt=D*Os(He),It=D*Pr(He);if(xt>wn){var Di=G*Os(Xe),ri=G*Pr(Xe),Li=D*Os(Ze),Ct=D*Pr(Ze),Yt;if(Pe<Wc&&(Yt=zS(mt,Pt,Li,Ct,Di,ri,Rt,It))){var Ai=mt-Yt[0],Ni=Pt-Yt[1],Bn=Di-Yt[0],ln=ri-Yt[1],cr=1/Pr(ES((Ai*Bn+Ni*ln)/(el(Ai*Ai+Ni*Ni)*el(Bn*Bn+ln*ln)))/2),Fn=el(Yt[0]*Yt[0]+Yt[1]*Yt[1]);St=Qd(xt,(D-Fn)/(cr-1)),Ie=Qd(xt,(G-Fn)/(cr+1))}}Ge>wn?Ie>wn?(rt=Fh(Li,Ct,mt,Pt,G,Ie,ve),Je=Fh(Di,ri,Rt,It,G,Ie,ve),o.moveTo(rt.cx+rt.x01,rt.cy+rt.y01),Ie<xt?o.arc(rt.cx,rt.cy,Ie,Hi(rt.y01,rt.x01),Hi(Je.y01,Je.x01),!ve):(o.arc(rt.cx,rt.cy,Ie,Hi(rt.y01,rt.x01),Hi(rt.y11,rt.x11),!ve),o.arc(0,0,G,Hi(rt.cy+rt.y11,rt.cx+rt.x11),Hi(Je.cy+Je.y11,Je.cx+Je.x11),!ve),o.arc(Je.cx,Je.cy,Ie,Hi(Je.y11,Je.x11),Hi(Je.y01,Je.x01),!ve))):(o.moveTo(mt,Pt),o.arc(0,0,G,We,Xe,!ve)):o.moveTo(mt,Pt),!(D>wn)||!(je>wn)?o.lineTo(Rt,It):St>wn?(rt=Fh(Rt,It,Di,ri,D,-St,ve),Je=Fh(mt,Pt,Li,Ct,D,-St,ve),o.lineTo(rt.cx+rt.x01,rt.cy+rt.y01),St<xt?o.arc(rt.cx,rt.cy,St,Hi(rt.y01,rt.x01),Hi(Je.y01,Je.x01),!ve):(o.arc(rt.cx,rt.cy,St,Hi(rt.y01,rt.x01),Hi(rt.y11,rt.x11),!ve),o.arc(0,0,D,Hi(rt.cy+rt.y11,rt.cx+rt.x11),Hi(Je.cy+Je.y11,Je.cx+Je.x11),ve),o.arc(Je.cx,Je.cy,St,Hi(Je.y11,Je.x11),Hi(Je.y01,Je.x01),!ve))):o.arc(0,0,D,He,Ze,ve)}if(o.closePath(),B)return o=null,B+""||null}return O.centroid=function(){var B=(+l.apply(this,arguments)+ +d.apply(this,arguments))/2,$=(+E.apply(this,arguments)+ +C.apply(this,arguments))/2-Wc/2;return[Os($)*B,Pr($)*B]},O.innerRadius=function(B){return arguments.length?(l=typeof B=="function"?B:Jo(+B),O):l},O.outerRadius=function(B){return arguments.length?(d=typeof B=="function"?B:Jo(+B),O):d},O.cornerRadius=function(B){return arguments.length?(y=typeof B=="function"?B:Jo(+B),O):y},O.padRadius=function(B){return arguments.length?(b=B==null?null:typeof B=="function"?B:Jo(+B),O):b},O.startAngle=function(B){return arguments.length?(E=typeof B=="function"?B:Jo(+B),O):E},O.endAngle=function(B){return arguments.length?(C=typeof B=="function"?B:Jo(+B),O):C},O.padAngle=function(B){return arguments.length?(k=typeof B=="function"?B:Jo(+B),O):k},O.context=function(B){return arguments.length?(o=B==null?null:B,O):o},O}function AA(l,d){return[(d=+d)*Math.cos(l-=Math.PI/2),d*Math.sin(l)]}export{TA as $,sA as A,x1 as B,Jv as C,pA as D,tA as E,kS as F,a1 as G,Nc as H,FS as I,PS as J,LS as K,RS as L,DS as M,YS as N,BS as O,HS as P,nA as Q,rA as R,hA as S,US as T,dA as U,KS as V,cg as W,u1 as X,GS as Y,_A as Z,mA as _,h1 as a,Jw as a0,fA as a1,Xw as a2,gA as a3,$S as a4,lg as a5,qS as a6,Gw as a7,bS as a8,SA as a9,AA as aa,EA as ab,Zf as ac,yA as ad,xA as ae,vA as af,wA as ag,bA as ah,aA as ai,iA as aj,VS as b,jS as c,qh as d,_y as e,WS as f,c1 as g,p1 as h,uA as i,XS as j,OS as k,NS as l,ZS as m,m1 as n,g1 as o,_1 as p,wy as q,eA as r,t1 as s,Nf as t,QS as u,JS as v,lA as w,cA as x,y1 as y,oA as z};
