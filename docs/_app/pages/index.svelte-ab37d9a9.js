import{S as Pn,i as Dn,s as Ln,e as Kt,c as Jt,b as We,g as Ki,d as bt,l as $a,M as Bm,F as oi,D as lo,H as Xd,I as Rm,a as sn,J as Fm,K as Om,L as Um,q as Br,o as $r,w as Xo,x as Rs,y as Ho,B as Yo,G as nm,k as Hu,t as Vm,m as Yu,h as Nm,N as om,O as ky,v as jm,P as Py,Q as sm,R as am,z as Dy,A as Ly,n as Gm,p as $m,C as By,r as Ry}from"../chunks/index-d98e54f8.js";function lm(C,I,U){const P=C.slice();return P[5]=I[U],P}function cm(C){let I,U;return{c(){I=Kt("link"),this.h()},l(P){I=Jt(P,"LINK",{rel:!0,href:!0,as:!0,type:!0,crossorigin:!0}),this.h()},h(){We(I,"rel","preload"),We(I,"href",U=C[5]),We(I,"as","font"),We(I,"type","font/woff2"),We(I,"crossorigin","")},m(P,V){Ki(P,I,V)},p(P,V){V&16&&U!==(U=P[5])&&We(I,"href",U)},d(P){P&&bt(I)}}}function Fy(C){let I,U,P,V,J,te,a,Ie,ge,le,H,me,_e,Be,mt,Ue,pt,ut,_t,rt,ft,qe,kt,vt,It,Ft;document.title=I=C[0]+" - The Pudding";let tt=C[4],Ot=[];for(let gt=0;gt<tt.length;gt+=1)Ot[gt]=cm(lm(C,tt,gt));return{c(){U=Kt("meta"),P=Kt("meta"),V=Kt("meta"),J=Kt("meta"),te=Kt("meta"),a=Kt("meta"),Ie=Kt("meta"),ge=Kt("meta"),le=Kt("meta"),H=Kt("meta"),_e=Kt("meta"),Be=Kt("meta"),mt=Kt("meta"),Ue=Kt("meta"),pt=Kt("meta"),ut=Kt("meta"),_t=Kt("meta"),rt=Kt("meta"),ft=Kt("meta"),kt=Kt("meta"),vt=Kt("link");for(let gt=0;gt<Ot.length;gt+=1)Ot[gt].c();Ft=$a(),this.h()},l(gt){const et=Bm('[data-svelte="svelte-e9ztej"]',document.head);U=Jt(et,"META",{name:!0,content:!0}),P=Jt(et,"META",{name:!0,content:!0}),V=Jt(et,"META",{name:!0,content:!0}),J=Jt(et,"META",{property:!0,content:!0}),te=Jt(et,"META",{property:!0,content:!0}),a=Jt(et,"META",{property:!0,content:!0}),Ie=Jt(et,"META",{property:!0,content:!0}),ge=Jt(et,"META",{property:!0,content:!0}),le=Jt(et,"META",{property:!0,content:!0}),H=Jt(et,"META",{property:!0,content:!0}),_e=Jt(et,"META",{property:!0,content:!0}),Be=Jt(et,"META",{property:!0,content:!0}),mt=Jt(et,"META",{property:!0,content:!0}),Ue=Jt(et,"META",{name:!0,content:!0}),pt=Jt(et,"META",{name:!0,content:!0}),ut=Jt(et,"META",{name:!0,content:!0}),_t=Jt(et,"META",{name:!0,content:!0}),rt=Jt(et,"META",{name:!0,content:!0}),ft=Jt(et,"META",{name:!0,content:!0}),kt=Jt(et,"META",{name:!0,content:!0}),vt=Jt(et,"LINK",{rel:!0,href:!0});for(let ze=0;ze<Ot.length;ze+=1)Ot[ze].l(et);Ft=$a(),et.forEach(bt),this.h()},h(){We(U,"name","description"),We(U,"content",C[1]),We(P,"name","author"),We(P,"content","The Pudding"),We(V,"name","news_keywords"),We(V,"content",C[3]),We(J,"property","og:title"),We(J,"content",C[0]),We(te,"property","og:site_name"),We(te,"content","The Pudding"),We(a,"property","og:url"),We(a,"content",C[2]),We(Ie,"property","og:description"),We(Ie,"content",C[1]),We(ge,"property","og:type"),We(ge,"content","article"),We(le,"property","og:locale"),We(le,"content","en_US"),We(H,"property","og:image"),We(H,"content",me=C[2]+"/assets/social-facebook.jpg"),We(_e,"property","og:image:type"),We(_e,"content","image/jpeg"),We(Be,"property","og:image:width"),We(Be,"content","1200"),We(mt,"property","og:image:height"),We(mt,"content","600"),We(Ue,"name","twitter:card"),We(Ue,"content","summary_large_image"),We(pt,"name","twitter:site"),We(pt,"content","https://pudding.cool"),We(ut,"name","twitter:creator"),We(ut,"content","@puddingviz"),We(_t,"name","twitter:title"),We(_t,"content",C[0]),We(rt,"name","twitter:description"),We(rt,"content",C[1]),We(ft,"name","twitter:image:src"),We(ft,"content",qe=C[2]+"/assets/social-twitter.jpg"),We(kt,"name","robots"),We(kt,"content","max-image-preview:large"),We(vt,"rel","canonical"),We(vt,"href",It=C[2]+"/")},m(gt,et){oi(document.head,U),oi(document.head,P),oi(document.head,V),oi(document.head,J),oi(document.head,te),oi(document.head,a),oi(document.head,Ie),oi(document.head,ge),oi(document.head,le),oi(document.head,H),oi(document.head,_e),oi(document.head,Be),oi(document.head,mt),oi(document.head,Ue),oi(document.head,pt),oi(document.head,ut),oi(document.head,_t),oi(document.head,rt),oi(document.head,ft),oi(document.head,kt),oi(document.head,vt);for(let ze=0;ze<Ot.length;ze+=1)Ot[ze].m(document.head,null);oi(document.head,Ft)},p(gt,[et]){if(et&1&&I!==(I=gt[0]+" - The Pudding")&&(document.title=I),et&2&&We(U,"content",gt[1]),et&8&&We(V,"content",gt[3]),et&1&&We(J,"content",gt[0]),et&4&&We(a,"content",gt[2]),et&2&&We(Ie,"content",gt[1]),et&4&&me!==(me=gt[2]+"/assets/social-facebook.jpg")&&We(H,"content",me),et&1&&We(_t,"content",gt[0]),et&2&&We(rt,"content",gt[1]),et&4&&qe!==(qe=gt[2]+"/assets/social-twitter.jpg")&&We(ft,"content",qe),et&4&&It!==(It=gt[2]+"/")&&We(vt,"href",It),et&16){tt=gt[4];let ze;for(ze=0;ze<tt.length;ze+=1){const St=lm(gt,tt,ze);Ot[ze]?Ot[ze].p(St,et):(Ot[ze]=cm(St),Ot[ze].c(),Ot[ze].m(Ft.parentNode,Ft))}for(;ze<Ot.length;ze+=1)Ot[ze].d(1);Ot.length=tt.length}},i:lo,o:lo,d(gt){bt(U),bt(P),bt(V),bt(J),bt(te),bt(a),bt(Ie),bt(ge),bt(le),bt(H),bt(_e),bt(Be),bt(mt),bt(Ue),bt(pt),bt(ut),bt(_t),bt(rt),bt(ft),bt(kt),bt(vt),Xd(Ot,gt),bt(Ft)}}}function Oy(C,I,U){let{title:P="Title TK"}=I,{description:V="Description TK"}=I,{url:J="https://pudding.cool"}=I,{keywords:te=""}=I,{preloadFont:a=[]}=I;return C.$$set=Ie=>{"title"in Ie&&U(0,P=Ie.title),"description"in Ie&&U(1,V=Ie.description),"url"in Ie&&U(2,J=Ie.url),"keywords"in Ie&&U(3,te=Ie.keywords),"preloadFont"in Ie&&U(4,a=Ie.preloadFont)},[P,V,J,te,a]}class Uy extends Pn{constructor(I){super(),Dn(this,I,Oy,Fy,Ln,{title:0,description:1,url:2,keywords:3,preloadFont:4})}}const Vy="Here is a sample headline",Ny="TK description",jy="https://pudding.cool",Gy="story",$y=[{block:"text",text:"Upward mobility is broadly defined as children having a better standard of living than their parents. There\u2019s no single way to measure a \u201Cbetter standard of living,\u201D but a child\u2019s income compared to their parent\u2019s is often used."},{block:"text",text:"Here\u2019s how upward mobility worked in my life."},{block:"text",text:"I was born in 1989 in the South Los Angeles suburb of Gardena, Calif."},{block:"image"},{block:"text",text:"My mother, grandparents and I lived on a classic American culdesac with modest single-family houses and manicured lawns. It was one of those blocks occupied by the same families for generations where everyone raised each other\u2019s kids."},{block:"image"},{block:"text",text:`At the time, I knew two things to be true: almost everyone looked like me, and it was hard to breathe. Oil wells and smog hung about like nosy neighbors. Our house was right off the 110 freeway, about 30 minutes south of Downtown LA and near industrial facilities ranging from concrete to gas. \r
\r
\r
My proximity to lousy air quality made breathing a chore, and my asthma didn\u2019t help either. Hospital visits were typical back then. \r
\r
\r
Once I entered first grade, I found reprieve from my neighborhood\u2019s air quality five days a week when I was bussed 15 miles northwest to the wealthy, seaside city of Playa Del Rey to attend a magnet elementary school.`},{block:"image"},{block:"text",text:`The first thing I noticed was the air. Playa Del Rey\u2019s proximity to the Pacific Ocean made the environment crisp; cool. I breathed better. I could run more. I could focus.\r
\r
\r
The second thing I noticed was the lack of Black folk. The majority of Black kids came with me on the bus. I was 6 years old when I noticed this pattern\u2014this association between better quality of life and the lack of Black families nearby. \r
\r
\r
Every Black person has this moment. In The Souls of Black Folk, written at the turn of the 20th Century, W.E.B. Du Bois describes this moment well:\r
\r
\r
\u201CThen it dawned upon me,\u201D he writes, \u201Cwith a certain suddenness that I was different from the others\u2026but shut out from their world by a vast veil.\u201D\r
\r
\r
I observed at 6 years old that a \u201Cveil\u201D separated me from my non-Black peers on the playground; perhaps not spatially like segregation in the South; but something just as visceral; real. \r
\r
\r
First grade was the last year I would attend grade school in Southern California. My mother would soon move me to a new place where she hoped to bring me, and herself, new opportunities. We would migrate north in search of something better.`},{block:"image"},{block:"subhead",text:"Migration"},{block:"text",text:`When my grandparents moved from the South to California in the 1940s, they were part of one of the largest migrations in American history. \r
\r
\r
The Great Migration, beautifully depicted in Isabel Wilkerson\u2019s The Warmth of Other Suns, is a story of holding the American Dream to its word. From 1910 to 1970, Black folk from across the American South would leave it in search of new opportunities, hoping that their fortunes would change and that of their progeny.`},{block:"map"},{block:"text",text:`Key to this migration is the concept of upward mobility.\r
\r
\r
My mother understood this, too. She wanted opportunities for me that she didn\u2019t have growing up, just as my grandparents had done for her. \r
\r
\r
When my mother\u2019s family migrated from Oklahoma and Arkansas to California in the 1940s, they settled in the California central valley towns of Fairmead, Chowchilla and Madera. There, they worked as farmers and fieldhands, mostly on almonds. My mom was born there and would spend her early years growing up in a makeshift house with many of my cousins.`},{block:"image"},{block:"text",text:"Years later, swaths of my family migrated out of farm country for better opportunities. Some went north to the Bay Area, settling primarily in Menlo Park and East Palo Alto. My mother\u2019s family was part of the cohort that went south to Los Angeles, settling primarily in LA\u2019s Crenshaw district and farther south in Compton."},{block:"image"},{block:"text",text:"My grandparents had different plans. Unlike the rest of my family, they settled us in a quaint, upwardly mobile neighborhood on the eastern edge of Gardena (or West Compton if you ask Google Maps). My mother told me they did this because my grandparents wanted to provide a better life for them."},{block:"image"},{block:"text",text:`A few decades later, it was her turn to do the same. My mother\u2019s job was closing its Los Angeles location and gave her two options: Either take a buyout or keep her job and relocate to the San Francisco office.\r
\r
\r
So, in the summer of 1996, when I was 7 years old, my mom moved us 373 miles north to Fremont, Calif. The city is on the east end of the Dumbarton Bridge, which connects Fremont to Menlo Park, making it an ideal location because we had family nearby. Or, at least, we did until the high cost of living forced them to move back to the Central Valley.`},{block:"image"},{block:"text",text:"We settled in a charming apartment in the Centerville District near the Fremont BART train station. Just up the street was a cornfield owned by a local family. Just east of us was the East Bay hillside. Cows grazed on the verdant grass while songbirds chirped. Drivers stopped for passing families of deer that wandered into the city streets."},{block:"image"},{block:"text",text:`It was there I noticed it again.\r
\r
\r
The air was crisp; cool. I could jump. I could sing. Except for this time, it wasn\u2019t just for the few hours I spent at school. It was every day.`},{block:"subhead",text:"Upward Mobility"},{block:"text",text:`In March of 2018, Raj Chetty, an economist at Harvard, and a team of researchers sought to estimate upward mobility across socioeconomic lines. Using anonymized census data and tax records of roughly 20 million Americans, he and his team predicted outcomes for children born between 1978 and 1983 to when they were in their 30s (around 2015). \r
\r
\r
They published much of this work via the Opportunity Insights nonprofit. Chetty et al.\u2019s work would be widely covered and was the source of powerful data visualizations from the New York Times.\r
\r
\r
Among Chetty\u2019s findings was the importance of geographical location. Research showed that outcomes for children could vary widely even when their neighborhoods were as little as a mile apart. Furthermore, the age at which someone moves has a profound impact on their future earnings but only up until a limit.\r
\r
\r
Let\u2019s return to Gardena to see these concepts in action.`},{block:"image"},{block:"text",text:"According to Opportunity Insights and U.S. census data, around 351 kids lived in my neighborhood in Gardena. It was about evenly split between Black (48%) and Hispanic (43%) kids."},{block:"image"},{block:"text",text:"Of the 171 Black kids in my neighborhood, almost half had parents who made over $74,000. I was one of them."},{block:"image"},{block:"text",text:"Black kids like me with parents in high-income percentiles from my neighborhood in Gardena are predicted to make $38,000 by 35 years old, placing them just above the median predicted income for Black kids across the U.S. with similar backgrounds ($32,000)."},{block:"image"},{block:"text",text:"But, Black boys from my neighborhood fare even better. Black boys whose parents are in the top 25% of earners are predicted to make $61,000, ranking about the highest predicted incomes for boys of any race."},{block:"image"},{block:"text",text:"These markers of high predicted income did not persist just east of our neighborhood."},{block:"image"},{block:"text",text:"The predicted income for Black boys with parents who made the same as my mother in the neighborhoods surrounding mine plummeted by more than 50%."},{block:"text",text:"So, what happened once we moved to Fremont?"},{block:"image"},{block:"text",text:`My Fremont neighborhood had roughly 1,200 kids. 4% (51) were Black. \r
\r
\r
And when it came to income, my predicted outcomes did improve. \r
\r
\r
There isn\u2019t sufficient data for Black boys whose parents made the same income as my mother in Fremont, but Black kids, in general, are predicted to have a household income of $49,000, an $11,000 increase from Gardena.`},{block:"image"},{block:"text",text:`Had my mother\u2019s job never terminated their LA location and offered to move us to the Bay Area, or had my family decided to stay in Compton instead of Gardena, I could\u2019ve had a different life.\r
\r
\r
The data I\u2019ve presented offers an interesting exercise in what could have been. And in many cases, I can point to instances in my life where this shift happens.`},{block:"subhead",text:"Conclusion"},{block:"text",text:`As an adult, I zigzagged across California, first attending college in San Francisco, and then working as a data journalist across the state. In 2015 I moved 3,000 miles east to work at the Washington Post. I was looking for better opportunities.\r
\r
\r
In the fall of 2021, my partner and I decided to move back to Los Angeles, returning to the area that has defined my family for almost a century.\r
\r
\r
As soon as I got a chance, I drove south to Gardena to see my old neighborhood. \r
\r
\r
I thought about the opportunities this neighborhood gave my family; gave me.\r
\r
\r
It now seems those opportunities dwindled.\r
\r
\r
In 1990, my Gardena neighborhood had a median household income of $81,000. In Fremont, the neighborhood we moved to had a similar median household income of $84,000.\r
\r
\r
And yet, according to 2012-2016 census estimates, the median household income in my Fremont neighborhood increased by 42% to $120,000. Over the same period, the median household income in my Gardena neighborhood decreased by 50% to $40,000.`},{block:"image"},{block:"text",text:`I can hypothesize about what changed. It could be because of the new Great Migration of Black folk from northern and western cities back to the South. It could be that Gardena\u2019s Hispanic population increased from 1990 to 2020 \u2014 a community that suffers many of the same racial injustices as Black communities. It could be because Fremont is next door to Silicon Valley and home to the most productive auto facility in the country. It could be because, according to Chetty\u2019s research, generational mobility for Americans dropped from 90% in the 1940s to 50% by the 1980s, meaning kids are more likely to make less than their parents.\r
\r
\r
All I know is that the \u201Cveil\u201D Du Bois described more than 100 years earlier, the same one I saw in the first grade, remains. \r
\r
\r
There\u2019s so much value in Black folk. Our art, culture and politics cannot be separated from what makes the United States what it is. And yet, our physical presence isn\u2019t valued in the same way. \r
\r
\r
Upward mobility is important because as Chetty et al.\u2019s research shows, your place of origin can wholly reshape your economic opportunities. \r
\r
\r
But, a place is more than the opportunity it provides. What makes a place is the people who live there.`}];var gc={title:Vy,description:Ny,url:jy,keywords:Gy,blocks:$y};function Zy(C){let I,U,P;const V=C[3].default,J=Rm(V,C,C[2],null);return{c(){I=Kt("div"),J&&J.c(),this.h()},l(te){I=Jt(te,"DIV",{id:!0,class:!0});var a=sn(I);J&&J.l(a),a.forEach(bt),this.h()},h(){We(I,"id",C[0]),We(I,"class",U=`block ${C[1]} w-full max-w-3xl mb-4 mx-auto`)},m(te,a){Ki(te,I,a),J&&J.m(I,null),P=!0},p(te,[a]){J&&J.p&&(!P||a&4)&&Fm(J,V,te,te[2],P?Um(V,te[2],a,null):Om(te[2]),null),(!P||a&1)&&We(I,"id",te[0]),(!P||a&2&&U!==(U=`block ${te[1]} w-full max-w-3xl mb-4 mx-auto`))&&We(I,"class",U)},i(te){P||(Br(J,te),P=!0)},o(te){$r(J,te),P=!1},d(te){te&&bt(I),J&&J.d(te)}}}function qy(C,I,U){let{$$slots:P={},$$scope:V}=I,{id:J}=I,{type:te}=I;return C.$$set=a=>{"id"in a&&U(0,J=a.id),"type"in a&&U(1,te=a.type),"$$scope"in a&&U(2,V=a.$$scope)},[J,te,V,P]}class Hd extends Pn{constructor(I){super(),Dn(this,I,qy,Zy,Ln,{id:0,type:1})}}function um(C,I,U){const P=C.slice();return P[3]=I[U],P[5]=U,P}function hm(C){let I,U=C[3]+"";return{c(){I=Kt("p"),this.h()},l(P){I=Jt(P,"P",{class:!0});var V=sn(I);V.forEach(bt),this.h()},h(){We(I,"class","mb-4")},m(P,V){Ki(P,I,V),I.innerHTML=U},p(P,V){V&2&&U!==(U=P[3]+"")&&(I.innerHTML=U)},d(P){P&&bt(I)}}}function Wy(C){let I,U=C[1],P=[];for(let V=0;V<U.length;V+=1)P[V]=hm(um(C,U,V));return{c(){for(let V=0;V<P.length;V+=1)P[V].c();I=$a()},l(V){for(let J=0;J<P.length;J+=1)P[J].l(V);I=$a()},m(V,J){for(let te=0;te<P.length;te+=1)P[te].m(V,J);Ki(V,I,J)},p(V,J){if(J&2){U=V[1];let te;for(te=0;te<U.length;te+=1){const a=um(V,U,te);P[te]?P[te].p(a,J):(P[te]=hm(a),P[te].c(),P[te].m(I.parentNode,I))}for(;te<P.length;te+=1)P[te].d(1);P.length=U.length}},d(V){Xd(P,V),V&&bt(I)}}}function Xy(C){let I,U;return I=new Hd({props:{id:C[0],type:"text",$$slots:{default:[Wy]},$$scope:{ctx:C}}}),{c(){Xo(I.$$.fragment)},l(P){Rs(I.$$.fragment,P)},m(P,V){Ho(I,P,V),U=!0},p(P,[V]){const J={};V&1&&(J.id=P[0]),V&66&&(J.$$scope={dirty:V,ctx:P}),I.$set(J)},i(P){U||(Br(I.$$.fragment,P),U=!0)},o(P){$r(I.$$.fragment,P),U=!1},d(P){Yo(I,P)}}}function Hy(C,I,U){let{id:P}=I,{text:V}=I,{grafs:J=V.split(`
`)}=I;return C.$$set=te=>{"id"in te&&U(0,P=te.id),"text"in te&&U(2,V=te.text),"grafs"in te&&U(1,J=te.grafs)},[P,J,V]}class Pd extends Pn{constructor(I){super(),Dn(this,I,Hy,Xy,Ln,{id:0,text:2,grafs:1})}}function Yy(C){let I;return{c(){I=Kt("h2"),this.h()},l(U){I=Jt(U,"H2",{class:!0});var P=sn(I);P.forEach(bt),this.h()},h(){We(I,"class","text-xl")},m(U,P){Ki(U,I,P),I.innerHTML=C[1]},p(U,P){P&2&&(I.innerHTML=U[1])},d(U){U&&bt(I)}}}function Ky(C){let I,U;return I=new Hd({props:{id:C[0],type:"subhead",$$slots:{default:[Yy]},$$scope:{ctx:C}}}),{c(){Xo(I.$$.fragment)},l(P){Rs(I.$$.fragment,P)},m(P,V){Ho(I,P,V),U=!0},p(P,[V]){const J={};V&1&&(J.id=P[0]),V&6&&(J.$$scope={dirty:V,ctx:P}),I.$set(J)},i(P){U||(Br(I.$$.fragment,P),U=!0)},o(P){$r(I.$$.fragment,P),U=!1},d(P){Yo(I,P)}}}function Jy(C,I,U){let{id:P}=I,{text:V}=I;return C.$$set=J=>{"id"in J&&U(0,P=J.id),"text"in J&&U(1,V=J.text)},[P,V]}class Qy extends Pn{constructor(I){super(),Dn(this,I,Jy,Ky,Ln,{id:0,text:1})}}function ex(C){let I,U;return{c(){I=Kt("img"),this.h()},l(P){I=Jt(P,"IMG",{src:!0,alt:!0}),this.h()},h(){nm(I.src,U=C[1])||We(I,"src",U),We(I,"alt",C[2])},m(P,V){Ki(P,I,V)},p(P,V){V&2&&!nm(I.src,U=P[1])&&We(I,"src",U),V&4&&We(I,"alt",P[2])},d(P){P&&bt(I)}}}function tx(C){let I,U;return I=new Hd({props:{id:C[0],type:"image",$$slots:{default:[ex]},$$scope:{ctx:C}}}),{c(){Xo(I.$$.fragment)},l(P){Rs(I.$$.fragment,P)},m(P,V){Ho(I,P,V),U=!0},p(P,[V]){const J={};V&1&&(J.id=P[0]),V&14&&(J.$$scope={dirty:V,ctx:P}),I.$set(J)},i(P){U||(Br(I.$$.fragment,P),U=!0)},o(P){$r(I.$$.fragment,P),U=!1},d(P){Yo(I,P)}}}function ix(C,I,U){let{id:P}=I,{src:V="https://via.placeholder.com/800x300"}=I,{alt:J}=I;return C.$$set=te=>{"id"in te&&U(0,P=te.id),"src"in te&&U(1,V=te.src),"alt"in te&&U(2,J=te.alt)},[P,V,J]}class rx extends Pn{constructor(I){super(),Dn(this,I,ix,tx,Ln,{id:0,src:1,alt:2})}}var nx=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Zm={exports:{}};(function(C,I){(function(U,P){C.exports=P()})(nx,function(){var U,P,V;function J(a,Ie){if(!U)U=Ie;else if(!P)P=Ie;else{var ge="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+U+")(sharedChunk); ("+P+")(sharedChunk); self.onerror = null;",le={};U(le),V=Ie(le),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(V.workerUrl=window.URL.createObjectURL(new Blob([ge],{type:"text/javascript"})))}}J(["exports"],function(a){var Ie="2.8.2",ge=le;function le(i,e,r,n){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=r,this.p2y=n}le.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},le.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},le.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},le.prototype.solveCurveX=function(i,e){var r,n,s,c,h;for(e===void 0&&(e=1e-6),s=i,h=0;h<8;h++){if(c=this.sampleCurveX(s)-i,Math.abs(c)<e)return s;var d=this.sampleCurveDerivativeX(s);if(Math.abs(d)<1e-6)break;s-=c/d}if((s=i)<(r=0))return r;if(s>(n=1))return n;for(;r<n;){if(c=this.sampleCurveX(s),Math.abs(c-i)<e)return s;i>c?r=s:n=s,s=.5*(n-r)+r}return s},le.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var H=me;function me(i,e){this.x=i,this.y=e}me.prototype={clone:function(){return new me(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(i,e){var r=Math.cos(i),n=Math.sin(i),s=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},me.convert=function(i){return i instanceof me?i:Array.isArray(i)?new me(i[0],i[1]):i};var _e=typeof self!="undefined"?self:{};const Be=Math.PI/180,mt=180/Math.PI;function Ue(i){return i*Be}function pt(i){return i*mt}const ut=[[0,0],[1,0],[1,1],[0,1]];function _t(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function rt(i,e,r,n){const s=new ge(i,e,r,n);return function(c){return s.solve(c)}}const ft=rt(.25,.1,.25,1);function qe(i,e,r){return Math.min(r,Math.max(e,i))}function kt(i,e,r){return(r=qe((r-i)/(e-i),0,1))*r*(3-2*r)}function vt(i,e,r){const n=r-e,s=((i-e)%n+n)%n+e;return s===e?r:s}function It(i,e,r){if(!i.length)return r(null,[]);let n=i.length;const s=new Array(i.length);let c=null;i.forEach((h,d)=>{e(h,(m,g)=>{m&&(c=m),s[d]=g,--n==0&&r(c,s)})})}function Ft(i){const e=[];for(const r in i)e.push(i[r]);return e}function tt(i,...e){for(const r of e)for(const n in r)i[n]=r[n];return i}let Ot=1;function gt(){return Ot++}function et(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function ze(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function St(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function si(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ai(i,e){return i.indexOf(e,i.length-e.length)!==-1}function vi(i,e,r){const n={};for(const s in i)n[s]=e.call(r||this,i[s],s,i);return n}function Tr(i,e,r){const n={};for(const s in i)e.call(r||this,i[s],s,i)&&(n[s]=i[s]);return n}function yi(i){return Array.isArray(i)?i.map(yi):typeof i=="object"&&i?vi(i,yi):i}const cr={};function Lt(i){cr[i]||(typeof console!="undefined"&&console.warn(i),cr[i]=!0)}function bi(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Ni(i){let e=0;for(let r,n,s=0,c=i.length,h=c-1;s<c;h=s++)r=i[s],n=i[h],e+=(n.x-r.x)*(r.y+n.y);return e}function Er(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function uo(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,s,c)=>{const h=s||c;return e[n]=!h||h.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let an,Ko,Bn,Rr,Bt=null;function ln(i){if(Bt==null){const e=i.navigator?i.navigator.userAgent:null;Bt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Bt}function Vs(i){try{const e=_e[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const $i={now:()=>Bn!==void 0?Bn:_e.performance.now(),setNow(i){Bn=i},restoreNow(){Bn=void 0},frame(i){const e=_e.requestAnimationFrame(i);return{cancel:()=>_e.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:r,height:n}=i;Rr||(Rr=_e.document.createElement("canvas"));const s=Rr.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return(r>Rr.width||n>Rr.height)&&(Rr.width=r,Rr.height=n),s.clearRect(-e,-e,r+2*e,n+2*e),s.drawImage(i,0,0,r,n),s.getImageData(-e,-e,r+2*e,n+2*e)},resolveURL:i=>(an||(an=_e.document.createElement("a")),an.href=i,an.href),get devicePixelRatio(){return _e.devicePixelRatio},get prefersReducedMotion(){return!!_e.matchMedia&&(Ko==null&&(Ko=_e.matchMedia("(prefers-reduced-motion: reduce)")),Ko.matches)}};let Rn;const Nt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Rn==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Rn={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{Rn=i}}return Rn},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},cn={supported:!1,testSupport:function(i){!On&&ur&&(ho?Jo(i):Fn=i)}};let Fn,ur,On=!1,ho=!1;function Jo(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,ur),i.isContextLost())return;cn.supported=!0}catch{}i.deleteTexture(e),On=!0}_e.document&&(ur=_e.document.createElement("img"),ur.onload=function(){Fn&&Jo(Fn),Fn=null,ho=!0},ur.onerror=function(){On=!0,Fn=null},ur.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const po="01",Un="NO_ACCESS_TOKEN";function Sr(i){return i.indexOf("mapbox:")===0}function Vn(i){return Nt.API_URL_REGEX.test(i)}const Ir=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mr(i){const e=i.match(Ir);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function un(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function Qo(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(_e.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Nn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Qo(Nt.ACCESS_TOKEN);let n="";return n=r&&r.u?_e.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(s,c)=>String.fromCharCode(Number("0x"+c)))):Nt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=Vs("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const s=_e.localStorage.getItem(r);s&&(this.eventData=JSON.parse(s));const c=_e.localStorage.getItem(n);c&&(this.anonId=c)}catch{Lt("Unable to read from LocalStorage")}}saveEventData(){const e=Vs("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{_e.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&_e.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Lt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,n,s){if(!Nt.EVENTS_URL)return;const c=Mr(Nt.EVENTS_URL);c.params.push(`access_token=${s||Nt.ACCESS_TOKEN||""}`);const h={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Ie,skuId:po,userId:this.anonId},d=r?tt(h,r):h,m={url:un(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([d])};this.pendingRequest=ie(m,g=>{this.pendingRequest=null,n(g),this.saveEventData(),this.processRequests(s)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const fo=new class extends Nn{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Nt.EVENTS_URL&&Nt.ACCESS_TOKEN&&Array.isArray(i)&&i.some(r=>Sr(r)||Vn(r))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Qo(Nt.ACCESS_TOKEN),r=e?e.u:Nt.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;St(this.anonId)||(this.anonId=et(),n=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),h=new Date(s),d=(s-this.eventData.lastSuccess)/864e5;n=n||d>=1||d<-1||c.getDate()!==h.getDate()}else n=!0;n?this.postEvent(s,{"enabled.telemetry":!1},c=>{c||(this.eventData.lastSuccess=s,this.eventData.tokenU=r)},i):this.processRequests()}},Xa=fo.postTurnstileEvent.bind(fo),Ns=new class extends Nn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,r,n){this.skuToken=e,this.errorCb=n,Nt.EVENTS_URL&&(r||Nt.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(Un)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),St(this.anonId)||(this.anonId=et()),this.postEvent(r,{skuToken:this.skuToken},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i))}},js=Ns.postMapLoadEvent.bind(Ns),mo=new class extends Nn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,r,n){if(!Nt.API_URL||!Nt.SESSION_PATH)return;const s=Mr(Nt.API_URL+Nt.SESSION_PATH);s.params.push(`sku=${e||""}`),s.params.push(`access_token=${n||Nt.ACCESS_TOKEN||""}`);const c={url:un(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ue(c,h=>{this.pendingRequest=null,r(h),this.saveEventData(),this.processRequests(n)})}getSessionAPI(i,e,r,n){this.skuToken=e,this.errorCb=n,Nt.SESSION_PATH&&Nt.API_URL&&(r||Nt.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(Un)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i)}},Gs=mo.getSessionAPI.bind(mo),jn=new Set,$s="mapbox-tiles";let Ar,hn,Gn=500,$n=50;function _o(){_e.caches&&!Ar&&(Ar=_e.caches.open($s))}function es(i){const e=i.indexOf("?");return e<0?i:i.slice(0,e)}let go=1/0;const $={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze($);class M extends Error{constructor(e,r,n){r===401&&Vn(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const k=Er()?()=>self.worker&&self.worker.referrer:()=>(_e.location.protocol==="blob:"?_e.parent:_e).location.href,N=function(i,e){if(!(/^file:/.test(r=i.url)||/^file:/.test(k())&&!/^\w+:/.test(r))){if(_e.fetch&&_e.Request&&_e.AbortController&&_e.Request.prototype.hasOwnProperty("signal"))return function(n,s){const c=new _e.AbortController,h=new _e.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:k(),signal:c.signal});let d=!1,m=!1;const g=(x=h.url).indexOf("sku=")>0&&Vn(x);var x;n.type==="json"&&h.headers.set("Accept","application/json");const v=(S,z,L)=>{if(m)return;if(S&&S.message!=="SecurityError"&&Lt(S),z&&L)return w(z);const F=Date.now();_e.fetch(h).then(G=>{if(G.ok){const Q=g?G.clone():null;return w(G,Q,F)}return s(new M(G.statusText,G.status,n.url))}).catch(G=>{G.code!==20&&s(new Error(G.message))})},w=(S,z,L)=>{(n.type==="arrayBuffer"?S.arrayBuffer():n.type==="json"?S.json():S.text()).then(F=>{m||(z&&L&&function(G,Q,re){if(_o(),!Ar)return;const oe={status:Q.status,statusText:Q.statusText,headers:new _e.Headers};Q.headers.forEach((ve,we)=>oe.headers.set(we,ve));const se=uo(Q.headers.get("Cache-Control")||"");if(se["no-store"])return;se["max-age"]&&oe.headers.set("Expires",new Date(re+1e3*se["max-age"]).toUTCString());const ae=oe.headers.get("Expires");ae&&(new Date(ae).getTime()-re<42e4||function(ve,we){if(hn===void 0)try{new Response(new ReadableStream),hn=!0}catch{hn=!1}hn?we(ve.body):ve.blob().then(we)}(Q,ve=>{const we=new _e.Response(ve,oe);_o(),Ar&&Ar.then(Me=>Me.put(es(G.url),we)).catch(Me=>Lt(Me.message))}))}(h,z,L),d=!0,s(null,F,S.headers.get("Cache-Control"),S.headers.get("Expires")))}).catch(F=>{m||s(new Error(F.message))})};return g?function(S,z){if(_o(),!Ar)return z(null);const L=es(S.url);Ar.then(F=>{F.match(L).then(G=>{const Q=function(re){if(!re)return!1;const oe=new Date(re.headers.get("Expires")||0),se=uo(re.headers.get("Cache-Control")||"");return oe>Date.now()&&!se["no-cache"]}(G);F.delete(L),Q&&F.put(L,G.clone()),z(null,G,Q)}).catch(z)}).catch(z)}(h,v):v(null,null),{cancel:()=>{m=!0,d||c.abort()}}}(i,e);if(Er()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(n,s){const c=new _e.XMLHttpRequest;c.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const h in n.headers)c.setRequestHeader(h,n.headers[h]);return n.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=n.credentials==="include",c.onerror=()=>{s(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let h=c.response;if(n.type==="json")try{h=JSON.parse(c.response)}catch(d){return s(d)}s(null,h,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else s(new M(c.statusText,c.status,n.url))},c.send(n.body),{cancel:()=>c.abort()}}(i,e)},Y=function(i,e){return N(tt(i,{type:"arrayBuffer"}),e)},ie=function(i,e){return N(tt(i,{method:"POST"}),e)},ue=function(i,e){return N(tt(i,{method:"GET"}),e)};function ce(i){const e=_e.document.createElement("a");return e.href=i,e.protocol===_e.document.location.protocol&&e.host===_e.document.location.host}const ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let pe,Ae;pe=[],Ae=0;const je=function(i,e){if(cn.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Ae>=Nt.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return pe.push(c),c}Ae++;let r=!1;const n=()=>{if(!r)for(r=!0,Ae--;pe.length&&Ae<Nt.MAX_PARALLEL_IMAGE_REQUESTS;){const c=pe.shift(),{requestParameters:h,callback:d,cancelled:m}=c;m||(c.cancel=je(h,d).cancel)}},s=Y(i,(c,h,d,m)=>{n(),c?e(c):h&&(_e.createImageBitmap?function(g,x){const v=new _e.Blob([new Uint8Array(g)],{type:"image/png"});_e.createImageBitmap(v).then(w=>{x(null,w)}).catch(w=>{x(new Error(`Could not load image because of ${w.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(g,x)=>e(g,x,d,m)):function(g,x){const v=new _e.Image,w=_e.URL;v.onload=()=>{x(null,v),w.revokeObjectURL(v.src),v.onload=null,_e.requestAnimationFrame(()=>{v.src=ne})},v.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const S=new _e.Blob([new Uint8Array(g)],{type:"image/png"});v.src=g.byteLength?w.createObjectURL(S):ne}(h,(g,x)=>e(g,x,d,m)))});return{cancel:()=>{s.cancel(),n()}}};function ke(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function lt(i,e,r){if(r&&r[i]){const n=r[i].indexOf(e);n!==-1&&r[i].splice(n,1)}}class nt{constructor(e,r={}){tt(this,r),this.type=e}}class ot extends nt{constructor(e,r={}){super("error",tt({error:e},r))}}class ht{on(e,r){return this._listeners=this._listeners||{},ke(e,r,this._listeners),this}off(e,r){return lt(e,r,this._listeners),lt(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},ke(e,r,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,r){typeof e=="string"&&(e=new nt(e,r||{}));const n=e.type;if(this.listens(n)){e.target=this;const s=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const d of s)d.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const d of c)lt(n,d,this._oneTimeListeners),d.call(this,e);const h=this._eventedParent;h&&(tt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof ot&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var fe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function jt(i,...e){for(const r of e)for(const n in r)i[n]=r[n];return i}function Je(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ut(i){if(Array.isArray(i))return i.map(Ut);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Ut(i[r]);return e}return Je(i)}class Gt extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Zn{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[n,s]of r)this.bindings[n]=s}concat(e){return new Zn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const qr={kind:"null"},Ne={kind:"number"},Pt={kind:"string"},Mt={kind:"boolean"},Fr={kind:"color"},qn={kind:"object"},Ct={kind:"value"},Wn={kind:"collator"},yo={kind:"formatted"},ji={kind:"resolvedImage"};function hr(i,e){return{kind:"array",itemType:i,N:e}}function li(i){if(i.kind==="array"){const e=li(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const oh=[qr,Ne,Pt,Mt,Fr,yo,qn,hr(Ct),ji];function ts(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ts(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of oh)if(!ts(r,e))return null}}return`Expected ${li(i)} but found ${li(e)} instead.`}function Zs(i,e){return e.some(r=>r.kind===i.kind)}function xo(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function qs(i){var e={exports:{}};return i(e,e.exports),e.exports}var Ha=qs(function(i,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(d){return(d=Math.round(d))<0?0:d>255?255:d}function s(d){return n(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function c(d){return(m=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:m>1?1:m;var m}function h(d,m,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?d+(m-d)*g*6:2*g<1?m:3*g<2?d+(m-d)*(2/3-g)*6:d}try{e.parseCSSColor=function(d){var m,g=d.replace(/ /g,"").toLowerCase();if(g in r)return r[g].slice();if(g[0]==="#")return g.length===4?(m=parseInt(g.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:g.length===7&&(m=parseInt(g.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var x=g.indexOf("("),v=g.indexOf(")");if(x!==-1&&v+1===g.length){var w=g.substr(0,x),S=g.substr(x+1,v-(x+1)).split(","),z=1;switch(w){case"rgba":if(S.length!==4)return null;z=c(S.pop());case"rgb":return S.length!==3?null:[s(S[0]),s(S[1]),s(S[2]),z];case"hsla":if(S.length!==4)return null;z=c(S.pop());case"hsl":if(S.length!==3)return null;var L=(parseFloat(S[0])%360+360)%360/360,F=c(S[1]),G=c(S[2]),Q=G<=.5?G*(F+1):G+F-G*F,re=2*G-Q;return[n(255*h(re,Q,L+1/3)),n(255*h(re,Q,L)),n(255*h(re,Q,L-1/3)),z];default:return null}}return null}}catch{}});class Vt{constructor(e,r,n,s=1){this.r=e,this.g=r,this.b=n,this.a=s}static parse(e){if(!e)return;if(e instanceof Vt)return e;if(typeof e!="string")return;const r=Ha.parseCSSColor(e);return r?new Vt(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,n,s]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(n)},${s})`}toArray(){const{r:e,g:r,b:n,a:s}=this;return s===0?[0,0,0,0]:[255*e/s,255*r/s,255*n/s,s]}}Vt.black=new Vt(0,0,0,1),Vt.white=new Vt(1,1,1,1),Vt.transparent=new Vt(0,0,0,0),Vt.red=new Vt(1,0,0,1),Vt.blue=new Vt(0,0,1,1);class vo{constructor(e,r,n){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ya{constructor(e,r,n,s,c){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=n,this.fontStack=s,this.textColor=c}}class Mi{constructor(e){this.sections=e}static fromString(e){return new Mi([new Ya(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Mi?e:Mi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(n)}return e}}class Ji{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ji({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Cr(i,e,r,n){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,e,r,n]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ws(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Vt||i instanceof vo||i instanceof Mi||i instanceof Ji)return!0;if(Array.isArray(i)){for(const e of i)if(!Ws(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ws(i[e]))return!1;return!0}return!1}function wi(i){if(i===null)return qr;if(typeof i=="string")return Pt;if(typeof i=="boolean")return Mt;if(typeof i=="number")return Ne;if(i instanceof Vt)return Fr;if(i instanceof vo)return Wn;if(i instanceof Mi)return yo;if(i instanceof Ji)return ji;if(Array.isArray(i)){const e=i.length;let r;for(const n of i){const s=wi(n);if(r){if(r===s)continue;r=Ct;break}r=s}return hr(r||Ct,e)}return qn}function Wr(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Vt||i instanceof Mi||i instanceof Ji?i.toString():JSON.stringify(i)}class Xr{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ws(e[1]))return r.error("invalid value");const n=e[1];let s=wi(n);const c=r.expectedType;return s.kind!=="array"||s.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(s=c),new Xr(s,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vt?["rgba"].concat(this.value.toArray()):this.value instanceof Mi?this.value.serialize():this.value}}class Bi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ka={string:Pt,number:Ne,boolean:Mt,object:qn};class zr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n,s=1;const c=e[0];if(c==="array"){let d,m;if(e.length>2){const g=e[1];if(typeof g!="string"||!(g in Ka)||g==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);d=Ka[g],s++}else d=Ct;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);m=e[2],s++}n=hr(d,m)}else n=Ka[c];const h=[];for(;s<e.length;s++){const d=r.parse(e[s],s,Ct);if(!d)return null;h.push(d)}return new zr(n,h)}evaluate(e){for(let r=0;r<this.args.length;r++){const n=this.args[r].evaluate(e);if(!ts(this.type,wi(n)))return n;if(r===this.args.length-1)throw new Bi(`Expected value to be of type ${li(this.type)}, but found ${li(wi(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){r.push(n.kind);const s=e.N;(typeof s=="number"||this.args.length>1)&&r.push(s)}}return r.concat(this.args.map(n=>n.serialize()))}}class bo{constructor(e){this.type=yo,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");const s=[];let c=!1;for(let h=1;h<=e.length-1;++h){const d=e[h];if(c&&typeof d=="object"&&!Array.isArray(d)){c=!1;let m=null;if(d["font-scale"]&&(m=r.parse(d["font-scale"],1,Ne),!m))return null;let g=null;if(d["text-font"]&&(g=r.parse(d["text-font"],1,hr(Pt)),!g))return null;let x=null;if(d["text-color"]&&(x=r.parse(d["text-color"],1,Fr),!x))return null;const v=s[s.length-1];v.scale=m,v.font=g,v.textColor=x}else{const m=r.parse(e[h],1,Ct);if(!m)return null;const g=m.type.kind;if(g!=="string"&&g!=="value"&&g!=="null"&&g!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,s.push({content:m,scale:null,font:null,textColor:null})}}return new bo(s)}evaluate(e){return new Mi(this.sections.map(r=>{const n=r.content.evaluate(e);return wi(n)===ji?new Ya("",n,null,null,null):new Ya(Wr(n),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),e.push(n)}return e}}class wo{constructor(e){this.type=ji,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const n=r.parse(e[1],1,Pt);return n?new wo(n):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),n=Ji.fromString(r);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(r)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const sh={"to-boolean":Mt,"to-color":Fr,"to-number":Ne,"to-string":Pt};class kr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return r.error("Expected one argument.");const s=sh[n],c=[];for(let h=1;h<e.length;h++){const d=r.parse(e[h],h,Ct);if(!d)return null;c.push(d)}return new kr(s,c)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,n;for(const s of this.args){if(r=s.evaluate(e),n=null,r instanceof Vt)return r;if(typeof r=="string"){const c=e.parseColor(r);if(c)return c}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Cr(r[0],r[1],r[2],r[3]),!n))return new Vt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Bi(n||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const n of this.args){if(r=n.evaluate(e),r===null)return 0;const s=Number(r);if(!isNaN(s))return s}throw new Bi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Mi.fromString(Wr(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ji.fromString(Wr(this.args[0].evaluate(e))):Wr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new bo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new wo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const ah=["Unknown","Point","LineString","Polygon"];class xc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ah[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*r-e[0])+this.featureDistanceData.bearing[1]*(s*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Vt.parse(e)),r}}class Qi{constructor(e,r,n,s){this.name=e,this.type=r,this._evaluate=n,this.args=s}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const n=e[0],s=Qi.definitions[n];if(!s)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(s)?s[0]:s.type,h=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,d=h.filter(([g])=>!Array.isArray(g)||g.length===e.length-1);let m=null;for(const[g,x]of d){m=new pn(r.registry,r.path,null,r.scope);const v=[];let w=!1;for(let S=1;S<e.length;S++){const z=e[S],L=Array.isArray(g)?g[S-1]:g.type,F=m.parse(z,1+v.length,L);if(!F){w=!0;break}v.push(F)}if(!w)if(Array.isArray(g)&&g.length!==v.length)m.error(`Expected ${g.length} arguments, but found ${v.length} instead.`);else{for(let S=0;S<v.length;S++){const z=Array.isArray(g)?g[S]:g.type,L=v[S];m.concat(S+1).checkSubtype(z,L.type)}if(m.errors.length===0)return new Qi(n,c,x,v)}}if(d.length===1)r.errors.push(...m.errors);else{const g=(d.length?d:h).map(([v])=>{return w=v,Array.isArray(w)?`(${w.map(li).join(", ")})`:`(${li(w.type)}...)`;var w}).join(" | "),x=[];for(let v=1;v<e.length;v++){const w=r.parse(e[v],1+x.length);if(!w)return null;x.push(li(w.type))}r.error(`Expected arguments of type ${g}, but found (${x.join(", ")}) instead.`)}return null}static register(e,r){Qi.definitions=r;for(const n in r)e[n]=Qi}}class Xs{constructor(e,r,n){this.type=Wn,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");const s=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,Mt);if(!s)return null;const c=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,Mt);if(!c)return null;let h=null;return n.locale&&(h=r.parse(n.locale,1,Pt),!h)?null:new Xs(s,c,h)}evaluate(e){return new vo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const dn=8192;function Ja(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Hs(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function vc(i,e){const r=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(r*s*dn),Math.round(n*s*dn)]}function Ys(i,e,r){const n=i[0]-e[0],s=i[1]-e[1],c=i[0]-r[0],h=i[1]-r[1];return n*h-c*s==0&&n*c<=0&&s*h<=0}function Qa(i,e){let r=!1;for(let h=0,d=e.length;h<d;h++){const m=e[h];for(let g=0,x=m.length;g<x-1;g++){if(Ys(i,m[g],m[g+1]))return!1;(s=m[g])[1]>(n=i)[1]!=(c=m[g+1])[1]>n[1]&&n[0]<(c[0]-s[0])*(n[1]-s[1])/(c[1]-s[1])+s[0]&&(r=!r)}}var n,s,c;return r}function lh(i,e){for(let r=0;r<e.length;r++)if(Qa(i,e[r]))return!0;return!1}function bc(i,e,r,n){const s=n[0]-r[0],c=n[1]-r[1],h=(i[0]-r[0])*c-s*(i[1]-r[1]),d=(e[0]-r[0])*c-s*(e[1]-r[1]);return h>0&&d<0||h<0&&d>0}function ch(i,e,r){for(const g of r)for(let x=0;x<g.length-1;++x)if((d=[(h=g[x+1])[0]-(c=g[x])[0],h[1]-c[1]])[0]*(m=[(s=e)[0]-(n=i)[0],s[1]-n[1]])[1]-d[1]*m[0]!=0&&bc(n,s,c,h)&&bc(c,h,n,s))return!0;var n,s,c,h,d,m;return!1}function wc(i,e){for(let r=0;r<i.length;++r)if(!Qa(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(ch(i[r],i[r+1],e))return!1;return!0}function uh(i,e){for(let r=0;r<e.length;r++)if(wc(i,e[r]))return!0;return!1}function Ks(i,e,r){const n=[];for(let s=0;s<i.length;s++){const c=[];for(let h=0;h<i[s].length;h++){const d=vc(i[s][h],r);Ja(e,d),c.push(d)}n.push(c)}return n}function is(i,e,r){const n=[];for(let s=0;s<i.length;s++){const c=Ks(i[s],e,r);n.push(c)}return n}function Tc(i,e,r,n){if(i[0]<r[0]||i[0]>r[2]){const s=.5*n;let c=i[0]-r[0]>s?-n:r[0]-i[0]>s?n:0;c===0&&(c=i[0]-r[2]>s?-n:r[2]-i[0]>s?n:0),i[0]+=c}Ja(e,i)}function Ec(i,e,r,n){const s=Math.pow(2,n.z)*dn,c=[n.x*dn,n.y*dn],h=[];if(!i)return h;for(const d of i)for(const m of d){const g=[m.x+c[0],m.y+c[1]];Tc(g,e,r,s),h.push(g)}return h}function Sc(i,e,r,n){const s=Math.pow(2,n.z)*dn,c=[n.x*dn,n.y*dn],h=[];if(!i)return h;for(const m of i){const g=[];for(const x of m){const v=[x.x+c[0],x.y+c[1]];Ja(e,v),g.push(v)}h.push(g)}if(e[2]-e[0]<=s/2){(d=e)[0]=d[1]=1/0,d[2]=d[3]=-1/0;for(const m of h)for(const g of m)Tc(g,e,r,s)}var d;return h}class Xn{constructor(e,r){this.type=Mt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ws(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let s=0;s<n.features.length;++s){const c=n.features[s].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Xn(n,n.features[s].geometry)}else if(n.type==="Feature"){const s=n.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new Xn(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Xn(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,n){const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],h=r.canonicalID();if(!h)return!1;if(n.type==="Polygon"){const d=Ks(n.coordinates,c,h),m=Ec(r.geometry(),s,c,h);if(!Hs(s,c))return!1;for(const g of m)if(!Qa(g,d))return!1}if(n.type==="MultiPolygon"){const d=is(n.coordinates,c,h),m=Ec(r.geometry(),s,c,h);if(!Hs(s,c))return!1;for(const g of m)if(!lh(g,d))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,n){const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],h=r.canonicalID();if(!h)return!1;if(n.type==="Polygon"){const d=Ks(n.coordinates,c,h),m=Sc(r.geometry(),s,c,h);if(!Hs(s,c))return!1;for(const g of m)if(!wc(g,d))return!1}if(n.type==="MultiPolygon"){const d=is(n.coordinates,c,h),m=Sc(r.geometry(),s,c,h);if(!Hs(s,c))return!1;for(const g of m)if(!uh(g,d))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Zi(i){if(i instanceof Qi&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Xn)return!1;let e=!0;return i.eachChild(r=>{e&&!Zi(r)&&(e=!1)}),e}function rs(i){if(i instanceof Qi&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!rs(r)&&(e=!1)}),e}function ns(i,e){if(i instanceof Qi&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(n=>{r&&!ns(n,e)&&(r=!1)}),r}class Hn{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const n=e[1];return r.scope.has(n)?new Hn(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class pn{constructor(e,r=[],n,s=new Zn,c=[]){this.registry=e,this.path=r,this.key=r.map(h=>`[${h}]`).join(""),this.scope=s,this.errors=c,this.expectedType=n}parse(e,r,n,s,c={}){return r?this.concat(r,n,s)._parse(e,c):this._parse(e,c)}_parse(e,r){function n(s,c,h){return h==="assert"?new zr(c,[s]):h==="coerce"?new kr(c,[s]):s}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const s=e[0];if(typeof s!="string")return this.error(`Expression name must be a string, but found ${typeof s} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const c=this.registry[s];if(c){let h=c.parse(e,this);if(!h)return null;if(this.expectedType){const d=this.expectedType,m=h.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||m.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||m.kind!=="value"&&m.kind!=="string"){if(this.checkSubtype(d,m))return null}else h=n(h,d,r.typeAnnotation||"coerce");else h=n(h,d,r.typeAnnotation||"assert")}if(!(h instanceof Xr)&&h.type.kind!=="resolvedImage"&&Js(h)){const d=new xc;try{h=new Xr(h.type,h.evaluate(d))}catch(m){return this.error(m.message),null}}return h}return this.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,n){const s=typeof e=="number"?this.path.concat(e):this.path,c=n?this.scope.concat(n):this.scope;return new pn(this.registry,s,r||null,c,this.errors)}error(e,...r){const n=`${this.key}${r.map(s=>`[${s}]`).join("")}`;this.errors.push(new Gt(n,e))}checkSubtype(e,r){const n=ts(e,r);return n&&this.error(n),n}}function Js(i){if(i instanceof Hn)return Js(i.boundExpression);if(i instanceof Qi&&i.name==="error"||i instanceof Xs||i instanceof Xn)return!1;const e=i instanceof kr||i instanceof zr;let r=!0;return i.eachChild(n=>{r=e?r&&Js(n):r&&n instanceof Xr}),!!r&&Zi(i)&&ns(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function os(i,e){const r=i.length-1;let n,s,c=0,h=r,d=0;for(;c<=h;)if(d=Math.floor((c+h)/2),n=i[d],s=i[d+1],n<=e){if(d===r||e<s)return d;c=d+1}else{if(!(n>e))throw new Bi("Input is not a number.");h=d-1}return 0}class ss{constructor(e,r,n){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[s,c]of n)this.labels.push(s),this.outputs.push(c)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const n=r.parse(e[1],1,Ne);if(!n)return null;const s=[];let c=null;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);for(let h=1;h<e.length;h+=2){const d=h===1?-1/0:e[h],m=e[h+1],g=h,x=h+1;if(typeof d!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(s.length&&s[s.length-1][0]>=d)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',g);const v=r.parse(m,x,c);if(!v)return null;c=c||v.type,s.push([d,v])}return new ss(c,n,s)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const s=this.input.evaluate(e);if(s<=r[0])return n[0].evaluate(e);const c=r.length;return s>=r[c-1]?n[c-1].evaluate(e):n[os(r,s)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function at(i,e,r){return i*(1-r)+e*r}var Qs=Object.freeze({__proto__:null,number:at,color:function(i,e,r){return new Vt(at(i.r,e.r,r),at(i.g,e.g,r),at(i.b,e.b,r),at(i.a,e.a,r))},array:function(i,e,r){return i.map((n,s)=>at(n,e[s],r))}});const Ic=.95047,Mc=1.08883,el=4/29,tl=6/29,il=3*tl*tl,Ac=Math.PI/180,Cc=180/Math.PI;function ea(i){return i>.008856451679035631?Math.pow(i,1/3):i/il+el}function fn(i){return i>tl?i*i*i:il*(i-el)}function To(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function rl(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ta(i){const e=rl(i.r),r=rl(i.g),n=rl(i.b),s=ea((.4124564*e+.3575761*r+.1804375*n)/Ic),c=ea((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*c-16,a:500*(s-c),b:200*(c-ea((.0193339*e+.119192*r+.9503041*n)/Mc)),alpha:i.a}}function nl(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,n=isNaN(i.b)?e:e-i.b/200;return e=1*fn(e),r=Ic*fn(r),n=Mc*fn(n),new Vt(To(3.2404542*r-1.5371385*e-.4985314*n),To(-.969266*r+1.8760108*e+.041556*n),To(.0556434*r-.2040259*e+1.0572252*n),i.alpha)}function hh(i,e,r){const n=e-i;return i+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const as={forward:ta,reverse:nl,interpolate:function(i,e,r){return{l:at(i.l,e.l,r),a:at(i.a,e.a,r),b:at(i.b,e.b,r),alpha:at(i.alpha,e.alpha,r)}}},ls={forward:function(i){const{l:e,a:r,b:n}=ta(i),s=Math.atan2(n,r)*Cc;return{h:s<0?s+360:s,c:Math.sqrt(r*r+n*n),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Ac,r=i.c;return nl({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:hh(i.h,e.h,r),c:at(i.c,e.c,r),l:at(i.l,e.l,r),alpha:at(i.alpha,e.alpha,r)}}};var ol=Object.freeze({__proto__:null,lab:as,hcl:ls});class er{constructor(e,r,n,s,c){this.type=e,this.operator=r,this.interpolation=n,this.input=s,this.labels=[],this.outputs=[];for(const[h,d]of c)this.labels.push(h),this.outputs.push(d)}static interpolationFactor(e,r,n,s){let c=0;if(e.name==="exponential")c=ia(r,e.base,n,s);else if(e.name==="linear")c=ia(r,1,n,s);else if(e.name==="cubic-bezier"){const h=e.controlPoints;c=new ge(h[0],h[1],h[2],h[3]).solve(ia(r,1,n,s))}return c}static parse(e,r){let[n,s,c,...h]=e;if(!Array.isArray(s)||s.length===0)return r.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){const g=s[1];if(typeof g!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:g}}else{if(s[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(s[0])}`,1,0);{const g=s.slice(1);if(g.length!==4||g.some(x=>typeof x!="number"||x<0||x>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:g}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(c=r.parse(c,2,Ne),!c)return null;const d=[];let m=null;n==="interpolate-hcl"||n==="interpolate-lab"?m=Fr:r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let g=0;g<h.length;g+=2){const x=h[g],v=h[g+1],w=g+3,S=g+4;if(typeof x!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(d.length&&d[d.length-1][0]>=x)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',w);const z=r.parse(v,S,m);if(!z)return null;m=m||z.type,d.push([x,z])}return m.kind==="number"||m.kind==="color"||m.kind==="array"&&m.itemType.kind==="number"&&typeof m.N=="number"?new er(m,n,s,c,d):r.error(`Type ${li(m)} is not interpolatable.`)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const s=this.input.evaluate(e);if(s<=r[0])return n[0].evaluate(e);const c=r.length;if(s>=r[c-1])return n[c-1].evaluate(e);const h=os(r,s),d=er.interpolationFactor(this.interpolation,s,r[h],r[h+1]),m=n[h].evaluate(e),g=n[h+1].evaluate(e);return this.operator==="interpolate"?Qs[this.type.kind.toLowerCase()](m,g,d):this.operator==="interpolate-hcl"?ls.reverse(ls.interpolate(ls.forward(m),ls.forward(g),d)):as.reverse(as.interpolate(as.forward(m),as.forward(g),d))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)r.push(this.labels[n],this.outputs[n].serialize());return r}}function ia(i,e,r,n){const s=n-r,c=i-r;return s===0?0:e===1?c/s:(Math.pow(e,c)-1)/(Math.pow(e,s)-1)}class cs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let n=null;const s=r.expectedType;s&&s.kind!=="value"&&(n=s);const c=[];for(const d of e.slice(1)){const m=r.parse(d,1+c.length,n,void 0,{typeAnnotation:"omit"});if(!m)return null;n=n||m.type,c.push(m)}const h=s&&c.some(d=>ts(s,d.type));return new cs(h?Ct:n,c)}evaluate(e){let r,n=null,s=0;for(const c of this.args){if(s++,n=c.evaluate(e),n&&n instanceof Ji&&!n.available&&(r||(r=n),n=null,s===this.args.length))return r;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class us{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let c=1;c<e.length-1;c+=2){const h=e[c];if(typeof h!="string")return r.error(`Expected string, but found ${typeof h} instead.`,c);if(/[^a-zA-Z0-9_]/.test(h))return r.error("Variable names must contain only alphanumeric characters or '_'.",c);const d=r.parse(e[c+1],c+1);if(!d)return null;n.push([h,d])}const s=r.parse(e[e.length-1],e.length-1,r.expectedType,n);return s?new us(n,s):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,n]of this.bindings)e.push(r,n.serialize());return e.push(this.result.serialize()),e}}class sl{constructor(e,r,n){this.type=e,this.index=r,this.input=n}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Ne),s=r.parse(e[2],2,hr(r.expectedType||Ct));return n&&s?new sl(s.type.itemType,n,s):null}evaluate(e){const r=this.index.evaluate(e),n=this.input.evaluate(e);if(r<0)throw new Bi(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new Bi(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new Bi(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ra{constructor(e,r){this.type=Mt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Ct),s=r.parse(e[2],2,Ct);return n&&s?Zs(n.type,[Mt,Pt,Ne,qr,Ct])?new ra(n,s):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${li(n.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!xo(r,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${li(wi(r))} instead.`);if(!xo(n,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${li(wi(n))} instead.`);return n.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class na{constructor(e,r,n){this.type=Ne,this.needle=e,this.haystack=r,this.fromIndex=n}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Ct),s=r.parse(e[2],2,Ct);if(!n||!s)return null;if(!Zs(n.type,[Mt,Pt,Ne,qr,Ct]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${li(n.type)} instead`);if(e.length===4){const c=r.parse(e[3],3,Ne);return c?new na(n,s,c):null}return new na(n,s)}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!xo(r,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${li(wi(r))} instead.`);if(!xo(n,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${li(wi(n))} instead.`);if(this.fromIndex){const s=this.fromIndex.evaluate(e);return n.indexOf(r,s)}return n.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class oa{constructor(e,r,n,s,c,h){this.inputType=e,this.type=r,this.input=n,this.cases=s,this.outputs=c,this.otherwise=h}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let n,s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const c={},h=[];for(let g=2;g<e.length-1;g+=2){let x=e[g];const v=e[g+1];Array.isArray(x)||(x=[x]);const w=r.concat(g);if(x.length===0)return w.error("Expected at least one branch label.");for(const z of x){if(typeof z!="number"&&typeof z!="string")return w.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return w.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return w.error("Numeric branch labels must be integer values.");if(n){if(w.checkSubtype(n,wi(z)))return null}else n=wi(z);if(c[String(z)]!==void 0)return w.error("Branch labels must be unique.");c[String(z)]=h.length}const S=r.parse(v,g,s);if(!S)return null;s=s||S.type,h.push(S)}const d=r.parse(e[1],1,Ct);if(!d)return null;const m=r.parse(e[e.length-1],e.length-1,s);return m?d.type.kind!=="value"&&r.concat(1).checkSubtype(n,d.type)?null:new oa(n,s,d,c,h,m):null}evaluate(e){const r=this.input.evaluate(e);return(wi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],s={};for(const h of r){const d=s[this.cases[h]];d===void 0?(s[this.cases[h]]=n.length,n.push([this.cases[h],[h]])):n[d][1].push(h)}const c=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,d]of n)e.push(d.length===1?c(d[0]):d.map(c)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class sa{constructor(e,r,n){this.type=e,this.branches=r,this.otherwise=n}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);const s=[];for(let h=1;h<e.length-1;h+=2){const d=r.parse(e[h],h,Mt);if(!d)return null;const m=r.parse(e[h+1],h+1,n);if(!m)return null;s.push([d,m]),n=n||m.type}const c=r.parse(e[e.length-1],e.length-1,n);return c?new sa(n,s,c):null}evaluate(e){for(const[r,n]of this.branches)if(r.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,n]of this.branches)e(r),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class aa{constructor(e,r,n,s){this.type=e,this.input=r,this.beginIndex=n,this.endIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Ct),s=r.parse(e[2],2,Ne);if(!n||!s)return null;if(!Zs(n.type,[hr(Ct),Pt,Ct]))return r.error(`Expected first argument to be of type array or string, but found ${li(n.type)} instead`);if(e.length===4){const c=r.parse(e[3],3,Ne);return c?new aa(n.type,n,s,c):null}return new aa(n.type,n,s)}evaluate(e){const r=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!xo(r,["string","array"]))throw new Bi(`Expected first argument to be of type array or string, but found ${li(wi(r))} instead.`);if(this.endIndex){const s=this.endIndex.evaluate(e);return r.slice(n,s)}return r.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function zc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function kc(i,e,r,n){return n.compare(e,r)===0}function Eo(i,e,r){const n=i!=="=="&&i!=="!=";return class qm{constructor(c,h,d){this.type=Mt,this.lhs=c,this.rhs=h,this.collator=d,this.hasUntypedArgument=c.type.kind==="value"||h.type.kind==="value"}static parse(c,h){if(c.length!==3&&c.length!==4)return h.error("Expected two or three arguments.");const d=c[0];let m=h.parse(c[1],1,Ct);if(!m)return null;if(!zc(d,m.type))return h.concat(1).error(`"${d}" comparisons are not supported for type '${li(m.type)}'.`);let g=h.parse(c[2],2,Ct);if(!g)return null;if(!zc(d,g.type))return h.concat(2).error(`"${d}" comparisons are not supported for type '${li(g.type)}'.`);if(m.type.kind!==g.type.kind&&m.type.kind!=="value"&&g.type.kind!=="value")return h.error(`Cannot compare types '${li(m.type)}' and '${li(g.type)}'.`);n&&(m.type.kind==="value"&&g.type.kind!=="value"?m=new zr(g.type,[m]):m.type.kind!=="value"&&g.type.kind==="value"&&(g=new zr(m.type,[g])));let x=null;if(c.length===4){if(m.type.kind!=="string"&&g.type.kind!=="string"&&m.type.kind!=="value"&&g.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(x=h.parse(c[3],3,Wn),!x)return null}return new qm(m,g,x)}evaluate(c){const h=this.lhs.evaluate(c),d=this.rhs.evaluate(c);if(n&&this.hasUntypedArgument){const m=wi(h),g=wi(d);if(m.kind!==g.kind||m.kind!=="string"&&m.kind!=="number")throw new Bi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${m.kind}, ${g.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const m=wi(h),g=wi(d);if(m.kind!=="string"||g.kind!=="string")return e(c,h,d)}return this.collator?r(c,h,d,this.collator.evaluate(c)):e(c,h,d)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[i];return this.eachChild(h=>{c.push(h.serialize())}),c}}}const dh=Eo("==",function(i,e,r){return e===r},kc),ph=Eo("!=",function(i,e,r){return e!==r},function(i,e,r,n){return!kc(0,e,r,n)}),Pc=Eo("<",function(i,e,r){return e<r},function(i,e,r,n){return n.compare(e,r)<0}),fh=Eo(">",function(i,e,r){return e>r},function(i,e,r,n){return n.compare(e,r)>0}),mh=Eo("<=",function(i,e,r){return e<=r},function(i,e,r,n){return n.compare(e,r)<=0}),_h=Eo(">=",function(i,e,r){return e>=r},function(i,e,r,n){return n.compare(e,r)>=0});class al{constructor(e,r,n,s,c){this.type=Pt,this.number=e,this.locale=r,this.currency=n,this.minFractionDigits=s,this.maxFractionDigits=c}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const n=r.parse(e[1],1,Ne);if(!n)return null;const s=e[2];if(typeof s!="object"||Array.isArray(s))return r.error("NumberFormat options argument must be an object.");let c=null;if(s.locale&&(c=r.parse(s.locale,1,Pt),!c))return null;let h=null;if(s.currency&&(h=r.parse(s.currency,1,Pt),!h))return null;let d=null;if(s["min-fraction-digits"]&&(d=r.parse(s["min-fraction-digits"],1,Ne),!d))return null;let m=null;return s["max-fraction-digits"]&&(m=r.parse(s["max-fraction-digits"],1,Ne),!m)?null:new al(n,c,h,d,m)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class la{constructor(e){this.type=Ne,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=r.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${li(n.type)} instead.`):new la(n):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Bi(`Expected value to be of type string or array, but found ${li(wi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Yn={"==":dh,"!=":ph,">":fh,"<":Pc,">=":_h,"<=":mh,array:zr,at:sl,boolean:zr,case:sa,coalesce:cs,collator:Xs,format:bo,image:wo,in:ra,"index-of":na,interpolate:er,"interpolate-hcl":er,"interpolate-lab":er,length:la,let:us,literal:Xr,match:oa,number:zr,"number-format":al,object:zr,slice:aa,step:ss,string:zr,"to-boolean":kr,"to-color":kr,"to-number":kr,"to-string":kr,var:Hn,within:Xn};function ll(i,[e,r,n,s]){e=e.evaluate(i),r=r.evaluate(i),n=n.evaluate(i);const c=s?s.evaluate(i):1,h=Cr(e,r,n,c);if(h)throw new Bi(h);return new Vt(e/255*c,r/255*c,n/255*c,c)}function Dc(i,e){return i in e}function cl(i,e){const r=e[i];return r===void 0?null:r}function mn(i){return{type:i}}function ul(i){return{result:"success",value:i}}function Kn(i){return{result:"error",value:i}}function So(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Lc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function hl(i){return!!i.expression&&i.expression.interpolated}function Wt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Jn(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Bc(i){return i}function dl(i,e){const r=e.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",s=n||!(n||i.property!==void 0),c=i.type||(hl(e)?"exponential":"interval");if(r&&((i=jt({},i)).stops&&(i.stops=i.stops.map(g=>[g[0],Vt.parse(g[1])])),i.default=Vt.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!ol[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let h,d,m;if(c==="exponential")h=pl;else if(c==="interval")h=yh;else if(c==="categorical"){h=gh,d=Object.create(null);for(const g of i.stops)d[g[0]]=g[1];m=typeof i.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);h=Rc}if(n){const g={},x=[];for(let S=0;S<i.stops.length;S++){const z=i.stops[S],L=z[0].zoom;g[L]===void 0&&(g[L]={zoom:L,type:i.type,property:i.property,default:i.default,stops:[]},x.push(L)),g[L].stops.push([z[0].value,z[1]])}const v=[];for(const S of x)v.push([g[S].zoom,dl(g[S],e)]);const w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:er.interpolationFactor.bind(void 0,w),zoomStops:v.map(S=>S[0]),evaluate:({zoom:S},z)=>pl({stops:v,base:i.base},e,S).evaluate(S,z)}}if(s){const g=c==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:g,interpolationFactor:er.interpolationFactor.bind(void 0,g),zoomStops:i.stops.map(x=>x[0]),evaluate:({zoom:x})=>h(i,e,x,d,m)}}return{kind:"source",evaluate(g,x){const v=x&&x.properties?x.properties[i.property]:void 0;return v===void 0?hs(i.default,e.default):h(i,e,v,d,m)}}}function hs(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function gh(i,e,r,n,s){return hs(typeof r===s?n[r]:void 0,i.default,e.default)}function yh(i,e,r){if(Wt(r)!=="number")return hs(i.default,e.default);const n=i.stops.length;if(n===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[n-1][0])return i.stops[n-1][1];const s=os(i.stops.map(c=>c[0]),r);return i.stops[s][1]}function pl(i,e,r){const n=i.base!==void 0?i.base:1;if(Wt(r)!=="number")return hs(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const c=os(i.stops.map(x=>x[0]),r),h=function(x,v,w,S){const z=S-w,L=x-w;return z===0?0:v===1?L/z:(Math.pow(v,L)-1)/(Math.pow(v,z)-1)}(r,n,i.stops[c][0],i.stops[c+1][0]),d=i.stops[c][1],m=i.stops[c+1][1];let g=Qs[e.type]||Bc;if(i.colorSpace&&i.colorSpace!=="rgb"){const x=ol[i.colorSpace];g=(v,w)=>x.reverse(x.interpolate(x.forward(v),x.forward(w),h))}return typeof d.evaluate=="function"?{evaluate(...x){const v=d.evaluate.apply(void 0,x),w=m.evaluate.apply(void 0,x);if(v!==void 0&&w!==void 0)return g(v,w,h)}}:g(d,m,h)}function Rc(i,e,r){return e.type==="color"?r=Vt.parse(r):e.type==="formatted"?r=Mi.fromString(r.toString()):e.type==="resolvedImage"?r=Ji.fromString(r.toString()):Wt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),hs(r,i.default,e.default)}Qi.register(Yn,{error:[{kind:"error"},[Pt],(i,[e])=>{throw new Bi(e.evaluate(i))}],typeof:[Pt,[Ct],(i,[e])=>li(wi(e.evaluate(i)))],"to-rgba":[hr(Ne,4),[Fr],(i,[e])=>e.evaluate(i).toArray()],rgb:[Fr,[Ne,Ne,Ne],ll],rgba:[Fr,[Ne,Ne,Ne,Ne],ll],has:{type:Mt,overloads:[[[Pt],(i,[e])=>Dc(e.evaluate(i),i.properties())],[[Pt,qn],(i,[e,r])=>Dc(e.evaluate(i),r.evaluate(i))]]},get:{type:Ct,overloads:[[[Pt],(i,[e])=>cl(e.evaluate(i),i.properties())],[[Pt,qn],(i,[e,r])=>cl(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Ct,[Pt],(i,[e])=>cl(e.evaluate(i),i.featureState||{})],properties:[qn,[],i=>i.properties()],"geometry-type":[Pt,[],i=>i.geometryType()],id:[Ct,[],i=>i.id()],zoom:[Ne,[],i=>i.globals.zoom],pitch:[Ne,[],i=>i.globals.pitch||0],"distance-from-center":[Ne,[],i=>i.distanceFromCenter()],"heatmap-density":[Ne,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ne,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Ne,[],i=>i.globals.skyRadialProgress||0],accumulated:[Ct,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ne,mn(Ne),(i,e)=>{let r=0;for(const n of e)r+=n.evaluate(i);return r}],"*":[Ne,mn(Ne),(i,e)=>{let r=1;for(const n of e)r*=n.evaluate(i);return r}],"-":{type:Ne,overloads:[[[Ne,Ne],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Ne],(i,[e])=>-e.evaluate(i)]]},"/":[Ne,[Ne,Ne],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Ne,[Ne,Ne],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Ne,[],()=>Math.LN2],pi:[Ne,[],()=>Math.PI],e:[Ne,[],()=>Math.E],"^":[Ne,[Ne,Ne],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Ne,[Ne],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ne,[Ne],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ne,[Ne],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ne,[Ne],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ne,[Ne],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ne,[Ne],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ne,[Ne],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ne,[Ne],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ne,[Ne],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ne,[Ne],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ne,mn(Ne),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Ne,mn(Ne),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Ne,[Ne],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ne,[Ne],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ne,[Ne],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ne,[Ne],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Mt,[Pt,Ct],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Mt,[Ct],(i,[e])=>i.id()===e.value],"filter-type-==":[Mt,[Pt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Mt,[Pt,Ct],(i,[e,r])=>{const n=i.properties()[e.value],s=r.value;return typeof n==typeof s&&n<s}],"filter-id-<":[Mt,[Ct],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[Mt,[Pt,Ct],(i,[e,r])=>{const n=i.properties()[e.value],s=r.value;return typeof n==typeof s&&n>s}],"filter-id->":[Mt,[Ct],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[Mt,[Pt,Ct],(i,[e,r])=>{const n=i.properties()[e.value],s=r.value;return typeof n==typeof s&&n<=s}],"filter-id-<=":[Mt,[Ct],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[Mt,[Pt,Ct],(i,[e,r])=>{const n=i.properties()[e.value],s=r.value;return typeof n==typeof s&&n>=s}],"filter-id->=":[Mt,[Ct],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[Mt,[Ct],(i,[e])=>e.value in i.properties()],"filter-has-id":[Mt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Mt,[hr(Pt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Mt,[hr(Ct)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Mt,[Pt,hr(Ct)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Mt,[Pt,hr(Ct)],(i,[e,r])=>function(n,s,c,h){for(;c<=h;){const d=c+h>>1;if(s[d]===n)return!0;s[d]>n?h=d-1:c=d+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Mt,overloads:[[[Mt,Mt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[mn(Mt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Mt,overloads:[[[Mt,Mt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[mn(Mt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Mt,[Mt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Mt,[Pt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Pt,[Pt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Pt,[Pt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Pt,mn(Ct),(i,e)=>e.map(r=>Wr(r.evaluate(i))).join("")],"resolved-locale":[Pt,[Wn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ca{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new xc,this._defaultValue=r?function(n){return n.type==="color"&&Jn(n.default)?new Vt(0,0,0,0):n.type==="color"?Vt.parse(n.default)||null:n.default===void 0?null:n.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,n,s,c,h,d,m){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=s||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=m||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,n,s,c,h,d,m){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=m||null;try{const g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new Bi(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console!="undefined"&&console.warn(g.message)),this._defaultValue}}}function Io(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Yn}function ds(i,e){const r=new pn(Yn,[],e?function(s){const c={color:Fr,string:Pt,number:Ne,enum:Pt,boolean:Mt,formatted:yo,resolvedImage:ji};return s.type==="array"?hr(c[s.value]||Ct,s.length):c[s.type]}(e):void 0),n=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?ul(new ca(n,e)):Kn(r.errors)}class fl{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!rs(r.expression)}evaluateWithoutErrorHandling(e,r,n,s,c,h){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,s,c,h)}evaluate(e,r,n,s,c,h){return this._styleExpression.evaluate(e,r,n,s,c,h)}}class ml{constructor(e,r,n,s){this.kind=e,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!rs(r.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,r,n,s,c,h){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,s,c,h)}evaluate(e,r,n,s,c,h){return this._styleExpression.evaluate(e,r,n,s,c,h)}interpolationFactor(e,r,n){return this.interpolationType?er.interpolationFactor(this.interpolationType,e,r,n):0}}function Fc(i,e){if((i=ds(i,e)).result==="error")return i;const r=i.value.expression,n=Zi(r);if(!n&&!So(e))return Kn([new Gt("","data expressions not supported")]);const s=ns(r,["zoom","pitch","distance-from-center"]);if(!s&&!Lc(e))return Kn([new Gt("","zoom expressions not supported")]);const c=ha(r);return c||s?c instanceof Gt?Kn([c]):c instanceof er&&!hl(e)?Kn([new Gt("",'"interpolate" expressions cannot be used with this property')]):ul(c?new ml(n?"camera":"composite",i.value,c.labels,c instanceof er?c.interpolation:void 0):new fl(n?"constant":"source",i.value)):Kn([new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ua{constructor(e,r){this._parameters=e,this._specification=r,jt(this,dl(this._parameters,this._specification))}static deserialize(e){return new ua(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ha(i){let e=null;if(i instanceof us)e=ha(i.result);else if(i instanceof cs){for(const r of i.args)if(e=ha(r),e)break}else(i instanceof ss||i instanceof er)&&i.input instanceof Qi&&i.input.name==="zoom"&&(e=i);return e instanceof Gt||i.eachChild(r=>{const n=ha(r);n instanceof Gt?e=n:!e&&n?e=new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new Gt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Ge{constructor(e,r,n,s){this.message=(e?`${e}: `:"")+n,s&&(this.identifier=s),r!=null&&r.__line__&&(this.line=r.__line__)}}function dr(i){const e=i.key,r=i.value,n=i.valueSpec||{},s=i.objectElementValidators||{},c=i.style,h=i.styleSpec;let d=[];const m=Wt(r);if(m!=="object")return[new Ge(e,r,`object expected, ${m} found`)];for(const g in r){const x=g.split(".")[0],v=n[x]||n["*"];let w;s[x]?w=s[x]:n[x]?w=ki:s["*"]?w=s["*"]:n["*"]&&(w=ki),w?d=d.concat(w({key:(e&&`${e}.`)+g,value:r[g],valueSpec:v,style:c,styleSpec:h,object:r,objectKey:g},r)):d.push(new Ge(e,r[g],`unknown property "${g}"`))}for(const g in n)s[g]||n[g].required&&n[g].default===void 0&&r[g]===void 0&&d.push(new Ge(e,r,`missing required property "${g}"`));return d}function ps(i){const e=i.value,r=i.valueSpec,n=i.style,s=i.styleSpec,c=i.key,h=i.arrayElementValidator||ki;if(Wt(e)!=="array")return[new Ge(c,e,`array expected, ${Wt(e)} found`)];if(r.length&&e.length!==r.length)return[new Ge(c,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Ge(c,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let d={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};s.$version<7&&(d.function=r.function),Wt(r.value)==="object"&&(d=r.value);let m=[];for(let g=0;g<e.length;g++)m=m.concat(h({array:e,arrayIndex:g,value:e[g],valueSpec:d,style:n,styleSpec:s,key:`${c}[${g}]`}));return m}function Oc(i){const e=i.key,r=i.value,n=i.valueSpec;let s=Wt(r);if(s==="number"&&r!=r&&(s="NaN"),s!=="number")return[new Ge(e,r,`number expected, ${s} found`)];if("minimum"in n){let c=n.minimum;if(Wt(n.minimum)==="array"&&(c=n.minimum[i.arrayIndex]),r<c)return[new Ge(e,r,`${r} is less than the minimum value ${c}`)]}if("maximum"in n){let c=n.maximum;if(Wt(n.maximum)==="array"&&(c=n.maximum[i.arrayIndex]),r>c)return[new Ge(e,r,`${r} is greater than the maximum value ${c}`)]}return[]}function Uc(i){const e=i.valueSpec,r=Je(i.value.type);let n,s,c,h={};const d=r!=="categorical"&&i.value.property===void 0,m=!d,g=Wt(i.value.stops)==="array"&&Wt(i.value.stops[0])==="array"&&Wt(i.value.stops[0][0])==="object",x=dr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(S){if(r==="identity")return[new Ge(S.key,S.value,'identity function may not have a "stops" property')];let z=[];const L=S.value;return z=z.concat(ps({key:S.key,value:L,valueSpec:S.valueSpec,style:S.style,styleSpec:S.styleSpec,arrayElementValidator:v})),Wt(L)==="array"&&L.length===0&&z.push(new Ge(S.key,L,"array must have at least one stop")),z},default:function(S){return ki({key:S.key,value:S.value,valueSpec:e,style:S.style,styleSpec:S.styleSpec})}}});return r==="identity"&&d&&x.push(new Ge(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||x.push(new Ge(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!hl(i.valueSpec)&&x.push(new Ge(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(m&&!So(i.valueSpec)?x.push(new Ge(i.key,i.value,"property functions not supported")):d&&!Lc(i.valueSpec)&&x.push(new Ge(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!g||i.value.property!==void 0||x.push(new Ge(i.key,i.value,'"property" property is required')),x;function v(S){let z=[];const L=S.value,F=S.key;if(Wt(L)!=="array")return[new Ge(F,L,`array expected, ${Wt(L)} found`)];if(L.length!==2)return[new Ge(F,L,`array length 2 expected, length ${L.length} found`)];if(g){if(Wt(L[0])!=="object")return[new Ge(F,L,`object expected, ${Wt(L[0])} found`)];if(L[0].zoom===void 0)return[new Ge(F,L,"object stop key must have zoom")];if(L[0].value===void 0)return[new Ge(F,L,"object stop key must have value")];const G=Je(L[0].zoom);if(typeof G!="number")return[new Ge(F,L[0].zoom,"stop zoom values must be numbers")];if(c&&c>G)return[new Ge(F,L[0].zoom,"stop zoom values must appear in ascending order")];G!==c&&(c=G,s=void 0,h={}),z=z.concat(dr({key:`${F}[0]`,value:L[0],valueSpec:{zoom:{}},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{zoom:Oc,value:w}}))}else z=z.concat(w({key:`${F}[0]`,value:L[0],valueSpec:{},style:S.style,styleSpec:S.styleSpec},L));return Io(Ut(L[1]))?z.concat([new Ge(`${F}[1]`,L[1],"expressions are not allowed in function stops.")]):z.concat(ki({key:`${F}[1]`,value:L[1],valueSpec:e,style:S.style,styleSpec:S.styleSpec}))}function w(S,z){const L=Wt(S.value),F=Je(S.value),G=S.value!==null?S.value:z;if(n){if(L!==n)return[new Ge(S.key,G,`${L} stop domain type must match previous stop domain type ${n}`)]}else n=L;if(L!=="number"&&L!=="string"&&L!=="boolean"&&typeof F!="number"&&typeof F!="string"&&typeof F!="boolean")return[new Ge(S.key,G,"stop domain value must be a number, string, or boolean")];if(L!=="number"&&r!=="categorical"){let Q=`number expected, ${L} found`;return So(e)&&r===void 0&&(Q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ge(S.key,G,Q)]}return r!=="categorical"||L!=="number"||typeof F=="number"&&isFinite(F)&&Math.floor(F)===F?r!=="categorical"&&L==="number"&&typeof F=="number"&&typeof s=="number"&&s!==void 0&&F<s?[new Ge(S.key,G,"stop domain values must appear in ascending order")]:(s=F,r==="categorical"&&F in h?[new Ge(S.key,G,"stop domain values must be unique")]:(h[F]=!0,[])):[new Ge(S.key,G,`integer expected, found ${String(F)}`)]}}function Mo(i){const e=(i.expressionContext==="property"?Fc:ds)(Ut(i.value),i.valueSpec);if(e.result==="error")return e.value.map(n=>new Ge(`${i.key}${n.key}`,i.value,n.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ge(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!rs(r))return[new Ge(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return Hr(r,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ns(r,["zoom","feature-state"]))return[new Ge(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Zi(r))return[new Ge(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hr(i,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const s of e.valueSpec.expression.parameters)r.delete(s);if(r.size===0)return[];const n=[];return i instanceof Qi&&r.has(i.name)?[new Ge(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(s=>{n.push(...Hr(s,e))}),n)}function fs(i){const e=i.key,r=i.value,n=i.valueSpec,s=[];return Array.isArray(n.values)?n.values.indexOf(Je(r))===-1&&s.push(new Ge(e,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(n.values).indexOf(Je(r))===-1&&s.push(new Ge(e,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),s}function _n(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!_n(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function gn(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};_n(i)||(i=ms(i));const r=i;let n=!0;try{n=function(g){if(!yn(g))return g;let x=Ut(g);return Vc(x),x=_l(x),x}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const s=fe[`filter_${e}`],c=ds(n,s);let h=null;if(c.result==="error")throw new Error(c.value.map(g=>`${g.key}: ${g.message}`).join(", "));h=(g,x,v)=>c.value.evaluate(g,x,{},v);let d=null,m=null;if(n!==r){const g=ds(r,s);if(g.result==="error")throw new Error(g.value.map(x=>`${x.key}: ${x.message}`).join(", "));d=(x,v,w,S,z)=>g.value.evaluate(x,v,{},w,void 0,void 0,S,z),m=!Zi(g.value.expression)}return h=h,{filter:h,dynamicFilter:d||void 0,needGeometry:da(n),needFeature:!!m}}function _l(i){if(!Array.isArray(i))return i;const e=function(r){if(Nc.has(r[0])){for(let n=1;n<r.length;n++)if(yn(r[n]))return!0}return r}(i);return e===!0?e:e.map(r=>_l(r))}function Vc(i){let e=!1;const r=[];if(i[0]==="case"){for(let n=1;n<i.length-1;n+=2)e=e||yn(i[n]),r.push(i[n+1]);r.push(i[i.length-1])}else if(i[0]==="match"){e=e||yn(i[1]);for(let n=2;n<i.length-1;n+=2)r.push(i[n+1]);r.push(i[i.length-1])}else if(i[0]==="step"){e=e||yn(i[1]);for(let n=1;n<i.length-1;n+=2)r.push(i[n+1])}e&&(i.length=0,i.push("any",...r));for(let n=1;n<i.length;n++)Vc(i[n])}function yn(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<i.length;r++)if(yn(i[r]))return!0;return!1}const Nc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function gl(i,e){return i<e?-1:i>e?1:0}function da(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(da(i[e]))return!0;return!1}function ms(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?_s(i[1],i[2],"=="):e==="!="?gs(_s(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?_s(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(ms))):e==="all"?["all"].concat(i.slice(1).map(ms)):e==="none"?["all"].concat(i.slice(1).map(ms).map(gs)):e==="in"?yl(i[1],i.slice(2)):e==="!in"?gs(yl(i[1],i.slice(2))):e==="has"?xl(i[1]):e==="!has"?gs(xl(i[1])):e!=="within"||i;var r}function _s(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function yl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(gl)]]:["filter-in-small",i,["literal",e]]}}function xl(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function gs(i){return["!",i]}function xn(i){return _n(Ut(i.value))?Mo(jt({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):vl(i)}function vl(i){const e=i.value,r=i.key;if(Wt(e)!=="array")return[new Ge(r,e,`array expected, ${Wt(e)} found`)];const n=i.styleSpec;let s,c=[];if(e.length<1)return[new Ge(r,e,"filter array must have at least 1 element")];switch(c=c.concat(fs({key:`${r}[0]`,value:e[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),Je(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Je(e[1])==="$type"&&c.push(new Ge(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&c.push(new Ge(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(s=Wt(e[1]),s!=="string"&&c.push(new Ge(`${r}[1]`,e[1],`string expected, ${s} found`)));for(let h=2;h<e.length;h++)s=Wt(e[h]),Je(e[1])==="$type"?c=c.concat(fs({key:`${r}[${h}]`,value:e[h],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):s!=="string"&&s!=="number"&&s!=="boolean"&&c.push(new Ge(`${r}[${h}]`,e[h],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let h=1;h<e.length;h++)c=c.concat(vl({key:`${r}[${h}]`,value:e[h],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":s=Wt(e[1]),e.length!==2?c.push(new Ge(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):s!=="string"&&c.push(new Ge(`${r}[1]`,e[1],`string expected, ${s} found`));break;case"within":s=Wt(e[1]),e.length!==2?c.push(new Ge(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):s!=="object"&&c.push(new Ge(`${r}[1]`,e[1],`object expected, ${s} found`))}return c}function bl(i,e){const r=i.key,n=i.style,s=i.styleSpec,c=i.value,h=i.objectKey,d=s[`${e}_${i.layerType}`];if(!d)return[];const m=h.match(/^(.*)-transition$/);if(e==="paint"&&m&&d[m[1]]&&d[m[1]].transition)return ki({key:r,value:c,valueSpec:s.transition,style:n,styleSpec:s});const g=i.valueSpec||d[h];if(!g)return[new Ge(r,c,`unknown property "${h}"`)];let x;if(Wt(c)==="string"&&So(g)&&!g.tokens&&(x=/^{([^}]+)}$/.exec(c)))return[new Ge(r,c,`"${h}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(x[1])} }\`.`)];const v=[];return i.layerType==="symbol"&&(h==="text-field"&&n&&!n.glyphs&&v.push(new Ge(r,c,'use of "text-field" requires a style "glyphs" property')),h==="text-font"&&Jn(Ut(c))&&Je(c.type)==="identity"&&v.push(new Ge(r,c,'"text-font" does not support identity functions'))),v.concat(ki({key:i.key,value:c,valueSpec:g,style:n,styleSpec:s,expressionContext:"property",propertyType:e,propertyKey:h}))}function pa(i){return bl(i,"paint")}function wl(i){return bl(i,"layout")}function jc(i){let e=[];const r=i.value,n=i.key,s=i.style,c=i.styleSpec;r.type||r.ref||e.push(new Ge(n,r,'either "type" or "ref" is required'));let h=Je(r.type);const d=Je(r.ref);if(r.id){const m=Je(r.id);for(let g=0;g<i.arrayIndex;g++){const x=s.layers[g];Je(x.id)===m&&e.push(new Ge(n,r.id,`duplicate layer id "${r.id}", previously used at line ${x.id.__line__}`))}}if("ref"in r){let m;["type","source","source-layer","filter","layout"].forEach(g=>{g in r&&e.push(new Ge(n,r[g],`"${g}" is prohibited for ref layers`))}),s.layers.forEach(g=>{Je(g.id)===d&&(m=g)}),m?m.ref?e.push(new Ge(n,r.ref,"ref cannot reference another ref layer")):h=Je(m.type):typeof d=="string"&&e.push(new Ge(n,r.ref,`ref layer "${d}" not found`))}else if(h!=="background"&&h!=="sky")if(r.source){const m=s.sources&&s.sources[r.source],g=m&&Je(m.type);m?g==="vector"&&h==="raster"?e.push(new Ge(n,r.source,`layer "${r.id}" requires a raster source`)):g==="raster"&&h!=="raster"?e.push(new Ge(n,r.source,`layer "${r.id}" requires a vector source`)):g!=="vector"||r["source-layer"]?g==="raster-dem"&&h!=="hillshade"?e.push(new Ge(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):h!=="line"||!r.paint||!r.paint["line-gradient"]||g==="geojson"&&m.lineMetrics||e.push(new Ge(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ge(n,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ge(n,r.source,`source "${r.source}" not found`))}else e.push(new Ge(n,r,'missing required property "source"'));return e=e.concat(dr({key:n,value:r,valueSpec:c.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ki({key:`${n}.type`,value:r.type,valueSpec:c.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:m=>xn(jt({layerType:h},m)),layout:m=>dr({layer:r,key:m.key,value:m.value,valueSpec:{},style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":g=>wl(jt({layerType:h},g))}}),paint:m=>dr({layer:r,key:m.key,value:m.value,valueSpec:{},style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":g=>pa(jt({layerType:h},g))}})}})),e}function Yr(i){const e=i.value,r=i.key,n=Wt(e);return n!=="string"?[new Ge(r,e,`string expected, ${n} found`)]:[]}const Gc={promoteId:function({key:i,value:e}){if(Wt(e)==="string")return Yr({key:i,value:e});{const r=[];for(const n in e)r.push(...Yr({key:`${i}.${n}`,value:e[n]}));return r}}};function $c(i){const e=i.value,r=i.key,n=i.styleSpec,s=i.style;if(!e.type)return[new Ge(r,e,'"type" is required')];const c=Je(e.type);let h;switch(c){case"vector":case"raster":case"raster-dem":return h=dr({key:r,value:e,valueSpec:n[`source_${c.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:Gc}),h;case"geojson":if(h=dr({key:r,value:e,valueSpec:n.source_geojson,style:s,styleSpec:n,objectElementValidators:Gc}),e.cluster)for(const d in e.clusterProperties){const[m,g]=e.clusterProperties[d],x=typeof m=="string"?[m,["accumulated"],["get",d]]:m;h.push(...Mo({key:`${r}.${d}.map`,value:g,expressionContext:"cluster-map"})),h.push(...Mo({key:`${r}.${d}.reduce`,value:x,expressionContext:"cluster-reduce"}))}return h;case"video":return dr({key:r,value:e,valueSpec:n.source_video,style:s,styleSpec:n});case"image":return dr({key:r,value:e,valueSpec:n.source_image,style:s,styleSpec:n});case"canvas":return[new Ge(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:s,styleSpec:n})}}function Zc(i){const e=i.value,r=i.styleSpec,n=r.light,s=i.style;let c=[];const h=Wt(e);if(e===void 0)return c;if(h!=="object")return c=c.concat([new Ge("light",e,`object expected, ${h} found`)]),c;for(const d in e){const m=d.match(/^(.*)-transition$/);c=c.concat(m&&n[m[1]]&&n[m[1]].transition?ki({key:d,value:e[d],valueSpec:r.transition,style:s,styleSpec:r}):n[d]?ki({key:d,value:e[d],valueSpec:n[d],style:s,styleSpec:r}):[new Ge(d,e[d],`unknown property "${d}"`)])}return c}function qc(i){const e=i.value,r=i.key,n=i.style,s=i.styleSpec,c=s.terrain;let h=[];const d=Wt(e);if(e===void 0)return h;if(d!=="object")return h=h.concat([new Ge("terrain",e,`object expected, ${d} found`)]),h;for(const m in e){const g=m.match(/^(.*)-transition$/);h=h.concat(g&&c[g[1]]&&c[g[1]].transition?ki({key:m,value:e[m],valueSpec:s.transition,style:n,styleSpec:s}):c[m]?ki({key:m,value:e[m],valueSpec:c[m],style:n,styleSpec:s}):[new Ge(m,e[m],`unknown property "${m}"`)])}if(e.source){const m=n.sources&&n.sources[e.source],g=m&&Je(m.type);m?g!=="raster-dem"&&h.push(new Ge(r,e.source,`terrain cannot be used with a source of type ${String(g)}, it only be used with a "raster-dem" source type`)):h.push(new Ge(r,e.source,`source "${e.source}" not found`))}else h.push(new Ge(r,e,'terrain is missing required property "source"'));return h}function Wc(i){const e=i.value,r=i.style,n=i.styleSpec,s=n.fog;let c=[];const h=Wt(e);if(e===void 0)return c;if(h!=="object")return c=c.concat([new Ge("fog",e,`object expected, ${h} found`)]),c;for(const d in e){const m=d.match(/^(.*)-transition$/);c=c.concat(m&&s[m[1]]&&s[m[1]].transition?ki({key:d,value:e[d],valueSpec:n.transition,style:r,styleSpec:n}):s[d]?ki({key:d,value:e[d],valueSpec:s[d],style:r,styleSpec:n}):[new Ge(d,e[d],`unknown property "${d}"`)])}return c}const ys={"*":()=>[],array:ps,boolean:function(i){const e=i.value,r=i.key,n=Wt(e);return n!=="boolean"?[new Ge(r,e,`boolean expected, ${n} found`)]:[]},number:Oc,color:function(i){const e=i.key,r=i.value,n=Wt(r);return n!=="string"?[new Ge(e,r,`color expected, ${n} found`)]:Ha.parseCSSColor(r)===null?[new Ge(e,r,`color expected, "${r}" found`)]:[]},enum:fs,filter:xn,function:Uc,layer:jc,object:dr,source:$c,light:Zc,terrain:qc,fog:Wc,string:Yr,formatted:function(i){return Yr(i).length===0?[]:Mo(i)},resolvedImage:function(i){return Yr(i).length===0?[]:Mo(i)},projection:function(i){const e=i.value,r=i.styleSpec,n=r.projection,s=i.style;let c=[];const h=Wt(e);if(h==="object")for(const d in e)c=c.concat(ki({key:d,value:e[d],valueSpec:n[d],style:s,styleSpec:r}));else h!=="string"&&(c=c.concat([new Ge("projection",e,`object or string expected, ${h} found`)]));return c}};function ki(i){const e=i.value,r=i.valueSpec,n=i.styleSpec;return r.expression&&Jn(Je(e))?Uc(i):r.expression&&Io(Ut(e))?Mo(i):r.type&&ys[r.type]?ys[r.type](i):dr(jt({},i,{valueSpec:r.type?n[r.type]:r}))}function tr(i){const e=i.value,r=i.key,n=Yr(i);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new Ge(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new Ge(r,e,'"glyphs" url must include a "{range}" token'))),n}function xs(i,e=fe){return Kr(ki({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:tr,"*":()=>[]}}))}const xh=i=>Kr(pa(i)),vh=i=>Kr(wl(i));function Kr(i){return i.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function Xc(i,e){let r=!1;if(e&&e.length)for(const n of e)i.fire(new ot(new Error(n.message))),r=!0;return r}var vn=Or;function Or(i,e,r){var n=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var s=new Int32Array(this.arrayBuffer);i=s[0],this.d=(e=s[1])+2*(r=s[2]);for(var c=0;c<this.d*this.d;c++){var h=s[3+c],d=s[3+c+1];n.push(h===d?null:s.subarray(h,d))}var m=s[3+n.length+1];this.keys=s.subarray(s[3+n.length],m),this.bboxes=s.subarray(m),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var g=0;g<this.d*this.d;g++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=r,this.scale=e/i,this.uid=0;var x=r/e*i;this.min=-x,this.max=i+x}Or.prototype.insert=function(i,e,r,n,s){this._forEachCell(e,r,n,s,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(s)},Or.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Or.prototype._insertCell=function(i,e,r,n,s,c){this.cells[s].push(c)},Or.prototype.query=function(i,e,r,n,s){var c=this.min,h=this.max;if(i<=c&&e<=c&&h<=r&&h<=n&&!s)return Array.prototype.slice.call(this.keys);var d=[];return this._forEachCell(i,e,r,n,this._queryCell,d,{},s),d},Or.prototype._queryCell=function(i,e,r,n,s,c,h,d){var m=this.cells[s];if(m!==null)for(var g=this.keys,x=this.bboxes,v=0;v<m.length;v++){var w=m[v];if(h[w]===void 0){var S=4*w;(d?d(x[S+0],x[S+1],x[S+2],x[S+3]):i<=x[S+2]&&e<=x[S+3]&&r>=x[S+0]&&n>=x[S+1])?(h[w]=!0,c.push(g[w])):h[w]=!1}}},Or.prototype._forEachCell=function(i,e,r,n,s,c,h,d){for(var m=this._convertToCellCoord(i),g=this._convertToCellCoord(e),x=this._convertToCellCoord(r),v=this._convertToCellCoord(n),w=m;w<=x;w++)for(var S=g;S<=v;S++){var z=this.d*S+w;if((!d||d(this._convertFromCellCoord(w),this._convertFromCellCoord(S),this._convertFromCellCoord(w+1),this._convertFromCellCoord(S+1)))&&s.call(this,i,e,r,n,z,c,h,d))return}},Or.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Or.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Or.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var s=new Int32Array(e+r+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var c=e,h=0;h<i.length;h++){var d=i[h];s[3+h]=c,s.set(d,c),c+=d.length}return s[3+i.length]=c,s.set(this.keys,c),s[3+i.length+1]=c+=this.keys.length,s.set(this.bboxes,c),c+=this.bboxes.length,s.buffer};const Ao={};function Ze(i,e,r={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),Ao[e]={klass:i,omit:r.omit||[]}}Ze(Object,"Object"),vn.serialize=function(i,e){const r=i.toArrayBuffer();return e&&e.push(r),{buffer:r}},vn.deserialize=function(i){return new vn(i.buffer)},Object.defineProperty(vn,"name",{value:"Grid"}),Ze(vn,"Grid"),Ze(Vt,"Color"),Ze(Error,"Error"),Ze(M,"AJAXError"),Ze(Ji,"ResolvedImage"),Ze(ua,"StylePropertyFunction"),Ze(ca,"StyleExpression",{omit:["_evaluator"]}),Ze(ml,"ZoomDependentExpression"),Ze(fl,"ZoomConstantExpression"),Ze(Qi,"CompoundExpression",{omit:["_evaluate"]});for(const i in Yn)Ao[Yn[i]._classRegistryKey]||Ze(Yn[i],`Expression${i}`);function Hc(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function fa(i){return _e.ImageBitmap&&i instanceof _e.ImageBitmap}function vs(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Hc(i)||fa(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof _e.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const n of i)r.push(vs(n,e));return r}if(typeof i=="object"){const r=i.constructor,n=r._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const s=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(const c in i)i.hasOwnProperty(c)&&(Ao[n].omit.indexOf(c)>=0||(s[c]=vs(i[c],e)));i instanceof Error&&(s.message=i.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(s.$name=n),s}throw new Error("can't serialize object of type "+typeof i)}function Co(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Hc(i)||fa(i)||ArrayBuffer.isView(i)||i instanceof _e.ImageData)return i;if(Array.isArray(i))return i.map(Co);if(typeof i=="object"){const e=i.$name||"Object",{klass:r}=Ao[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const n=Object.create(r.prototype);for(const s of Object.keys(i))s!=="$name"&&(n[s]=Co(i[s]));return n}throw new Error("can't deserialize object of type "+typeof i)}class Tl{constructor(){this.first=!0}update(e,r){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const Yc=i=>i>=1536&&i<=1791,ma=i=>i>=1872&&i<=1919,bs=i=>i>=2208&&i<=2303,El=i=>i>=11904&&i<=12031,Kc=i=>i>=12032&&i<=12255,Sl=i=>i>=12272&&i<=12287,_a=i=>i>=12288&&i<=12351,ws=i=>i>=12352&&i<=12447,ga=i=>i>=12448&&i<=12543,Jc=i=>i>=12544&&i<=12591,Qc=i=>i>=12704&&i<=12735,eu=i=>i>=12736&&i<=12783,Il=i=>i>=12784&&i<=12799,tu=i=>i>=12800&&i<=13055,iu=i=>i>=13056&&i<=13311,ru=i=>i>=13312&&i<=19903,Ml=i=>i>=19968&&i<=40959,nu=i=>i>=40960&&i<=42127,ou=i=>i>=42128&&i<=42191,su=i=>i>=44032&&i<=55215,Ts=i=>i>=63744&&i<=64255,Al=i=>i>=64336&&i<=65023,au=i=>i>=65040&&i<=65055,zo=i=>i>=65072&&i<=65103,lu=i=>i>=65104&&i<=65135,ya=i=>i>=65136&&i<=65279,Cl=i=>i>=65280&&i<=65519;function xa(i){for(const e of i)if(va(e.charCodeAt(0)))return!0;return!1}function cu(i){for(const e of i)if(!uu(e.charCodeAt(0)))return!1;return!0}function uu(i){return!(Yc(i)||ma(i)||bs(i)||Al(i)||ya(i))}function va(i){return!(i!==746&&i!==747&&(i<4352||!(Qc(i)||Jc(i)||zo(i)&&!(i>=65097&&i<=65103)||Ts(i)||iu(i)||El(i)||eu(i)||!(!_a(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ru(i)||Ml(i)||tu(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||su(i)||ws(i)||Sl(i)||(e=>e>=12688&&e<=12703)(i)||Kc(i)||Il(i)||ga(i)&&i!==12540||!(!Cl(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!lu(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||au(i)||(e=>e>=19904&&e<=19967)(i)||nu(i)||ou(i))))}function ba(i){return!(va(i)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||_a(e)||ga(e)||(r=>r>=57344&&r<=63743)(e)||zo(e)||lu(e)||Cl(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function wa(i){return i>=1424&&i<=2303||Al(i)||ya(i)}function bh(i,e){return!(!e&&wa(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(r=>r>=6016&&r<=6143)(i))}function wh(i){for(const e of i)if(wa(e.charCodeAt(0)))return!0;return!1}const zl="deferred",Es="loading",kl="loaded";let Pl=null,qi="unavailable",ir=null;const Ss=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(qi="error"),Pl&&Pl(i)};function Qn(){Dl.fire(new nt("pluginStateChange",{pluginStatus:qi,pluginURL:ir}))}const Dl=new ht,Ta=function(){return qi},ko=function(){if(qi!==zl||!ir)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");qi=Es,Qn(),ir&&Y({url:ir},i=>{i?Ss(i):(qi=kl,Qn())})},pr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>qi===kl||pr.applyArabicShaping!=null,isLoading:()=>qi===Es,setState(i){qi=i.pluginStatus,ir=i.pluginURL},isParsed:()=>pr.applyArabicShaping!=null&&pr.processBidirectionalText!=null&&pr.processStyledBidirectionalText!=null,getPluginURL:()=>ir};class ti{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Tl,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,n){for(const s of r)if(!bh(s.charCodeAt(0),n))return!1;return!0}(e,pr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class Is{constructor(e,r){this.property=e,this.value=r,this.expression=function(n,s){if(Jn(n))return new ua(n,s);if(Io(n)){const c=Fc(n,s);if(c.result==="error")throw new Error(c.value.map(h=>`${h.key}: ${h.message}`).join(", "));return c.value}{let c=n;return typeof n=="string"&&s.type==="color"&&(c=Vt.parse(n)),{kind:"constant",evaluate:()=>c}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,n){return this.property.possiblyEvaluate(this,e,r,n)}}class Po{constructor(e){this.property=e,this.value=new Is(e,void 0)}transitioned(e,r){return new t(this.property,this.value,r,tt({},e.transition,this.transition),e.now)}untransitioned(){return new t(this.property,this.value,null,{},0)}}class l{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return yi(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Po(this._values[e].property)),this._values[e].value=new Is(this._values[e].property,r===null?void 0:yi(r))}getTransition(e){return yi(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Po(this._values[e].property)),this._values[e].transition=yi(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n);const s=this.getTransition(r);s!==void 0&&(e[`${r}-transition`]=s)}return e}transitioned(e,r){const n=new o(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].transitioned(e,r._values[s]);return n}untransitioned(){const e=new o(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class t{constructor(e,r,n,s,c){const h=s.delay||0,d=s.duration||0;c=c||0,this.property=e,this.value=r,this.begin=c+h,this.end=this.begin+d,e.specification.transition&&(s.delay||s.duration)&&(this.prior=n)}possiblyEvaluate(e,r,n){const s=e.now||0,c=this.value.possiblyEvaluate(e,r,n),h=this.prior;if(h){if(s>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(s<this.begin)return h.possiblyEvaluate(e,r,n);{const d=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,r,n),c,_t(d))}}return c}}class o{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,n){const s=new f(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].possiblyEvaluate(e,r,n);return s}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class u{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return yi(this._values[e].value)}setValue(e,r){this._values[e]=new Is(this._values[e].property,r===null?void 0:yi(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n)}return e}possiblyEvaluate(e,r,n){const s=new f(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].possiblyEvaluate(e,r,n);return s}}class p{constructor(e,r,n){this.property=e,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,n,s){return this.property.evaluate(this.value,this.parameters,e,r,n,s)}}class f{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class _{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,n){const s=Qs[this.specification.type];return s?s(e,r,n):e}}class y{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,n,s){return new p(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},n,s)}:e.expression,r)}interpolate(e,r,n){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new p(this,{kind:"constant",value:void 0},e.parameters);const s=Qs[this.specification.type];return s?new p(this,{kind:"constant",value:s(e.value.value,r.value.value,n)},e.parameters):e}evaluate(e,r,n,s,c,h){return e.kind==="constant"?e.value:e.evaluate(r,n,s,c,h)}}class b extends y{possiblyEvaluate(e,r,n,s){if(e.value===void 0)return new p(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const c=e.expression.evaluate(r,null,{},n,s),h=e.property.specification.type==="resolvedImage"&&typeof c!="string"?c.name:c,d=this._calculate(h,h,h,r);return new p(this,{kind:"constant",value:d},r)}if(e.expression.kind==="camera"){const c=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new p(this,{kind:"constant",value:c},r)}return new p(this,e.expression,r)}evaluate(e,r,n,s,c,h){if(e.kind==="source"){const d=e.evaluate(r,n,s,c,h);return this._calculate(d,d,d,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},n,s),e.evaluate({zoom:Math.floor(r.zoom)},n,s),e.evaluate({zoom:Math.floor(r.zoom)+1},n,s),r):e.value}_calculate(e,r,n,s){return s.zoom>s.zoomHistory.lastIntegerZoom?{from:e,to:r,other:n}:{from:n,to:r,other:e}}interpolate(e){return e}}class T{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,s){if(e.value!==void 0){if(e.expression.kind==="constant"){const c=e.expression.evaluate(r,null,{},n,s);return this._calculate(c,c,c,r)}return this._calculate(e.expression.evaluate(new ti(Math.floor(r.zoom-1),r)),e.expression.evaluate(new ti(Math.floor(r.zoom),r)),e.expression.evaluate(new ti(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,n,s){return s.zoom>s.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:n,to:r}}interpolate(e){return e}}class E{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,s){return!!e.expression.evaluate(r,null,{},n,s)}interpolate(){return!1}}class A{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const s=this.defaultPropertyValues[r]=new Is(n,void 0),c=this.defaultTransitionablePropertyValues[r]=new Po(n);this.defaultTransitioningPropertyValues[r]=c.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=s.possiblyEvaluate({})}}}function B(i,e){return 256*(i=qe(Math.floor(i),0,255))+qe(Math.floor(e),0,255)}Ze(y,"DataDrivenProperty"),Ze(_,"DataConstantProperty"),Ze(b,"CrossFadedDataDrivenProperty"),Ze(T,"CrossFadedProperty"),Ze(E,"ColorRampProperty");const O={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class R{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class D{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function X(i,e=1){let r=0,n=0;return{members:i.map(s=>{const c=O[s.type].BYTES_PER_ELEMENT,h=r=j(r,Math.max(e,c)),d=s.components||1;return n=Math.max(n,c),r+=c*d,{name:s.name,type:s.type,components:d,offset:h}}),size:j(r,Math.max(n,e)),alignment:e}}function j(i,e){return Math.ceil(i/e)*e}class q extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const s=2*e;return this.int16[s+0]=r,this.int16[s+1]=n,e}}q.prototype.bytesPerElement=4,Ze(q,"StructArrayLayout2i4");class W extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,r,n)}emplace(e,r,n,s){const c=3*e;return this.int16[c+0]=r,this.int16[c+1]=n,this.int16[c+2]=s,e}}W.prototype.bytesPerElement=6,Ze(W,"StructArrayLayout3i6");class K extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n,s)}emplace(e,r,n,s,c){const h=4*e;return this.int16[h+0]=r,this.int16[h+1]=n,this.int16[h+2]=s,this.int16[h+3]=c,e}}K.prototype.bytesPerElement=8,Ze(K,"StructArrayLayout4i8");class Z extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,s,c,h,d)}emplace(e,r,n,s,c,h,d,m){const g=6*e,x=12*e,v=3*e;return this.int16[g+0]=r,this.int16[g+1]=n,this.uint8[x+4]=s,this.uint8[x+5]=c,this.uint8[x+6]=h,this.uint8[x+7]=d,this.float32[v+2]=m,e}}Z.prototype.bytesPerElement=12,Ze(Z,"StructArrayLayout2i4ub1f12");class ee extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n,s)}emplace(e,r,n,s,c){const h=4*e;return this.float32[h+0]=r,this.float32[h+1]=n,this.float32[h+2]=s,this.float32[h+3]=c,e}}ee.prototype.bytesPerElement=16,Ze(ee,"StructArrayLayout4f16");class he extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h,d,m,g,x){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,n,s,c,h,d,m,g,x)}emplace(e,r,n,s,c,h,d,m,g,x,v){const w=10*e;return this.uint16[w+0]=r,this.uint16[w+1]=n,this.uint16[w+2]=s,this.uint16[w+3]=c,this.uint16[w+4]=h,this.uint16[w+5]=d,this.uint16[w+6]=m,this.uint16[w+7]=g,this.uint16[w+8]=x,this.uint16[w+9]=v,e}}he.prototype.bytesPerElement=20,Ze(he,"StructArrayLayout10ui20");class xe extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,n,s,c,h,d,m)}emplace(e,r,n,s,c,h,d,m,g){const x=8*e;return this.uint16[x+0]=r,this.uint16[x+1]=n,this.uint16[x+2]=s,this.uint16[x+3]=c,this.uint16[x+4]=h,this.uint16[x+5]=d,this.uint16[x+6]=m,this.uint16[x+7]=g,e}}xe.prototype.bytesPerElement=16,Ze(xe,"StructArrayLayout8ui16");class Te extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,n,s,c,h)}emplace(e,r,n,s,c,h,d){const m=6*e;return this.int16[m+0]=r,this.int16[m+1]=n,this.int16[m+2]=s,this.int16[m+3]=c,this.int16[m+4]=h,this.int16[m+5]=d,e}}Te.prototype.bytesPerElement=12,Ze(Te,"StructArrayLayout6i12");class be extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h,d,m,g,x,v,w,S,z,L,F){const G=this.length;return this.resize(G+1),this.emplace(G,e,r,n,s,c,h,d,m,g,x,v,w,S,z,L,F)}emplace(e,r,n,s,c,h,d,m,g,x,v,w,S,z,L,F,G){const Q=16*e;return this.int16[Q+0]=r,this.int16[Q+1]=n,this.int16[Q+2]=s,this.int16[Q+3]=c,this.uint16[Q+4]=h,this.uint16[Q+5]=d,this.uint16[Q+6]=m,this.uint16[Q+7]=g,this.int16[Q+8]=x,this.int16[Q+9]=v,this.int16[Q+10]=w,this.int16[Q+11]=S,this.int16[Q+12]=z,this.int16[Q+13]=L,this.int16[Q+14]=F,this.int16[Q+15]=G,e}}be.prototype.bytesPerElement=32,Ze(be,"StructArrayLayout4i4ui4i4i32");class Re extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,r,n)}emplace(e,r,n,s){const c=3*e;return this.float32[c+0]=r,this.float32[c+1]=n,this.float32[c+2]=s,e}}Re.prototype.bytesPerElement=12,Ze(Re,"StructArrayLayout3f12");class de extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}de.prototype.bytesPerElement=4,Ze(de,"StructArrayLayout1ul4");class Fe extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h,d,m,g,x,v,w,S){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,n,s,c,h,d,m,g,x,v,w,S)}emplace(e,r,n,s,c,h,d,m,g,x,v,w,S,z){const L=20*e,F=10*e;return this.int16[L+0]=r,this.int16[L+1]=n,this.int16[L+2]=s,this.int16[L+3]=c,this.int16[L+4]=h,this.float32[F+3]=d,this.float32[F+4]=m,this.float32[F+5]=g,this.float32[F+6]=x,this.int16[L+14]=v,this.uint32[F+8]=w,this.uint16[L+18]=S,this.uint16[L+19]=z,e}}Fe.prototype.bytesPerElement=40,Ze(Fe,"StructArrayLayout5i4f1i1ul2ui40");class De extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,s,c,h,d)}emplace(e,r,n,s,c,h,d,m){const g=8*e;return this.int16[g+0]=r,this.int16[g+1]=n,this.int16[g+2]=s,this.int16[g+4]=c,this.int16[g+5]=h,this.int16[g+6]=d,this.int16[g+7]=m,e}}De.prototype.bytesPerElement=16,Ze(De,"StructArrayLayout3i2i2i16");class Ke extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,s,c)}emplace(e,r,n,s,c,h){const d=4*e,m=8*e;return this.float32[d+0]=r,this.float32[d+1]=n,this.float32[d+2]=s,this.int16[m+6]=c,this.int16[m+7]=h,e}}Ke.prototype.bytesPerElement=16,Ze(Ke,"StructArrayLayout2f1f2i16");class Ee extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n,s)}emplace(e,r,n,s,c){const h=12*e,d=3*e;return this.uint8[h+0]=r,this.uint8[h+1]=n,this.float32[d+1]=s,this.float32[d+2]=c,e}}Ee.prototype.bytesPerElement=12,Ze(Ee,"StructArrayLayout2ub2f12");class Xe extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,r,n)}emplace(e,r,n,s){const c=3*e;return this.uint16[c+0]=r,this.uint16[c+1]=n,this.uint16[c+2]=s,e}}Xe.prototype.bytesPerElement=6,Ze(Xe,"StructArrayLayout3ui6");class st extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h,d,m,g,x,v,w,S,z,L,F,G,Q,re,oe,se){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,r,n,s,c,h,d,m,g,x,v,w,S,z,L,F,G,Q,re,oe,se)}emplace(e,r,n,s,c,h,d,m,g,x,v,w,S,z,L,F,G,Q,re,oe,se,ae){const ve=30*e,we=15*e,Me=60*e;return this.int16[ve+0]=r,this.int16[ve+1]=n,this.int16[ve+2]=s,this.float32[we+2]=c,this.float32[we+3]=h,this.uint16[ve+8]=d,this.uint16[ve+9]=m,this.uint32[we+5]=g,this.uint32[we+6]=x,this.uint32[we+7]=v,this.uint16[ve+16]=w,this.uint16[ve+17]=S,this.uint16[ve+18]=z,this.float32[we+10]=L,this.float32[we+11]=F,this.uint8[Me+48]=G,this.uint8[Me+49]=Q,this.uint8[Me+50]=re,this.uint32[we+13]=oe,this.int16[ve+28]=se,this.uint8[Me+58]=ae,e}}st.prototype.bytesPerElement=60,Ze(st,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class He extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h,d,m,g,x,v,w,S,z,L,F,G,Q,re,oe,se,ae,ve,we,Me,Ce,ye,Se,Pe,Ve){const Le=this.length;return this.resize(Le+1),this.emplace(Le,e,r,n,s,c,h,d,m,g,x,v,w,S,z,L,F,G,Q,re,oe,se,ae,ve,we,Me,Ce,ye,Se,Pe,Ve)}emplace(e,r,n,s,c,h,d,m,g,x,v,w,S,z,L,F,G,Q,re,oe,se,ae,ve,we,Me,Ce,ye,Se,Pe,Ve,Le){const Oe=38*e,yt=19*e;return this.int16[Oe+0]=r,this.int16[Oe+1]=n,this.int16[Oe+2]=s,this.float32[yt+2]=c,this.float32[yt+3]=h,this.int16[Oe+8]=d,this.int16[Oe+9]=m,this.int16[Oe+10]=g,this.int16[Oe+11]=x,this.int16[Oe+12]=v,this.int16[Oe+13]=w,this.uint16[Oe+14]=S,this.uint16[Oe+15]=z,this.uint16[Oe+16]=L,this.uint16[Oe+17]=F,this.uint16[Oe+18]=G,this.uint16[Oe+19]=Q,this.uint16[Oe+20]=re,this.uint16[Oe+21]=oe,this.uint16[Oe+22]=se,this.uint16[Oe+23]=ae,this.uint16[Oe+24]=ve,this.uint16[Oe+25]=we,this.uint16[Oe+26]=Me,this.uint16[Oe+27]=Ce,this.uint16[Oe+28]=ye,this.uint32[yt+15]=Se,this.float32[yt+16]=Pe,this.float32[yt+17]=Ve,this.float32[yt+18]=Le,e}}He.prototype.bytesPerElement=76,Ze(He,"StructArrayLayout3i2f6i15ui1ul3f76");class Ye extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Ye.prototype.bytesPerElement=4,Ze(Ye,"StructArrayLayout1f4");class ct extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,s,c,h,d)}emplace(e,r,n,s,c,h,d,m){const g=7*e;return this.float32[g+0]=r,this.float32[g+1]=n,this.float32[g+2]=s,this.float32[g+3]=c,this.float32[g+4]=h,this.float32[g+5]=d,this.float32[g+6]=m,e}}ct.prototype.bytesPerElement=28,Ze(ct,"StructArrayLayout7f28");class Tt extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,s,c)}emplace(e,r,n,s,c,h){const d=5*e;return this.float32[d+0]=r,this.float32[d+1]=n,this.float32[d+2]=s,this.float32[d+3]=c,this.float32[d+4]=h,e}}Tt.prototype.bytesPerElement=20,Ze(Tt,"StructArrayLayout5f20");class it extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n,s)}emplace(e,r,n,s,c){const h=6*e;return this.uint32[3*e+0]=r,this.uint16[h+2]=n,this.uint16[h+3]=s,this.uint16[h+4]=c,e}}it.prototype.bytesPerElement=12,Ze(it,"StructArrayLayout1ul3ui12");class dt extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const s=2*e;return this.uint16[s+0]=r,this.uint16[s+1]=n,e}}dt.prototype.bytesPerElement=4,Ze(dt,"StructArrayLayout2ui4");class Rt extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Rt.prototype.bytesPerElement=2,Ze(Rt,"StructArrayLayout1ui2");class ci extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const s=2*e;return this.float32[s+0]=r,this.float32[s+1]=n,e}}ci.prototype.bytesPerElement=8,Ze(ci,"StructArrayLayout2f8");class Fi extends D{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,s,c,h,d)}emplace(e,r,n,s,c,h,d,m){const g=8*e,x=4*e;return this.int16[g+0]=r,this.int16[g+1]=n,this.int16[g+2]=s,this.int16[g+3]=c,this.int16[g+4]=h,this.int16[g+5]=d,this.float32[x+3]=m,e}}Fi.prototype.bytesPerElement=16,Ze(Fi,"StructArrayLayout6i1f16");class Oi extends R{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Oi.prototype.size=12;class rr extends Te{get(e){return new Oi(this,e)}}Ze(rr,"FillExtrusionExtArray");class Pr extends R{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Pr.prototype.size=40;class Jr extends Fe{get(e){return new Pr(this,e)}}Ze(Jr,"CollisionBoxArray");class bn extends R{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}bn.prototype.size=60;class Qr extends st{get(e){return new bn(this,e)}}Ze(Qr,"PlacedSymbolArray");class di extends R{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}di.prototype.size=76;class mi extends He{get(e){return new di(this,e)}}Ze(mi,"SymbolInstanceArray");class $t extends Ye{getoffsetX(e){return this.float32[1*e+0]}}Ze($t,"GlyphOffsetArray");class Ti extends W{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ze(Ti,"SymbolLineVertexArray");class nr extends R{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}nr.prototype.size=12;class ui extends it{get(e){return new nr(this,e)}}Ze(ui,"FeatureIndexArray");class fr extends R{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}fr.prototype.size=4;class Ms extends dt{get(e){return new fr(this,e)}}Ze(Ms,"FillExtrusionCentroidArray");class or extends R{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}or.prototype.size=16;class eo extends Fi{get(e){return new or(this,e)}}Ze(eo,"CircleGlobeExtArray");const hu=X([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Ll=X([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Do=qs(function(i){i.exports=function(e,r){var n,s,c,h,d,m,g,x;for(s=e.length-(n=3&e.length),c=r,d=3432918353,m=461845907,x=0;x<s;)g=255&e.charCodeAt(x)|(255&e.charCodeAt(++x))<<8|(255&e.charCodeAt(++x))<<16|(255&e.charCodeAt(++x))<<24,++x,c=27492+(65535&(h=5*(65535&(c=(c^=g=(65535&(g=(g=(65535&g)*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(g=0,n){case 3:g^=(255&e.charCodeAt(x+2))<<16;case 2:g^=(255&e.charCodeAt(x+1))<<8;case 1:c^=g=(65535&(g=(g=(65535&(g^=255&e.charCodeAt(x)))*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295}return c^=e.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}}),Th=qs(function(i){i.exports=function(e,r){for(var n,s=e.length,c=r^s,h=0;s>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(h)|(255&e.charCodeAt(++h))<<8|(255&e.charCodeAt(++h))<<16|(255&e.charCodeAt(++h))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:c^=(255&e.charCodeAt(h+2))<<16;case 2:c^=(255&e.charCodeAt(h+1))<<8;case 1:c=1540483477*(65535&(c^=255&e.charCodeAt(h)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}}),wn=Do,Bl=Th;wn.murmur3=Do,wn.murmur2=Bl;class du{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,n,s){this.ids.push(Jd(e)),this.positions.push(r,n,s)}getPositions(e){const r=Jd(e);let n=0,s=this.ids.length-1;for(;n<s;){const h=n+s>>1;this.ids[h]>=r?s=h:n=h+1}const c=[];for(;this.ids[n]===r;)c.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return c}static serialize(e,r){const n=new Float64Array(e.ids),s=new Uint32Array(e.positions);return Eh(n,s,0,n.length-1),r&&r.push(n.buffer,s.buffer),{ids:n,positions:s}}static deserialize(e){const r=new du;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Jd(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:wn(String(i))}function Eh(i,e,r,n){for(;r<n;){const s=i[r+n>>1];let c=r-1,h=n+1;for(;;){do c++;while(i[c]<s);do h--;while(i[h]>s);if(c>=h)break;pu(i,c,h),pu(e,3*c,3*h),pu(e,3*c+1,3*h+1),pu(e,3*c+2,3*h+2)}h-r<n-h?(Eh(i,e,r,h),r=h+1):(Eh(i,e,h+1,n),n=h)}}function pu(i,e,r){const n=i[e];i[e]=i[r],i[r]=n}Ze(du,"FeaturePositionMap");class to{constructor(e,r){this.gl=e.gl,this.location=r}}class fu extends to{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Qd extends to{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ep extends to{constructor(e,r){super(e,r),this.current=Vt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const c_=new Float32Array(16),u_=new Float32Array(9),h_=new Float32Array(4);function Sh(i){return[B(255*i.r,255*i.g),B(255*i.b,255*i.a)]}class Rl{constructor(e,r,n){this.value=e,this.uniformNames=r.map(s=>`u_${s}`),this.type=n}setUniform(e,r,n){e.set(n.constantOr(this.value))}getBinding(e,r,n){return this.type==="color"?new ep(e,r):new fu(e,r)}}class Ea{constructor(e,r){this.uniformNames=r.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,n,s){const c=s==="u_pattern_to"||s==="u_dash_to"?this.patternTo:s==="u_pattern_from"||s==="u_dash_from"?this.patternFrom:s==="u_pixel_ratio_to"?this.pixelRatioTo:s==="u_pixel_ratio_from"?this.pixelRatioFrom:null;c&&e.set(c)}getBinding(e,r,n){return n==="u_pattern_from"||n==="u_pattern_to"||n==="u_dash_from"||n==="u_dash_to"?new Qd(e,r):new fu(e,r)}}class io{constructor(e,r,n,s){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(c=>({name:`a_${c}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,r,n,s,c,h){const d=this.paintVertexArray.length,m=this.expression.evaluate(new ti(0),r,{},c,s,h);this.paintVertexArray.resize(e),this._setPaintValue(d,e,m)}updatePaintArray(e,r,n,s,c){const h=this.expression.evaluate({zoom:0},n,s,void 0,c);this._setPaintValue(e,r,h)}_setPaintValue(e,r,n){if(this.type==="color"){const s=Sh(n);for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,s[0],s[1])}else{for(let s=e;s<r;s++)this.paintVertexArray.emplace(s,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class en{constructor(e,r,n,s,c,h){this.expression=e,this.uniformNames=r.map(d=>`u_${d}_t`),this.type=n,this.useIntegerZoom=s,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,n,s,c,h){const d=this.expression.evaluate(new ti(this.zoom),r,{},c,s,h),m=this.expression.evaluate(new ti(this.zoom+1),r,{},c,s,h),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,d,m)}updatePaintArray(e,r,n,s,c){const h=this.expression.evaluate({zoom:this.zoom},n,s,void 0,c),d=this.expression.evaluate({zoom:this.zoom+1},n,s,void 0,c);this._setPaintValue(e,r,h,d)}_setPaintValue(e,r,n,s){if(this.type==="color"){const c=Sh(n),h=Sh(s);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,c[0],c[1],h[0],h[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,n,s);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,s=qe(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(s)}getBinding(e,r,n){return new fu(e,r)}}class Lo{constructor(e,r,n,s,c,h,d){this.expression=e,this.type=n,this.useIntegerZoom=s,this.zoom=c,this.layerId=d,this.paintVertexAttributes=(n==="array"?Ll:hu).members;for(let m=0;m<r.length;++m);this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,r,n){const s=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(s,e,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(e,r,n,s,c,h){this._setPaintValues(e,r,n.patterns&&n.patterns[this.layerId],h)}_setPaintValues(e,r,n,s){if(!s||!n)return;const{min:c,mid:h,max:d}=n,m=s[c],g=s[h],x=s[d];if(m&&g&&x)for(let v=e;v<r;v++)this._setPaintValue(this.zoomInPaintVertexArray,v,g,m),this._setPaintValue(this.zoomOutPaintVertexArray,v,g,x)}_setPaintValue(e,r,n,s){e.emplace(r,n.tl[0],n.tl[1],n.br[0],n.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],n.pixelRatio,s.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Bo{constructor(e,r,n=()=>!0){this.binders={},this._buffers=[];const s=[];for(const c in e.paint._values){if(!n(c))continue;const h=e.paint.get(c);if(!(h instanceof p&&So(h.property.specification)))continue;const d=p_(c,e.type),m=h.value,g=h.property.specification.type,x=h.property.useIntegerZoom,v=h.property.specification["property-type"],w=v==="cross-faded"||v==="cross-faded-data-driven",S=String(c)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(m.kind!=="constant"||S)if(m.kind==="source"||S||w){const z=tp(c,g,"source");this.binders[c]=w?new Lo(m,d,g,x,r,z,e.id):new io(m,d,g,z),s.push(`/a_${c}`)}else{const z=tp(c,g,"composite");this.binders[c]=new en(m,d,g,x,r,z),s.push(`/z_${c}`)}else this.binders[c]=w?new Ea(m.value,d):new Rl(m.value,d,g),s.push(`/u_${c}`)}this.cacheKey=s.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof io||r instanceof en?r.maxValue:0}populatePaintArrays(e,r,n,s,c,h){for(const d in this.binders){const m=this.binders[d];(m instanceof io||m instanceof en||m instanceof Lo)&&m.populatePaintArray(e,r,n,s,c,h)}}setConstantPatternPositions(e,r){for(const n in this.binders){const s=this.binders[n];s instanceof Ea&&s.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,n,s,c,h){let d=!1;for(const m in e){const g=r.getPositions(m);for(const x of g){const v=n.feature(x.index);for(const w in this.binders){const S=this.binders[w];if((S instanceof io||S instanceof en||S instanceof Lo)&&S.expression.isStateDependent===!0){const z=s.paint.get(w);S.expression=z.value,S.updatePaintArray(x.start,x.end,v,e[m],c,h),d=!0}}}}return d}defines(){const e=[];for(const r in this.binders){const n=this.binders[r];(n instanceof Rl||n instanceof Ea)&&e.push(...n.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof io||n instanceof en||n instanceof Lo)for(let s=0;s<n.paintVertexAttributes.length;s++)e.push(n.paintVertexAttributes[s].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Rl||n instanceof Ea||n instanceof en)for(const s of n.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const n=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Rl||c instanceof Ea||c instanceof en){for(const h of c.uniformNames)if(r[h]){const d=c.getBinding(e,r[h],h);n.push({name:h,property:s,binding:d})}}}return n}setUniforms(e,r,n,s){for(const{name:c,property:h,binding:d}of r)this.binders[h].setUniform(d,s,n.get(h),c)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const n=this.binders[r];if(e&&n instanceof Lo){const s=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;s&&this._buffers.push(s)}else(n instanceof io||n instanceof en)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const r in this.binders){const n=this.binders[r];(n instanceof io||n instanceof en||n instanceof Lo)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof io||r instanceof en||r instanceof Lo)&&r.destroy()}}}class As{constructor(e,r,n=()=>!0){this.programConfigurations={};for(const s of e)this.programConfigurations[s.id]=new Bo(s,r,n);this.needsUpload=!1,this._featureMap=new du,this._bufferOffset=0}populatePaintArrays(e,r,n,s,c,h,d){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,r,s,c,h,d);r.id!==void 0&&this._featureMap.add(r.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,n,s,c){for(const h of n)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,r,h,s,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const d_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function p_(i,e){return d_[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const f_={"line-pattern":{source:he,composite:he},"fill-pattern":{source:he,composite:he},"fill-extrusion-pattern":{source:he,composite:he},"line-dasharray":{source:xe,composite:xe}},m_={color:{source:ci,composite:ee},number:{source:Ye,composite:ci}};function tp(i,e,r){const n=f_[i];return n&&n[r]||m_[e][r]}Ze(Rl,"ConstantBinder"),Ze(Ea,"CrossFadedConstantBinder"),Ze(io,"SourceExpressionBinder"),Ze(Lo,"CrossFadedCompositeBinder"),Ze(en,"CompositeExpressionBinder"),Ze(Bo,"ProgramConfiguration",{omit:["_buffers"]}),Ze(As,"ProgramConfigurationSet");const mu="-transition";class tn extends ht{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new u(r.layout)),r.paint)){this._transitionablePaint=new l(r.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new f(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,n={}){r!=null&&this._validate(vh,`layers.${this.id}.layout.${e}`,e,r,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return ai(e,mu)?this._transitionablePaint.getTransition(e.slice(0,-mu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,n={}){if(r!=null&&this._validate(xh,`layers.${this.id}.paint.${e}`,e,r,n))return!1;if(ai(e,mu))return this._transitionablePaint.setTransition(e.slice(0,-mu.length),r||void 0),!1;{const s=this._transitionablePaint._values[e],c=s.property.specification["property-type"]==="cross-faded-data-driven",h=s.value.isDataDriven(),d=s.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const m=this._transitionablePaint._values[e].value;return m.isDataDriven()||h||c||this._handleOverridablePaintPropertyUpdate(e,d,m)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Tr(e,(r,n)=>!(r===void 0||n==="layout"&&!Object.keys(r).length||n==="paint"&&!Object.keys(r).length))}_validate(e,r,n,s,c={}){return(!c||c.validate!==!1)&&Xc(this,e.call(xs,{key:r,layerType:this.type,objectKey:n,value:s,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof p&&So(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=gn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const __=X([{name:"a_pos",components:2,type:"Int16"}],4),g_=X([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class _i{constructor(e=[]){this.segments=e}prepareSegment(e,r,n,s){let c=this.segments[this.segments.length-1];return e>_i.MAX_VERTEX_ARRAY_LENGTH&&Lt(`Max vertices per segment is ${_i.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>_i.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==s)&&(c={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},s!==void 0&&(c.sortKey=s),this.segments.push(c)),c}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,n,s){return new _i([{vertexOffset:e,primitiveOffset:r,vertexLength:n,primitiveLength:s,vaos:{},sortKey:0}])}}_i.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ze(_i,"SegmentVector");var wt=8192;class Ro{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ht?new Ht(e.lng,e.lat):Ht.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ht?new Ht(e.lng,e.lat):Ht.convert(e),this}extend(e){const r=this._sw,n=this._ne;let s,c;if(e instanceof Ht)s=e,c=e;else{if(!(e instanceof Ro))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ro.convert(e)):this.extend(Ht.convert(e)):this;if(s=e._sw,c=e._ne,!s||!c)return this}return r||n?(r.lng=Math.min(s.lng,r.lng),r.lat=Math.min(s.lat,r.lat),n.lng=Math.max(c.lng,n.lng),n.lat=Math.max(c.lat,n.lat)):(this._sw=new Ht(s.lng,s.lat),this._ne=new Ht(c.lng,c.lat)),this}getCenter(){return new Ht((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ht(this.getWest(),this.getNorth())}getSouthEast(){return new Ht(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:n}=Ht.convert(e);let s=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&s}static convert(e){return!e||e instanceof Ro?e:new Ro(e)}}const Ih=63710088e-1;class Ht{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ht(vt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,n=this.lat*r,s=e.lat*r,c=Math.sin(n)*Math.sin(s)+Math.cos(n)*Math.cos(s)*Math.cos((e.lng-this.lng)*r);return Ih*Math.acos(Math.min(c,1))}toBounds(e=0){const r=360*e/40075017,n=r/Math.cos(Math.PI/180*this.lat);return new Ro(new Ht(this.lng-n,this.lat-r),new Ht(this.lng+n,this.lat+r))}static convert(e){if(e instanceof Ht)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ht(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ht(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ip=2*Math.PI*Ih;function Mh(i){return ip*Math.cos(i*Math.PI/180)}function Fl(i){return(180+i)/360}function Sa(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Ia(i,e){return i/Mh(e)}function Ur(i){return 360*i-180}function Ui(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function rp(i,e){return i*Mh(Ui(e))}const Tn=85.051129;class _u{constructor(e,r,n=0){this.x=+e,this.y=+r,this.z=+n}static fromLngLat(e,r=0){const n=Ht.convert(e);return new _u(Fl(n.lng),Sa(n.lat),Ia(r,n.lat))}toLngLat(){return new Ht(Ur(this.x),Ui(this.y))}toAltitude(){return rp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ip*(e=Ui(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ah(i,e,r,n,s,c,h,d,m){const g=(e+n)/2,x=(r+s)/2,v=new H(g,x);d(v),function(w,S,z,L,F,G){const Q=z-F,re=L-G;return Math.abs((L-S)*Q-(z-w)*re)/Math.hypot(Q,re)}(v.x,v.y,c.x,c.y,h.x,h.y)>=m?(Ah(i,e,r,g,x,c,v,d,m),Ah(i,g,x,n,s,v,h,d,m)):i.push(h)}function y_(i,e,r){let n=i[0],s=n.x,c=n.y;e(n);const h=[n];for(let d=1;d<i.length;d++){const m=i[d],{x:g,y:x}=m;e(m),Ah(h,s,c,g,x,n,m,e,r),s=g,c=x,n=m}return h}const Ch=Math.pow(2,14)-1,np=-Ch-1;function x_(i,e){const r=Math.round(i.x*e),n=Math.round(i.y*e);return i.x=qe(r,np,Ch),i.y=qe(n,np,Ch),(r<i.x||r>i.x+1||n<i.y||n>i.y+1)&&Lt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function ro(i,e,r){const n=i.loadGeometry(),s=i.extent,c=wt/s;if(e&&r&&r.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:d,x:m,y:g,projection:x}=r,v=w=>{const S=Ur((e.x+w.x/s)/h),z=Ui((e.y+w.y/s)/h),L=x.project(S,z);w.x=(L.x*d-m)*s,w.y=(L.y*d-g)*s};for(let w=0;w<n.length;w++)if(i.type!==1)n[w]=y_(n[w],v,1);else{const S=[];for(const z of n[w])z.x<0||z.x>=s||z.y<0||z.y>=s||(v(z),S.push(z));n[w]=S}}for(const h of n)for(const d of h)x_(d,c);return n}function Cs(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ro(i):[]}}function gu(i,e,r,n,s){i.emplaceBack(2*e+(n+1)/2,2*r+(s+1)/2)}function yu(i,e,r,n){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384,n)}class zh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new q,this.indexArray=new Xe,this.segments=new _i,this.programConfigurations=new As(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,s){const c=this.layers[0],h=[];let d=null;c.type==="circle"&&(d=c.layout.get("circle-sort-key"));for(const{feature:g,id:x,index:v,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,z=Cs(g,S);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),z,n))continue;const L=d?d.evaluate(z,{},n):void 0,F={id:x,properties:g.properties,type:g.type,sourceLayerIndex:w,index:v,geometry:S?z.geometry:ro(g,n,s),patterns:{},sortKey:L};h.push(F)}d&&h.sort((g,x)=>g.sortKey-x.sortKey);let m=null;s.projection.name==="globe"&&(this.globeExtVertexArray=new eo,m=s.projection);for(const g of h){const{geometry:x,index:v,sourceLayerIndex:w}=g,S=e[v].feature;this.addFeature(g,x,v,r.availableImages,n,m),r.featureIndex.insert(S,x,v,w,this.index)}}update(e,r,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,__.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,g_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,n,s,c,h){for(const d of r)for(const m of d){const g=m.x,x=m.y;if(g<0||g>=wt||x<0||x>=wt)continue;if(h){const S=h.projectTilePoint(g,x,c),z=h.upVector(c,g,x),L=Ui((x/wt+c.y)/(1<<c.z)),F=h.pixelsPerMeter(L,1)/Ia(1,L),G=this.globeExtVertexArray;yu(G,S,z,F),yu(G,S,z,F),yu(G,S,z,F),yu(G,S,z,F)}const v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),w=v.vertexLength;gu(this.layoutVertexArray,g,x,-1,-1),gu(this.layoutVertexArray,g,x,1,-1),gu(this.layoutVertexArray,g,x,1,1),gu(this.layoutVertexArray,g,x,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+3,w+2),v.vertexLength+=4,v.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},s,c)}}function op(i,e){for(let r=0;r<i.length;r++)if(Ma(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ma(i,e[r]))return!0;return!!kh(i,e)}function v_(i,e,r){return!!Ma(i,e)||!!Ph(e,i,r)}function sp(i,e){if(i.length===1)return lp(e,i[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let s=0;s<n.length;s++)if(Ma(i,n[s]))return!0}for(let r=0;r<i.length;r++)if(lp(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(kh(i,e[r]))return!0;return!1}function b_(i,e,r){if(i.length>1){if(kh(i,e))return!0;for(let n=0;n<e.length;n++)if(Ph(e[n],i,r))return!0}for(let n=0;n<i.length;n++)if(Ph(i[n],e,r))return!0;return!1}function kh(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const n=i[r],s=i[r+1];for(let c=0;c<e.length-1;c++)if(w_(n,s,e[c],e[c+1]))return!0}return!1}function w_(i,e,r,n){return bi(i,r,n)!==bi(e,r,n)&&bi(i,e,r)!==bi(i,e,n)}function Ph(i,e,r){const n=r*r;if(e.length===1)return i.distSqr(e[0])<n;for(let s=1;s<e.length;s++)if(ap(i,e[s-1],e[s])<n)return!0;return!1}function ap(i,e,r){const n=e.distSqr(r);if(n===0)return i.distSqr(e);const s=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/n;return i.distSqr(s<0?e:s>1?r:r.sub(e)._mult(s)._add(e))}function lp(i,e){let r,n,s,c=!1;for(let h=0;h<i.length;h++){r=i[h];for(let d=0,m=r.length-1;d<r.length;m=d++)n=r[d],s=r[m],n.y>e.y!=s.y>e.y&&e.x<(s.x-n.x)*(e.y-n.y)/(s.y-n.y)+n.x&&(c=!c)}return c}function Ma(i,e){let r=!1;for(let n=0,s=i.length-1;n<i.length;s=n++){const c=i[n],h=i[s];c.y>e.y!=h.y>e.y&&e.x<(h.x-c.x)*(e.y-c.y)/(h.y-c.y)+c.x&&(r=!r)}return r}function cp(i,e,r,n,s){for(const h of i)if(e<=h.x&&r<=h.y&&n>=h.x&&s>=h.y)return!0;const c=[new H(e,r),new H(e,s),new H(n,s),new H(n,r)];if(i.length>2){for(const h of c)if(Ma(i,h))return!0}for(let h=0;h<i.length-1;h++)if(T_(i[h],i[h+1],c))return!0;return!1}function T_(i,e,r){const n=r[0],s=r[2];if(i.x<n.x&&e.x<n.x||i.x>s.x&&e.x>s.x||i.y<n.y&&e.y<n.y||i.y>s.y&&e.y>s.y)return!1;const c=bi(i,e,r[0]);return c!==bi(i,e,r[1])||c!==bi(i,e,r[2])||c!==bi(i,e,r[3])}function Aa(i,e,r){const n=e.paint.get(i).value;return n.kind==="constant"?n.value:r.programConfigurations.get(e.id).getMaxValue(i)}function xu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function up(i,e,r,n,s){if(!e[0]&&!e[1])return i;const c=H.convert(e)._mult(s);r==="viewport"&&c._rotate(-n);const h=[];for(let d=0;d<i.length;d++)h.push(i[d].sub(c));return h}function hp(i,e,r,n){const s=H.convert(i)._mult(n);return e==="viewport"&&s._rotate(-r),s}Ze(zh,"CircleBucket",{omit:["layers"]});const E_=new A({"circle-sort-key":new y(fe.layout_circle["circle-sort-key"])});var S_={paint:new A({"circle-radius":new y(fe.paint_circle["circle-radius"]),"circle-color":new y(fe.paint_circle["circle-color"]),"circle-blur":new y(fe.paint_circle["circle-blur"]),"circle-opacity":new y(fe.paint_circle["circle-opacity"]),"circle-translate":new _(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new _(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new y(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new y(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new y(fe.paint_circle["circle-stroke-opacity"])}),layout:E_},Dh=1e-6,mr=typeof Float32Array!="undefined"?Float32Array:Array;function dp(){var i=new mr(9);return mr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function En(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Lh(i,e,r){var n=e[0],s=e[1],c=e[2],h=e[3],d=e[4],m=e[5],g=e[6],x=e[7],v=e[8],w=e[9],S=e[10],z=e[11],L=e[12],F=e[13],G=e[14],Q=e[15],re=r[0],oe=r[1],se=r[2],ae=r[3];return i[0]=re*n+oe*d+se*v+ae*L,i[1]=re*s+oe*m+se*w+ae*F,i[2]=re*c+oe*g+se*S+ae*G,i[3]=re*h+oe*x+se*z+ae*Q,i[4]=(re=r[4])*n+(oe=r[5])*d+(se=r[6])*v+(ae=r[7])*L,i[5]=re*s+oe*m+se*w+ae*F,i[6]=re*c+oe*g+se*S+ae*G,i[7]=re*h+oe*x+se*z+ae*Q,i[8]=(re=r[8])*n+(oe=r[9])*d+(se=r[10])*v+(ae=r[11])*L,i[9]=re*s+oe*m+se*w+ae*F,i[10]=re*c+oe*g+se*S+ae*G,i[11]=re*h+oe*x+se*z+ae*Q,i[12]=(re=r[12])*n+(oe=r[13])*d+(se=r[14])*v+(ae=r[15])*L,i[13]=re*s+oe*m+se*w+ae*F,i[14]=re*c+oe*g+se*S+ae*G,i[15]=re*h+oe*x+se*z+ae*Q,i}function zs(i,e,r){var n,s,c,h,d,m,g,x,v,w,S,z,L=r[0],F=r[1],G=r[2];return e===i?(i[12]=e[0]*L+e[4]*F+e[8]*G+e[12],i[13]=e[1]*L+e[5]*F+e[9]*G+e[13],i[14]=e[2]*L+e[6]*F+e[10]*G+e[14],i[15]=e[3]*L+e[7]*F+e[11]*G+e[15]):(s=e[1],c=e[2],h=e[3],d=e[4],m=e[5],g=e[6],x=e[7],v=e[8],w=e[9],S=e[10],z=e[11],i[0]=n=e[0],i[1]=s,i[2]=c,i[3]=h,i[4]=d,i[5]=m,i[6]=g,i[7]=x,i[8]=v,i[9]=w,i[10]=S,i[11]=z,i[12]=n*L+d*F+v*G+e[12],i[13]=s*L+m*F+w*G+e[13],i[14]=c*L+g*F+S*G+e[14],i[15]=h*L+x*F+z*G+e[15]),i}function Fo(i,e,r){var n=r[0],s=r[1],c=r[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[7]=e[7]*s,i[8]=e[8]*c,i[9]=e[9]*c,i[10]=e[10]*c,i[11]=e[11]*c,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Bh(i,e,r){var n=Math.sin(r),s=Math.cos(r),c=e[4],h=e[5],d=e[6],m=e[7],g=e[8],x=e[9],v=e[10],w=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=c*s+g*n,i[5]=h*s+x*n,i[6]=d*s+v*n,i[7]=m*s+w*n,i[8]=g*s-c*n,i[9]=x*s-h*n,i[10]=v*s-d*n,i[11]=w*s-m*n,i}function Rh(i,e,r){var n=Math.sin(r),s=Math.cos(r),c=e[0],h=e[1],d=e[2],m=e[3],g=e[8],x=e[9],v=e[10],w=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=c*s-g*n,i[1]=h*s-x*n,i[2]=d*s-v*n,i[3]=m*s-w*n,i[8]=c*n+g*s,i[9]=h*n+x*s,i[10]=d*n+v*s,i[11]=m*n+w*s,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var I_=Lh;function Fh(){var i=new mr(3);return mr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function pp(i){var e=new mr(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function fp(i){return Math.hypot(i[0],i[1],i[2])}function Ol(i,e,r){var n=new mr(3);return n[0]=i,n[1]=e,n[2]=r,n}function mp(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function _p(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i}function gp(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i}function Oh(i,e,r){return i[0]=Math.min(e[0],r[0]),i[1]=Math.min(e[1],r[1]),i[2]=Math.min(e[2],r[2]),i}function Uh(i,e,r){return i[0]=Math.max(e[0],r[0]),i[1]=Math.max(e[1],r[1]),i[2]=Math.max(e[2],r[2]),i}function Ul(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function Vh(i,e,r,n){return i[0]=e[0]+r[0]*n,i[1]=e[1]+r[1]*n,i[2]=e[2]+r[2]*n,i}function Vl(i,e){var r=e[0],n=e[1],s=e[2],c=r*r+n*n+s*s;return c>0&&(c=1/Math.sqrt(c)),i[0]=e[0]*c,i[1]=e[1]*c,i[2]=e[2]*c,i}function Nl(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function yp(i,e,r){var n=e[0],s=e[1],c=e[2],h=r[0],d=r[1],m=r[2];return i[0]=s*m-c*d,i[1]=c*h-n*m,i[2]=n*d-s*h,i}function ks(i,e,r){var n=e[0],s=e[1],c=e[2],h=r[3]*n+r[7]*s+r[11]*c+r[15];return i[0]=(r[0]*n+r[4]*s+r[8]*c+r[12])/(h=h||1),i[1]=(r[1]*n+r[5]*s+r[9]*c+r[13])/h,i[2]=(r[2]*n+r[6]*s+r[10]*c+r[14])/h,i}function xp(i,e,r){var n=r[0],s=r[1],c=r[2],h=e[0],d=e[1],m=e[2],g=s*m-c*d,x=c*h-n*m,v=n*d-s*h,w=s*v-c*x,S=c*g-n*v,z=n*x-s*g,L=2*r[3];return x*=L,v*=L,S*=2,z*=2,i[0]=h+(g*=L)+(w*=2),i[1]=d+x+S,i[2]=m+v+z,i}var jl,Ca=_p,M_=gp,A_=fp;function za(i,e,r){var n=e[0],s=e[1],c=e[2],h=e[3];return i[0]=r[0]*n+r[4]*s+r[8]*c+r[12]*h,i[1]=r[1]*n+r[5]*s+r[9]*c+r[13]*h,i[2]=r[2]*n+r[6]*s+r[10]*c+r[14]*h,i[3]=r[3]*n+r[7]*s+r[11]*c+r[15]*h,i}function vp(){var i=new mr(4);return mr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function bp(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function wp(i,e,r){r*=.5;var n=e[0],s=e[1],c=e[2],h=e[3],d=Math.sin(r),m=Math.cos(r);return i[0]=n*m+h*d,i[1]=s*m+c*d,i[2]=c*m-s*d,i[3]=h*m-n*d,i}Fh(),jl=new mr(4),mr!=Float32Array&&(jl[0]=0,jl[1]=0,jl[2]=0,jl[3]=0),Fh(),Ol(1,0,0),Ol(0,1,0),vp(),vp(),dp();class Nh{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,n,s){const c=Math.pow(2,n),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(m=>{const g=za([],m,e),x=1/g[3]/r*c;return function(v,w,S){return v[0]=w[0]*S[0],v[1]=w[1]*S[1],v[2]=w[2]*S[2],v[3]=w[3]*S[3],v}(g,g,[x,x,s?1/g[3]:x,x])}),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(m=>{const g=Vl([],yp([],Ca([],h[m[0]],h[m[1]]),Ca([],h[m[2]],h[m[1]]))),x=-Nl(g,h[m[1]]);return g.concat(x)});return new Nh(h,d)}}class Dr{constructor(e,r){this.min=e,this.max=r,this.center=Ul([],mp([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],n=pp(this.min),s=pp(this.max);for(let c=0;c<r.length;c++)n[c]=r[c]?this.min[c]:this.center[c],s[c]=r[c]?this.center[c]:this.max[c];return s[2]=this.max[2],new Dr(n,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let n=!0;for(let s=0;s<e.planes.length;s++){const c=e.planes[s];let h=0;for(let d=0;d<r.length;d++)h+=Nl(c,r[d])+c[3]>=0;if(h===0)return 0;h!==r.length&&(n=!1)}if(n)return 2;for(let s=0;s<3;s++){let c=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let d=0;d<e.points.length;d++){const m=e.points[d][s]-this.min[s];c=Math.min(c,m),h=Math.max(h,m)}if(h<0||c>this.max[s]-this.min[s])return 0}return 1}}function Tp(i,e,r,n,s,c,h,d,m){if(c&&i.queryGeometry.isAboveHorizon)return!1;c&&(m*=i.pixelToTileUnitsFactor);for(const g of e)for(const x of g){const v=x.add(d),w=s&&r.elevation?r.elevation.exaggeration()*s.getElevationAt(v.x,v.y,!0):0,S=c?v:C_(v,w,n),z=c?i.tilespaceRays.map(F=>k_(F,w)):i.queryGeometry.screenGeometry,L=za([],[x.x,x.y,w,1],n);if(!h&&c?m*=L[3]/r.cameraToCenterDistance:h&&!c&&(m*=r.cameraToCenterDistance/L[3]),v_(z,S,m))return!0}return!1}function C_(i,e,r){const n=za([],[i.x,i.y,e,1],r);return new H(n[0]/n[3],n[1]/n[3])}const Ep=Ol(0,0,0),z_=Ol(0,0,1);function k_(i,e){const r=Fh();return Ep[2]=e,i.intersectsPlane(Ep,z_,r),new H(r[0],r[1])}class Sp extends zh{}function Ip(i,{width:e,height:r},n,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*r*n)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*r*n);return i.width=e,i.height=r,i.data=s,i}function Mp(i,e,r){const{width:n,height:s}=e;n===i.width&&s===i.height||(jh(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,n),height:Math.min(i.height,s)},r),i.width=n,i.height=s,i.data=e.data)}function jh(i,e,r,n,s,c){if(s.width===0||s.height===0)return e;if(s.width>i.width||s.height>i.height||r.x>i.width-s.width||r.y>i.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||n.x>e.width-s.width||n.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");const h=i.data,d=e.data;for(let m=0;m<s.height;m++){const g=((r.y+m)*i.width+r.x)*c,x=((n.y+m)*e.width+n.x)*c;for(let v=0;v<s.width*c;v++)d[x+v]=h[g+v]}return e}Ze(Sp,"HeatmapBucket",{omit:["layers"]});class no{constructor(e,r){Ip(this,e,1,r)}resize(e){Mp(this,new no(e),1)}clone(){return new no({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,s,c){jh(e,r,n,s,c,1)}}class _r{constructor(e,r){Ip(this,e,4,r)}resize(e){Mp(this,new _r(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _r({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,s,c){jh(e,r,n,s,c,4)}}Ze(no,"AlphaImage"),Ze(_r,"RGBAImage");var P_={paint:new A({"heatmap-radius":new y(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new y(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new E(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _(fe.paint_heatmap["heatmap-opacity"])})};function Gh(i){const e={},r=i.resolution||256,n=i.clips?i.clips.length:1,s=i.image||new _r({width:r,height:n}),c=(h,d,m)=>{e[i.evaluationKey]=m;const g=i.expression.evaluate(e);s.data[h+d+0]=Math.floor(255*g.r/g.a),s.data[h+d+1]=Math.floor(255*g.g/g.a),s.data[h+d+2]=Math.floor(255*g.b/g.a),s.data[h+d+3]=Math.floor(255*g.a)};if(i.clips)for(let h=0,d=0;h<n;++h,d+=4*r)for(let m=0,g=0;m<r;m++,g+=4){const x=m/(r-1),{start:v,end:w}=i.clips[h];c(d,g,v*(1-x)+w*x)}else for(let h=0,d=0;h<r;h++,d+=4)c(0,d,h/(r-1));return s}var D_={paint:new A({"hillshade-illumination-direction":new _(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _(fe.paint_hillshade["hillshade-accent-color"])})};const L_=X([{name:"a_pos",components:2,type:"Int16"}],4),{members:B_}=L_;var vu=bu,R_=bu;function bu(i,e,r){r=r||2;var n,s,c,h,d,m,g,x=e&&e.length,v=x?e[0]*r:i.length,w=Ap(i,0,v,r,!0),S=[];if(!w||w.next===w.prev)return S;if(x&&(w=function(L,F,G,Q){var re,oe,se,ae=[];for(re=0,oe=F.length;re<oe;re++)(se=Ap(L,F[re]*Q,re<oe-1?F[re+1]*Q:L.length,Q,!1))===se.next&&(se.steiner=!0),ae.push($_(se));for(ae.sort(N_),re=0;re<ae.length;re++)G=Oo(G=j_(ae[re],G),G.next);return G}(i,e,w,r)),i.length>80*r){n=c=i[0],s=h=i[1];for(var z=r;z<v;z+=r)(d=i[z])<n&&(n=d),(m=i[z+1])<s&&(s=m),d>c&&(c=d),m>h&&(h=m);g=(g=Math.max(c-n,h-s))!==0?1/g:0}return Gl(w,S,r,n,s,g),S}function Ap(i,e,r,n,s){var c,h;if(s===qh(i,e,r,n)>0)for(c=e;c<r;c+=n)h=kp(c,i[c],i[c+1],h);else for(c=r-n;c>=e;c-=n)h=kp(c,i[c],i[c+1],h);return h&&wu(h,h.next)&&(Zl(h),h=h.next),h}function Oo(i,e){if(!i)return i;e||(e=i);var r,n=i;do if(r=!1,n.steiner||!wu(n,n.next)&&Ei(n.prev,n,n.next)!==0)n=n.next;else{if(Zl(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function Gl(i,e,r,n,s,c,h){if(i){!h&&c&&function(x,v,w,S){var z=x;do z.z===null&&(z.z=$h(z.x,z.y,v,w,S)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==x);z.prevZ.nextZ=null,z.prevZ=null,function(L){var F,G,Q,re,oe,se,ae,ve,we=1;do{for(G=L,L=null,oe=null,se=0;G;){for(se++,Q=G,ae=0,F=0;F<we&&(ae++,Q=Q.nextZ);F++);for(ve=we;ae>0||ve>0&&Q;)ae!==0&&(ve===0||!Q||G.z<=Q.z)?(re=G,G=G.nextZ,ae--):(re=Q,Q=Q.nextZ,ve--),oe?oe.nextZ=re:L=re,re.prevZ=oe,oe=re;G=Q}oe.nextZ=null,we*=2}while(se>1)}(z)}(i,n,s,c);for(var d,m,g=i;i.prev!==i.next;)if(d=i.prev,m=i.next,c?O_(i,n,s,c):F_(i))e.push(d.i/r),e.push(i.i/r),e.push(m.i/r),Zl(i),i=m.next,g=m.next;else if((i=m)===g){h?h===1?Gl(i=U_(Oo(i),e,r),e,r,n,s,c,2):h===2&&V_(i,e,r,n,s,c):Gl(Oo(i),e,r,n,s,c,1);break}}}function F_(i){var e=i.prev,r=i,n=i.next;if(Ei(e,r,n)>=0)return!1;for(var s=i.next.next;s!==i.prev;){if(ka(e.x,e.y,r.x,r.y,n.x,n.y,s.x,s.y)&&Ei(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function O_(i,e,r,n){var s=i.prev,c=i,h=i.next;if(Ei(s,c,h)>=0)return!1;for(var d=s.x>c.x?s.x>h.x?s.x:h.x:c.x>h.x?c.x:h.x,m=s.y>c.y?s.y>h.y?s.y:h.y:c.y>h.y?c.y:h.y,g=$h(s.x<c.x?s.x<h.x?s.x:h.x:c.x<h.x?c.x:h.x,s.y<c.y?s.y<h.y?s.y:h.y:c.y<h.y?c.y:h.y,e,r,n),x=$h(d,m,e,r,n),v=i.prevZ,w=i.nextZ;v&&v.z>=g&&w&&w.z<=x;){if(v!==i.prev&&v!==i.next&&ka(s.x,s.y,c.x,c.y,h.x,h.y,v.x,v.y)&&Ei(v.prev,v,v.next)>=0||(v=v.prevZ,w!==i.prev&&w!==i.next&&ka(s.x,s.y,c.x,c.y,h.x,h.y,w.x,w.y)&&Ei(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;v&&v.z>=g;){if(v!==i.prev&&v!==i.next&&ka(s.x,s.y,c.x,c.y,h.x,h.y,v.x,v.y)&&Ei(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;w&&w.z<=x;){if(w!==i.prev&&w!==i.next&&ka(s.x,s.y,c.x,c.y,h.x,h.y,w.x,w.y)&&Ei(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function U_(i,e,r){var n=i;do{var s=n.prev,c=n.next.next;!wu(s,c)&&Cp(s,n,n.next,c)&&$l(s,c)&&$l(c,s)&&(e.push(s.i/r),e.push(n.i/r),e.push(c.i/r),Zl(n),Zl(n.next),n=i=c),n=n.next}while(n!==i);return Oo(n)}function V_(i,e,r,n,s,c){var h=i;do{for(var d=h.next.next;d!==h.prev;){if(h.i!==d.i&&Z_(h,d)){var m=zp(h,d);return h=Oo(h,h.next),m=Oo(m,m.next),Gl(h,e,r,n,s,c),void Gl(m,e,r,n,s,c)}d=d.next}h=h.next}while(h!==i)}function N_(i,e){return i.x-e.x}function j_(i,e){var r=function(c,h){var d,m=h,g=c.x,x=c.y,v=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){var w=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(w<=g&&w>v){if(v=w,w===g){if(x===m.y)return m;if(x===m.next.y)return m.next}d=m.x<m.next.x?m:m.next}}m=m.next}while(m!==h);if(!d)return null;if(g===v)return d;var S,z=d,L=d.x,F=d.y,G=1/0;m=d;do g>=m.x&&m.x>=L&&g!==m.x&&ka(x<F?g:v,x,L,F,x<F?v:g,x,m.x,m.y)&&(S=Math.abs(x-m.y)/(g-m.x),$l(m,c)&&(S<G||S===G&&(m.x>d.x||m.x===d.x&&G_(d,m)))&&(d=m,G=S)),m=m.next;while(m!==z);return d}(i,e);if(!r)return e;var n=zp(r,i),s=Oo(r,r.next);return Oo(n,n.next),e===r?s:e}function G_(i,e){return Ei(i.prev,i,e.prev)<0&&Ei(e.next,i,i.next)<0}function $h(i,e,r,n,s){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-r)*s)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $_(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function ka(i,e,r,n,s,c,h,d){return(s-h)*(e-d)-(i-h)*(c-d)>=0&&(i-h)*(n-d)-(r-h)*(e-d)>=0&&(r-h)*(c-d)-(s-h)*(n-d)>=0}function Z_(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,n){var s=r;do{if(s.i!==r.i&&s.next.i!==r.i&&s.i!==n.i&&s.next.i!==n.i&&Cp(s,s.next,r,n))return!0;s=s.next}while(s!==r);return!1}(i,e)&&($l(i,e)&&$l(e,i)&&function(r,n){var s=r,c=!1,h=(r.x+n.x)/2,d=(r.y+n.y)/2;do s.y>d!=s.next.y>d&&s.next.y!==s.y&&h<(s.next.x-s.x)*(d-s.y)/(s.next.y-s.y)+s.x&&(c=!c),s=s.next;while(s!==r);return c}(i,e)&&(Ei(i.prev,i,e.prev)||Ei(i,e.prev,e))||wu(i,e)&&Ei(i.prev,i,i.next)>0&&Ei(e.prev,e,e.next)>0)}function Ei(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function wu(i,e){return i.x===e.x&&i.y===e.y}function Cp(i,e,r,n){var s=Eu(Ei(i,e,r)),c=Eu(Ei(i,e,n)),h=Eu(Ei(r,n,i)),d=Eu(Ei(r,n,e));return s!==c&&h!==d||!(s!==0||!Tu(i,r,e))||!(c!==0||!Tu(i,n,e))||!(h!==0||!Tu(r,i,n))||!(d!==0||!Tu(r,e,n))}function Tu(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Eu(i){return i>0?1:i<0?-1:0}function $l(i,e){return Ei(i.prev,i,i.next)<0?Ei(i,e,i.next)>=0&&Ei(i,i.prev,e)>=0:Ei(i,e,i.prev)<0||Ei(i,i.next,e)<0}function zp(i,e){var r=new Zh(i.i,i.x,i.y),n=new Zh(e.i,e.x,e.y),s=i.next,c=e.prev;return i.next=e,e.prev=i,r.next=s,s.prev=r,n.next=r,r.prev=n,c.next=n,n.prev=c,n}function kp(i,e,r,n){var s=new Zh(i,e,r);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Zl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Zh(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qh(i,e,r,n){for(var s=0,c=e,h=r-n;c<r;c+=n)s+=(i[h]-i[c])*(i[c+1]+i[h+1]),h=c;return s}function q_(i,e,r,n,s){Pp(i,e,r||0,n||i.length-1,s||W_)}function Pp(i,e,r,n,s){for(;n>r;){if(n-r>600){var c=n-r+1,h=e-r+1,d=Math.log(c),m=.5*Math.exp(2*d/3),g=.5*Math.sqrt(d*m*(c-m)/c)*(h-c/2<0?-1:1);Pp(i,e,Math.max(r,Math.floor(e-h*m/c+g)),Math.min(n,Math.floor(e+(c-h)*m/c+g)),s)}var x=i[e],v=r,w=n;for(ql(i,r,e),s(i[n],x)>0&&ql(i,r,n);v<w;){for(ql(i,v,w),v++,w--;s(i[v],x)<0;)v++;for(;s(i[w],x)>0;)w--}s(i[r],x)===0?ql(i,r,w):ql(i,++w,n),w<=e&&(r=w+1),e<=w&&(n=w-1)}}function ql(i,e,r){var n=i[e];i[e]=i[r],i[r]=n}function W_(i,e){return i<e?-1:i>e?1:0}function Wh(i,e){const r=i.length;if(r<=1)return[i];const n=[];let s,c;for(let h=0;h<r;h++){const d=Ni(i[h]);d!==0&&(i[h].area=Math.abs(d),c===void 0&&(c=d<0),c===d<0?(s&&n.push(s),s=[i[h]]):s.push(i[h]))}if(s&&n.push(s),e>1)for(let h=0;h<n.length;h++)n[h].length<=e||(q_(n[h],e,1,n[h].length-1,X_),n[h]=n[h].slice(0,e));return n}function X_(i,e){return e.area-i.area}function Xh(i,e,r){const n=r.patternDependencies;let s=!1;for(const c of e){const h=c.paint.get(`${i}-pattern`);h.isConstant()||(s=!0);const d=h.constantOr(null);d&&(s=!0,n[d.to]=!0,n[d.from]=!0)}return s}function Hh(i,e,r,n,s){const c=s.patternDependencies;for(const h of e){const d=h.paint.get(`${i}-pattern`).value;if(d.kind!=="constant"){let m=d.evaluate({zoom:n-1},r,{},s.availableImages),g=d.evaluate({zoom:n},r,{},s.availableImages),x=d.evaluate({zoom:n+1},r,{},s.availableImages);m=m&&m.name?m.name:m,g=g&&g.name?g.name:g,x=x&&x.name?x.name:x,c[m]=!0,c[g]=!0,c[x]=!0,r.patterns[h.id]={min:m,mid:g,max:x}}}return r}bu.deviation=function(i,e,r,n){var s=e&&e.length,c=Math.abs(qh(i,0,s?e[0]*r:i.length,r));if(s)for(var h=0,d=e.length;h<d;h++)c-=Math.abs(qh(i,e[h]*r,h<d-1?e[h+1]*r:i.length,r));var m=0;for(h=0;h<n.length;h+=3){var g=n[h]*r,x=n[h+1]*r,v=n[h+2]*r;m+=Math.abs((i[g]-i[v])*(i[x+1]-i[g+1])-(i[g]-i[x])*(i[v+1]-i[g+1]))}return c===0&&m===0?0:Math.abs((m-c)/c)},bu.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,s=0;s<i.length;s++){for(var c=0;c<i[s].length;c++)for(var h=0;h<e;h++)r.vertices.push(i[s][c][h]);s>0&&r.holes.push(n+=i[s-1].length)}return r},vu.default=R_;class Su{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new q,this.indexArray=new Xe,this.indexArray2=new dt,this.programConfigurations=new As(e.layers,e.zoom),this.segments=new _i,this.segments2=new _i,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,n,s){this.hasPattern=Xh("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:d,id:m,index:g,sourceLayerIndex:x}of e){const v=this.layers[0]._featureFilter.needGeometry,w=Cs(d,v);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),w,n))continue;const S=c?c.evaluate(w,{},n,r.availableImages):void 0,z={id:m,properties:d.properties,type:d.type,sourceLayerIndex:x,index:g,geometry:v?w.geometry:ro(d,n,s),patterns:{},sortKey:S};h.push(z)}c&&h.sort((d,m)=>d.sortKey-m.sortKey);for(const d of h){const{geometry:m,index:g,sourceLayerIndex:x}=d;if(this.hasPattern){const v=Hh("fill",this.layers,d,this.zoom,r);this.patternFeatures.push(v)}else this.addFeature(d,m,g,n,{},r.availableImages);r.featureIndex.insert(e[g].feature,m,g,x,this.index)}}update(e,r,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,s)}addFeatures(e,r,n,s,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,B_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,n,s,c,h=[]){for(const d of Wh(r,500)){let m=0;for(const z of d)m+=z.length;const g=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),x=g.vertexLength,v=[],w=[];for(const z of d){if(z.length===0)continue;z!==d[0]&&w.push(v.length/2);const L=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),F=L.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(F+z.length-1,F),v.push(z[0].x),v.push(z[0].y);for(let G=1;G<z.length;G++)this.layoutVertexArray.emplaceBack(z[G].x,z[G].y),this.indexArray2.emplaceBack(F+G-1,F+G),v.push(z[G].x),v.push(z[G].y);L.vertexLength+=z.length,L.primitiveLength+=z.length}const S=vu(v,w);for(let z=0;z<S.length;z+=3)this.indexArray.emplaceBack(x+S[z],x+S[z+1],x+S[z+2]);g.vertexLength+=m,g.primitiveLength+=S.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,h,s)}}Ze(Su,"FillBucket",{omit:["layers","patternFeatures"]});const H_=new A({"fill-sort-key":new y(fe.layout_fill["fill-sort-key"])});var Y_={paint:new A({"fill-antialias":new _(fe.paint_fill["fill-antialias"]),"fill-opacity":new y(fe.paint_fill["fill-opacity"]),"fill-color":new y(fe.paint_fill["fill-color"]),"fill-outline-color":new y(fe.paint_fill["fill-outline-color"]),"fill-translate":new _(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new _(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new b(fe.paint_fill["fill-pattern"])}),layout:H_};const K_=X([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),J_=X([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Q_=X([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:eg}=K_;var Dp=Pa;function Pa(i,e,r,n,s){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=s,i.readFields(tg,this,e)}function tg(i,e,r){i==1?e.id=r.readVarint():i==2?function(n,s){for(var c=n.readVarint()+n.pos;n.pos<c;){var h=s._keys[n.readVarint()],d=s._values[n.readVarint()];s.properties[h]=d}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function ig(i){for(var e,r,n=0,s=0,c=i.length,h=c-1;s<c;h=s++)n+=((r=i[h]).x-(e=i[s]).x)*(e.y+r.y);return n}Pa.types=["Unknown","Point","LineString","Polygon"],Pa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,n=1,s=0,c=0,h=0,d=[];i.pos<r;){if(s<=0){var m=i.readVarint();n=7&m,s=m>>3}if(s--,n===1||n===2)c+=i.readSVarint(),h+=i.readSVarint(),n===1&&(e&&d.push(e),e=[]),e.push(new H(c,h));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&d.push(e),d},Pa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,n=0,s=0,c=0,h=1/0,d=-1/0,m=1/0,g=-1/0;i.pos<e;){if(n<=0){var x=i.readVarint();r=7&x,n=x>>3}if(n--,r===1||r===2)(s+=i.readSVarint())<h&&(h=s),s>d&&(d=s),(c+=i.readSVarint())<m&&(m=c),c>g&&(g=c);else if(r!==7)throw new Error("unknown command "+r)}return[h,m,d,g]},Pa.prototype.toGeoJSON=function(i,e,r){var n,s,c=this.extent*Math.pow(2,r),h=this.extent*i,d=this.extent*e,m=this.loadGeometry(),g=Pa.types[this.type];function x(S){for(var z=0;z<S.length;z++){var L=S[z];S[z]=[360*(L.x+h)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+d)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var v=[];for(n=0;n<m.length;n++)v[n]=m[n][0];x(m=v);break;case 2:for(n=0;n<m.length;n++)x(m[n]);break;case 3:for(m=function(S){var z=S.length;if(z<=1)return[S];for(var L,F,G=[],Q=0;Q<z;Q++){var re=ig(S[Q]);re!==0&&(F===void 0&&(F=re<0),F===re<0?(L&&G.push(L),L=[S[Q]]):L.push(S[Q]))}return L&&G.push(L),G}(m),n=0;n<m.length;n++)for(s=0;s<m[n].length;s++)x(m[n][s])}m.length===1?m=m[0]:g="Multi"+g;var w={type:"Feature",geometry:{type:g,coordinates:m},properties:this.properties};return"id"in this&&(w.id=this.id),w};var Lp=Bp;function Bp(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(rg,this,e),this.length=this._features.length}function rg(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(n){for(var s=null,c=n.readVarint()+n.pos;n.pos<c;){var h=n.readVarint()>>3;s=h===1?n.readString():h===2?n.readFloat():h===3?n.readDouble():h===4?n.readVarint64():h===5?n.readVarint():h===6?n.readSVarint():h===7?n.readBoolean():null}return s}(r))}function ng(i,e,r){if(i===3){var n=new Lp(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}Bp.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Dp(this._pbf,e,this.extent,this._keys,this._values)};var Ps={VectorTile:function(i,e){this.layers=i.readFields(ng,{},e)},VectorTileFeature:Dp,VectorTileLayer:Lp};function Iu(i,e,r,n){const s=[],c=n===0?(h,d,m,g,x,v)=>{h.push(new H(v,m+(v-d)/(g-d)*(x-m)))}:(h,d,m,g,x,v)=>{h.push(new H(d+(v-m)/(x-m)*(g-d),v))};for(const h of i){const d=[];for(const m of h){if(m.length<=2)continue;const g=[];for(let w=0;w<m.length-1;w++){const S=m[w].x,z=m[w].y,L=m[w+1].x,F=m[w+1].y,G=n===0?S:z,Q=n===0?L:F;G<e?Q>e&&c(g,S,z,L,F,e):G>r?Q<r&&c(g,S,z,L,F,r):g.push(m[w]),Q<e&&G>=e&&c(g,S,z,L,F,e),Q>r&&G<=r&&c(g,S,z,L,F,r)}let x=m[m.length-1];const v=n===0?x.x:x.y;v>=e&&v<=r&&g.push(x),g.length&&(x=g[g.length-1],g[0].x===x.x&&g[0].y===x.y||g.push(g[0]),d.push(g))}d.length&&s.push(d)}return s}const og=Ps.VectorTileFeature.types,sg=Math.pow(2,13);function Wl(i,e,r,n,s,c,h,d){i.emplaceBack((e<<1)+h,(r<<1)+c,(Math.floor(n*sg)<<1)+s,Math.round(d))}function Xl(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Rp{constructor(){this.acc=new H(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new H(e.x,e.y),this.max=new H(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const n=this.min,s=this.max;e.x<n.x?n.x=e.x:e.x>s.x&&(s.x=e.x),e.y<n.y?n.y=e.y:e.y>s.y&&(s.y=e.y),((e.x===0||e.x===wt)&&e.x===r.x)!=((e.y===0||e.y===wt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,at(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>wt!=e.x>wt&&this.addBorderIntersection(1,at(r.y,e.y,(wt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,at(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>wt!=e.y>wt&&this.addBorderIntersection(3,at(r.x,e.x,(wt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,r.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,r.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((r,n)=>r+n.edges,0);return e!==0?this.acc.div(e)._round():new H(0,0)}span(){return new H(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Hl{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new K,this.centroidVertexArray=new Ms,this.indexArray=new Xe,this.programConfigurations=new As(e.layers,e.zoom),this.segments=new _i,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,n,s){this.features=[],this.hasPattern=Xh("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(c){const h=Math.exp(Math.PI*(1-c.y/(1<<c.z)*2));return 80150034*h/(h*h+1)/wt/(1<<c.z)}(n);for(const{feature:c,id:h,index:d,sourceLayerIndex:m}of e){const g=this.layers[0]._featureFilter.needGeometry,x=Cs(c,g);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),x,n))continue;const v={id:h,sourceLayerIndex:m,index:d,geometry:g?x.geometry:ro(c,n,s),properties:c.properties,type:c.type,patterns:{}},w=this.layoutVertexArray.length;this.hasPattern?this.features.push(Hh("fill-extrusion",this.layers,v,this.zoom,r)):this.addFeature(v,v.geometry,d,n,{},r.availableImages,s),r.featureIndex.insert(c,v.geometry,d,m,this.index,w)}this.sortBorders()}addFeatures(e,r,n,s,c){for(const h of this.features){const{geometry:d}=h;this.addFeature(h,d,h.index,r,n,s,c)}this.sortBorders()}update(e,r,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,eg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Q_.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,J_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,s,c,h,d){const m=[new H(0,0),new H(wt,wt)],g=d.projection,x=g.name==="globe",v=this.enableTerrain&&!x?new Rp:null;x&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new rr);const w=Wh(r,500);for(let L=w.length-1;L>=0;L--){const F=w[L];(F.length===0||(S=F[0]).every(G=>G.x<=0)||S.every(G=>G.x>=wt)||S.every(G=>G.y<=0)||S.every(G=>G.y>=wt))&&w.splice(L,1)}var S;let z;if(x){const F=1<<s.z,G=Ur(s.x/F),Q=Ur((s.x+1)/F),re=Ui(s.y/F),oe=Ui((s.y+1)/F);z=function(se,ae,ve,we,Me=0,Ce){const ye=[];if(!se.length||!ve||!we)return ye;const Se=(xt,Et)=>{for(const Qe of xt)ye.push({polygon:Qe,bounds:Et})},Pe=Math.ceil(Math.log2(ve)),Ve=Math.ceil(Math.log2(we)),Le=Pe-Ve,Oe=[];for(let xt=0;xt<Math.abs(Le);xt++)Oe.push(Le>0?0:1);for(let xt=0;xt<Math.min(Pe,Ve);xt++)Oe.push(0),Oe.push(1);let yt=se;if(yt=Iu(yt,ae[0].y-Me,ae[1].y+Me,1),yt=Iu(yt,ae[0].x-Me,ae[1].x+Me,0),!yt.length)return ye;const At=[];for(Oe.length?At.push({polygons:yt,bounds:ae,depth:0}):Se(yt,ae);At.length;){const xt=At.pop(),Et=xt.depth,Qe=Oe[Et],$e=xt.bounds[0],zt=xt.bounds[1],Zt=Qe===0?$e.x:$e.y,Ai=Qe===0?zt.x:zt.y,ii=Ce?Ce(Qe,Zt,Ai):.5*(Zt+Ai),Ci=Iu(xt.polygons,Zt-Me,ii+Me,Qe),qt=Iu(xt.polygons,ii-Me,Ai+Me,Qe);if(Ci.length){const Dt=[$e,new H(Qe===0?ii:zt.x,Qe===1?ii:zt.y)];Oe.length>Et+1?At.push({polygons:Ci,bounds:Dt,depth:Et+1}):Se(Ci,Dt)}if(qt.length){const Dt=[new H(Qe===0?ii:$e.x,Qe===1?ii:$e.y),zt];Oe.length>Et+1?At.push({polygons:qt,bounds:Dt,depth:Et+1}):Se(qt,Dt)}}return ye}(w,m,Math.ceil((Q-G)/11.25),Math.ceil((re-oe)/11.25),1,(se,ae,ve)=>{if(se===0)return .5*(ae+ve);{const we=Ui((s.y+ae/wt)/F);return(Sa(.5*(Ui((s.y+ve/wt)/F)+we))*F-s.y)*wt}})}else{z=[];for(const L of w)z.push({polygon:L,bounds:m})}for(const L of z){const F=L.polygon;let G=0,Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let ve=0;ve<F.length;ve++){const we=F[ve];if(we.length===0)continue;G+=we.length;let Me=0;v&&v.startRing(we[0]);for(let Ce=0;Ce<we.length;Ce++){const ye=we[Ce];if(Ce>=1){const Se=we[Ce-1];if(!ag(ye,Se,L.bounds)){v&&v.append(ye,Se),Q.vertexLength+4>_i.MAX_VERTEX_ARRAY_LENGTH&&(Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Pe=ye.sub(Se)._perp(),Ve=Pe.x/(Math.abs(Pe.x)+Math.abs(Pe.y)),Le=Pe.y>0?1:0,Oe=Se.dist(ye);Me+Oe>32768&&(Me=0),Wl(this.layoutVertexArray,ye.x,ye.y,Ve,Le,0,0,Me),Wl(this.layoutVertexArray,ye.x,ye.y,Ve,Le,0,1,Me),Me+=Oe,Wl(this.layoutVertexArray,Se.x,Se.y,Ve,Le,0,0,Me),Wl(this.layoutVertexArray,Se.x,Se.y,Ve,Le,0,1,Me);const yt=Q.vertexLength;if(this.indexArray.emplaceBack(yt,yt+2,yt+1),this.indexArray.emplaceBack(yt+1,yt+2,yt+3),Q.vertexLength+=4,Q.primitiveLength+=2,x){const At=this.layoutVertexExtArray,xt=g.projectTilePoint(ye.x,ye.y,s),Et=g.projectTilePoint(Se.x,Se.y,s),Qe=g.upVector(s,ye.x,ye.y),$e=g.upVector(s,Se.x,Se.y);Xl(At,xt,Qe),Xl(At,xt,Qe),Xl(At,Et,$e),Xl(At,Et,$e)}}}}}if(Q.vertexLength+G>_i.MAX_VERTEX_ARRAY_LENGTH&&(Q=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray)),og[e.type]!=="Polygon")continue;const re=[],oe=[],se=Q.vertexLength;for(let ve=0;ve<F.length;ve++){const we=F[ve];if(we.length!==0){we!==F[0]&&oe.push(re.length/2);for(let Me=0;Me<we.length;Me++){const Ce=we[Me];Wl(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),re.push(Ce.x),re.push(Ce.y),v&&v.currentPolyCount.top++,x&&Xl(this.layoutVertexExtArray,g.projectTilePoint(Ce.x,Ce.y,s),g.upVector(s,Ce.x,Ce.y))}}}const ae=vu(re,oe);for(let ve=0;ve<ae.length;ve+=3)this.indexArray.emplaceBack(se+ae[ve],se+ae[ve+2],se+ae[ve+1]);Q.primitiveLength+=ae.length/3,Q.vertexLength+=G}if(v&&v.polyCount.length>0){if(v.borders){v.vertexArrayOffset=this.centroidVertexArray.length;const L=v.borders,F=this.featuresOnBorder.push(v)-1;for(let G=0;G<4;G++)L[G][0]!==Number.MAX_VALUE&&this.borders[G].push(F)}this.encodeCentroid(v.borders?void 0:v.centroid(),v)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,h,s)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,n)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,r,n=!0){let s,c;if(e)if(e.y!==0){const d=r.span()._mult(this.tileToMeter);s=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(d.x/10)),c=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(d.y/10))}else s=Math.ceil(7*(e.x+450)),c=0;else s=0,c=+n;let h=n?this.centroidVertexArray.length:r.vertexArrayOffset;for(const d of r.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*d.edges+d.top);for(let m=0;m<2*d.edges;m++)this.centroidVertexArray.emplace(h++,0,c),this.centroidVertexArray.emplace(h++,s,c);for(let m=0;m<d.top;m++)this.centroidVertexArray.emplace(h++,s,c)}}}function ag(i,e,r){return i.x===e.x&&(i.x<r[0].x||i.x>r[1].x)||i.y===e.y&&(i.y<r[0].y||i.y>r[1].y)}Ze(Hl,"FillExtrusionBucket",{omit:["layers","features"]}),Ze(Rp,"PartMetadata");var lg={paint:new A({"fill-extrusion-opacity":new _(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new y(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new b(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new y(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new y(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Yl(i,e){return i.x*e.x+i.y*e.y}function Fp(i,e){if(i.length===1){let r=0;const n=e[r++];let s;for(;!s||n.equals(s);)if(s=e[r++],!s)return 1/0;for(;r<e.length;r++){const c=e[r],h=i[0],d=s.sub(n),m=c.sub(n),g=h.sub(n),x=Yl(d,d),v=Yl(d,m),w=Yl(m,m),S=Yl(g,d),z=Yl(g,m),L=x*w-v*v,F=(w*S-v*z)/L,G=(x*z-v*S)/L,Q=n.z*(1-F-G)+s.z*F+c.z*G;if(isFinite(Q))return Q}return 1/0}{let r=1/0;for(const n of e)r=Math.min(r,n.z);return r}}function Op(i){const e=new H(i[0],i[1]);return e.z=i[2],e}function cg(i,e,r,n,s,c,h,d){const m=h*s.getElevationAt(i,e,!0,!0),g=c[0]!==0,x=g?c[1]===0?h*(c[0]/7-450):h*function(v,w,S){const z=Math.floor(w[0]/8),L=Math.floor(w[1]/8),F=10*(w[0]-8*z),G=10*(w[1]-8*L),Q=v.getElevationAt(z,L,!0,!0),re=v.getMeterToDEM(S),oe=Math.floor(.5*(F*re-1)),se=Math.floor(.5*(G*re-1)),ae=v.tileCoordToPixel(z,L),ve=2*oe+1,we=2*se+1,Me=function(Le,Oe,yt,At,xt){return[Le.getElevationAtPixel(Oe,yt,!0),Le.getElevationAtPixel(Oe+xt,yt,!0),Le.getElevationAtPixel(Oe,yt+xt,!0),Le.getElevationAtPixel(Oe+At,yt+xt,!0)]}(v,ae.x-oe,ae.y-se,ve,we),Ce=Math.abs(Me[0]-Me[1]),ye=Math.abs(Me[2]-Me[3]),Se=Math.abs(Me[0]-Me[2])+Math.abs(Me[1]-Me[3]),Pe=Math.min(.25,.5*re*(Ce+ye)/ve),Ve=Math.min(.25,.5*re*Se/we);return Q+Math.max(Pe*F,Ve*G)}(s,c,d):m;return{base:m+(r===0)?-1:r,top:g?Math.max(x+n,m+r+2):m+n}}const ug=X([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:hg}=ug,dg=X([{name:"a_packed",components:3,type:"Float32"}]),{members:pg}=dg,fg=Ps.VectorTileFeature.types,mg=Math.cos(Math.PI/180*37.5);class Mu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Z,this.layoutVertexArray2=new Re,this.indexArray=new Xe,this.programConfigurations=new As(e.layers,e.zoom),this.segments=new _i,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,s){this.hasPattern=Xh("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),h=[];for(const{feature:x,id:v,index:w,sourceLayerIndex:S}of e){const z=this.layers[0]._featureFilter.needGeometry,L=Cs(x,z);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),L,n))continue;const F=c?c.evaluate(L,{},n):void 0,G={id:v,properties:x.properties,type:x.type,sourceLayerIndex:S,index:w,geometry:z?L.geometry:ro(x,n,s),patterns:{},sortKey:F};h.push(G)}c&&h.sort((x,v)=>x.sortKey-v.sortKey);const{lineAtlas:d,featureIndex:m}=r,g=this.addConstantDashes(d);for(const x of h){const{geometry:v,index:w,sourceLayerIndex:S}=x;if(g&&this.addFeatureDashes(x,d),this.hasPattern){const z=Hh("line",this.layers,x,this.zoom,r);this.patternFeatures.push(z)}else this.addFeature(x,v,w,n,d.positions,r.availableImages);m.insert(e[w].feature,v,w,S,this.index)}}addConstantDashes(e){let r=!1;for(const n of this.layers){const s=n.paint.get("line-dasharray").value,c=n.layout.get("line-cap").value;if(s.kind!=="constant"||c.kind!=="constant")r=!0;else{const h=c.value,d=s.value;if(!d)continue;e.addDash(d.from,h),e.addDash(d.to,h),d.other&&e.addDash(d.other,h)}}return r}addFeatureDashes(e,r){const n=this.zoom;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,h=s.layout.get("line-cap").value;if(c.kind==="constant"&&h.kind==="constant")continue;let d,m,g,x,v,w;if(c.kind==="constant"){const F=c.value;if(!F)continue;d=F.other||F.to,m=F.to,g=F.from}else d=c.evaluate({zoom:n-1},e),m=c.evaluate({zoom:n},e),g=c.evaluate({zoom:n+1},e);h.kind==="constant"?x=v=w=h.value:(x=h.evaluate({zoom:n-1},e),v=h.evaluate({zoom:n},e),w=h.evaluate({zoom:n+1},e)),r.addDash(d,x),r.addDash(m,v),r.addDash(g,w);const S=r.getKey(d,x),z=r.getKey(m,v),L=r.getKey(g,w);e.patterns[s.id]={min:S,mid:z,max:L}}}update(e,r,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,s)}addFeatures(e,r,n,s,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,pg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,n,s,c,h){const d=this.layers[0].layout,m=d.get("line-join").evaluate(e,{}),g=d.get("line-cap").evaluate(e,{}),x=d.get("line-miter-limit"),v=d.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const w of r)this.addLine(w,e,m,g,x,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,h,s)}addLine(e,r,n,s,c,h){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<e.length-1;G++)this.totalDistance+=e[G].dist(e[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const d=fg[r.type]==="Polygon";let m=e.length;for(;m>=2&&e[m-1].equals(e[m-2]);)m--;let g=0;for(;g<m-1&&e[g].equals(e[g+1]);)g++;if(m<(d?3:2))return;n==="bevel"&&(c=1.05);const x=this.overscaling<=16?122880/(512*this.overscaling):0,v=this.segments.prepareSegment(10*m,this.layoutVertexArray,this.indexArray);let w,S,z,L,F;this.e1=this.e2=-1,d&&(w=e[m-2],F=e[g].sub(w)._unit()._perp());for(let G=g;G<m;G++){if(z=G===m-1?d?e[g+1]:void 0:e[G+1],z&&e[G].equals(z))continue;F&&(L=F),w&&(S=w),w=e[G],F=z?z.sub(w)._unit()._perp():L,L=L||F;let Q=L.add(F);Q.x===0&&Q.y===0||Q._unit();const re=L.x*F.x+L.y*F.y,oe=Q.x*F.x+Q.y*F.y,se=oe!==0?1/oe:1/0,ae=2*Math.sqrt(2-2*oe),ve=oe<mg&&S&&z,we=L.x*F.y-L.y*F.x>0;if(ve&&G>g){const ye=w.dist(S);if(ye>2*x){const Se=w.sub(w.sub(S)._mult(x/ye)._round());this.updateDistance(S,Se),this.addCurrentVertex(Se,L,0,0,v),S=Se}}const Me=S&&z;let Ce=Me?n:d?"butt":s;if(Me&&Ce==="round"&&(se<h?Ce="miter":se<=2&&(Ce="fakeround")),Ce==="miter"&&se>c&&(Ce="bevel"),Ce==="bevel"&&(se>2&&(Ce="flipbevel"),se<c&&(Ce="miter")),S&&this.updateDistance(S,w),Ce==="miter")Q._mult(se),this.addCurrentVertex(w,Q,0,0,v);else if(Ce==="flipbevel"){if(se>100)Q=F.mult(-1);else{const ye=se*L.add(F).mag()/L.sub(F).mag();Q._perp()._mult(ye*(we?-1:1))}this.addCurrentVertex(w,Q,0,0,v),this.addCurrentVertex(w,Q.mult(-1),0,0,v)}else if(Ce==="bevel"||Ce==="fakeround"){const ye=-Math.sqrt(se*se-1),Se=we?ye:0,Pe=we?0:ye;if(S&&this.addCurrentVertex(w,L,Se,Pe,v),Ce==="fakeround"){const Ve=Math.round(180*ae/Math.PI/20);for(let Le=1;Le<Ve;Le++){let Oe=Le/Ve;if(Oe!==.5){const At=Oe-.5;Oe+=Oe*At*(Oe-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*At*At+(.848013+re*(.215638*re-1.06021)))}const yt=F.sub(L)._mult(Oe)._add(L)._unit()._mult(we?-1:1);this.addHalfVertex(w,yt.x,yt.y,!1,we,0,v)}}z&&this.addCurrentVertex(w,F,-Se,-Pe,v)}else if(Ce==="butt")this.addCurrentVertex(w,Q,0,0,v);else if(Ce==="square"){const ye=S?1:-1;S||this.addCurrentVertex(w,Q,ye,ye,v),this.addCurrentVertex(w,Q,0,0,v),S&&this.addCurrentVertex(w,Q,ye,ye,v)}else Ce==="round"&&(S&&(this.addCurrentVertex(w,L,0,0,v),this.addCurrentVertex(w,L,1,1,v,!0)),z&&(this.addCurrentVertex(w,F,-1,-1,v,!0),this.addCurrentVertex(w,F,0,0,v)));if(ve&&G<m-1){const ye=w.dist(z);if(ye>2*x){const Se=w.add(z.sub(w)._mult(x/ye)._round());this.updateDistance(w,Se),this.addCurrentVertex(Se,F,0,0,v),w=Se}}}}addCurrentVertex(e,r,n,s,c,h=!1){const d=r.y*s-r.x,m=-r.y-r.x*s;this.addHalfVertex(e,r.x+r.y*n,r.y-r.x*n,h,!1,n,c),this.addHalfVertex(e,d,m,h,!0,-s,c)}addHalfVertex({x:e,y:r},n,s,c,h,d,m){this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(r<<1)+(h?1:0),Math.round(63*n)+128,Math.round(63*s)+128,1+(d===0?0:d<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const g=m.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,g),m.primitiveLength++),h?this.e2=g:this.e1=g}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Ze(Mu,"LineBucket",{omit:["layers","patternFeatures"]});const _g=new A({"line-cap":new y(fe.layout_line["line-cap"]),"line-join":new y(fe.layout_line["line-join"]),"line-miter-limit":new _(fe.layout_line["line-miter-limit"]),"line-round-limit":new _(fe.layout_line["line-round-limit"]),"line-sort-key":new y(fe.layout_line["line-sort-key"])});var Up={paint:new A({"line-opacity":new y(fe.paint_line["line-opacity"]),"line-color":new y(fe.paint_line["line-color"]),"line-translate":new _(fe.paint_line["line-translate"]),"line-translate-anchor":new _(fe.paint_line["line-translate-anchor"]),"line-width":new y(fe.paint_line["line-width"]),"line-gap-width":new y(fe.paint_line["line-gap-width"]),"line-offset":new y(fe.paint_line["line-offset"]),"line-blur":new y(fe.paint_line["line-blur"]),"line-dasharray":new b(fe.paint_line["line-dasharray"]),"line-pattern":new b(fe.paint_line["line-pattern"]),"line-gradient":new E(fe.paint_line["line-gradient"])}),layout:_g};const Vp=new class extends y{possiblyEvaluate(i,e){return e=new ti(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,n){return e=tt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,n)}}(Up.paint.properties["line-width"].specification);function Np(i,e){return e>0?e+2*i:i}Vp.useIntegerZoom=!0;const gg=X([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),yg=X([{name:"a_projected_pos",components:3,type:"Float32"}],4);X([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xg=X([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),vg=X([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);X([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jp=X([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bg=X([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);X([{name:"triangle",components:3,type:"Uint16"}]),X([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),X([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),X([{type:"Float32",name:"offsetX"}]),X([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Vi=24;const Sn=128;function Yh(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ti(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:s}=r;let c=0;for(;c<n.length&&n[c]<=i;)c++;c=Math.max(0,c-1);let h=c;for(;h<n.length&&n[h]<i+1;)h++;h=Math.min(n.length-1,h);const d=n[c],m=n[h];return r.kind==="composite"?{kind:"composite",minZoom:d,maxZoom:m,interpolationType:s}:{kind:"camera",minZoom:d,maxZoom:m,minSize:r.evaluate(new ti(d)),maxSize:r.evaluate(new ti(m)),interpolationType:s}}}function Au(i,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:s}){return i.kind==="source"?n/Sn:i.kind==="composite"?at(n/Sn,s/Sn,r):e}function Da(i,e){let r=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:s,minZoom:c,maxZoom:h}=i,d=s?qe(er.interpolationFactor(s,e,c,h),0,1):0;i.kind==="camera"?n=at(i.minSize,i.maxSize,d):r=d}return{uSizeT:r,uSize:n}}var wg=Object.freeze({__proto__:null,getSizeData:Yh,evaluateSizeForFeature:Au,evaluateSizeForZoom:Da,SIZE_PACK_FACTOR:Sn});function Tg(i,e,r){return i.sections.forEach(n=>{n.text=function(s,c,h){const d=c.layout.get("text-transform").evaluate(h,{});return d==="uppercase"?s=s.toLocaleUpperCase():d==="lowercase"&&(s=s.toLocaleLowerCase()),pr.applyArabicShaping&&(s=pr.applyArabicShaping(s)),s}(n.text,e,r)}),i}const Kl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function Eg(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function Sg(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var Gp=function(i,e,r,n,s){var c,h,d=8*s-n-1,m=(1<<d)-1,g=m>>1,x=-7,v=r?s-1:0,w=r?-1:1,S=i[e+v];for(v+=w,c=S&(1<<-x)-1,S>>=-x,x+=d;x>0;c=256*c+i[e+v],v+=w,x-=8);for(h=c&(1<<-x)-1,c>>=-x,x+=n;x>0;h=256*h+i[e+v],v+=w,x-=8);if(c===0)c=1-g;else{if(c===m)return h?NaN:1/0*(S?-1:1);h+=Math.pow(2,n),c-=g}return(S?-1:1)*h*Math.pow(2,c-n)},$p=function(i,e,r,n,s,c){var h,d,m,g=8*c-s-1,x=(1<<g)-1,v=x>>1,w=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=n?0:c-1,z=n?1:-1,L=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(d=isNaN(e)?1:0,h=x):(h=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-h))<1&&(h--,m*=2),(e+=h+v>=1?w/m:w*Math.pow(2,1-v))*m>=2&&(h++,m/=2),h+v>=x?(d=0,h=x):h+v>=1?(d=(e*m-1)*Math.pow(2,s),h+=v):(d=e*Math.pow(2,v-1)*Math.pow(2,s),h=0));s>=8;i[r+S]=255&d,S+=z,d/=256,s-=8);for(h=h<<s|d,g+=s;g>0;i[r+S]=255&h,S+=z,h/=256,g-=8);i[r+S-z]|=128*L},Jl=ei;function ei(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ei.Varint=0,ei.Fixed64=1,ei.Bytes=2,ei.Fixed32=5;var Kh=4294967296,Zp=1/Kh,qp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function oo(i){return i.type===ei.Bytes?i.readVarint()+i.pos:i.pos+1}function La(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Wp(i,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var s=r.pos-1;s>=i;s--)r.buf[s+n]=r.buf[s]}function Ig(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Mg(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Ag(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Cg(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function zg(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function kg(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Pg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Dg(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Lg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Cu(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ba(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Xp(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Bg(i,e,r){e.glyphs=[],i===1&&r.readMessage(Rg,e)}function Rg(i,e,r){if(i===3){const{id:n,bitmap:s,width:c,height:h,left:d,top:m,advance:g}=r.readMessage(Fg,{});e.glyphs.push({id:n,bitmap:new no({width:c+6,height:h+6},s),metrics:{width:c,height:h,left:d,top:m,advance:g}})}else i===4?e.ascender=r.readSVarint():i===5&&(e.descender=r.readSVarint())}function Fg(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Jh(i){let e=0,r=0;for(const h of i)e+=h.w*h.h,r=Math.max(r,h.w);i.sort((h,d)=>d.h-h.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let s=0,c=0;for(const h of i)for(let d=n.length-1;d>=0;d--){const m=n[d];if(!(h.w>m.w||h.h>m.h)){if(h.x=m.x,h.y=m.y,c=Math.max(c,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===m.w&&h.h===m.h){const g=n.pop();d<n.length&&(n[d]=g)}else h.h===m.h?(m.x+=h.w,m.w-=h.w):h.w===m.w?(m.y+=h.h,m.h-=h.h):(n.push({x:m.x+h.w,y:m.y,w:m.w-h.w,h:h.h}),m.y+=h.h,m.h-=h.h);break}}return{w:s,h:c,fill:e/(s*c)||0}}ei.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),s=n>>3,c=this.pos;this.type=7&n,i(s,e,this),this.pos===c&&this.skip(n)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Cu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Xp(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Cu(this.buf,this.pos)+Cu(this.buf,this.pos+4)*Kh;return this.pos+=8,i},readSFixed64:function(){var i=Cu(this.buf,this.pos)+Xp(this.buf,this.pos+4)*Kh;return this.pos+=8,i},readFloat:function(){var i=Gp(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Gp(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(s,c,h){var d,m,g=h.buf;if(d=(112&(m=g[h.pos++]))>>4,m<128||(d|=(127&(m=g[h.pos++]))<<3,m<128)||(d|=(127&(m=g[h.pos++]))<<10,m<128)||(d|=(127&(m=g[h.pos++]))<<17,m<128)||(d|=(127&(m=g[h.pos++]))<<24,m<128)||(d|=(1&(m=g[h.pos++]))<<31,m<128))return La(s,d,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&qp?function(r,n,s){return qp.decode(r.subarray(n,s))}(this.buf,e,i):function(r,n,s){for(var c="",h=n;h<s;){var d,m,g,x=r[h],v=null,w=x>239?4:x>223?3:x>191?2:1;if(h+w>s)break;w===1?x<128&&(v=x):w===2?(192&(d=r[h+1]))==128&&(v=(31&x)<<6|63&d)<=127&&(v=null):w===3?(m=r[h+2],(192&(d=r[h+1]))==128&&(192&m)==128&&((v=(15&x)<<12|(63&d)<<6|63&m)<=2047||v>=55296&&v<=57343)&&(v=null)):w===4&&(m=r[h+2],g=r[h+3],(192&(d=r[h+1]))==128&&(192&m)==128&&(192&g)==128&&((v=(15&x)<<18|(63&d)<<12|(63&m)<<6|63&g)<=65535||v>=1114112)&&(v=null)),v===null?(v=65533,w=1):v>65535&&(v-=65536,c+=String.fromCharCode(v>>>10&1023|55296),v=56320|1023&v),c+=String.fromCharCode(v),h+=w}return c}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==ei.Bytes)return i.push(this.readVarint(e));var r=oo(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==ei.Bytes)return i.push(this.readSVarint());var e=oo(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ei.Bytes)return i.push(this.readBoolean());var e=oo(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ei.Bytes)return i.push(this.readFloat());var e=oo(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ei.Bytes)return i.push(this.readDouble());var e=oo(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ei.Bytes)return i.push(this.readFixed32());var e=oo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ei.Bytes)return i.push(this.readSFixed32());var e=oo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ei.Bytes)return i.push(this.readFixed64());var e=oo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ei.Bytes)return i.push(this.readSFixed64());var e=oo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===ei.Varint)for(;this.buf[this.pos++]>127;);else if(e===ei.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ei.Fixed32)this.pos+=4;else{if(e!==ei.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ba(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ba(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ba(this.buf,-1&i,this.pos),Ba(this.buf,Math.floor(i*Zp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ba(this.buf,-1&i,this.pos),Ba(this.buf,Math.floor(i*Zp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var n,s;if(e>=0?(n=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,s=s+1|0)),e>=0xffffffffffffffff||e<-0xffffffffffffffff)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(c,h,d){d.buf[d.pos++]=127&c|128,c>>>=7,d.buf[d.pos++]=127&c|128,c>>>=7,d.buf[d.pos++]=127&c|128,c>>>=7,d.buf[d.pos++]=127&c|128,d.buf[d.pos]=127&(c>>>=7)}(n,0,r),function(c,h){var d=(7&c)<<4;h.buf[h.pos++]|=d|((c>>>=3)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c)))))}(s,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(n,s,c){for(var h,d,m=0;m<s.length;m++){if((h=s.charCodeAt(m))>55295&&h<57344){if(!d){h>56319||m+1===s.length?(n[c++]=239,n[c++]=191,n[c++]=189):d=h;continue}if(h<56320){n[c++]=239,n[c++]=191,n[c++]=189,d=h;continue}h=d-55296<<10|h-56320|65536,d=null}else d&&(n[c++]=239,n[c++]=191,n[c++]=189,d=null);h<128?n[c++]=h:(h<2048?n[c++]=h>>6|192:(h<65536?n[c++]=h>>12|224:(n[c++]=h>>18|240,n[c++]=h>>12&63|128),n[c++]=h>>6&63|128),n[c++]=63&h|128)}return c}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Wp(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),$p(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),$p(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var n=this.pos-r;n>=128&&Wp(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,e,r){this.writeTag(i,ei.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Ig,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Mg,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,zg,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Ag,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Cg,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,kg,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Pg,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Dg,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Lg,e)},writeBytesField:function(i,e){this.writeTag(i,ei.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,ei.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,ei.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,ei.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,ei.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,ei.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,ei.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,ei.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,ei.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,ei.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Qh{constructor(e,{pixelRatio:r,version:n,stretchX:s,stretchY:c,content:h}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=s,this.stretchY=c,this.content=h,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hp{constructor(e,r){const n={},s={};this.haveRenderCallbacks=[];const c=[];this.addImages(e,n,c),this.addImages(r,s,c);const{w:h,h:d}=Jh(c),m=new _r({width:h||1,height:d||1});for(const g in e){const x=e[g],v=n[g].paddedRect;_r.copy(x.data,m,{x:0,y:0},{x:v.x+1,y:v.y+1},x.data)}for(const g in r){const x=r[g],v=s[g].paddedRect,w=v.x+1,S=v.y+1,z=x.data.width,L=x.data.height;_r.copy(x.data,m,{x:0,y:0},{x:w,y:S},x.data),_r.copy(x.data,m,{x:0,y:L-1},{x:w,y:S-1},{width:z,height:1}),_r.copy(x.data,m,{x:0,y:0},{x:w,y:S+L},{width:z,height:1}),_r.copy(x.data,m,{x:z-1,y:0},{x:w-1,y:S},{width:1,height:L}),_r.copy(x.data,m,{x:0,y:0},{x:w+z,y:S},{width:1,height:L})}this.image=m,this.iconPositions=n,this.patternPositions=s}addImages(e,r,n){for(const s in e){const c=e[s],h={x:0,y:0,w:c.data.width+2,h:c.data.height+2};n.push(h),r[s]=new Qh(h,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),r)}patchUpdatedImage(e,r,n){if(!e||!r||e.version===r.version)return;e.version=r.version;const[s,c]=e.tl;n.update(r.data,void 0,{x:s,y:c})}}Ze(Qh,"ImagePosition"),Ze(Hp,"ImageAtlas");const Lr={horizontal:1,vertical:2,horizontalOnly:3};class Ql{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const n=new Ql;return n.scale=e||1,n.fontStack=r,n}static forImage(e){const r=new Ql;return r.imageName=e,r}}class Ra{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const n=new Ra;for(let s=0;s<e.sections.length;s++){const c=e.sections[s];c.image?n.addImageSection(c):n.addTextSection(c,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,n){let s="";for(let c=0;c<r.length;c++){const h=r.charCodeAt(c+1)||null,d=r.charCodeAt(c-1)||null;s+=!n&&(h&&ba(h)&&!Kl[r[c+1]]||d&&ba(d)&&!Kl[r[c-1]])||!Kl[r[c]]?r[c]:Kl[r[c]]}return s}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&zu[this.text.charCodeAt(n)];n++)e++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&zu[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const n=new Ra;return n.text=this.text.substring(e,r),n.sectionIndex=this.sectionIndex.slice(e,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Ql.forText(e.scale,e.fontStack||r));const n=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(n)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Lt("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Ql.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Lt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ed(i,e,r,n,s,c,h,d,m,g,x,v,w,S,z,L){const F=Ra.fromFeature(i,s);let G;v===Lr.vertical&&F.verticalizePunctuation(w);const{processBidirectionalText:Q,processStyledBidirectionalText:re}=pr;if(Q&&F.sections.length===1){G=[];const ae=Q(F.toString(),td(F,g,c,e,n,S,z));for(const ve of ae){const we=new Ra;we.text=ve,we.sections=F.sections;for(let Me=0;Me<ve.length;Me++)we.sectionIndex.push(0);G.push(we)}}else if(re){G=[];const ae=re(F.text,F.sectionIndex,td(F,g,c,e,n,S,z));for(const ve of ae){const we=new Ra;we.text=ve[0],we.sectionIndex=ve[1],we.sections=F.sections,G.push(we)}}else G=function(ae,ve){const we=[],Me=ae.text;let Ce=0;for(const ye of ve)we.push(ae.substring(Ce,ye)),Ce=ye;return Ce<Me.length&&we.push(ae.substring(Ce,Me.length)),we}(F,td(F,g,c,e,n,S,z));const oe=[],se={positionedLines:oe,text:F.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:v,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ae,ve,we,Me,Ce,ye,Se,Pe,Ve,Le,Oe,yt){let At=0,xt=0,Et=0;const Qe=Pe==="right"?1:Pe==="left"?0:.5;let $e=!1;for(const qt of Ce){const Dt=qt.getSections();for(const Yt of Dt){if(Yt.imageName)continue;const pi=ve[Yt.fontStack];if(pi&&($e=pi.ascender!==void 0&&pi.descender!==void 0,!$e))break}if(!$e)break}let zt=0;for(const qt of Ce){qt.trim();const Dt=qt.getMaxScale(),Yt=(Dt-1)*Vi,pi={positionedGlyphs:[],lineOffset:0};ae.positionedLines[zt]=pi;const gi=pi.positionedGlyphs;let zi=0;if(!qt.length()){xt+=ye,++zt;continue}let Pi=0,xr=0;for(let Qt=0;Qt<qt.length();Qt++){const Xi=qt.getSection(Qt),vr=qt.getSectionIndex(Qt),Ri=qt.getCharCode(Qt);let Di=Xi.scale,ni=null,ri=null,ar=null,Hi=Vi,Si=0;const Yi=!(Ve===Lr.horizontal||!Oe&&!va(Ri)||Oe&&(zu[Ri]||(Zt=Ri,Yc(Zt)||ma(Zt)||bs(Zt)||Al(Zt)||ya(Zt))));if(Xi.imageName){const Gi=Me[Xi.imageName];if(!Gi)continue;ar=Xi.imageName,ae.iconsInText=ae.iconsInText||!0,ri=Gi.paddedRect;const Li=Gi.displaySize;Di=Di*Vi/yt,ni={width:Li[0],height:Li[1],left:1,top:-3,advance:Yi?Li[1]:Li[0],localGlyph:!1},Si=$e?-ni.height*Di:Dt*Vi-17-Li[1]*Di,Hi=ni.advance;const Nr=(Yi?Li[0]:Li[1])*Di-Vi*Dt;Nr>0&&Nr>zi&&(zi=Nr)}else{const Gi=we[Xi.fontStack];if(!Gi)continue;Gi[Ri]&&(ri=Gi[Ri]);const Li=ve[Xi.fontStack];if(!Li)continue;const Nr=Li.glyphs[Ri];if(!Nr)continue;if(ni=Nr.metrics,Hi=Ri!==8203?Vi:0,$e){const Zo=Li.ascender!==void 0?Math.abs(Li.ascender):0,cc=Li.descender!==void 0?Math.abs(Li.descender):0,uc=(Zo+cc)*Di;Pi<uc&&(Pi=uc,xr=(Zo-cc)/2*Di),Si=-Zo*Di}else Si=(Dt-Di)*Vi-17}Yi?(ae.verticalizable=!0,gi.push({glyph:Ri,imageName:ar,x:At,y:xt+Si,vertical:Yi,scale:Di,localGlyph:ni.localGlyph,fontStack:Xi.fontStack,sectionIndex:vr,metrics:ni,rect:ri}),At+=Hi*Di+Le):(gi.push({glyph:Ri,imageName:ar,x:At,y:xt+Si,vertical:Yi,scale:Di,localGlyph:ni.localGlyph,fontStack:Xi.fontStack,sectionIndex:vr,metrics:ni,rect:ri}),At+=ni.advance*Di+Le)}gi.length!==0&&(Et=Math.max(At-Le,Et),$e?ef(gi,Qe,zi,xr,ye*Dt/2):ef(gi,Qe,zi,0,ye/2)),At=0;const sr=ye*Dt+zi;pi.lineOffset=Math.max(zi,Yt),xt+=sr,++zt}var Zt;const Ai=xt,{horizontalAlign:ii,verticalAlign:Ci}=id(Se);(function(qt,Dt,Yt,pi,gi,zi){const Pi=(Dt-Yt)*gi,xr=-zi*pi;for(const sr of qt)for(const Qt of sr.positionedGlyphs)Qt.x+=Pi,Qt.y+=xr})(ae.positionedLines,Qe,ii,Ci,Et,Ai),ae.top+=-Ci*Ai,ae.bottom=ae.top+Ai,ae.left+=-ii*Et,ae.right=ae.left+Et,ae.hasBaseline=$e}(se,e,r,n,G,h,d,m,v,g,w,L),!function(ae){for(const ve of ae)if(ve.positionedGlyphs.length!==0)return!1;return!0}(oe)&&se}const zu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Og={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Yp(i,e,r,n,s,c){if(e.imageName){const h=n[e.imageName];return h?h.displaySize[0]*e.scale*Vi/c+s:0}{const h=r[e.fontStack],d=h&&h.glyphs[i];return d?d.metrics.advance*e.scale+s:0}}function Kp(i,e,r,n){const s=Math.pow(i-e,2);return n?i<e?s/2:2*s:s+Math.abs(r)*r}function Ug(i,e,r){let n=0;return i===10&&(n-=1e4),r&&(n+=150),i!==40&&i!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function Jp(i,e,r,n,s,c){let h=null,d=Kp(e,r,s,c);for(const m of n){const g=Kp(e-m.x,r,s,c)+m.badness;g<=d&&(h=m,d=g)}return{index:i,x:e,priorBreak:h,badness:d}}function Qp(i){return i?Qp(i.priorBreak).concat(i.index):[]}function td(i,e,r,n,s,c,h){if(c!=="point")return[];if(!i)return[];const d=[],m=function(w,S,z,L,F,G){let Q=0;for(let re=0;re<w.length();re++){const oe=w.getSection(re);Q+=Yp(w.getCharCode(re),oe,L,F,S,G)}return Q/Math.max(1,Math.ceil(Q/z))}(i,e,r,n,s,h),g=i.text.indexOf("\u200B")>=0;let x=0;for(let w=0;w<i.length();w++){const S=i.getSection(w),z=i.getCharCode(w);if(zu[z]||(x+=Yp(z,S,n,s,e,h)),w<i.length()-1){const L=!((v=z)<11904||!(Qc(v)||Jc(v)||zo(v)||Ts(v)||iu(v)||El(v)||eu(v)||_a(v)||ru(v)||Ml(v)||tu(v)||Cl(v)||ws(v)||Sl(v)||Kc(v)||Il(v)||ga(v)||au(v)||ou(v)||nu(v)));(Og[z]||L||S.imageName)&&d.push(Jp(w+1,x,m,d,Ug(z,i.getCharCode(w+1),L&&g),!1))}}var v;return Qp(Jp(i.length(),x,m,d,0,!0))}function id(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function ef(i,e,r,n,s){if(!(e||r||n||s))return;const c=i.length-1,h=i[c],d=(h.x+h.metrics.advance*h.scale)*e;for(let m=0;m<=c;m++)i[m].x-=d,i[m].y+=r+n+s}function Vg(i,e,r){const{horizontalAlign:n,verticalAlign:s}=id(r),c=e[0]-i.displaySize[0]*n,h=e[1]-i.displaySize[1]*s;return{image:i,top:h,bottom:h+i.displaySize[1],left:c,right:c+i.displaySize[0]}}function tf(i,e,r,n,s,c){const h=i.image;let d;if(h.content){const F=h.content,G=h.pixelRatio||1;d=[F[0]/G,F[1]/G,h.displaySize[0]-F[2]/G,h.displaySize[1]-F[3]/G]}const m=e.left*c,g=e.right*c;let x,v,w,S;r==="width"||r==="both"?(S=s[0]+m-n[3],v=s[0]+g+n[1]):(S=s[0]+(m+g-h.displaySize[0])/2,v=S+h.displaySize[0]);const z=e.top*c,L=e.bottom*c;return r==="height"||r==="both"?(x=s[1]+z-n[0],w=s[1]+L+n[2]):(x=s[1]+(z+L-h.displaySize[1])/2,w=x+h.displaySize[1]),{image:h,top:x,right:v,bottom:w,left:S,collisionPadding:d}}class so extends H{constructor(e,r,n,s,c){super(e,r),this.angle=s,this.z=n,c!==void 0&&(this.segment=c)}clone(){return new so(this.x,this.y,this.z,this.angle,this.segment)}}function rf(i,e,r,n,s){if(e.segment===void 0)return!0;let c=e,h=e.segment+1,d=0;for(;d>-r/2;){if(h--,h<0)return!1;d-=i[h].dist(c),c=i[h]}d+=i[h].dist(i[h+1]),h++;const m=[];let g=0;for(;d<r/2;){const x=i[h],v=i[h+1];if(!v)return!1;let w=i[h-1].angleTo(x)-x.angleTo(v);for(w=Math.abs((w+3*Math.PI)%(2*Math.PI)-Math.PI),m.push({distance:d,angleDelta:w}),g+=w;d-m[0].distance>n;)g-=m.shift().angleDelta;if(g>s)return!1;h++,d+=x.dist(v)}return!0}function nf(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function of(i,e,r){return i?.6*e*r:0}function sf(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Ng(i,e,r,n,s,c){const h=of(r,s,c),d=sf(r,n)*c;let m=0;const g=nf(i)/2;for(let x=0;x<i.length-1;x++){const v=i[x],w=i[x+1],S=v.dist(w);if(m+S>g){const z=(g-m)/S,L=at(v.x,w.x,z),F=at(v.y,w.y,z),G=new so(L,F,0,w.angleTo(v),x);return!h||rf(i,G,d,h,e)?G:void 0}m+=S}}function jg(i,e,r,n,s,c,h,d,m){const g=of(n,c,h),x=sf(n,s),v=x*h,w=i[0].x===0||i[0].x===m||i[0].y===0||i[0].y===m;return e-v<e/4&&(e=v+e/4),af(i,w?e/2*d%e:(x/2+2*c)*h*d%e,e,g,r,v,w,!1,m)}function af(i,e,r,n,s,c,h,d,m){const g=c/2,x=nf(i);let v=0,w=e-r,S=[];for(let z=0;z<i.length-1;z++){const L=i[z],F=i[z+1],G=L.dist(F),Q=F.angleTo(L);for(;w+r<v+G;){w+=r;const re=(w-v)/G,oe=at(L.x,F.x,re),se=at(L.y,F.y,re);if(oe>=0&&oe<m&&se>=0&&se<m&&w-g>=0&&w+g<=x){const ae=new so(oe,se,0,Q,z);ae._round(),n&&!rf(i,ae,c,n,s)||S.push(ae)}}v+=G}return d||S.length||h||(S=af(i,v/2,r,n,s,c,h,!0,m)),S}function lf(i,e,r,n,s){const c=[];for(let h=0;h<i.length;h++){const d=i[h];let m;for(let g=0;g<d.length-1;g++){let x=d[g],v=d[g+1];x.x<e&&v.x<e||(x.x<e?x=new H(e,x.y+(e-x.x)/(v.x-x.x)*(v.y-x.y))._round():v.x<e&&(v=new H(e,x.y+(e-x.x)/(v.x-x.x)*(v.y-x.y))._round()),x.y<r&&v.y<r||(x.y<r?x=new H(x.x+(r-x.y)/(v.y-x.y)*(v.x-x.x),r)._round():v.y<r&&(v=new H(x.x+(r-x.y)/(v.y-x.y)*(v.x-x.x),r)._round()),x.x>=n&&v.x>=n||(x.x>=n?x=new H(n,x.y+(n-x.x)/(v.x-x.x)*(v.y-x.y))._round():v.x>=n&&(v=new H(n,x.y+(n-x.x)/(v.x-x.x)*(v.y-x.y))._round()),x.y>=s&&v.y>=s||(x.y>=s?x=new H(x.x+(s-x.y)/(v.y-x.y)*(v.x-x.x),s)._round():v.y>=s&&(v=new H(x.x+(s-x.y)/(v.y-x.y)*(v.x-x.x),s)._round()),m&&x.equals(m[m.length-1])||(m=[x],c.push(m)),m.push(v)))))}}return c}Ze(so,"Anchor");const ec=1e20;function cf(i,e,r,n,s,c,h,d,m){for(let g=e;g<e+n;g++)uf(i,r*c+g,c,s,h,d,m);for(let g=r;g<r+s;g++)uf(i,g*c+e,1,n,h,d,m)}function uf(i,e,r,n,s,c,h){c[0]=0,h[0]=-ec,h[1]=ec,s[0]=i[e];for(let d=1,m=0,g=0;d<n;d++){s[d]=i[e+d*r];const x=d*d;do{const v=c[m];g=(s[d]-s[v]+x-v*v)/(d-v)/2}while(g<=h[m]&&--m>-1);m++,c[m]=d,h[m]=g,h[m+1]=ec}for(let d=0,m=0;d<n;d++){for(;h[m+1]<d;)m++;const g=c[m],x=d-g;i[e+d*r]=s[g]+x*x}}const rd={none:0,ideographs:1,all:2};class Fa{constructor(e,r,n){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const n=[];for(const s in e)for(const c of e[s])n.push({stack:s,id:c});It(n,({stack:s,id:c},h)=>{let d=this.entries[s];d||(d=this.entries[s]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let m=d.glyphs[c];if(m!==void 0)return void h(null,{stack:s,id:c,glyph:m});if(m=this._tinySDF(d,s,c),m)return d.glyphs[c]=m,void h(null,{stack:s,id:c,glyph:m});const g=Math.floor(c/256);if(256*g>65535)return void h(new Error("glyphs > 65535 not supported"));if(d.ranges[g])return void h(null,{stack:s,id:c,glyph:m});let x=d.requests[g];x||(x=d.requests[g]=[],Fa.loadGlyphRange(s,g,this.url,this.requestManager,(v,w)=>{if(w){d.ascender=w.ascender,d.descender=w.descender;for(const S in w.glyphs)this._doesCharSupportLocalGlyph(+S)||(d.glyphs[+S]=w.glyphs[+S]);d.ranges[g]=!0}for(const S of x)S(v,w);delete d.requests[g]})),x.push((v,w)=>{v?h(v):w&&h(null,{stack:s,id:c,glyph:w.glyphs[c]||null})})},(s,c)=>{if(s)r(s);else if(c){const h={};for(const{stack:d,id:m,glyph:g}of c)h[d]===void 0&&(h[d]={}),h[d].glyphs===void 0&&(h[d].glyphs={}),h[d].glyphs[m]=g&&{id:g.id,bitmap:g.bitmap.clone(),metrics:g.metrics},h[d].ascender=this.entries[d].ascender,h[d].descender=this.entries[d].descender;r(null,h)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==rd.none&&(this.localGlyphMode===rd.all?!!this.localFontFamily:!!this.localFontFamily&&(Ml(e)||su(e)||ws(e)||ga(e)||_a(e)))}_tinySDF(e,r,n){const s=this.localFontFamily;if(!s||!this._doesCharSupportLocalGlyph(n))return;let c=e.tinySDF;if(!c){let L="400";/bold/i.test(r)?L="900":/medium/i.test(r)?L="500":/light/i.test(r)&&(L="200"),c=e.tinySDF=new Fa.TinySDF({fontFamily:s,fontWeight:L,fontSize:48,buffer:6,radius:16}),c.fontWeight=L}if(this.localGlyphs[c.fontWeight][n])return this.localGlyphs[c.fontWeight][n];const h=String.fromCharCode(n),{data:d,width:m,height:g,glyphWidth:x,glyphHeight:v,glyphLeft:w,glyphTop:S,glyphAdvance:z}=c.draw(h);return this.localGlyphs[c.fontWeight][n]={id:n,bitmap:new no({width:m,height:g},d),metrics:{width:x/2,height:v/2,left:w/2,top:S/2-27,advance:z/2,localGlyph:!0}}}}function hf(i,e,r,n){const s=[],c=i.image,h=c.pixelRatio,d=c.paddedRect.w-2,m=c.paddedRect.h-2,g=i.right-i.left,x=i.bottom-i.top,v=c.stretchX||[[0,d]],w=c.stretchY||[[0,m]],S=(ye,Se)=>ye+Se[1]-Se[0],z=v.reduce(S,0),L=w.reduce(S,0),F=d-z,G=m-L;let Q=0,re=z,oe=0,se=L,ae=0,ve=F,we=0,Me=G;if(c.content&&n){const ye=c.content;Q=ku(v,0,ye[0]),oe=ku(w,0,ye[1]),re=ku(v,ye[0],ye[2]),se=ku(w,ye[1],ye[3]),ae=ye[0]-Q,we=ye[1]-oe,ve=ye[2]-ye[0]-re,Me=ye[3]-ye[1]-se}const Ce=(ye,Se,Pe,Ve)=>{const Le=Pu(ye.stretch-Q,re,g,i.left),Oe=Du(ye.fixed-ae,ve,ye.stretch,z),yt=Pu(Se.stretch-oe,se,x,i.top),At=Du(Se.fixed-we,Me,Se.stretch,L),xt=Pu(Pe.stretch-Q,re,g,i.left),Et=Du(Pe.fixed-ae,ve,Pe.stretch,z),Qe=Pu(Ve.stretch-oe,se,x,i.top),$e=Du(Ve.fixed-we,Me,Ve.stretch,L),zt=new H(Le,yt),Zt=new H(xt,yt),Ai=new H(xt,Qe),ii=new H(Le,Qe),Ci=new H(Oe/h,At/h),qt=new H(Et/h,$e/h),Dt=e*Math.PI/180;if(Dt){const gi=Math.sin(Dt),zi=Math.cos(Dt),Pi=[zi,-gi,gi,zi];zt._matMult(Pi),Zt._matMult(Pi),ii._matMult(Pi),Ai._matMult(Pi)}const Yt=ye.stretch+ye.fixed,pi=Se.stretch+Se.fixed;return{tl:zt,tr:Zt,bl:ii,br:Ai,tex:{x:c.paddedRect.x+1+Yt,y:c.paddedRect.y+1+pi,w:Pe.stretch+Pe.fixed-Yt,h:Ve.stretch+Ve.fixed-pi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ci,pixelOffsetBR:qt,minFontScaleX:ve/h/g,minFontScaleY:Me/h/x,isSDF:r}};if(n&&(c.stretchX||c.stretchY)){const ye=df(v,F,z),Se=df(w,G,L);for(let Pe=0;Pe<ye.length-1;Pe++){const Ve=ye[Pe],Le=ye[Pe+1];for(let Oe=0;Oe<Se.length-1;Oe++)s.push(Ce(Ve,Se[Oe],Le,Se[Oe+1]))}}else s.push(Ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:d+1},{fixed:0,stretch:m+1}));return s}function ku(i,e,r){let n=0;for(const s of i)n+=Math.max(e,Math.min(r,s[1]))-Math.max(e,Math.min(r,s[0]));return n}function df(i,e,r){const n=[{fixed:-1,stretch:0}];for(const[s,c]of i){const h=n[n.length-1];n.push({fixed:s-h.stretch,stretch:h.stretch}),n.push({fixed:s-h.stretch,stretch:h.stretch+(c-s)})}return n.push({fixed:e+1,stretch:r}),n}function Pu(i,e,r,n){return i/e*r+n}function Du(i,e,r,n){return i-e*r/n}function Gg(i,e,r,n){const s=e+i.positionedLines[n].lineOffset;return n===0?r+s/2:r+(s+(e+i.positionedLines[n-1].lineOffset))/2}Fa.loadGlyphRange=function(i,e,r,n,s){const c=256*e,h=c+255,d=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",i).replace("{range}",`${c}-${h}`),$.Glyphs);Y(d,(m,g)=>{if(m)s(m);else if(g){const x={},v=function(w){return new Jl(w).readFields(Bg,{})}(g);for(const w of v.glyphs)x[w.id]=w;s(null,{glyphs:x,ascender:v.ascender,descender:v.descender})}})},Fa.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:r=8,cutoff:n=.25,fontFamily:s="sans-serif",fontWeight:c="normal",fontStyle:h="normal"}){this.buffer=e,this.cutoff=n,this.radius=r;const d=this.size=i+4*e,m=this._createCanvas(d),g=this.ctx=m.getContext("2d",{willReadFrequently:!0});g.font=`${h} ${c} ${i}px ${s}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:s,actualBoundingBoxRight:c}=this.ctx.measureText(i),h=Math.floor(r),d=Math.min(this.size-this.buffer,Math.ceil(c-s)),m=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(n)),g=d+2*this.buffer,x=m+2*this.buffer,v=g*x,w=new Uint8ClampedArray(v),S={data:w,width:g,height:x,glyphWidth:d,glyphHeight:m,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(d===0||m===0)return S;const{ctx:z,buffer:L,gridInner:F,gridOuter:G}=this;z.clearRect(L,L,d,m),z.fillText(i,L,L+h+1);const Q=z.getImageData(L,L,d,m);G.fill(ec,0,v),F.fill(0,0,v);for(let re=0;re<m;re++)for(let oe=0;oe<d;oe++){const se=Q.data[4*(re*d+oe)+3]/255;if(se===0)continue;const ae=(re+L)*g+oe+L;if(se===1)G[ae]=0,F[ae]=ec;else{const ve=.5-se;G[ae]=ve>0?ve*ve:0,F[ae]=ve<0?ve*ve:0}}cf(G,0,0,g,x,g,this.f,this.v,this.z),cf(F,L,L,d,m,g,this.f,this.v,this.z);for(let re=0;re<v;re++){const oe=Math.sqrt(G[re])-Math.sqrt(F[re]);w[re]=Math.round(255-255*(oe/this.radius+this.cutoff))}return S}};class $g{constructor(e=[],r=Zg){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:n}=this,s=r[e];for(;e>0;){const c=e-1>>1,h=r[c];if(n(s,h)>=0)break;r[e]=h,e=c}r[e]=s}_down(e){const{data:r,compare:n}=this,s=this.length>>1,c=r[e];for(;e<s;){let h=1+(e<<1),d=r[h];const m=h+1;if(m<this.length&&n(r[m],d)<0&&(h=m,d=r[m]),n(d,c)>=0)break;r[e]=d,e=h}r[e]=c}}function Zg(i,e){return i<e?-1:i>e?1:0}function qg(i,e=1,r=!1){let n=1/0,s=1/0,c=-1/0,h=-1/0;const d=i[0];for(let S=0;S<d.length;S++){const z=d[S];(!S||z.x<n)&&(n=z.x),(!S||z.y<s)&&(s=z.y),(!S||z.x>c)&&(c=z.x),(!S||z.y>h)&&(h=z.y)}const m=Math.min(c-n,h-s);let g=m/2;const x=new $g([],Wg);if(m===0)return new H(n,s);for(let S=n;S<c;S+=m)for(let z=s;z<h;z+=m)x.push(new Oa(S+g,z+g,g,i));let v=function(S){let z=0,L=0,F=0;const G=S[0];for(let Q=0,re=G.length,oe=re-1;Q<re;oe=Q++){const se=G[Q],ae=G[oe],ve=se.x*ae.y-ae.x*se.y;L+=(se.x+ae.x)*ve,F+=(se.y+ae.y)*ve,z+=3*ve}return new Oa(L/z,F/z,0,S)}(i),w=x.length;for(;x.length;){const S=x.pop();(S.d>v.d||!v.d)&&(v=S,r&&console.log("found best %d after %d probes",Math.round(1e4*S.d)/1e4,w)),S.max-v.d<=e||(g=S.h/2,x.push(new Oa(S.p.x-g,S.p.y-g,g,i)),x.push(new Oa(S.p.x+g,S.p.y-g,g,i)),x.push(new Oa(S.p.x-g,S.p.y+g,g,i)),x.push(new Oa(S.p.x+g,S.p.y+g,g,i)),w+=4)}return r&&(console.log(`num probes: ${w}`),console.log(`best distance: ${v.d}`)),v.p}function Wg(i,e){return e.max-i.max}function Oa(i,e,r,n){this.p=new H(i,e),this.h=r,this.d=function(s,c){let h=!1,d=1/0;for(let m=0;m<c.length;m++){const g=c[m];for(let x=0,v=g.length,w=v-1;x<v;w=x++){const S=g[x],z=g[w];S.y>s.y!=z.y>s.y&&s.x<(z.x-S.x)*(s.y-S.y)/(z.y-S.y)+S.x&&(h=!h),d=Math.min(d,ap(s,S,z))}}return(h?1:-1)*Math.sqrt(d)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const nd=Number.POSITIVE_INFINITY,Xg=Math.sqrt(2);function pf(i,e){return e[1]!==nd?function(r,n,s){let c=0,h=0;switch(n=Math.abs(n),s=Math.abs(s),r){case"top-right":case"top-left":case"top":h=s-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-s}switch(r){case"top-right":case"bottom-right":case"right":c=-n;break;case"top-left":case"bottom-left":case"left":c=n}return[c,h]}(i,e[0],e[1]):function(r,n){let s=0,c=0;n<0&&(n=0);const h=n/Xg;switch(r){case"top-right":case"top-left":c=h-7;break;case"bottom-right":case"bottom-left":c=7-h;break;case"bottom":c=7-n;break;case"top":c=n-7}switch(r){case"top-right":case"bottom-right":s=-h;break;case"top-left":case"bottom-left":s=h;break;case"left":s=n;break;case"right":s=-n}return[s,c]}(i,e[0])}function Hg(i,e,r,n,s,c,h,d,m,g){i.createArrays(),i.tilePixelRatio=wt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const x=i.layers[0].layout,v=i.layers[0]._unevaluatedLayout._values,w={};if(i.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:F}=i.textSizeData;w.compositeTextSizes=[v["text-size"].possiblyEvaluate(new ti(L),d),v["text-size"].possiblyEvaluate(new ti(F),d)]}if(i.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:F}=i.iconSizeData;w.compositeIconSizes=[v["icon-size"].possiblyEvaluate(new ti(L),d),v["icon-size"].possiblyEvaluate(new ti(F),d)]}w.layoutTextSize=v["text-size"].possiblyEvaluate(new ti(m+1),d),w.layoutIconSize=v["icon-size"].possiblyEvaluate(new ti(m+1),d),w.textMaxSize=v["text-size"].possiblyEvaluate(new ti(18),d);const S=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point",z=x.get("text-size");for(const L of i.features){const F=x.get("text-font").evaluate(L,{},d).join(","),G=z.evaluate(L,{},d),Q=w.layoutTextSize.evaluate(L,{},d),re=(w.layoutIconSize.evaluate(L,{},d),{horizontal:{},vertical:void 0}),oe=L.text;let se,ae=[0,0];if(oe){const Me=oe.toString(),Ce=x.get("text-letter-spacing").evaluate(L,{},d)*Vi,ye=x.get("text-line-height").evaluate(L,{},d)*Vi,Se=cu(Me)?Ce:0,Pe=x.get("text-anchor").evaluate(L,{},d),Ve=x.get("text-variable-anchor");if(!Ve){const Et=x.get("text-radial-offset").evaluate(L,{},d);ae=Et?pf(Pe,[Et*Vi,nd]):x.get("text-offset").evaluate(L,{},d).map(Qe=>Qe*Vi)}let Le=S?"center":x.get("text-justify").evaluate(L,{},d);const Oe=x.get("symbol-placement"),yt=Oe==="point",At=Oe==="point"?x.get("text-max-width").evaluate(L,{},d)*Vi:0,xt=Et=>{i.allowVerticalPlacement&&xa(Me)&&(re.vertical=ed(oe,e,r,s,F,At,ye,Pe,Et,Se,ae,Lr.vertical,!0,Oe,Q,G))};if(!S&&Ve){const Et=Le==="auto"?Ve.map($e=>od($e)):[Le];let Qe=!1;for(let $e=0;$e<Et.length;$e++){const zt=Et[$e];if(!re.horizontal[zt])if(Qe)re.horizontal[zt]=re.horizontal[0];else{const Zt=ed(oe,e,r,s,F,At,ye,"center",zt,Se,ae,Lr.horizontal,!1,Oe,Q,G);Zt&&(re.horizontal[zt]=Zt,Qe=Zt.positionedLines.length===1)}}xt("left")}else{if(Le==="auto"&&(Le=od(Pe)),yt||x.get("text-writing-mode").indexOf("horizontal")>=0||!xa(Me)){const Et=ed(oe,e,r,s,F,At,ye,Pe,Le,Se,ae,Lr.horizontal,!1,Oe,Q,G);Et&&(re.horizontal[Le]=Et)}xt(Oe==="point"?"left":Le)}}let ve=!1;if(L.icon&&L.icon.name){const Me=n[L.icon.name];Me&&(se=Vg(s[L.icon.name],x.get("icon-offset").evaluate(L,{},d),x.get("icon-anchor").evaluate(L,{},d)),ve=Me.sdf,i.sdfIcons===void 0?i.sdfIcons=Me.sdf:i.sdfIcons!==Me.sdf&&Lt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Me.pixelRatio!==i.pixelRatio||x.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const we=mf(re.horizontal)||re.vertical;i.iconsInText||(i.iconsInText=!!we&&we.iconsInText),(we||se)&&Yg(i,L,re,se,n,w,Q,0,ae,ve,h,d,g)}c&&i.generateCollisionDebugBuffers(m,i.collisionBoxArray)}function od(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Yg(i,e,r,n,s,c,h,d,m,g,x,v,w){let S=c.textMaxSize.evaluate(e,{},v);S===void 0&&(S=h);const z=i.layers[0].layout,L=z.get("icon-offset").evaluate(e,{},v),F=mf(r.horizontal)||r.vertical,G=h/24,Q=i.tilePixelRatio*S/24,re=(ye=i.overscaling,i.zoom>18&&ye>2&&(ye>>=1),Math.max(wt/(512*ye),1)*z.get("symbol-spacing")),oe=z.get("text-padding")*i.tilePixelRatio,se=z.get("icon-padding")*i.tilePixelRatio,ae=Ue(z.get("text-max-angle")),ve=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",we=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Me=z.get("symbol-placement"),Ce=re/2;var ye;const Se=z.get("icon-text-fit");let Pe;n&&Se!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Pe=tf(n,r.vertical,Se,z.get("icon-text-fit-padding"),L,G)),F&&(n=tf(n,F,Se,z.get("icon-text-fit-padding"),L,G)));const Ve=(Le,Oe,yt)=>{if(Oe.x<0||Oe.x>=wt||Oe.y<0||Oe.y>=wt)return;const{x:At,y:xt,z:Et}=w.projectTilePoint(Oe.x,Oe.y,yt),Qe=new so(At,xt,Et,0,void 0);(function($e,zt,Zt,Ai,ii,Ci,qt,Dt,Yt,pi,gi,zi,Pi,xr,sr,Qt,Xi,vr,Ri,Di,ni,ri,ar,Hi,Si){const Yi=$e.addToLineVertexArray(zt,Ai);let Gi,Li,Nr,Zo,cc,uc,Kf,Jf=0,Qf=0,em=0,tm=0,wd=-1,Td=-1;const Cn={};let im=wn(""),Ed=0,Sd=0;if(Yt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ed,Sd]=Yt.layout.get("text-offset").evaluate(ni,{},Si).map(br=>br*Vi):(Ed=Yt.layout.get("text-radial-offset").evaluate(ni,{},Si)*Vi,Sd=nd),$e.allowVerticalPlacement&&ii.vertical){const br=ii.vertical;if(sr)uc=sd(br),Dt&&(Kf=sd(Dt));else{const wr=Yt.layout.get("text-rotate").evaluate(ni,{},Si)+90;Nr=Lu(pi,Zt,zt,gi,zi,Pi,br,xr,wr,Qt),Dt&&(Zo=Lu(pi,Zt,zt,gi,zi,Pi,Dt,vr,wr))}}if(Ci){const br=Yt.layout.get("icon-rotate").evaluate(ni,{},Si),wr=Yt.layout.get("icon-text-fit")!=="none",hc=hf(Ci,br,ar,wr),Md=Dt?hf(Dt,br,ar,wr):void 0;Li=Lu(pi,Zt,zt,gi,zi,Pi,Ci,vr,br),Jf=4*hc.length;const rm=$e.iconSizeData;let Bs=null;rm.kind==="source"?(Bs=[Sn*Yt.layout.get("icon-size").evaluate(ni,{},Si)],Bs[0]>Uo&&Lt(`${$e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):rm.kind==="composite"&&(Bs=[Sn*ri.compositeIconSizes[0].evaluate(ni,{},Si),Sn*ri.compositeIconSizes[1].evaluate(ni,{},Si)],(Bs[0]>Uo||Bs[1]>Uo)&&Lt(`${$e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),$e.addSymbols($e.icon,hc,Bs,Di,Ri,ni,!1,Zt,zt,Yi.lineStartIndex,Yi.lineLength,-1,Hi,Si),wd=$e.icon.placedSymbolArray.length-1,Md&&(Qf=4*Md.length,$e.addSymbols($e.icon,Md,Bs,Di,Ri,ni,Lr.vertical,Zt,zt,Yi.lineStartIndex,Yi.lineLength,-1,Hi,Si),Td=$e.icon.placedSymbolArray.length-1)}for(const br in ii.horizontal){const wr=ii.horizontal[br];Gi||(im=wn(wr.text),sr?cc=sd(wr):Gi=Lu(pi,Zt,zt,gi,zi,Pi,wr,xr,Yt.layout.get("text-rotate").evaluate(ni,{},Si),Qt));const hc=wr.positionedLines.length===1;if(em+=ff($e,Zt,zt,wr,qt,Yt,sr,ni,Qt,Yi,ii.vertical?Lr.horizontal:Lr.horizontalOnly,hc?Object.keys(ii.horizontal):[br],Cn,wd,ri,Hi,Si),hc)break}ii.vertical&&(tm+=ff($e,Zt,zt,ii.vertical,qt,Yt,sr,ni,Qt,Yi,Lr.vertical,["vertical"],Cn,Td,ri,Hi,Si));let qo=-1;const Id=(br,wr)=>br?Math.max(br,wr):wr;qo=Id(cc,qo),qo=Id(uc,qo),qo=Id(Kf,qo);const zy=qo>-1?1:0;$e.glyphOffsetArray.length>=Vo.MAX_GLYPHS&&Lt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ni.sortKey!==void 0&&$e.addToSortKeyRanges($e.symbolInstances.length,ni.sortKey),$e.symbolInstances.emplaceBack(Zt.x,Zt.y,Zt.z,zt.x,zt.y,Cn.right>=0?Cn.right:-1,Cn.center>=0?Cn.center:-1,Cn.left>=0?Cn.left:-1,Cn.vertical>=0?Cn.vertical:-1,wd,Td,im,Gi!==void 0?Gi:$e.collisionBoxArray.length,Gi!==void 0?Gi+1:$e.collisionBoxArray.length,Nr!==void 0?Nr:$e.collisionBoxArray.length,Nr!==void 0?Nr+1:$e.collisionBoxArray.length,Li!==void 0?Li:$e.collisionBoxArray.length,Li!==void 0?Li+1:$e.collisionBoxArray.length,Zo||$e.collisionBoxArray.length,Zo?Zo+1:$e.collisionBoxArray.length,gi,em,tm,Jf,Qf,zy,0,Ed,Sd,qo)})(i,Oe,Qe,Le,r,n,s,Pe,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,oe,ve,m,0,se,we,L,e,c,g,x,v)};if(Me==="line")for(const Le of lf(e.geometry,0,0,wt,wt)){const Oe=jg(Le,re,ae,r.vertical||F,n,24,Q,i.overscaling,wt);for(const yt of Oe){const At=F;At&&Kg(i,At.text,Ce,yt)||Ve(Le,yt,v)}}else if(Me==="line-center"){for(const Le of e.geometry)if(Le.length>1){const Oe=Ng(Le,ae,r.vertical||F,n,24,Q);Oe&&Ve(Le,Oe,v)}}else if(e.type==="Polygon")for(const Le of Wh(e.geometry,0)){const Oe=qg(Le,16);Ve(Le[0],new so(Oe.x,Oe.y,0,0,void 0),v)}else if(e.type==="LineString")for(const Le of e.geometry)Ve(Le,new so(Le[0].x,Le[0].y,0,0,void 0),v);else if(e.type==="Point")for(const Le of e.geometry)for(const Oe of Le)Ve([Oe],new so(Oe.x,Oe.y,0,0,void 0),v)}const Uo=32640;function ff(i,e,r,n,s,c,h,d,m,g,x,v,w,S,z,L,F){const G=function(oe,se,ae,ve,we,Me,Ce,ye){const Se=[];if(se.positionedLines.length===0)return Se;const Pe=ve.layout.get("text-rotate").evaluate(Me,{})*Math.PI/180,Ve=function(xt){const Et=xt[0],Qe=xt[1],$e=Et*Qe;return $e>0?[Et,-Qe]:$e<0?[-Et,Qe]:Et===0?[Qe,Et]:[Qe,-Et]}(ae);let Le=Math.abs(se.top-se.bottom);for(const xt of se.positionedLines)Le-=xt.lineOffset;const Oe=se.positionedLines.length,yt=Le/Oe;let At=se.top-ae[1];for(let xt=0;xt<Oe;++xt){const Et=se.positionedLines[xt];At=Gg(se,yt,At,xt);for(const Qe of Et.positionedGlyphs){if(!Qe.rect)continue;const $e=Qe.rect||{};let zt=4,Zt=!0,Ai=1,ii=0;if(Qe.imageName){const ri=Ce[Qe.imageName];if(!ri)continue;if(ri.sdf){Lt("SDF images are not supported in formatted text and will be ignored.");continue}Zt=!1,Ai=ri.pixelRatio,zt=1/Ai}const Ci=(we||ye)&&Qe.vertical,qt=Qe.metrics.advance*Qe.scale/2,Dt=Qe.metrics,Yt=Qe.rect;if(Yt===null)continue;ye&&se.verticalizable&&(ii=Qe.imageName?qt-Qe.metrics.width*Qe.scale/2:0);const pi=we?[Qe.x+qt,Qe.y]:[0,0];let gi=[0,0],zi=[0,0],Pi=!1;we||(Ci?(zi=[Qe.x+qt+Ve[0],Qe.y+Ve[1]-ii],Pi=!0):gi=[Qe.x+qt+ae[0],Qe.y+ae[1]-ii]);const xr=Yt.w*Qe.scale/(Ai*(Qe.localGlyph?2:1)),sr=Yt.h*Qe.scale/(Ai*(Qe.localGlyph?2:1));let Qt,Xi,vr,Ri;if(Ci){const ri=Qe.y-At,ar=new H(-qt,qt-ri),Hi=-Math.PI/2,Si=new H(...zi);Qt=new H(-qt+gi[0],gi[1]),Qt._rotateAround(Hi,ar)._add(Si),Qt.x+=-ri+qt,Qt.y-=(Dt.left-zt)*Qe.scale;const Yi=Qe.imageName?Dt.advance*Qe.scale:Vi*Qe.scale,Gi=String.fromCharCode(Qe.glyph);Eg(Gi)?Qt.x+=(1-zt)*Qe.scale:Sg(Gi)?Qt.x+=Yi-Dt.height*Qe.scale+(-zt-1)*Qe.scale:Qt.x+=Qe.imageName||Dt.width+2*zt===Yt.w&&Dt.height+2*zt===Yt.h?(Yi-sr)/2:(Yi-(Dt.height+2*zt)*Qe.scale)/2,Xi=new H(Qt.x,Qt.y-xr),vr=new H(Qt.x+sr,Qt.y),Ri=new H(Qt.x+sr,Qt.y-xr)}else{const ri=(Dt.left-zt)*Qe.scale-qt+gi[0],ar=(-Dt.top-zt)*Qe.scale+gi[1],Hi=ri+xr,Si=ar+sr;Qt=new H(ri,ar),Xi=new H(Hi,ar),vr=new H(ri,Si),Ri=new H(Hi,Si)}if(Pe){let ri;ri=we?new H(0,0):Pi?new H(Ve[0],Ve[1]):new H(ae[0],ae[1]),Qt._rotateAround(Pe,ri),Xi._rotateAround(Pe,ri),vr._rotateAround(Pe,ri),Ri._rotateAround(Pe,ri)}const Di=new H(0,0),ni=new H(0,0);Se.push({tl:Qt,tr:Xi,bl:vr,br:Ri,tex:$e,writingMode:se.writingMode,glyphOffset:pi,sectionIndex:Qe.sectionIndex,isSDF:Zt,pixelOffsetTL:Di,pixelOffsetBR:ni,minFontScaleX:0,minFontScaleY:0})}}return Se}(0,n,m,c,h,d,s,i.allowVerticalPlacement),Q=i.textSizeData;let re=null;Q.kind==="source"?(re=[Sn*c.layout.get("text-size").evaluate(d,{},F)],re[0]>Uo&&Lt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Q.kind==="composite"&&(re=[Sn*z.compositeTextSizes[0].evaluate(d,{},F),Sn*z.compositeTextSizes[1].evaluate(d,{},F)],(re[0]>Uo||re[1]>Uo)&&Lt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,G,re,m,h,d,x,e,r,g.lineStartIndex,g.lineLength,S,L,F);for(const oe of v)w[oe]=i.text.placedSymbolArray.length-1;return 4*G.length}function mf(i){for(const e in i)return i[e];return null}function Lu(i,e,r,n,s,c,h,d,m,g){let x=h.top,v=h.bottom,w=h.left,S=h.right;const z=h.collisionPadding;if(z&&(w-=z[0],x-=z[1],S+=z[2],v+=z[3]),m){const L=new H(w,x),F=new H(S,x),G=new H(w,v),Q=new H(S,v),re=Ue(m);let oe=new H(0,0);g&&(oe=new H(g[0],g[1])),L._rotateAround(re,oe),F._rotateAround(re,oe),G._rotateAround(re,oe),Q._rotateAround(re,oe),w=Math.min(L.x,F.x,G.x,Q.x),S=Math.max(L.x,F.x,G.x,Q.x),x=Math.min(L.y,F.y,G.y,Q.y),v=Math.max(L.y,F.y,G.y,Q.y)}return i.emplaceBack(e.x,e.y,e.z,r.x,r.y,w,x,S,v,d,n,s,c),i.length-1}function sd(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function Kg(i,e,r,n){const s=i.compareText;if(e in s){const c=s[e];for(let h=c.length-1;h>=0;h--)if(n.dist(c[h])<r)return!0}else s[e]=[];return s[e].push(n),!1}const Jg=Ps.VectorTileFeature.types,Qg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bu(i,e,r,n,s,c,h,d,m,g,x,v,w,S,z,L){const F=x?Math.min(Uo,Math.round(x[0])):0,G=x?Math.min(Uo,Math.round(x[1])):0;i.emplaceBack(e,r,Math.round(32*h),Math.round(32*d),m,g,(F<<1)+(v?1:0),G,16*w,16*S,256*z,256*L,n,s,c,0)}function ad(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function ey(i){for(const e of i.sections)if(wh(e.text))return!0;return!1}class ld{constructor(e){this.layoutVertexArray=new be,this.indexArray=new Xe,this.programConfigurations=e,this.segments=new _i,this.dynamicLayoutVertexArray=new Re,this.opacityVertexArray=new de,this.placedSymbolArray=new Qr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,n,s){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,yg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Qg,!0),this.opacityVertexBuffer.itemSize=1),(n||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ze(ld,"SymbolBuffers");class cd{constructor(e,r,n){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new n,this.segments=new _i,this.collisionVertexArray=new Ee,this.collisionVertexArrayExt=new Re}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,xg.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,vg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ze(cd,"CollisionBuffers");class Vo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=En([]),this.placementViewportMatrix=En([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yh(this.zoom,r["text-size"]),this.iconSizeData=Yh(this.zoom,r["icon-size"]);const n=this.layers[0].layout,s=n.get("symbol-sort-key"),c=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&s.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(h=>Lr[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new ld(new As(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ld(new As(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new $t,this.lineVertexArray=new Ti,this.symbolInstances=new mi}calculateGlyphDependencies(e,r,n,s,c){for(let h=0;h<e.length;h++)if(r[e.charCodeAt(h)]=!0,s&&c){const d=Kl[e.charAt(h)];d&&(r[d.charCodeAt(0)]=!0)}}populate(e,r,n,s){const c=this.layers[0],h=c.layout,d=h.get("text-font"),m=h.get("text-field"),g=h.get("icon-image"),x=(m.value.kind!=="constant"||m.value.value instanceof Mi&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(d.value.kind!=="constant"||d.value.value.length>0),v=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,w=h.get("symbol-sort-key");if(this.features=[],!x&&!v)return;const S=r.iconDependencies,z=r.glyphDependencies,L=r.availableImages,F=new ti(this.zoom);for(const{feature:G,id:Q,index:re,sourceLayerIndex:oe}of e){const se=c._featureFilter.needGeometry,ae=Cs(G,se);if(!c._featureFilter.filter(F,ae,n))continue;let ve,we;if(se||(ae.geometry=ro(G,n,s)),x){const Ce=c.getValueAndResolveTokens("text-field",ae,n,L),ye=Mi.factory(Ce);ey(ye)&&(this.hasRTLText=!0),(!this.hasRTLText||Ta()==="unavailable"||this.hasRTLText&&pr.isParsed())&&(ve=Tg(ye,c,ae))}if(v){const Ce=c.getValueAndResolveTokens("icon-image",ae,n,L);we=Ce instanceof Ji?Ce:Ji.fromString(Ce)}if(!ve&&!we)continue;const Me=this.sortFeaturesByKey?w.evaluate(ae,{},n):void 0;if(this.features.push({id:Q,text:ve,icon:we,index:re,sourceLayerIndex:oe,geometry:ae.geometry,properties:G.properties,type:Jg[G.type],sortKey:Me}),we&&(S[we.name]=!0),ve){const Ce=d.evaluate(ae,{},n).join(","),ye=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Lr.vertical)>=0;for(const Se of ve.sections)if(Se.image)S[Se.image.name]=!0;else{const Pe=xa(ve.toString()),Ve=Se.fontStack||Ce,Le=z[Ve]=z[Ve]||{};this.calculateGlyphDependencies(Se.text,Le,ye,this.allowVerticalPlacement,Pe)}}}h.get("symbol-placement")==="line"&&(this.features=function(G){const Q={},re={},oe=[];let se=0;function ae(Ce){oe.push(G[Ce]),se++}function ve(Ce,ye,Se){const Pe=re[Ce];return delete re[Ce],re[ye]=Pe,oe[Pe].geometry[0].pop(),oe[Pe].geometry[0]=oe[Pe].geometry[0].concat(Se[0]),Pe}function we(Ce,ye,Se){const Pe=Q[ye];return delete Q[ye],Q[Ce]=Pe,oe[Pe].geometry[0].shift(),oe[Pe].geometry[0]=Se[0].concat(oe[Pe].geometry[0]),Pe}function Me(Ce,ye,Se){const Pe=Se?ye[0][ye[0].length-1]:ye[0][0];return`${Ce}:${Pe.x}:${Pe.y}`}for(let Ce=0;Ce<G.length;Ce++){const ye=G[Ce],Se=ye.geometry,Pe=ye.text?ye.text.toString():null;if(!Pe){ae(Ce);continue}const Ve=Me(Pe,Se),Le=Me(Pe,Se,!0);if(Ve in re&&Le in Q&&re[Ve]!==Q[Le]){const Oe=we(Ve,Le,Se),yt=ve(Ve,Le,oe[Oe].geometry);delete Q[Ve],delete re[Le],re[Me(Pe,oe[yt].geometry,!0)]=yt,oe[Oe].geometry=null}else Ve in re?ve(Ve,Le,Se):Le in Q?we(Ve,Le,Se):(ae(Ce),Q[Ve]=se-1,re[Le]=se-1)}return oe.filter(Ce=>Ce.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,Q)=>G.sortKey-Q.sortKey)}update(e,r,n,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,n,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,n,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const n=this.lineVertexArray.length,s=e.segment;if(s!==void 0){let c=e.dist(r[s+1]),h=e.dist(r[s]);const d={};for(let m=s+1;m<r.length;m++)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:c},m<r.length-1&&(c+=r[m+1].dist(r[m]));for(let m=s||0;m>=0;m--)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:h},m>0&&(h+=r[m-1].dist(r[m]));for(let m=0;m<r.length;m++){const g=d[m];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,r,n,s,c,h,d,m,g,x,v,w,S,z){const L=e.indexArray,F=e.layoutVertexArray,G=e.segments.prepareSegment(4*r.length,F,L,this.canOverlap?h.sortKey:void 0),Q=this.glyphOffsetArray.length,re=G.vertexLength,oe=this.allowVerticalPlacement&&d===Lr.vertical?Math.PI/2:0,se=h.text&&h.text.sections;for(let ae=0;ae<r.length;ae++){const{tl:ve,tr:we,bl:Me,br:Ce,tex:ye,pixelOffsetTL:Se,pixelOffsetBR:Pe,minFontScaleX:Ve,minFontScaleY:Le,glyphOffset:Oe,isSDF:yt,sectionIndex:At}=r[ae],xt=G.vertexLength,Et=Oe[1];Bu(F,m.x,m.y,m.z,g.x,g.y,ve.x,Et+ve.y,ye.x,ye.y,n,yt,Se.x,Se.y,Ve,Le),Bu(F,m.x,m.y,m.z,g.x,g.y,we.x,Et+we.y,ye.x+ye.w,ye.y,n,yt,Pe.x,Se.y,Ve,Le),Bu(F,m.x,m.y,m.z,g.x,g.y,Me.x,Et+Me.y,ye.x,ye.y+ye.h,n,yt,Se.x,Pe.y,Ve,Le),Bu(F,m.x,m.y,m.z,g.x,g.y,Ce.x,Et+Ce.y,ye.x+ye.w,ye.y+ye.h,n,yt,Pe.x,Pe.y,Ve,Le),ad(e.dynamicLayoutVertexArray,m,oe),L.emplaceBack(xt,xt+1,xt+2),L.emplaceBack(xt+1,xt+2,xt+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Oe[0]),ae!==r.length-1&&At===r[ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(F.length,h,h.index,{},S,z,se&&se[At])}e.placedSymbolArray.emplaceBack(m.x,m.y,m.z,g.x,g.y,Q,this.glyphOffsetArray.length-Q,re,x,v,g.segment,n?n[0]:0,n?n[1]:0,s[0],s[1],d,0,!1,0,w,0)}_commitLayoutVertex(e,r,n,s,c,h,d){e.emplaceBack(r,n,s,c,h,Math.round(d.x),Math.round(d.y))}_addCollisionDebugVertices(e,r,n,s,c,h,d){const m=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),g=m.vertexLength,x=d.tileAnchorX,v=d.tileAnchorY;for(let S=0;S<4;S++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,s,c,h,x,v,new H(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,s,c,h,x,v,new H(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,s,c,h,x,v,new H(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,s,c,h,x,v,new H(e.x1,e.y2)),m.vertexLength+=4;const w=n.indexArray;w.emplaceBack(g,g+1),w.emplaceBack(g+1,g+2),w.emplaceBack(g+2,g+3),w.emplaceBack(g+3,g),m.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,n,s,c,h){for(let d=s;d<c;d++){const m=n.get(d),g=this.getSymbolInstanceTextSize(e,h,r,d);this._addCollisionDebugVertices(m,g,this.textCollisionBox,m.projectedAnchorX,m.projectedAnchorY,m.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,r,n,s,c,h){for(let d=s;d<c;d++){const m=n.get(d),g=this.getSymbolInstanceIconSize(e,r,d);this._addCollisionDebugVertices(m,g,this.iconCollisionBox,m.projectedAnchorX,m.projectedAnchorY,m.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cd(De,jp.members,dt),this.iconCollisionBox=new cd(De,jp.members,dt);const n=Da(this.iconSizeData,e),s=Da(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(s,e,r,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(s,e,r,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(n,e,r,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(n,e,r,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,r,n,s){const c=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:s),h=Au(this.textSizeData,e,c)/Vi;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,r,n){const s=this.icon.placedSymbolArray.get(n),c=Au(this.iconSizeData,e,s);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,r,n){e.emplaceBack(r,-n,-n),e.emplaceBack(r,n,-n),e.emplaceBack(r,n,n),e.emplaceBack(r,-n,n)}_updateTextDebugCollisionBoxes(e,r,n,s,c,h){for(let d=s;d<c;d++){const m=n.get(d),g=this.getSymbolInstanceTextSize(e,h,r,d);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,g,m.padding)}}_updateIconDebugCollisionBoxes(e,r,n,s,c){for(let h=s;h<c;h++){const d=n.get(h),m=this.getSymbolInstanceIconSize(e,r,h);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,m,d.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=Da(this.iconSizeData,e),s=Da(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(s,e,r,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(s,e,r,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(n,e,r,h.iconBoxStartIndex,h.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,r,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,n,s,c,h,d,m,g){const x={};for(let v=r;v<n;v++){const w=e.get(v);x.textBox={x1:w.x1,y1:w.y1,x2:w.x2,y2:w.y2,padding:w.padding,projectedAnchorX:w.projectedAnchorX,projectedAnchorY:w.projectedAnchorY,projectedAnchorZ:w.projectedAnchorZ,tileAnchorX:w.tileAnchorX,tileAnchorY:w.tileAnchorY},x.textFeatureIndex=w.featureIndex;break}for(let v=s;v<c;v++){const w=e.get(v);x.verticalTextBox={x1:w.x1,y1:w.y1,x2:w.x2,y2:w.y2,padding:w.padding,projectedAnchorX:w.projectedAnchorX,projectedAnchorY:w.projectedAnchorY,projectedAnchorZ:w.projectedAnchorZ,tileAnchorX:w.tileAnchorX,tileAnchorY:w.tileAnchorY},x.verticalTextFeatureIndex=w.featureIndex;break}for(let v=h;v<d;v++){const w=e.get(v);x.iconBox={x1:w.x1,y1:w.y1,x2:w.x2,y2:w.y2,padding:w.padding,projectedAnchorX:w.projectedAnchorX,projectedAnchorY:w.projectedAnchorY,projectedAnchorZ:w.projectedAnchorZ,tileAnchorX:w.tileAnchorX,tileAnchorY:w.tileAnchorY},x.iconFeatureIndex=w.featureIndex;break}for(let v=m;v<g;v++){const w=e.get(v);x.verticalIconBox={x1:w.x1,y1:w.y1,x2:w.x2,y2:w.y2,padding:w.padding,projectedAnchorX:w.projectedAnchorX,projectedAnchorY:w.projectedAnchorY,projectedAnchorZ:w.projectedAnchorZ,tileAnchorX:w.tileAnchorX,tileAnchorY:w.tileAnchorY},x.verticalIconFeatureIndex=w.featureIndex;break}return x}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const n=e.placedSymbolArray.get(r),s=n.vertexStartIndex+4*n.numGlyphs;for(let c=n.vertexStartIndex;c<s;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),n=Math.cos(e),s=[],c=[],h=[];for(let d=0;d<this.symbolInstances.length;++d){h.push(d);const m=this.symbolInstances.get(d);s.push(0|Math.round(r*m.tileAnchorX+n*m.tileAnchorY)),c.push(m.featureIndex)}return h.sort((d,m)=>s[d]-s[m]||c[m]-c[d]),h}addToSortKeyRanges(e,r){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((s,c,h)=>{s>=0&&h.indexOf(s)===c&&this.addIndicesForPlacedSymbol(this.text,s)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ze(Vo,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Vo.MAX_GLYPHS=65535,Vo.addDynamicAttributes=ad;const ty=new A({"symbol-placement":new _(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new _(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new y(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _(fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new _(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new y(fe.layout_symbol["icon-size"]),"icon-text-fit":new _(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new y(fe.layout_symbol["icon-image"]),"icon-rotate":new y(fe.layout_symbol["icon-rotate"]),"icon-padding":new _(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new _(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new y(fe.layout_symbol["icon-offset"]),"icon-anchor":new y(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _(fe.layout_symbol["text-rotation-alignment"]),"text-field":new y(fe.layout_symbol["text-field"]),"text-font":new y(fe.layout_symbol["text-font"]),"text-size":new y(fe.layout_symbol["text-size"]),"text-max-width":new y(fe.layout_symbol["text-max-width"]),"text-line-height":new y(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new y(fe.layout_symbol["text-letter-spacing"]),"text-justify":new y(fe.layout_symbol["text-justify"]),"text-radial-offset":new y(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _(fe.layout_symbol["text-variable-anchor"]),"text-anchor":new y(fe.layout_symbol["text-anchor"]),"text-max-angle":new _(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new _(fe.layout_symbol["text-writing-mode"]),"text-rotate":new y(fe.layout_symbol["text-rotate"]),"text-padding":new _(fe.layout_symbol["text-padding"]),"text-keep-upright":new _(fe.layout_symbol["text-keep-upright"]),"text-transform":new y(fe.layout_symbol["text-transform"]),"text-offset":new y(fe.layout_symbol["text-offset"]),"text-allow-overlap":new _(fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _(fe.layout_symbol["text-ignore-placement"]),"text-optional":new _(fe.layout_symbol["text-optional"])});var ud={paint:new A({"icon-opacity":new y(fe.paint_symbol["icon-opacity"]),"icon-color":new y(fe.paint_symbol["icon-color"]),"icon-halo-color":new y(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new y(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new y(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new _(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new _(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new y(fe.paint_symbol["text-opacity"]),"text-color":new y(fe.paint_symbol["text-color"],{runtimeType:Fr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new y(fe.paint_symbol["text-halo-color"]),"text-halo-width":new y(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new y(fe.paint_symbol["text-halo-blur"]),"text-translate":new _(fe.paint_symbol["text-translate"]),"text-translate-anchor":new _(fe.paint_symbol["text-translate-anchor"])}),layout:ty};class _f{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:qr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ze(_f,"FormatSectionOverride",{omit:["defaultValue"]});class Ru extends tn{constructor(e){super(e,ud)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const s=[];for(const c of n)s.indexOf(c)<0&&s.push(c);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,n,s){const c=this.layout.get(e).evaluate(r,{},n,s),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Io(h.value)||!c?c:function(d,m){return m.replace(/{([^{}]+)}/g,(g,x)=>x in d?String(d[x]):"")}(r.properties,c)}createBucket(e){return new Vo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ud.paint.overridableProperties){if(!Ru.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),n=new _f(r),s=new ca(n,r.property.specification);let c=null;c=r.value.kind==="constant"||r.value.kind==="source"?new fl("source",s):new ml("composite",s,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new p(r.property,c,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&Ru.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const n=e.get("text-field"),s=ud.paint.properties[r];let c=!1;const h=d=>{for(const m of d)if(s.overrides&&s.overrides.hasOverride(m))return void(c=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Mi)h(n.value.value.sections);else if(n.value.kind==="source"){const d=g=>{c||(g instanceof Xr&&wi(g.value)===yo?h(g.value.sections):g instanceof bo?h(g.sections):g.eachChild(d))},m=n.value;m._styleExpression&&d(m._styleExpression.expression)}return c}getProgramConfiguration(e){return new Bo(this,e)}}var iy={paint:new A({"background-color":new _(fe.paint_background["background-color"]),"background-pattern":new T(fe.paint_background["background-pattern"]),"background-opacity":new _(fe.paint_background["background-opacity"])})},ry={paint:new A({"raster-opacity":new _(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new _(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new _(fe.paint_raster["raster-saturation"]),"raster-contrast":new _(fe.paint_raster["raster-contrast"]),"raster-resampling":new _(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new _(fe.paint_raster["raster-fade-duration"])})};class ny extends tn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var oy={paint:new A({"sky-type":new _(fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new _(fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new _(fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new _(fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new _(fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new E(fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new _(fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new _(fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new _(fe.paint_sky["sky-opacity"])})};function hd(i,e,r){const n=[0,0,1],s=bp([]);return function(c,h,d){d*=.5;var m=h[0],g=h[1],x=h[2],v=h[3],w=Math.sin(d),S=Math.cos(d);c[0]=m*S-x*w,c[1]=g*S+v*w,c[2]=x*S+m*w,c[3]=v*S-g*w}(s,s,r?-Ue(i)+Math.PI:Ue(i)),wp(s,s,-Ue(e)),xp(n,n,s),Vl(n,n)}const sy={circle:class extends tn{constructor(i){super(i,S_)}createBucket(i){return new zh(i)}queryRadius(i){const e=i;return Aa("circle-radius",this,e)+Aa("circle-stroke-width",this,e)+xu(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,n,s,c,h,d){const m=hp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,i.pixelToTileUnitsFactor),g=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Tp(i,n,c,h,d,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",m,g)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Bo(this,i)}},heatmap:class extends tn{createBucket(i){return new Sp(i)}constructor(i){super(i,P_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Aa("heatmap-radius",this,i)}queryIntersectsFeature(i,e,r,n,s,c,h,d){const m=this.paint.get("heatmap-radius").evaluate(e,r);return Tp(i,n,c,h,d,!0,!0,new H(0,0),m)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Bo(this,i)}},hillshade:class extends tn{constructor(i){super(i,D_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends tn{constructor(i){super(i,Y_)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(i){return new Bo(this,i)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Su(i)}queryRadius(){return xu(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,n,s,c){return!i.queryGeometry.isAboveHorizon&&sp(up(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,i.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends tn{constructor(i){super(i,lg)}createBucket(i){return new Hl(i)}queryRadius(){return xu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Bo(this,i)}queryIntersectsFeature(i,e,r,n,s,c,h,d,m){const g=hp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,i.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(e,r),v=this.paint.get("fill-extrusion-base").evaluate(e,r),w=[0,0],S=d&&c.elevation,z=c.elevation?c.elevation.exaggeration():1,L=i.tile.getBucket(this);if(S&&L instanceof Hl){const Q=L.centroidVertexArray,re=m+1;if(re<Q.length){const oe=Q.get(re);w[0]=oe.a_centroid_pos0,w[1]=oe.a_centroid_pos1}}if(w[0]===0&&w[1]===1)return!1;const F=function(Q,re,oe,se,ae,ve,we,Me,Ce){return ve?function(ye,Se,Pe,Ve,Le,Oe,yt,At,xt){const Et=[],Qe=[],$e=[0,0,0,1];for(const zt of ye){const Zt=[],Ai=[];for(const ii of zt){const Ci=ii.x+Ve.x,qt=ii.y+Ve.y,Dt=cg(Ci,qt,Se,Pe,Oe,yt,At,xt);$e[0]=Ci,$e[1]=qt,$e[2]=Dt.base,$e[3]=1,za($e,$e,Le),$e[3]=Math.max($e[3],1e-5);const Yt=Op([$e[0]/$e[3],$e[1]/$e[3],$e[2]/$e[3]]);$e[0]=Ci,$e[1]=qt,$e[2]=Dt.top,$e[3]=1,za($e,$e,Le),$e[3]=Math.max($e[3],1e-5);const pi=Op([$e[0]/$e[3],$e[1]/$e[3],$e[2]/$e[3]]);Zt.push(Yt),Ai.push(pi)}Et.push(Zt),Qe.push(Ai)}return[Et,Qe]}(Q,re,oe,se,ae,ve,we,Me,Ce):function(ye,Se,Pe,Ve,Le){const Oe=[],yt=[],At=Le[8]*Se,xt=Le[9]*Se,Et=Le[10]*Se,Qe=Le[11]*Se,$e=Le[8]*Pe,zt=Le[9]*Pe,Zt=Le[10]*Pe,Ai=Le[11]*Pe;for(const ii of ye){const Ci=[],qt=[];for(const Dt of ii){const Yt=Dt.x+Ve.x,pi=Dt.y+Ve.y,gi=Le[0]*Yt+Le[4]*pi+Le[12],zi=Le[1]*Yt+Le[5]*pi+Le[13],Pi=Le[2]*Yt+Le[6]*pi+Le[14],xr=Le[3]*Yt+Le[7]*pi+Le[15],sr=gi+At,Qt=zi+xt,Xi=Pi+Et,vr=Math.max(xr+Qe,1e-5),Ri=gi+$e,Di=zi+zt,ni=Pi+Zt,ri=Math.max(xr+Ai,1e-5),ar=new H(sr/vr,Qt/vr);ar.z=Xi/vr,Ci.push(ar);const Hi=new H(Ri/ri,Di/ri);Hi.z=ni/ri,qt.push(Hi)}Oe.push(Ci),yt.push(qt)}return[Oe,yt]}(Q,re,oe,se,ae)}(n,v,x,g,h,S?d:null,w,z,c.center.lat),G=i.queryGeometry;return function(Q,re,oe){let se=1/0;sp(oe,re)&&(se=Fp(oe,re[0]));for(let ae=0;ae<re.length;ae++){const ve=re[ae],we=Q[ae];for(let Me=0;Me<ve.length-1;Me++){const Ce=ve[Me],ye=[Ce,ve[Me+1],we[Me+1],we[Me],Ce];op(oe,ye)&&(se=Math.min(se,Fp(oe,ye)))}}return se!==1/0&&se}(F[0],F[1],G.isPointQuery()?G.screenBounds:G.screenGeometry)}},line:class extends tn{constructor(i){super(i,Up),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ss,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Vp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Mu(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Bo(this,i)}queryRadius(i){const e=i,r=Np(Aa("line-width",this,e),Aa("line-gap-width",this,e)),n=Aa("line-offset",this,e);return r/2+Math.abs(n)+xu(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,n,s,c){if(i.queryGeometry.isAboveHorizon)return!1;const h=up(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,i.pixelToTileUnitsFactor),d=i.pixelToTileUnitsFactor/2*Np(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),m=this.paint.get("line-offset").evaluate(e,r);return m&&(n=function(g,x){const v=[],w=new H(0,0);for(let S=0;S<g.length;S++){const z=g[S],L=[];for(let F=0;F<z.length;F++){const G=z[F-1],Q=z[F],re=z[F+1],oe=F===0?w:Q.sub(G)._unit()._perp(),se=F===z.length-1?w:re.sub(Q)._unit()._perp(),ae=oe._add(se)._unit();ae._mult(1/(ae.x*se.x+ae.y*se.y)),L.push(ae._mult(x)._add(Q))}v.push(L)}return v}(n,m*i.pixelToTileUnitsFactor)),function(g,x,v){for(let w=0;w<x.length;w++){const S=x[w];if(g.length>=3){for(let z=0;z<S.length;z++)if(Ma(g,S[z]))return!0}if(b_(g,S,v))return!0}return!1}(h,n,d)}isTileClipped(){return!0}},symbol:Ru,background:class extends tn{constructor(i){super(i,iy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends tn{constructor(i){super(i,ry)}getProgramIds(){return["raster"]}},sky:class extends tn{constructor(i){super(i,oy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Gh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),s=!n,c=i.style.light,h=c.properties.get("position");return s&&c.properties.get("anchor")==="viewport"&&Lt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?hd(h.azimuthal,90-h.polar,e):hd(n[0],90-n[1],e)}const r=this.paint.get("sky-gradient-center");return hd(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class tc{constructor(e,r,n,s){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(r,s)}update(e,r,n){const{width:s,height:c}=e,{context:h}=this,{gl:d}=h,{HTMLImageElement:m,HTMLCanvasElement:g,HTMLVideoElement:x,ImageData:v,ImageBitmap:w}=_e;if(d.bindTexture(d.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA&&(!r||r.premultiply!==!1)),n||this.size&&this.size[0]===s&&this.size[1]===c){const{x:S,y:z}=n||{x:0,y:0};e instanceof m||e instanceof g||e instanceof x||e instanceof v||w&&e instanceof w?d.texSubImage2D(d.TEXTURE_2D,0,S,z,d.RGBA,d.UNSIGNED_BYTE,e):d.texSubImage2D(d.TEXTURE_2D,0,S,z,s,c,d.RGBA,d.UNSIGNED_BYTE,e.data)}else this.size=[s,c],e instanceof m||e instanceof g||e instanceof x||e instanceof v||w&&e instanceof w?d.texImage2D(d.TEXTURE_2D,0,this.format,this.format,d.UNSIGNED_BYTE,e):d.texImage2D(d.TEXTURE_2D,0,this.format,s,c,0,this.format,d.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,r){const{context:n}=this,{gl:s}=n;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.filter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap?e===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class dd{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new no({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const n=this.getKey(e,r);return this.positions[n]}trim(){const e=this.width,r=this.height=ze(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,n){const s=[];let c=e.length%2==1?-e[e.length-1]*n:0,h=e[0]*n,d=!0;s.push({left:c,right:h,isDash:d,zeroLength:e[0]===0});let m=e[0];for(let g=1;g<e.length;g++){d=!d;const x=e[g];c=m*n,m+=x,h=m*n,s.push({left:c,right:h,isDash:d,zeroLength:x===0})}return s}addRoundDash(e,r,n){const s=r/2;for(let c=-n;c<=n;c++){const h=this.width*(this.nextRow+n+c);let d=0,m=e[d];for(let g=0;g<this.width;g++){g/m.right>1&&(m=e[++d]);const x=Math.abs(g-m.left),v=Math.abs(g-m.right),w=Math.min(x,v);let S;const z=c/n*(s+1);if(m.isDash){const L=s-Math.abs(z);S=Math.sqrt(w*w+L*L)}else S=s-Math.sqrt(w*w+z*z);this.image.data[h+g]=Math.max(0,Math.min(255,S+128))}}}addRegularDash(e,r){for(let m=e.length-1;m>=0;--m){const g=e[m],x=e[m+1];g.zeroLength?e.splice(m,1):x&&x.isDash===g.isDash&&(x.left=g.left,e.splice(m,1))}const n=e[0],s=e[e.length-1];n.isDash===s.isDash&&(n.left=s.left-this.width,s.right=n.right+this.width);const c=this.width*this.nextRow;let h=0,d=e[h];for(let m=0;m<this.width;m++){m/d.right>1&&(d=e[++h]);const g=Math.abs(m-d.left),x=Math.abs(m-d.right),v=Math.min(g,x);this.image.data[c+m]=Math.max(0,Math.min(255,(d.isDash?v:-v)+r+128))}}addDash(e,r){const n=this.getKey(e,r);if(this.positions[n])return this.positions[n];const s=r==="round",c=s?7:0,h=2*c+1;if(this.nextRow+h>this.height)return Lt("LineAtlas out of space"),null;e.length===0&&e.push(1);let d=0;for(let x=0;x<e.length;x++)e[x]<0&&(Lt("Negative value is found in line dasharray, replacing values with 0"),e[x]=0),d+=e[x];if(d!==0){const x=this.width/d,v=this.getDashRanges(e,this.width,x);s?this.addRoundDash(v,x,c):this.addRegularDash(v,r==="square"?.5*x:0)}const m=this.nextRow+c;this.nextRow+=h;const g={tl:[m,c],br:[d,0]};return this.positions[n]=g,g}}Ze(dd,"LineAtlas");class ay{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const ly=_e.performance;function gf(i){const e=i?i.url.toString():void 0;return ly.getEntriesByName(e)}class cy{constructor(){this.tasks={},this.taskQueue=[],si(["process"],this),this.invoker=new ay(this.process),this.nextId=0}add(e,r){const n=this.nextId++,s=function({type:c,isSymbolTile:h,zoom:d}){return d=d||0,c==="message"?0:c!=="maybePrepare"||h?c!=="parseTile"||h?c==="parseTile"&&h?300-d:c==="maybePrepare"&&h?400-d:500:200-d:100-d}(r);if(s===0){Er();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:r,priority:s,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){Er();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let s=0;s<this.taskQueue.length;s++){const c=this.tasks[this.taskQueue[s]];c.priority<r&&(r=c.priority,e=s)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}const uy=X([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),hy=X([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:yf}=uy,xf=X([{name:"a_pos_3",components:3,type:"Int16"}]);var ic=X([{name:"a_pos",type:"Int16",components:2}]);const Ua=wt/Math.PI/2,gr=-Ua,yr=Ua,dy=[new Dr([gr,gr,gr],[yr,yr,yr]),new Dr([gr,gr,gr],[0,0,yr]),new Dr([0,gr,gr],[yr,0,yr]),new Dr([gr,0,gr],[0,yr,yr]),new Dr([0,0,gr],[yr,yr,yr])];class py{constructor(e,r,n){this.a=Ca([],e,n),this.b=Ca([],r,n),this.center=n;const s=Vl([],this.a),c=Vl([],this.b);this.angle=Math.acos(Nl(s,c))}}function pd(i,e){if(i.angle===0)return null;let r;return r=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),r<0||r>1?null:function(n,s,c,h){const d=Math.sin(c);return n*(Math.sin((1-h)*c)/d)+s*(Math.sin(h*c)/d)}(i.a[e],i.b[e],i.angle,qe(r,0,1))+i.center[e]}function rc(i){if(i.z<=1)return dy[i.z+2*i.y+i.x];const[e,r]=fd(i),n=[ao(e[0],e[1]),ao(e[0],r[1]),ao(r[0],e[1]),ao(r[0],r[1])],s=[yr,yr,yr],c=[gr,gr,gr];for(const h of n)s[0]=Math.min(s[0],h[0]),s[1]=Math.min(s[1],h[1]),s[2]=Math.min(s[2],h[2]),c[0]=Math.max(c[0],h[0]),c[1]=Math.max(c[1],h[1]),c[2]=Math.max(c[2],h[2]);return new Dr(s,c)}function fy(i,e,r){const n=e/i.worldSize,s=(Se,Pe)=>{Ul(Se,Se,n),Ul(Pe,Pe,n)},c=Number.MAX_VALUE,h=[-c,-c,-c],d=[c,c,c],m=Ef(i);if(r.z<=1){const Se=rc(r).getCorners();for(let Pe=0;Pe<Se.length;Pe++)ks(Se[Pe],Se[Pe],m),Oh(d,d,Se[Pe]),Uh(h,h,Se[Pe]);return s(d,h),new Dr(d,h)}const[g,x]=fd(r),v=new Ro;v.setSouthWest([g[1],x[0]]),v.setNorthEast([x[1],g[0]]);const w=[ao(v.getSouth(),v.getWest()),ao(v.getSouth(),v.getEast()),ao(v.getNorth(),v.getEast()),ao(v.getNorth(),v.getWest())];for(let Se=0;Se<w.length;Se++)ks(w[Se],w[Se],m),Oh(d,d,w[Se]),Uh(h,h,w[Se]);if(v.contains(i.center))return h[2]=0,s(d,h),new Dr(d,h);const S=[m[12],m[13],m[14]],z=i.center.lng,L=qe(i.center.lat,-85.051129,Tn),F=[Fl(z),Sa(L)],G=v.getCenter().lng,Q=qe(v.getCenter().lat,-85.051129,Tn),re=[Fl(G),Sa(Q)];let oe=new Array(3),se=0;const ae=F[0]-re[0],ve=F[1]-re[1];if(Math.abs(ae)>Math.abs(ve))se=ae>=0?1:3,oe=S;else{se=ve>=0?0:2;const Se=[m[4],m[5],m[6]];let Pe;Pe=ve>=0?-Math.sin(Ue(v.getSouth()))*Ua:-Math.sin(Ue(v.getNorth()))*Ua,oe=Vh(oe,S,Se,Pe)}const we=w[se],Me=w[(se+1)%4],Ce=new py(we,Me,oe),ye=[pd(Ce,0)||we[0],pd(Ce,1)||we[1],pd(Ce,2)||we[2]];return d[2]=Math.min(we[2],Me[2]),Oh(d,d,ye),Uh(h,h,ye),s(d,h),new Dr(d,h)}function fd(i){const e=1<<i.z,r=i.x/e,n=(i.x+1)/e,s=(i.y+1)/e;return[[Ui(i.y/e),Ur(r)],[Ui(s),Ur(n)]]}function vf(i,e,r,n=Ua){return r=Ue(r),[i*Math.sin(r)*n,-e*n,i*Math.cos(r)*n]}function ao(i,e,r){return vf(Math.cos(Ue(i)),Math.sin(Ue(i)),e,r)}function bf(i,e,r){const n=Math.pow(2,r.z),s=(i/wt+r.x)/n;return ao(Ui((e/wt+r.y)/n),Ur(s))}function md(i){return 16383/Math.max(...Ca([],i.max,i.min))}function wf(i){const e=En(new Float64Array(16)),r=md(i);var n,s;return Fo(e,e,[r,r,r]),zs(e,e,((n=[])[0]=-(s=i.min)[0],n[1]=-s[1],n[2]=-s[2],n)),e}function Tf(i,e,r,n,s){const c=function(m){const g=wt/(2*Math.PI);return m/(2*Math.PI)/g}(r),h=[i,e,-r/(2*Math.PI)],d=En(new Float64Array(16));return zs(d,d,h),Fo(d,d,[c,c,c]),Bh(d,d,Ue(-s)),Rh(d,d,Ue(-n)),d}function Ef(i){const{x:e,y:r}=i.point,{lng:n,lat:s}=i._center;return Tf(e,r,i.worldSize,n,s)}const Sf=Ue(85),my=Math.cos(Sf),_y=Math.sin(Sf);function If(i,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[i*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Fu{constructor(e,r,n){this.z=e,this.x=r,this.y=n,this.key=nc(0,e,e,r,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const n=function(c,h,d){var m=If(256*c,256*(h=Math.pow(2,d)-h-1),d),g=If(256*(c+1),256*(h+1),d);return m[0]+","+m[1]+","+g[0]+","+g[1]}(this.x,this.y,this.z),s=function(c,h,d){let m,g="";for(let x=c;x>0;x--)m=1<<x-1,g+=(h&m?1:0)+(d&m?2:0);return g}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Mf{constructor(e,r){this.wrap=e,this.canonical=r,this.key=nc(e,r.z,r.z,r.x,r.y)}}class Wi{constructor(e,r,n,s,c){this.overscaledZ=e,this.wrap=r,this.canonical=new Fu(n,+s,+c),this.key=r===0&&e===n?this.canonical.key:nc(r,e,n,s,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Wi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wi(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return nc(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return nc(this.wrap*+r,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Wi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,n=2*this.canonical.x,s=2*this.canonical.y;return[new Wi(r,this.wrap,r,n,s),new Wi(r,this.wrap,r,n+1,s),new Wi(r,this.wrap,r,n,s+1),new Wi(r,this.wrap,r,n+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Wi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Wi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Mf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function nc(i,e,r,n,s){const c=1<<Math.min(r,22);let h=c*(s%c)+n%c;return i&&r<22&&(h+=c*c*((i<0?-2*i-1:2*i)%(1<<2*(22-r)))),16*(32*h+r)+(e-r)}function Ds(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const r=Math.pow(2,-i.z),n=i.x*r,s=(i.x+1)*r,c=i.y*r,h=(i.y+1)*r,d=Ur(n),m=Ur(s),g=Ui(c),x=Ui(h),v=e.project(d,g),w=e.project(m,g),S=e.project(m,x),z=e.project(d,x);let L=Math.min(v.x,w.x,S.x,z.x),F=Math.min(v.y,w.y,S.y,z.y),G=Math.max(v.x,w.x,S.x,z.x),Q=Math.max(v.y,w.y,S.y,z.y);const re=r/16;function oe(ae,ve,we,Me,Ce,ye){const Se=(we+Ce)/2,Pe=(Me+ye)/2,Ve=e.project(Ur(Se),Ui(Pe)),Le=Math.max(0,L-Ve.x,F-Ve.y,Ve.x-G,Ve.y-Q);L=Math.min(L,Ve.x),G=Math.max(G,Ve.x),F=Math.min(F,Ve.y),Q=Math.max(Q,Ve.y),Le>re&&(oe(ae,Ve,we,Me,Se,Pe),oe(Ve,ve,Se,Pe,Ce,ye))}oe(v,w,n,c,s,c),oe(w,S,s,c,s,h),oe(S,z,s,h,n,h),oe(z,v,n,h,n,c),L-=re,F-=re,G+=re,Q+=re;const se=1/Math.max(G-L,Q-F);return{scale:se,x:L*se,y:F*se,x2:G*se,y2:Q*se,projection:e}}Ze(Fu,"CanonicalTileID"),Ze(Wi,"OverscaledTileID",{omit:["projMatrix"]});class Af{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const n=e[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const gy=["tile","layer","source","sourceLayer","state"];class Cf{constructor(e,r,n,s,c){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=n,this._y=s,this.properties=e.properties,this.id=c}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of gy)this[r]!==void 0&&(e[r]=this[r]);return e}}const Vr=32,In=33,No=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,r=0,n=0,s=0,c=0,h=0,d=0;for(1&e?s=c=h=Vr:r=n=d=Vr;(e>>=1)>1;){const g=r+s>>1,x=n+c>>1;1&e?(s=r,c=n,r=h,n=d):(r=s,n=c,s=h,c=d),h=g,d=x}const m=4*i;No[m+0]=r,No[m+1]=n,No[m+2]=s,No[m+3]=c}const Mn=new Uint16Array(2178),jo=new Uint8Array(1089),Ou=new Uint16Array(1089);function zf(i){return i===0?-.03125:i===32?.03125:0}var kf=X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Pf={type:2,extent:wt,loadGeometry:()=>[[new H(0,0),new H(8193,0),new H(8193,8193),new H(0,8193),new H(0,0)]]};class _d{constructor(e,r,n,s,c){this.tileID=e,this.uid=gt(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,this.expiredRequestCount=0,this.state="loading",s&&s.transform&&(this.projection=s.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<$i.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ds(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,c){const h={};if(!c)return h;for(const d of s){const m=d.layerIds.map(g=>c.getLayer(g)).filter(Boolean);if(m.length!==0){d.layers=m,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(g=>m.filter(x=>x.id===g)[0]));for(const g of m)h[g.id]=d}}return h}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const s in this.buckets){const c=this.buckets[s];if(c instanceof Vo){if(this.hasSymbolBuckets=!0,!n)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const s in this.buckets){const c=this.buckets[s];if(c instanceof Vo&&c.hasRTLText){this.hasRTLText=!0,pr.isLoading()||pr.isLoaded()||Ta()!=="deferred"||ko();break}}this.queryPadding=0;for(const s in this.buckets){const c=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(s).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Jr}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const s=this.buckets[n];s.uploadPending()&&s.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new tc(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new tc(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new tc(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,n,s,c,h,d,m){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:s,pixelPosMatrix:d,transform:h,params:c,tileTransform:this.tileTransform},e,r,n):{}}querySourceFeatures(e,r){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const s=n.loadVTLayers(),c=r?r.sourceLayer:"",h=s._geojsonTileLayer||s[c];if(!h)return;const d=gn(r&&r.filter),{z:m,x:g,y:x}=this.tileID.canonical,v={z:m,x:g,y:x};for(let w=0;w<h.length;w++){const S=h.feature(w);if(d.needGeometry){const F=Cs(S,!0);if(!d.filter(new ti(this.tileID.overscaledZ),F,this.tileID.canonical))continue}else if(!d.filter(new ti(this.tileID.overscaledZ),S))continue;const z=n.getId(S,c),L=new Cf(S,m,g,x,z);L.tile=v,e.push(L)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const n=uo(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let s=!1;if(this.expirationTime>n)s=!1;else if(r)if(this.expirationTime<r)s=!0;else{const c=this.expirationTime-r;c?this.expirationTime=n+Math.max(c,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const n=this.latestFeatureIndex.loadVTLayers(),s=r.style.listImages();for(const c in this.buckets){if(!r.style.hasLayer(c))continue;const h=this.buckets[c],d=h.layers[0].sourceLayer||"_geojsonTileLayer",m=n[d],g=e[d];if(!m||!g||Object.keys(g).length===0)continue;if(h.update(g,m,s,this.imageAtlas&&this.imageAtlas.patternPositions||{}),h instanceof Mu||h instanceof Su){const v=r.style._getSourceCache(h.layers[0].source);r._terrain&&r._terrain.enabled&&v&&h.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(v.id,this.tileID)}const x=r&&r.style&&r.style.getLayer(c);x&&(this.queryPadding=Math.max(this.queryPadding,x.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<$i.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=$i.now()+e}setTexture(e,r){const n=r.context,s=n.gl;this.texture=r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new tc(n,e,s.RGBA,{useMipmap:!0}),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),n.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax))}setDependencies(e,r){const n={};for(const s of r)n[s]=!0;this.dependencies[e]=n}hasDependency(e,r){for(const n of e){const s=this.dependencies[n];if(s){for(const c of r)if(s[c])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const n=ro(Pf,this.tileID.canonical,this.tileTransform)[0],s=new q,c=new Rt;for(let h=0;h<n.length;h++){const{x:d,y:m}=n[h];s.emplaceBack(d,m),c.emplaceBack(h)}c.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(c),this._tileDebugBuffer=e.createVertexBuffer(s,ic.members),this._tileDebugSegments=_i.simpleSegment(0,0,s.length,c.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const n=ro(Pf,this.tileID.canonical,this.tileTransform)[0];let s,c;if(this.isRaster){const h=function(d,m){const g=Ds(d,m),x=Math.pow(2,d.z);for(let F=0;F<In;F++)for(let G=0;G<In;G++){const Q=Ur((d.x+(G+zf(G))/Vr)/x),re=Ui((d.y+(F+zf(F))/Vr)/x),oe=m.project(Q,re),se=F*In+G;Mn[2*se+0]=Math.round((oe.x*g.scale-g.x)*wt),Mn[2*se+1]=Math.round((oe.y*g.scale-g.y)*wt)}jo.fill(0),Ou.fill(0);for(let F=2045;F>=0;F--){const G=4*F,Q=No[G+0],re=No[G+1],oe=No[G+2],se=No[G+3],ae=Q+oe>>1,ve=re+se>>1,we=ae+ve-re,Me=ve+Q-ae,Ce=re*In+Q,ye=se*In+oe,Se=ve*In+ae,Pe=Math.hypot((Mn[2*Ce+0]+Mn[2*ye+0])/2-Mn[2*Se+0],(Mn[2*Ce+1]+Mn[2*ye+1])/2-Mn[2*Se+1])>=16;if(jo[Se]=jo[Se]||(Pe?1:0),F<1022){const Ve=(re+Me>>1)*In+(Q+we>>1),Le=(se+Me>>1)*In+(oe+we>>1);jo[Se]=jo[Se]||jo[Ve]||jo[Le]}}const v=new K,w=new Xe;let S=0;function z(F,G){const Q=G*In+F;return Ou[Q]===0&&(v.emplaceBack(Mn[2*Q+0],Mn[2*Q+1],F*wt/Vr,G*wt/Vr),Ou[Q]=++S),Ou[Q]-1}function L(F,G,Q,re,oe,se){const ae=F+Q>>1,ve=G+re>>1;if(Math.abs(F-oe)+Math.abs(G-se)>1&&jo[ve*In+ae])L(oe,se,F,G,ae,ve),L(Q,re,oe,se,ae,ve);else{const we=z(F,G),Me=z(Q,re),Ce=z(oe,se);w.emplaceBack(we,Me,Ce)}}return L(0,0,Vr,Vr,Vr,0),L(Vr,Vr,0,0,0,Vr),{vertices:v,indices:w}}(this.tileID.canonical,r);s=h.vertices,c=h.indices}else{s=new K,c=new Xe;for(const{x:d,y:m}of n)s.emplaceBack(d,m,0,0);const h=vu(s.int16,void 0,4);for(let d=0;d<h.length;d+=3)c.emplaceBack(h[d],h[d+1],h[d+2])}this._tileBoundsBuffer=e.createVertexBuffer(s,kf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(c),this._tileBoundsSegments=_i.simpleSegment(0,0,s.length,c.length)}_makeGlobeTileDebugBuffers(e,r){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!r||r.name!=="globe")return;const n=this.tileID.canonical,s=wf(rc(n));this._makeGlobeTileDebugBorderBuffer(e,n,s),this._makeGlobeTileDebugTextBuffer(e,n,s)}_makeGlobeTileDebugBorderBuffer(e,r,n){const s=new q,c=new Rt,h=new W,d=(g,x,v,w,S)=>{const z=(v-g)/(S-1),L=(w-x)/(S-1),F=s.length;for(let G=0;G<S;G++){const Q=g+G*z,re=x+G*L;s.emplaceBack(Q,re);const oe=bf(Q,re,r),se=ks(oe,oe,n);h.emplaceBack(se[0],se[1],se[2]),c.emplaceBack(F+G)}},m=wt;d(0,0,m,0,16),d(m,0,m,m,16),d(m,m,0,m,16),d(0,m,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(c),this._tileDebugBuffer=e.createVertexBuffer(s,ic.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(h,xf.members),this._tileDebugSegments=_i.simpleSegment(0,0,s.length,c.length)}_makeGlobeTileDebugTextBuffer(e,r,n){const s=new q,c=new Xe,h=new W,d=25;c.reserve(32),s.reserve(d),h.reserve(d);const m=(g,x)=>d*g+x;for(let g=0;g<d;g++){const x=2048*g;for(let v=0;v<d;v++){const w=2048*v;s.emplaceBack(w,x);const S=bf(w,x,r),z=ks(S,S,n);h.emplaceBack(z[0],z[1],z[2])}}for(let g=0;g<4;g++)for(let x=0;x<4;x++){const v=m(g,x),w=m(g,x+1),S=m(g+1,x),z=m(g+1,x+1);c.emplaceBack(v,w,S),c.emplaceBack(S,w,z)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(c),this._tileDebugTextBuffer=e.createVertexBuffer(s,ic.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(h,xf.members),this._tileDebugTextSegments=_i.simpleSegment(0,0,d,32)}}class yy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,n){const s=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},tt(this.stateChanges[e][s],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const c in this.state[e])c!==s&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][s]===null){this.deletedStates[e][s]={};for(const c in this.state[e][s])n[c]||(this.deletedStates[e][s][c]=null)}else for(const c in n)this.deletedStates[e]&&this.deletedStates[e][s]&&this.deletedStates[e][s][c]===null&&delete this.deletedStates[e][s][c]}removeFeatureState(e,r,n){if(this.deletedStates[e]===null)return;const s=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&r!==void 0)this.deletedStates[e][s]!==null&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][n]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][s])for(n in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][n]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,r){const n=String(r),s=tt({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const c=this.deletedStates[e][r];if(c===null)return{};for(const h in c)delete s[h]}return s}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const n={};for(const s in this.stateChanges){this.state[s]=this.state[s]||{};const c={};for(const h in this.stateChanges[s])this.state[s][h]||(this.state[s][h]={}),tt(this.state[s][h],this.stateChanges[s][h]),c[h]=this.state[s][h];n[s]=c}for(const s in this.deletedStates){this.state[s]=this.state[s]||{};const c={};if(this.deletedStates[s]===null)for(const h in this.state[s])c[h]={},this.state[s][h]={};else for(const h in this.deletedStates[s]){if(this.deletedStates[s][h]===null)this.state[s][h]={};else for(const d of Object.keys(this.deletedStates[s][h]))delete this.state[s][h][d];c[h]=this.state[s][h]}n[s]=n[s]||{},tt(n[s],c)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const s in e)e[s].setFeatureState(n,r)}}class Df{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const n=this.toIdx(e,r);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function Lf(i,e,r,n){let s=0,c=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(n[h])<1e-15){if(r[h]<i[h]||r[h]>e[h])return null}else{const d=1/n[h];let m=(i[h]-r[h])*d,g=(e[h]-r[h])*d;if(m>g){const x=m;m=g,g=x}if(m>s&&(s=m),g<c&&(c=g),s>c)return null}return s}function Bf(i,e,r,n,s,c,h,d,m,g,x){const v=n-i,w=s-e,S=c-r,z=h-i,L=d-e,F=m-r,G=x[1]*F-x[2]*L,Q=x[2]*z-x[0]*F,re=x[0]*L-x[1]*z,oe=v*G+w*Q+S*re;if(Math.abs(oe)<1e-15)return null;const se=1/oe,ae=g[0]-i,ve=g[1]-e,we=g[2]-r,Me=(ae*G+ve*Q+we*re)*se;if(Me<0||Me>1)return null;const Ce=ve*S-we*w,ye=we*v-ae*S,Se=ae*w-ve*v,Pe=(x[0]*Ce+x[1]*ye+x[2]*Se)*se;return Pe<0||Me+Pe>1?null:(z*Ce+L*ye+F*Se)*se}function Rf(i,e,r){return(i-e)/(r-e)}function Ff(i,e,r,n,s,c,h,d,m){const g=1<<r,x=c-n,v=h-s,w=(i+1)/g*x+n,S=(e+0)/g*v+s,z=(e+1)/g*v+s;d[0]=(i+0)/g*x+n,d[1]=S,m[0]=w,m[1]=z}class Of{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(c){const h=Math.ceil(Math.log2(c.dim/8)),d=[];let m=Math.ceil(Math.pow(2,h));const g=1/m,x=(S,z,L,F,G)=>{const Q=F?1:0,re=(S+1)*L-Q,oe=z*L,se=(z+1)*L-Q;G[0]=S*L,G[1]=oe,G[2]=re,G[3]=se};let v=new Df(m);const w=[];for(let S=0;S<m*m;S++){x(S%m,Math.floor(S/m),g,!1,w);const z=Go(w[0],w[1],c),L=Go(w[2],w[1],c),F=Go(w[2],w[3],c),G=Go(w[0],w[3],c);v.minimums.push(Math.min(z,L,F,G)),v.maximums.push(Math.max(z,L,F,G)),v.leaves.push(1)}for(d.push(v),m/=2;m>=1;m/=2){const S=d[d.length-1];v=new Df(m);for(let z=0;z<m*m;z++){x(z%m,Math.floor(z/m),2,!0,w);const L=S.getElevation(w[0],w[1]),F=S.getElevation(w[2],w[1]),G=S.getElevation(w[2],w[3]),Q=S.getElevation(w[0],w[3]),re=S.isLeaf(w[0],w[1]),oe=S.isLeaf(w[2],w[1]),se=S.isLeaf(w[2],w[3]),ae=S.isLeaf(w[0],w[3]),ve=Math.min(L.min,F.min,G.min,Q.min),we=Math.max(L.max,F.max,G.max,Q.max),Me=re&&oe&&se&&ae;v.maximums.push(we),v.minimums.push(ve),v.leaves.push(we-ve<=5&&Me?1:0)}d.push(v)}return d}(this.dem),n=r.length-1,s=r[n];this._addNode(s.minimums[0],s.maximums[0],s.leaves[0]),this._construct(r,0,0,n,0)}raycastRoot(e,r,n,s,c,h,d=1){return Lf([e,r,-100],[n,s,this.maximums[0]*d],c,h)}raycast(e,r,n,s,c,h,d=1){if(!this.nodeCount)return null;const m=this.raycastRoot(e,r,n,s,c,h,d);if(m==null)return null;const g=[],x=[],v=[],w=[],S=[{idx:0,t:m,nodex:0,nodey:0,depth:0}];for(;S.length>0;){const{idx:z,t:L,nodex:F,nodey:G,depth:Q}=S.pop();if(this.leaves[z]){Ff(F,G,Q,e,r,n,s,v,w);const oe=1<<Q,se=(F+0)/oe,ae=(F+1)/oe,ve=(G+0)/oe,we=(G+1)/oe,Me=Go(se,ve,this.dem)*d,Ce=Go(ae,ve,this.dem)*d,ye=Go(ae,we,this.dem)*d,Se=Go(se,we,this.dem)*d,Pe=Bf(v[0],v[1],Me,w[0],v[1],Ce,w[0],w[1],ye,c,h),Ve=Bf(w[0],w[1],ye,v[0],w[1],Se,v[0],v[1],Me,c,h),Le=Math.min(Pe!==null?Pe:Number.MAX_VALUE,Ve!==null?Ve:Number.MAX_VALUE);if(Le!==Number.MAX_VALUE)return Le;{const Oe=Vh([],c,h,L);if(Uf(Me,Ce,Se,ye,Rf(Oe[0],v[0],w[0]),Rf(Oe[1],v[1],w[1]))>=Oe[2])return L}continue}let re=0;for(let oe=0;oe<this._siblingOffset.length;oe++){Ff((F<<1)+this._siblingOffset[oe][0],(G<<1)+this._siblingOffset[oe][1],Q+1,e,r,n,s,v,w),v[2]=-100,w[2]=this.maximums[this.childOffsets[z]+oe]*d;const se=Lf(v,w,c,h);if(se!=null){const ae=se;g[oe]=ae;let ve=!1;for(let we=0;we<re&&!ve;we++)ae>=g[x[we]]&&(x.splice(we,0,oe),ve=!0);ve||(x[re]=oe),re++}}for(let oe=0;oe<re;oe++){const se=x[oe];S.push({idx:this.childOffsets[z]+se,t:g[se],nodex:(F<<1)+this._siblingOffset[se][0],nodey:(G<<1)+this._siblingOffset[se][1],depth:Q+1})}}return null}_addNode(e,r,n){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,n,s,c){if(e[s].isLeaf(r,n)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const h=s-1,d=e[h];let m=0,g=0;for(let x=0;x<this._siblingOffset.length;x++){const v=2*r+this._siblingOffset[x][0],w=2*n+this._siblingOffset[x][1],S=d.getElevation(v,w),z=d.isLeaf(v,w),L=this._addNode(S.min,S.max,z);z&&(m|=1<<x),g||(g=L)}for(let x=0;x<this._siblingOffset.length;x++)m&1<<x||this._construct(e,2*r+this._siblingOffset[x][0],2*n+this._siblingOffset[x][1],h,g+x)}}function Uf(i,e,r,n,s,c){return at(at(i,r,c),at(e,n,c),s)}function Go(i,e,r){const n=r.dim,s=qe(i*n-.5,0,n-1),c=qe(e*n-.5,0,n-1),h=Math.floor(s),d=Math.floor(c),m=Math.min(h+1,n-1),g=Math.min(d+1,n-1);return Uf(r.get(h,d),r.get(m,d),r.get(h,g),r.get(m,g),s-h,c-d)}const Vf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Uu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,n,s=!1,c=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return Lt(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const h=this.dim=r.height-2,d=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=n||"mapbox",this.borderReady=s,!s){for(let m=0;m<h;m++)d[this._idx(-1,m)]=d[this._idx(0,m)],d[this._idx(h,m)]=d[this._idx(h-1,m)],d[this._idx(m,-1)]=d[this._idx(m,0)],d[this._idx(m,h)]=d[this._idx(m,h-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(h,-1)]=d[this._idx(h-1,0)],d[this._idx(-1,h)]=d[this._idx(0,h-1)],d[this._idx(h,h)]=d[this._idx(h-1,h-1)],c&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Of(this)}get(e,r,n=!1){n&&(e=qe(e,-1,this.dim),r=qe(r,-1,this.dim));const s=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[s],this.pixels[s+1],this.pixels[s+2])}static getUnpackVector(e){return Vf[e]}get unpackVector(){return Vf[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,n){return(256*e*256+256*r+n)/10-1e4}_unpackTerrarium(e,r,n){return 256*e+r+n/256-32768}static pack(e,r){const n=[0,0,0,0],s=Uu.getUnpackVector(r);let c=Math.floor((e+s[3])/s[2]);return n[2]=c%256,c=Math.floor(c/256),n[1]=c%256,c=Math.floor(c/256),n[0]=c,n}getPixels(){return new _r({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=r*this.dim,c=r*this.dim+this.dim,h=n*this.dim,d=n*this.dim+this.dim;switch(r){case-1:s=c-1;break;case 1:c=s+1}switch(n){case-1:h=d-1;break;case 1:d=h+1}const m=-r*this.dim,g=-n*this.dim;for(let x=h;x<d;x++)for(let v=s;v<c;v++){const w=4*this._idx(v,x),S=4*this._idx(v+m,x+g);this.pixels[w+0]=e.pixels[S+0],this.pixels[w+1]=e.pixels[S+1],this.pixels[w+2]=e.pixels[S+2],this.pixels[w+3]=e.pixels[S+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ze(Uu,"DEMData"),Ze(Of,"DemMinMaxQuadTree",{omit:["dem"]});class xy{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,n){const s=e.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);const c={value:r,timeout:void 0};if(n!==void 0&&(c.timeout=setTimeout(()=>{this.remove(e,c)},n)),this.data[s].push(c),this.order.push(s),this.order.length>this.max){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const n=e.wrapped().key,s=r===void 0?0:this.data[n].indexOf(r),c=this.data[n][s];return this.data[n].splice(s,1),c.timeout&&clearTimeout(c.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(c.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const n in this.data)for(const s of this.data[n])e(s.value)||r.push(s);for(const n of r)this.remove(n.value.tileID,n)}}class Va{constructor(e,r,n){this.func=e,this.mask=r,this.range=n}}Va.ReadOnly=!1,Va.ReadWrite=!0,Va.disabled=new Va(519,Va.ReadOnly,[0,1]);const gd=7680;class yd{constructor(e,r,n,s,c,h){this.test=e,this.ref=r,this.mask=n,this.fail=s,this.depthFail=c,this.pass=h}}yd.disabled=new yd({func:519,mask:0},0,0,gd,gd,gd);class An{constructor(e,r,n){this.blendFunction=e,this.blendColor=r,this.mask=n}}An.Replace=[1,0],An.disabled=new An(An.Replace,Vt.transparent,[!1,!1,!1,!1]),An.unblended=new An(An.Replace,Vt.transparent,[!0,!0,!0,!0]),An.alphaBlended=new An([1,771],Vt.transparent,[!0,!0,!0,!0]);const xd=1029,vd=2305;class rn{constructor(e,r,n){this.enable=e,this.mode=r,this.frontFace=n}}rn.disabled=new rn(!1,xd,vd),rn.backCCW=new rn(!0,xd,vd),rn.backCW=new rn(!0,xd,2304),rn.frontCW=new rn(!0,1028,2304),rn.frontCCW=new rn(!0,1028,vd);class Ls extends ht{constructor(e,r,n){super(),this.id=e,this._onlySymbols=n,r.on("data",s=>{s.dataType==="source"&&s.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&s.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new xy(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new yy,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const r in this._tiles){const n=this._tiles[r];this._source.prepareTile(n)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,n.tileID),n.upload(e),n.prepare(this.map.style.imageManager)}else for(const r in this._tiles){const n=this._tiles[r];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Ft(this._tiles).map(e=>e.tileID).sort(Nf).map(e=>e.key)}getRenderableIds(e){const r=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&r.push(this._tiles[n]);return e?r.sort((n,s)=>{const c=n.tileID,h=s.tileID,d=new H(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),m=new H(h.canonical.x,h.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-h.overscaledZ||m.y-d.y||m.x-d.x}).map(n=>n.tileID.key):r.map(n=>n.tileID).sort(Nf).map(n=>n.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=r),this._loadTile(n,this._tileLoaded.bind(this,n,e,r)))}_tileLoaded(e,r,n,s){if(s)if(e.state="errored",s.status!==404)this._source.fire(new ot(s,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=$i.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new nt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let s=0;s<r.length;s++){const c=r[s];if(e.neighboringTiles&&e.neighboringTiles[c]){const h=this.getTileByID(c);n(e,h),n(h,e)}}function n(s,c){if(!s.dem||s.dem.borderReady)return;s.needsHillshadePrepare=!0,s.needsDEMTextureUpload=!0;let h=c.tileID.canonical.x-s.tileID.canonical.x;const d=c.tileID.canonical.y-s.tileID.canonical.y,m=Math.pow(2,s.tileID.canonical.z),g=c.tileID.key;h===0&&d===0||Math.abs(d)>1||(Math.abs(h)>1&&(Math.abs(h+m)===1?h+=m:Math.abs(h-m)===1&&(h-=m)),c.dem&&s.dem&&(s.dem.backfillBorder(c.dem,h,d),s.neighboringTiles&&s.neighboringTiles[g]&&(s.neighboringTiles[g].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,n,s){for(const c in this._tiles){let h=this._tiles[c];if(s[c]||!h.hasData()||h.tileID.overscaledZ<=r||h.tileID.overscaledZ>n)continue;let d=h.tileID;for(;h&&h.tileID.overscaledZ>r+1;){const g=h.tileID.scaledTo(h.tileID.overscaledZ-1);h=this._tiles[g.key],h&&h.hasData()&&(d=g)}let m=d;for(;m.overscaledZ>r;)if(m=m.scaledTo(m.overscaledZ-1),e[m.key]){s[d.key]=d;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=r?n:null}for(let n=e.overscaledZ-1;n>=r;n--){const s=e.scaledTo(n),c=this._getLoadedTile(s);if(c)return c}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const n=Math.ceil(e.width/r)+1,s=Math.ceil(e.height/r)+1,c=Math.floor(n*s*5),h=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,c):c,d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(d)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const n={};for(const s in this._tiles){const c=this._tiles[s];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+r),n[c.tileID.key]=c}this._tiles=n;for(const s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(const s in this._tiles)this._setTileReloadTimer(+s,this._tiles[s])}}update(e,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let s;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?s=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(d=>new Wi(d.canonical.z,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y)):(s=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(s=s.filter(d=>this._source.hasTile(d)))):s=[];const c=this._updateRetainedTiles(s);if(jf(this._source.type)&&s.length!==0){const d={},m={},g=Object.keys(c);for(const v of g){const w=c[v],S=this._tiles[v];if(!S||S.fadeEndTime&&S.fadeEndTime<=$i.now())continue;const z=this.findLoadedParent(w,Math.max(w.overscaledZ-Ls.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),d[z.tileID.key]=z.tileID),m[v]=w}const x=s[s.length-1].overscaledZ;for(const v in this._tiles){const w=this._tiles[v];if(c[v]||!w.hasData())continue;let S=w.tileID;for(;S.overscaledZ>x;){S=S.scaledTo(S.overscaledZ-1);const z=this._tiles[S.key];if(z&&z.hasData()&&m[S.key]){c[v]=w.tileID;break}}}for(const v in d)c[v]||(this._coveredTiles[v]=!0,c[v]=d[v])}for(const d in c)this._tiles[d].clearFadeHold();const h=function(d,m){const g=[];for(const x in d)x in m||g.push(x);return g}(this._tiles,c);for(const d of h){const m=this._tiles[d];m.hasSymbolBuckets&&!m.holdingForFade()?m.setHoldDuration(this.map._fadeDuration):m.hasSymbolBuckets&&!m.symbolFadeFinished()||this._removeTile(+d)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const n={},s=e.reduce((g,x)=>Math.min(g,x.overscaledZ),1/0),c=e[0].overscaledZ,h=Math.max(c-Ls.maxOverzooming,this._source.minzoom),d=Math.max(c+Ls.maxUnderzooming,this._source.minzoom),m={};for(const g of e){const x=this._addTile(g);r[g.key]=g,x.hasData()||s<this._source.maxzoom&&(m[g.key]=g)}this._retainLoadedChildren(m,s,d,r);for(const g of e){let x=this._tiles[g.key];if(x.hasData())continue;if(g.canonical.z>=this._source.maxzoom){const w=g.children(this._source.maxzoom)[0],S=this.getTile(w);if(S&&S.hasData()){r[w.key]=w;continue}}else{const w=g.children(this._source.maxzoom);if(r[w[0].key]&&r[w[1].key]&&r[w[2].key]&&r[w[3].key])continue}let v=x.wasRequested();for(let w=g.overscaledZ-1;w>=h;--w){const S=g.scaledTo(w);if(n[S.key]||(n[S.key]=!0,x=this.getTile(S),!x&&v&&(x=this._addTile(S)),x&&(r[S.key]=S,v=x.wasRequested(),x.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let n,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){n=this._loadedParentTiles[s.key];break}r.push(s.key);const c=s.scaledTo(s.overscaledZ-1);if(n=this._getLoadedTile(c),n)break;s=c}for(const c of r)this._loadedParentTiles[c]=n}}_addTile(e){let r=this._tiles[e.key];if(r)return this._source.prepareTile&&this._source.prepareTile(r),r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const n=Boolean(r);if(!n){const s=this.map?this.map.painter:null;r=new _d(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,s,this._isRaster),this._source.prepareTile&&this._source.prepareTile(r)||this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new nt("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=r.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,n){const s=[],c=this.transform;if(!c)return s;for(const h in this._tiles){const d=this._tiles[h];if(n&&d.clearQueryDebugViz(),d.holdingForFade())continue;const m=e.containsTile(d,c,r);m&&s.push(m)}return s}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of r)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(jf(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=$i.now())return!0}return!1}setFeatureState(e,r,n){this._state.updateState(e=e||"_geojsonTileLayer",r,n)}removeFeatureState(e,r,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,n)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,n){const s=this._tiles[e];s&&s.setDependencies(r,n)}reloadTilesForDependencies(e,r){for(const n in this._tiles)this._tiles[n].hasDependency(e,r)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,r))}_preloadTiles(e,r){const n=new Map,s=Array.isArray(e)?e:[e],c=this.map.painter.terrain,h=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const d of s){const m=d.coveringTiles({tileSize:h,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const g of m)n.set(g.key,g);this.usedForTerrain&&d.updateElevation(!1)}It(Array.from(n.values()),(d,m)=>{const g=new _d(d,this._source.tileSize*d.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(g,x=>{this._source.type==="raster-dem"&&g.dem&&this._backfillDEM(g),m(x,g)})},r)}}function Nf(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||n-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function jf(i){return i==="raster"||i==="image"||i==="video"}Ls.maxOverzooming=10,Ls.maxUnderzooming=3;class Vu{constructor(e,r,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=n}static create(e,r,n){const s=n||e.findDEMTileFor(r);if(!s||!s.dem)return;const c=s.dem,h=s.tileID,d=1<<r.canonical.z-h.canonical.z;return new Vu(s,s.tileSize/wt/d,[(r.canonical.x/d-h.canonical.x)*c.dim,(r.canonical.y/d-h.canonical.y)*c.dim])}tileCoordToPixel(e,r){const n=r*this._scale+this._offset[1],s=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(n);return new H(s,c)}getElevationAt(e,r,n,s){const c=e*this._scale+this._offset[0],h=r*this._scale+this._offset[1],d=Math.floor(c),m=Math.floor(h),g=this._dem;return s=!!s,n?at(at(g.get(d,m,s),g.get(d,m+1,s),h-m),at(g.get(d+1,m,s),g.get(d+1,m+1,s),h-m),c-d):g.get(d,m,s)}getElevationAtPixel(e,r,n){return this._dem.get(e,r,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ia(1,e)*this._dem.stride}}class Gf{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new vn(wt,16,0),this.featureIndexArray=new ui,this.promoteId=r}insert(e,r,n,s,c,h=0){const d=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,s,c,h);const m=this.grid;for(let g=0;g<r.length;g++){const x=r[g],v=[1/0,1/0,-1/0,-1/0];for(let w=0;w<x.length;w++){const S=x[w];v[0]=Math.min(v[0],S.x),v[1]=Math.min(v[1],S.y),v[2]=Math.max(v[2],S.x),v[3]=Math.max(v[3],S.y)}v[0]<wt&&v[1]<wt&&v[2]>=0&&v[3]>=0&&m.insert(d,v[0],v[1],v[2],v[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ps.VectorTile(new Jl(this.rawTileData)).layers,this.sourceLayerCoder=new Af(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,n,s){this.loadVTLayers();const c=e.params||{},h=gn(c.filter),d=e.tileResult,m=e.transform,g=d.bufferedTilespaceBounds,x=this.grid.query(g.min.x,g.min.y,g.max.x,g.max.y,(z,L,F,G)=>cp(d.bufferedTilespaceGeometry,z,L,F,G));x.sort(vy);let v=null;m.elevation&&x.length>0&&(v=Vu.create(m.elevation,this.tileID));const w={};let S;for(let z=0;z<x.length;z++){const L=x[z];if(L===S)continue;S=L;const F=this.featureIndexArray.get(L);let G=null;this.loadMatchingFeature(w,F,h,c.layers,c.availableImages,r,n,s,(Q,re,oe,se=0)=>(G||(G=ro(Q,this.tileID.canonical,e.tileTransform)),re.queryIntersectsFeature(d,Q,oe,G,this.z,e.transform,e.pixelPosMatrix,v,se)))}return w}loadMatchingFeature(e,r,n,s,c,h,d,m,g){const{featureIndex:x,bucketIndex:v,sourceLayerIndex:w,layoutVertexArrayOffset:S}=r,z=this.bucketLayerIDs[v];if(s&&!function(Q,re){for(let oe=0;oe<Q.length;oe++)if(re.indexOf(Q[oe])>=0)return!0;return!1}(s,z))return;const L=this.sourceLayerCoder.decode(w),F=this.vtLayers[L].feature(x);if(n.needGeometry){const Q=Cs(F,!0);if(!n.filter(new ti(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!n.filter(new ti(this.tileID.overscaledZ),F))return;const G=this.getId(F,L);for(let Q=0;Q<z.length;Q++){const re=z[Q];if(s&&s.indexOf(re)<0)continue;const oe=h[re];if(!oe)continue;let se={};G!==void 0&&m&&(se=m.getState(oe.sourceLayer||"_geojsonTileLayer",G));const ae=tt({},d[re]);ae.paint=$f(ae.paint,oe.paint,F,se,c),ae.layout=$f(ae.layout,oe.layout,F,se,c);const ve=!g||g(F,oe,se,S);if(!ve)continue;const we=new Cf(F,this.z,this.x,this.y,G);we.layer=ae;let Me=e[re];Me===void 0&&(Me=e[re]=[]),Me.push({featureIndex:x,feature:we,intersectionZ:ve})}}lookupSymbolFeatures(e,r,n,s,c,h,d,m){const g={};this.loadVTLayers();const x=gn(c);for(const v of e)this.loadMatchingFeature(g,{bucketIndex:n,sourceLayerIndex:s,featureIndex:v,layoutVertexArrayOffset:0},x,h,d,m,r);return g}loadFeature(e){const{featureIndex:r,sourceLayerIndex:n}=e;this.loadVTLayers();const s=this.sourceLayerCoder.decode(n),c=this.vtFeatures[s];if(c[r])return c[r];const h=this.vtLayers[s].feature(r);return c[r]=h,h}hasLayer(e){for(const r of this.bucketLayerIDs)for(const n of r)if(e===n)return!0;return!1}getId(e,r){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof n=="boolean"&&(n=Number(n))),n}}function $f(i,e,r,n,s){return vi(i,(c,h)=>{const d=e instanceof f?e.get(h):null;return d&&d.evaluate?d.evaluate(r,n,s):d})}function vy(i,e){return e-i}Ze(Gf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Zf{constructor(e){const r={},n=[];for(const d in e){const m=e[d],g=r[d]={};for(const x in m.glyphs){const v=m.glyphs[+x];if(!v||v.bitmap.width===0||v.bitmap.height===0)continue;const w=v.metrics.localGlyph?2:1,S={x:0,y:0,w:v.bitmap.width+2*w,h:v.bitmap.height+2*w};n.push(S),g[x]=S}}const{w:s,h:c}=Jh(n),h=new no({width:s||1,height:c||1});for(const d in e){const m=e[d];for(const g in m.glyphs){const x=m.glyphs[+g];if(!x||x.bitmap.width===0||x.bitmap.height===0)continue;const v=r[d][g],w=x.metrics.localGlyph?2:1;no.copy(x.bitmap,h,{x:0,y:0},{x:v.x+w,y:v.y+w},x.bitmap)}}this.image=h,this.positions=r}}Ze(Zf,"GlyphAtlas");class by{constructor(e){this.tileID=new Wi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ds(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,n,s,c){this.status="parsing",this.data=e,this.collisionBoxArray=new Jr;const h=new Af(Object.keys(e.layers).sort()),d=new Gf(this.tileID,this.promoteId);d.bucketLayerIDs=[];const m={},g=new dd(256,256),x={featureIndex:d,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:g,availableImages:n},v=r.familiesBySource[this.source];for(const se in v){const ae=e.layers[se];if(!ae)continue;let ve=!1,we=!1;for(const ye of v[se])ye[0].type==="symbol"?ve=!0:we=!0;if(this.isSymbolTile===!0&&!ve||this.isSymbolTile===!1&&!we)continue;ae.version===1&&Lt(`Vector tile source "${this.source}" layer "${se}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Me=h.encode(se),Ce=[];for(let ye=0;ye<ae.length;ye++){const Se=ae.feature(ye),Pe=d.getId(Se,se);Ce.push({feature:Se,id:Pe,index:ye,sourceLayerIndex:Me})}for(const ye of v[se]){const Se=ye[0];this.isSymbolTile!==void 0&&Se.type==="symbol"!==this.isSymbolTile||Se.minzoom&&this.zoom<Math.floor(Se.minzoom)||Se.maxzoom&&this.zoom>=Se.maxzoom||Se.visibility!=="none"&&(bd(ye,this.zoom,n),(m[Se.id]=Se.createBucket({index:d.bucketLayerIDs.length,layers:ye,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Me,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:n})).populate(Ce,x,this.tileID.canonical,this.tileTransform),d.bucketLayerIDs.push(ye.map(Pe=>Pe.id)))}}let w,S,z,L;g.trim();const F={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},G=vi(x.glyphDependencies,se=>Object.keys(se).map(Number));Object.keys(G).length?s.send("getGlyphs",{uid:this.uid,stacks:G},(se,ae)=>{w||(w=se,S=ae,oe.call(this))},void 0,!1,F):S={};const Q=Object.keys(x.iconDependencies);Q.length?s.send("getImages",{icons:Q,source:this.source,tileID:this.tileID,type:"icons"},(se,ae)=>{w||(w=se,z=ae,oe.call(this))},void 0,!1,F):z={};const re=Object.keys(x.patternDependencies);function oe(){if(w)return c(w);if(S&&z&&L){const se=new Zf(S),ae=new Hp(z,L);for(const ve in m){const we=m[ve];we instanceof Vo?(bd(we.layers,this.zoom,n),Hg(we,S,se.positions,z,ae.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):we.hasPattern&&(we instanceof Mu||we instanceof Su||we instanceof Hl)&&(bd(we.layers,this.zoom,n),we.addFeatures(x,this.tileID.canonical,ae.patternPositions,n,this.tileTransform))}this.status="done",c(null,{buckets:Ft(m).filter(ve=>!ve.isEmpty()),featureIndex:d,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:se.image,lineAtlas:g,imageAtlas:ae,glyphMap:this.returnDependencies?S:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?se.positions:null})}}re.length?s.send("getImages",{icons:re,source:this.source,tileID:this.tileID,type:"patterns"},(se,ae)=>{w||(w=se,L=ae,oe.call(this))},void 0,!1,F):L={},oe.call(this)}}function bd(i,e,r){const n=new ti(e);for(const s of i)s.recalculate(n,r)}class qf{constructor(e){this.entries={},this.scheduler=e}request(e,r,n,s){const c=this.entries[e]=this.entries[e]||{callbacks:[]};if(c.result){const[h,d]=c.result;return this.scheduler?this.scheduler.add(()=>{s(h,d)},r):s(h,d),()=>{}}return c.callbacks.push(s),c.cancel||(c.cancel=n((h,d)=>{c.result=[h,d];for(const m of c.callbacks)this.scheduler?this.scheduler.add(()=>{m(h,d)},r):m(h,d);setTimeout(()=>delete this.entries[e],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(h=>h!==s),c.callbacks.length||(c.cancel(),delete this.entries[e]))}}}function Wf(i,e,r){const n=JSON.stringify(i.request);return i.data&&(this.deduped.entries[n]={result:[null,i.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},s=>{const c=Y(i.request,(h,d,m,g)=>{h?s(h):d&&s(null,{vectorTile:r?void 0:new Ps.VectorTile(new Jl(d)),rawData:d,cacheControl:m,expires:g})});return()=>{c.cancel(),s()}},e)}const wy=En(new Float32Array(16));class $o{constructor(e){this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Ht(0,0)}projectTilePoint(e,r,n){return{x:e,y:r,z:0}}locationPoint(e,r){return e._coordinatePoint(e.locationCoordinate(r),!1)}pixelsPerMeter(e,r){return Ia(1,e)*r}farthestPixelDistance(e){return function(r,n){const s=r.fovAboveCenter,c=r.elevation?r.elevation.getMinElevationBelowMSL()*n:0,h=(r._camera.position[2]*r.worldSize-c)/Math.cos(r._pitch),d=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-r._pitch-s,.01)),m=Math.sin(r._pitch)*d+h;return Math.min(1.01*m,h*(1/r._horizonShift))}(e,e.pixelsPerMeter)}pointCoordinate(e,r,n,s){const c=e.horizonLineFromTop(!1),h=new H(r,Math.max(c,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,s))}createInversionMatrix(e,r){return wy}createTileMatrix(e,r,n){let s,c,h;const d=n.canonical,m=En(new Float64Array(16));if(this.isReprojectedInTileSpace){const g=Ds(d,this);s=1,c=g.x+n.wrap*g.scale,h=g.y,Fo(m,m,[s/g.scale,s/g.scale,e.pixelsPerMeter/r])}else s=r/e.zoomScale(d.z),c=(d.x+Math.pow(2,d.z)*n.wrap)*s,h=d.y*s;return zs(m,m,[c,h,0]),Fo(m,m,[s/wt,s/wt,1]),m}upVector(e,r,n){return[0,0,1]}upVectorScale(e,r,n){return{metersToTile:1,metersToLabelSpace:1}}}class Ty extends $o{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Fl(e),y:Sa(r),z:0}}unproject(e,r){const n=Ur(e),s=Ui(r);return new Ht(n,s)}}class Ey extends $o{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,n]=this.parallels=e.parallels||[29.5,45.5],s=Math.sin(Ue(r));this.n=(s+Math.sin(Ue(n)))/2,this.c=1+s*(2*this.n-s),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n,c:s,r0:c}=this,h=Ue(e-this.center[0]),d=Ue(r),m=Math.sqrt(s-2*n*Math.sin(d))/n;return{x:m*Math.sin(h*n),y:m*Math.cos(h*n)-c,z:0}}unproject(e,r){const{n,c:s,r0:c}=this,h=c+r;let d=Math.atan2(e,Math.abs(h))*Math.sign(h);h*n<0&&(d-=Math.PI*Math.sign(e)*Math.sign(h));const m=Ue(this.center[0])*n;d=vt(d,-Math.PI-m,Math.PI-m);const g=pt(d/n)+this.center[0],x=Math.asin(qe((s-(e*e+h*h)*n*n)/(2*n),-1,1)),v=qe(pt(x),-85.051129,Tn);return new Ht(g,v)}}const oc=1.340264,sc=-.081106,ac=893e-6,lc=.003796,Nu=Math.sqrt(3)/2;class Sy extends $o{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Nu*Math.sin(r)),s=n*n,c=s*s*s;return{x:.5*(e*Math.cos(n)/(Nu*(oc+3*sc*s+c*(7*ac+9*lc*s)))/Math.PI+.5),y:1-.5*(n*(oc+sc*s+c*(ac+lc*s))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,s=n*n,c=s*s*s;for(let x,v,w,S=0;S<12&&(v=n*(oc+sc*s+c*(ac+lc*s))-r,w=oc+3*sc*s+c*(7*ac+9*lc*s),x=v/w,n=qe(n-x,-Math.PI/3,Math.PI/3),s=n*n,c=s*s*s,!(Math.abs(x)<1e-12));++S);const h=Nu*e*(oc+3*sc*s+c*(7*ac+9*lc*s))/Math.cos(n),d=Math.asin(Math.sin(n)/Nu),m=qe(180*h/Math.PI,-180,180),g=qe(180*d/Math.PI,-85.051129,Tn);return new Ht(m,g)}}class Iy extends $o{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const n=360*(e-.5),s=qe(360*(.5-r),-85.051129,Tn);return new Ht(n,s)}}const Na=Math.PI/2;function ju(i){return Math.tan((Na+i)/2)}class My extends $o{constructor(e){super(e),this.center=e.center||[0,30];const[r,n]=this.parallels=e.parallels||[30,30],s=Ue(r),c=Ue(n),h=Math.cos(s);this.n=s===c?Math.sin(s):Math.log(h/Math.cos(c))/Math.log(ju(c)/ju(s)),this.f=h*Math.pow(ju(s),this.n)/this.n}project(e,r){r=Ue(r),e=Ue(e-this.center[0]);const n=1e-6,{n:s,f:c}=this;c>0?r<-Na+n&&(r=-Na+n):r>Na-n&&(r=Na-n);const h=c/Math.pow(ju(r),s),d=h*Math.sin(s*e),m=c-h*Math.cos(s*e);return{x:.5*(d/Math.PI+.5),y:1-.5*(m/Math.PI+.5),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;const{n,f:s}=this,c=s-r,h=Math.sign(c),d=Math.sign(n)*Math.sqrt(e*e+c*c);let m=Math.atan2(e,Math.abs(c))*h;c*n<0&&(m-=Math.PI*Math.sign(e)*h);const g=qe(pt(m/n)+this.center[0],-180,180),x=qe(pt(2*Math.atan(Math.pow(s/d,1/n))-Na),-85.051129,Tn);return new Ht(g,x)}}const Xf=Ue(Tn);class Ay extends $o{project(e,r){const n=(r=Ue(r))*r,s=n*n;return{x:.5*((e=Ue(e))*(.8707-.131979*n+s*(s*(.003971*n-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+n*(.015085+s*(.028874*n-.044475-.005916*s)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,s=25,c=0,h=n*n;do{h=n*n;const g=h*h;c=(n*(1.007226+h*(.015085+g*(.028874*h-.044475-.005916*g)))-r)/(1.007226+h*(.045255+g*(.259866*h-.311325-.005916*11*g))),n=qe(n-c,-Xf,Xf)}while(Math.abs(c)>1e-6&&--s>0);h=n*n;const d=qe(pt(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),m=pt(n);return new Ht(d,m)}}const Hf=Ue(Tn);class Cy extends $o{project(e,r){r=Ue(r),e=Ue(e);const n=Math.cos(r),s=2/Math.PI,c=Math.acos(n*Math.cos(e/2)),h=Math.sin(c)/c,d=.5*(e*s+2*n*Math.sin(e/2)/h)||0,m=.5*(r+Math.sin(r)/h)||0;return{x:.5*(d/Math.PI+.5),y:1-.5*(m/Math.PI+1),z:0}}unproject(e,r){let n=e=(2*e-.5)*Math.PI,s=r=(2*(1-r)-1)*Math.PI,c=25;const h=1e-6;let d=0,m=0;do{const g=Math.cos(s),x=Math.sin(s),v=2*x*g,w=x*x,S=g*g,z=Math.cos(n/2),L=Math.sin(n/2),F=2*z*L,G=L*L,Q=1-S*z*z,re=Q?1/Q:0,oe=Q?Math.acos(g*z)*Math.sqrt(1/Q):0,se=.5*(2*oe*g*L+2*n/Math.PI)-e,ae=.5*(oe*x+s)-r,ve=.5*re*(S*G+oe*g*z*w)+1/Math.PI,we=re*(F*v/4-oe*x*L),Me=.125*re*(v*L-oe*x*S*F),Ce=.5*re*(w*z+oe*G*g)+.5,ye=we*Me-Ce*ve;d=(ae*we-se*Ce)/ye,m=(se*Me-ae*ve)/ye,n=qe(n-d,-Math.PI,Math.PI),s=qe(s-m,-Hf,Hf)}while((Math.abs(d)>h||Math.abs(m)>h)&&--c>0);return new Ht(pt(n),pt(s))}}class Yf extends $o{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ue(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:n,cosPhi:s}=this;return{x:Ue(e)*s*n+.5,y:-Math.sin(Ue(r))/s*n+.5,z:0}}unproject(e,r){const{scale:n,cosPhi:s}=this,c=-(r-.5)/n,h=qe(pt((e-.5)/n)/s,-180,180),d=Math.asin(qe(c*s,-1,1)),m=qe(pt(d),-85.051129,Tn);return new Ht(h,m)}}a.ARRAY_TYPE=mr,a.AUTH_ERR_MSG=Un,a.Aabb=Dr,a.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},si(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Er()?i:_e,this.scheduler=new cy}send(i,e,r,n,s=!1,c){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=c,this.callbacks[h]=r);const d=ln(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:i,hasCallback:!!r,targetMapId:n,mustQueue:s,sourceMapId:this.mapId,data:vs(e,d)},d),{cancel:()=>{r&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n.cancel()}else if(e.mustQueue||Er()){const n=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),n&&n.metadata||{type:"message"})}else this.processTask(r,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Co(e.error)):r(null,Co(e.data)))}else{const r=ln(this.globalScope)?void 0:[],n=e.hasCallback?(c,h)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:c?vs(c):null,data:vs(h,r)},r)}:c=>{},s=Co(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,s,n);else if(this.parent.getWorkerSource){const c=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,c[0],s.source)[c[1]](s,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Fu,a.Color=Vt,a.ColorMode=An,a.CullFaceMode=rn,a.DEMData=Uu,a.DataConstantProperty=_,a.DedupedRequest=qf,a.DepthMode=Va,a.EXTENT=wt,a.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const r=e.getSource().maxzoom,n=1<<r,s=Math.floor(i.x),c=Math.floor((i.x-s)*n),h=Math.floor(i.y*n),d=this.findDEMTileFor(new Wi(r,s,r,c,h));return!(!d||!d.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,r=!0){e==null&&(e=null);const n=this._source();if(!n||i.y<0||i.y>1)return e;const s=n.getSource().maxzoom,c=1<<s,h=Math.floor(i.x),d=i.x-h,m=new Wi(s,h,s,Math.floor(d*c),Math.floor(i.y*c)),g=this.findDEMTileFor(m);if(!g||!g.dem)return e;const x=g.dem,v=1<<g.tileID.canonical.z,w=(d*v-g.tileID.canonical.x)*x.dim,S=(i.y*v-g.tileID.canonical.y)*x.dim,z=Math.floor(w),L=Math.floor(S);return(r?this.exaggeration():1)*at(at(x.get(z,L),x.get(z,L+1),S-L),at(x.get(z+1,L),x.get(z+1,L+1),S-L),w-z)}getAtTileOffset(i,e,r){const n=1<<i.canonical.z;return this.getAtPointOrZero(new _u(i.wrap+(i.canonical.x+e/wt)/n,(i.canonical.y+r/wt)/n))}getAtTileOffsetFunc(i,e,r,n){return s=>{const c=this.getAtTileOffset(i,s.x,s.y),h=n.upVector(i.canonical,s.x,s.y);return Ul(h,h,c*n.upVectorScale(i.canonical,e,r).metersToTile),h}}getForTilePoints(i,e,r,n){const s=Vu.create(this,i,n);return!!s&&(e.forEach(c=>{c[2]=this.exaggeration()*s.getElevationAt(c[0],c[1],r)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const r=e.dem.tree,n=e.tileID,s=1<<i.canonical.z-n.canonical.z;let c=i.canonical.x/s-n.canonical.x,h=i.canonical.y/s-n.canonical.y,d=0;for(let m=0;m<i.canonical.z-n.canonical.z&&!r.leaves[d];m++){c*=2,h*=2;const g=2*Math.floor(h)+Math.floor(c);d=r.childOffsets[d]+g,c%=1,h%=1}return{min:this.exaggeration()*r.minimums[d],max:this.exaggeration()*r.maximums[d]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=ot,a.EvaluationParameters=ti,a.Event=nt,a.Evented=ht,a.FillExtrusionBucket=Hl,a.Frustum=Nh,a.GLOBE_RADIUS=Ua,a.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i),this._createAtmosphere(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(i){const e=new q,r=new Xe,n=65;for(let s=0;s<n;s++)for(let c=0;c<n;c++)e.emplaceBack(c,s);for(let s=0;s<64;s++)for(let c=0;c<64;c++){const h=s*n+c;r.emplaceBack(h+1,h,h+n),r.emplaceBack(h+n,h+n+1,h+1)}this._gridBuffer=i.createVertexBuffer(e,ic.members),this._gridIndexBuffer=i.createIndexBuffer(r,!0),this._gridSegments=_i.simpleSegment(0,0,4225,8192)}_createPoles(i){const e=new Xe;for(let s=0;s<=64;s++)e.emplaceBack(0,s+1,s+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const r=new ct,n=new ct;this._poleSegments=[];for(let s=0,c=0;s<5;s++){const h=1<<s,d=512*h/Math.PI/2,m=360/h;r.emplaceBack(0,-d,0,0,0,.5,0),n.emplaceBack(0,-d,0,0,0,.5,1);for(let g=0;g<=64;g++){const x=g/64,v=at(0,m,x),[w,S,z]=vf(my,_y,v,d);r.emplaceBack(w,S,z,0,0,x,0),n.emplaceBack(w,S,z,0,0,x,1)}this._poleSegments.push(_i.simpleSegment(c,0,66,64)),c+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(r,yf,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(n,yf,!1)}_createAtmosphere(i){const e=new Tt;e.emplaceBack(-1,1,1,0,0),e.emplaceBack(1,1,1,1,0),e.emplaceBack(1,-1,1,1,1),e.emplaceBack(-1,-1,1,0,1);const r=new Xe;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.atmosphereVertexBuffer=i.createVertexBuffer(e,hy.members),this.atmosphereIndexBuffer=i.createIndexBuffer(r),this.atmosphereSegments=_i.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i){if(!this._wireframeSegments){const e=new dt,r=64,n=r+1;for(let s=0;s<r;s++)for(let c=0;c<r;c++){const h=s*n+c;e.emplaceBack(h,h+1),e.emplaceBack(h,h+n),e.emplaceBack(h,h+n+1)}this._wireframeIndexBuffer=i.createIndexBuffer(e),this._wireframeSegments=_i.simpleSegment(0,0,r*r,e.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},a.GlyphManager=Fa,a.ImagePosition=Qh,a.LineAtlas=dd,a.LngLat=Ht,a.LngLatBounds=Ro,a.LocalGlyphMode=rd,a.MAX_MERCATOR_LATITUDE=Tn,a.MercatorCoordinate=_u,a.ONE_EM=Vi,a.OverscaledTileID=Wi,a.Properties=A,a.RGBAImage=_r,a.Ray=class{constructor(i,e){this.pos=i,this.dir=e}intersectsPlane(i,e,r){const n=Nl(e,this.dir);if(Math.abs(n)<1e-6)return!1;const s=((i[0]-this.pos[0])*e[0]+(i[1]-this.pos[1])*e[1]+(i[2]-this.pos[2])*e[2])/n;return r[0]=this.pos[0]+this.dir[0]*s,r[1]=this.pos[1]+this.dir[1]*s,r[2]=this.pos[2]+this.dir[2]*s,!0}closestPointOnSphere(i,e,r){if(function(w,S){var z=w[0],L=w[1],F=w[2],G=S[0],Q=S[1],re=S[2];return Math.abs(z-G)<=Dh*Math.max(1,Math.abs(z),Math.abs(G))&&Math.abs(L-Q)<=Dh*Math.max(1,Math.abs(L),Math.abs(Q))&&Math.abs(F-re)<=Dh*Math.max(1,Math.abs(F),Math.abs(re))}(this.pos,i)||e===0)return r[0]=r[1]=r[2]=0,!1;const[n,s,c]=this.dir,h=this.pos[0]-i[0],d=this.pos[1]-i[1],m=this.pos[2]-i[2],g=n*n+s*s+c*c,x=2*(h*n+d*s+m*c),v=x*x-4*g*(h*h+d*d+m*m-e*e);if(v<0){const w=Math.max(-x/2,0),S=h+n*w,z=d+s*w,L=m+c*w,F=Math.hypot(S,z,L);return r[0]=S*e/F,r[1]=z*e/F,r[2]=L*e/F,!1}{const w=(-x-Math.sqrt(v))/(2*g);if(w<0){const S=Math.hypot(h,d,m);return r[0]=h*e/S,r[1]=d*e/S,r[2]=m*e/S,!1}return r[0]=h+n*w,r[1]=d+s*w,r[2]=m+c*w,!0}}},a.RequestManager=class{constructor(i,e,r){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",po,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Sr(i))return i;const r=Mr(i);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Sr(i))return i;const r=Mr(i);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(i,e){if(!Sr(i))return i;const r=Mr(i);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(i,e,r,n){const s=Mr(i);return Sr(i)?(s.path=`/styles/v1${s.path}/sprite${e}${r}`,this._makeAPIURL(s,this._customAccessToken||n)):(s.path+=`${e}${r}`,un(s))}normalizeTileURL(i,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Sr(i))return i;const n=Mr(i);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&n.authority!=="raster"&&r===512?"@2x":""}${cn.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${Nt.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${Nt.TILE_URL_VERSION}${n.path}`);const s=this._customAccessToken||function(c){for(const h of c){const d=h.match(/^access_token=(.*)$/);if(d)return d[1]}return null}(n.params)||Nt.ACCESS_TOKEN;return Nt.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,s)}canonicalizeTileURL(i,e){const r=Mr(i);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return i;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${Nt.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${Nt.TILE_URL_VERSION}/`,"")}`;let s=r.params;return e&&(s=s.filter(c=>!c.match(/^access_token=/))),s.length&&(n+=`?${s.join("&")}`),n}canonicalizeTileset(i,e){const r=!!e&&Sr(e),n=[];for(const s of i.tiles||[])Vn(s)?n.push(this.canonicalizeTileURL(s,r)):n.push(s);return n}_makeAPIURL(i,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=Mr(Nt.API_URL);if(i.protocol=n.protocol,i.authority=n.authority,i.protocol==="http"){const s=i.params.indexOf("secure");s>=0&&i.params.splice(s,1)}if(n.path!=="/"&&(i.path=`${n.path}${i.path}`),!Nt.REQUIRE_ACCESS_TOKEN)return un(i);if(e=e||Nt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return i.params=i.params.filter(s=>s.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),un(i)}},a.ResourceType=$,a.SegmentVector=_i,a.SourceCache=Ls,a.StencilMode=yd,a.StructArrayLayout1ui2=Rt,a.StructArrayLayout2f1f2i16=Ke,a.StructArrayLayout2i4=q,a.StructArrayLayout2ui4=dt,a.StructArrayLayout3f12=Re,a.StructArrayLayout3ui6=Xe,a.StructArrayLayout4i8=K,a.Texture=tc,a.Tile=_d,a.Transitionable=l,a.Uniform1f=fu,a.Uniform1i=class extends to{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends to{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.Uniform3f=class extends to{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.Uniform4f=Qd,a.UniformColor=ep,a.UniformMatrix2f=class extends to{constructor(i,e){super(i,e),this.current=h_}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},a.UniformMatrix3f=class extends to{constructor(i,e){super(i,e),this.current=u_}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},a.UniformMatrix4f=class extends to{constructor(i,e){super(i,e),this.current=c_}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.UnwrappedTileID=Mf,a.ValidationError=Ge,a.VectorTileWorkerSource=class extends ht{constructor(i,e,r,n,s){super(),this.actor=i,this.layerIndex=e,this.availableImages=r,this.loadVectorData=s||Wf,this.loading={},this.loaded={},this.deduped=new qf(i.scheduler),this.isSpriteLoaded=n,this.scheduler=i.scheduler}loadTile(i,e){const r=i.uid,n=i&&i.request,s=n&&n.collectResourceTiming,c=this.loading[r]=new by(i);c.abort=this.loadVectorData(i,(h,d)=>{const m=!this.loading[r];if(delete this.loading[r],m||h||!d)return c.status="done",m||(this.loaded[r]=c),e(h);const g=d.rawData,x={};d.expires&&(x.expires=d.expires),d.cacheControl&&(x.cacheControl=d.cacheControl),c.vectorTile=d.vectorTile||new Ps.VectorTile(new Jl(g));const v=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(w,S)=>{if(w||!S)return e(w);const z={};if(s){const L=gf(n);L.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(L)))}e(null,tt({rawTileData:g.slice(0)},S,x,z))})};this.isSpriteLoaded?v():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(v,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):v()}),this.loaded=this.loaded||{},this.loaded[r]=c})}reloadTile(i,e){const r=this.loaded,n=i.uid,s=this;if(r&&r[n]){const c=r[n];c.showCollisionBoxes=i.showCollisionBoxes,c.enableTerrain=!!i.enableTerrain,c.projection=i.projection,c.tileTransform=Ds(i.tileID.canonical,i.projection);const h=(d,m)=>{const g=c.reloadCallback;g&&(delete c.reloadCallback,c.parse(c.vectorTile,s.layerIndex,this.availableImages,s.actor,g)),e(d,m)};c.status==="parsing"?c.reloadCallback=h:c.status==="done"&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,h):h())}}abortTile(i,e){const r=i.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),e()}removeTile(i,e){const r=this.loaded,n=i.uid;r&&r[n]&&delete r[n],e()}},a.WritingMode=Lr,a.ZoomHistory=Tl,a.add=mp,a.addDynamicAttributes=ad,a.adjoint=function(i,e){var r=e[0],n=e[1],s=e[2],c=e[3],h=e[4],d=e[5],m=e[6],g=e[7],x=e[8];return i[0]=h*x-d*g,i[1]=s*g-n*x,i[2]=n*d-s*h,i[3]=d*m-c*x,i[4]=r*x-s*m,i[5]=s*c-r*d,i[6]=c*g-h*m,i[7]=n*m-r*g,i[8]=r*h-n*c,i},a.asyncAll=It,a.bezier=rt,a.bindAll=si,a.boundsAttributes=kf,a.bufferConvexPolygon=function(i,e){const r=[];for(let n=0;n<i.length;n++){const s=vt(n-1,-1,i.length-1),c=vt(n+1,-1,i.length-1),h=i[n],d=i[c],m=i[s].sub(h).unit(),g=d.sub(h).unit(),x=g.angleWithSep(m.x,m.y),v=m.add(g).unit().mult(-1*e/Math.sin(x/2));r.push(h.add(v))}return r},a.cacheEntryPossiblyAdded=function(i){go++,go>$n&&(i.getActor().send("enforceCacheSizeLimit",Gn),go=0)},a.calculateGlobeLabelMatrix=function(i,e){const{lng:r,lat:n}=i._center,s=Tf(0,0,i.worldSize/i._projectionScaler,r,n);return Lh(s,s,function(c){const h=En(new Float64Array(16)),d=1/md(c);return zs(h,h,c.min),Fo(h,h,[d,d,d]),h}(rc(e)))},a.calculateGlobeMatrix=Ef,a.calculateGlobeMercatorMatrix=function(i){const e=i.worldSize,r=i.point,n=Ia(1,i.center.lat)*e,s=i.pixelsPerMeter,c=e/(n/i.pixelsPerMeter),h=En(new Float64Array(16));return zs(h,h,[r.x,r.y,0]),Fo(h,h,[c,c,s]),Float32Array.from(h)},a.circumferenceAtLatitude=Mh,a.clamp=qe,a.clearTileCache=function(i){const e=_e.caches.delete($s);i&&e.catch(i).then(()=>i())},a.clipLine=lf,a.clone=function(i){var e=new mr(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.clone$1=yi,a.collisionCircleLayout=bg,a.config=Nt,a.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},a.create=function(){var i=new mr(16);return mr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.create$1=dp,a.createExpression=ds,a.createLayout=X,a.createStyleLayer=function(i){return i.type==="custom"?new ny(i):new sy[i.type](i)},a.cross=yp,a.degToRad=Ue,a.div=function(i,e,r){return i[0]=e[0]/r[0],i[1]=e[1]/r[1],i[2]=e[2]/r[2],i},a.dot=Nl,a.earthRadius=Ih,a.ease=ft,a.easeCubicInOut=_t,a.emitValidationErrors=Xc,a.endsWith=ai,a.enforceCacheSizeLimit=function(i){_o(),Ar&&Ar.then(e=>{e.keys().then(r=>{for(let n=0;n<r.length-i;n++)e.delete(r[n])})})},a.evaluateSizeForFeature=Au,a.evaluateSizeForZoom=Da,a.evaluateVariableOffset=pf,a.evented=Dl,a.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},a.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},a.exported=$i,a.exported$1=cn,a.extend=tt,a.extend$1=jt,a.filterObject=Tr,a.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},a.fromQuat=function(i,e){var r=e[0],n=e[1],s=e[2],c=e[3],h=r+r,d=n+n,m=s+s,g=r*h,x=n*h,v=n*d,w=s*h,S=s*d,z=s*m,L=c*h,F=c*d,G=c*m;return i[0]=1-v-z,i[1]=x+G,i[2]=w-F,i[3]=0,i[4]=x-G,i[5]=1-g-z,i[6]=S+L,i[7]=0,i[8]=w+F,i[9]=S-L,i[10]=1-g-v,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.fromRotation=function(i,e){var r=Math.sin(e),n=Math.cos(e);return i[0]=n,i[1]=r,i[2]=0,i[3]=-r,i[4]=n,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},a.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return ut[e]},a.getAABBPointSquareDist=function(i,e,r){let n=0;for(let s=0;s<2;++s){const c=r?r[s]:0;i[s]>c&&(n+=(i[s]-c)*(i[s]-c)),e[s]<c&&(n+=(c-e[s])*(c-e[s]))}return n},a.getAnchorAlignment=id,a.getAnchorJustification=od,a.getBounds=function(i){let e=1/0,r=1/0,n=-1/0,s=-1/0;for(const c of i)e=Math.min(e,c.x),r=Math.min(r,c.y),n=Math.max(n,c.x),s=Math.max(s,c.y);return{min:new H(e,r),max:new H(n,s)}},a.getColumn=function(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]},a.getGridMatrix=function(i,e){const[r,n]=e,s=.015625;return[0,(n[1]-r[1])*s,1<<i.z,(n[0]-r[0])*s,0,i.y,r[0],r[1],s]},a.getImage=je,a.getJSON=function(i,e){return N(tt(i,{type:"json"}),e)},a.getMapSessionAPI=Gs,a.getPerformanceMeasurement=gf,a.getProjection=function(i){const e=i.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new Ty(i);case"equirectangular":return new Iy(i);case"naturalEarth":return new Ay(i);case"equalEarth":return new Sy(i);case"winkelTripel":return new Cy(i);case"albers":return r?new Yf(i):new Ey(i);case"lambertConformalConic":return r?new Yf(i):new My(i)}throw new Error(`Invalid projection name: ${i.name}`)},a.getRTLTextPluginStatus=Ta,a.getReferrer=k,a.getTilePoint=function(i,{x:e,y:r},n=0){return new H(((e-n)*i.scale-i.x)*wt,(r*i.scale-i.y)*wt)},a.getTileVec3=function(i,e,r=0){return Ol(((e.x-r)*i.scale-i.x)*wt,(e.y*i.scale-i.y)*wt,rp(e.z,e.y))},a.getVideo=function(i,e){const r=_e.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<i.length;n++){const s=_e.document.createElement("source");ce(i[n])||(r.crossOrigin="Anonymous"),s.src=i[n],r.appendChild(s)}return{cancel:()=>{}}},a.globeECEFOrigin=function(i,e){const r=[0,0,0];return ks(r,r,wf(rc(e.canonical))),ks(r,r,i),r},a.globePixelsToTileUnits=function(i,e){return wt/(512*Math.pow(2,i))*md(rc(e))},a.globePoleMatrixForTile=function(i,e,r){const n=En(new Float64Array(16)),s=1<<i,c=360*(e/s-.5),h=r.point,d=r.worldSize/(r.tileSize*s);return zs(n,n,[h.x,h.y,-r.worldSize/Math.PI/2]),Fo(n,n,[d,d,d]),Bh(n,n,Ue(-r._center.lat)),Rh(n,n,Ue(-r._center.lng+c)),Float32Array.from(n)},a.globeTileLatLngCorners=fd,a.globeToMercatorTransition=function(i){return kt(5,6,i)},a.identity=En,a.identity$1=bp,a.invert=function(i,e){var r=e[0],n=e[1],s=e[2],c=e[3],h=e[4],d=e[5],m=e[6],g=e[7],x=e[8],v=e[9],w=e[10],S=e[11],z=e[12],L=e[13],F=e[14],G=e[15],Q=r*d-n*h,re=r*m-s*h,oe=r*g-c*h,se=n*m-s*d,ae=n*g-c*d,ve=s*g-c*m,we=x*L-v*z,Me=x*F-w*z,Ce=x*G-S*z,ye=v*F-w*L,Se=v*G-S*L,Pe=w*G-S*F,Ve=Q*Pe-re*Se+oe*ye+se*Ce-ae*Me+ve*we;return Ve?(i[0]=(d*Pe-m*Se+g*ye)*(Ve=1/Ve),i[1]=(s*Se-n*Pe-c*ye)*Ve,i[2]=(L*ve-F*ae+G*se)*Ve,i[3]=(w*ae-v*ve-S*se)*Ve,i[4]=(m*Ce-h*Pe-g*Me)*Ve,i[5]=(r*Pe-s*Ce+c*Me)*Ve,i[6]=(F*oe-z*ve-G*re)*Ve,i[7]=(x*ve-w*oe+S*re)*Ve,i[8]=(h*Se-d*Ce+g*we)*Ve,i[9]=(n*Ce-r*Se-c*we)*Ve,i[10]=(z*ae-L*oe+G*Q)*Ve,i[11]=(v*oe-x*ae-S*Q)*Ve,i[12]=(d*Me-h*ye-m*we)*Ve,i[13]=(r*ye-n*Me+s*we)*Ve,i[14]=(L*re-z*se-F*Q)*Ve,i[15]=(x*se-v*re+w*Q)*Ve,i):null},a.isMapAuthenticated=function(i){return jn.has(i)},a.isMapboxURL=Sr,a.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!ln(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=Ui,a.len=A_,a.length=fp,a.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},a.loadVectorTile=Wf,a.makeRequest=N,a.mercatorXfromLng=Fl,a.mercatorYfromLat=Sa,a.mercatorZfromAltitude=Ia,a.mul=I_,a.mul$1=M_,a.multiply=function(i,e,r){var n=e[0],s=e[1],c=e[2],h=e[3],d=e[4],m=e[5],g=e[6],x=e[7],v=e[8],w=r[0],S=r[1],z=r[2],L=r[3],F=r[4],G=r[5],Q=r[6],re=r[7],oe=r[8];return i[0]=w*n+S*h+z*g,i[1]=w*s+S*d+z*x,i[2]=w*c+S*m+z*v,i[3]=L*n+F*h+G*g,i[4]=L*s+F*d+G*x,i[5]=L*c+F*m+G*v,i[6]=Q*n+re*h+oe*g,i[7]=Q*s+re*d+oe*x,i[8]=Q*c+re*m+oe*v,i},a.multiply$1=Lh,a.multiply$2=gp,a.nextPowerOfTwo=ze,a.normalize=Vl,a.normalize$1=function(i,e){var r=e[0],n=e[1],s=e[2],c=e[3],h=r*r+n*n+s*s+c*c;return h>0&&(h=1/Math.sqrt(h)),i[0]=r*h,i[1]=n*h,i[2]=s*h,i[3]=c*h,i},a.number=at,a.ortho=function(i,e,r,n,s,c,h){var d=1/(e-r),m=1/(n-s),g=1/(c-h);return i[0]=-2*d,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*g,i[11]=0,i[12]=(e+r)*d,i[13]=(s+n)*m,i[14]=(h+c)*g,i[15]=1,i},a.pbf=Jl,a.perspective=function(i,e,r,n,s){var c,h=1/Math.tan(e/2);return i[0]=h/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=h,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,s!=null&&s!==1/0?(i[10]=(s+n)*(c=1/(n-s)),i[14]=2*s*n*c):(i[10]=-1,i[14]=-2*n),i},a.pick=function(i,e){const r={};for(let n=0;n<e.length;n++){const s=e[n];s in i&&(r[s]=i[s])}return r},a.plugin=pr,a.pointGeometry=H,a.polygonIntersectsBox=cp,a.polygonIntersectsPolygon=op,a.polygonizeBounds=function(i,e,r=0,n=!0){const s=new H(r,r),c=i.sub(s),h=e.add(s),d=[c,new H(h.x,c.y),h,new H(c.x,h.y)];return n&&d.push(c),d},a.posAttributes=ic,a.postMapLoadEvent=js,a.postTurnstileEvent=Xa,a.potpack=Jh,a.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},a.radToDeg=pt,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(i){return i({pluginStatus:qi,pluginURL:ir}),Dl.on("pluginStateChange",i),i},a.removeAuthState=function(i){jn.delete(i)},a.renderColorRamp=Gh,a.rotateX=Bh,a.rotateX$1=wp,a.rotateY=Rh,a.rotateZ=function(i,e,r){var n=Math.sin(r),s=Math.cos(r),c=e[0],h=e[1],d=e[2],m=e[3],g=e[4],x=e[5],v=e[6],w=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=c*s+g*n,i[1]=h*s+x*n,i[2]=d*s+v*n,i[3]=m*s+w*n,i[4]=g*s-c*n,i[5]=x*s-h*n,i[6]=v*s-d*n,i[7]=w*s-m*n,i},a.rotateZ$1=function(i,e,r){r*=.5;var n=e[0],s=e[1],c=e[2],h=e[3],d=Math.sin(r),m=Math.cos(r);return i[0]=n*m+s*d,i[1]=s*m-n*d,i[2]=c*m+h*d,i[3]=h*m-c*d,i},a.scale=Fo,a.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},a.scale$2=Ul,a.scaleAndAdd=Vh,a.setCacheLimits=function(i,e){Gn=i,$n=e},a.setColumn=function(i,e,r){i[4*e+0]=r[0],i[4*e+1]=r[1],i[4*e+2]=r[2],i[4*e+3]=r[3]},a.setRTLTextPlugin=function(i,e,r=!1){if(qi===zl||qi===Es||qi===kl)throw new Error("setRTLTextPlugin cannot be called multiple times.");ir=$i.resolveURL(i),qi=zl,Pl=e,Qn(),r||ko()},a.smoothstep=kt,a.spec=fe,a.storeAuthState=function(i,e){e?jn.add(i):jn.delete(i)},a.sub=Ca,a.subtract=_p,a.symbolSize=wg,a.tileAABB=function(i,e,r,n,s,c,h,d,m){if(m.name==="globe")return fy(i,e,new Fu(r,n,s));const g=Ds({z:r,x:n,y:s},m);return new Dr([(c+g.x/g.scale)*e,e*(g.y/g.scale),h],[(c+g.x2/g.scale)*e,e*(g.y2/g.scale),d])},a.tileTransform=Ds,a.transformMat3=function(i,e,r){var n=e[0],s=e[1],c=e[2];return i[0]=n*r[0]+s*r[3]+c*r[6],i[1]=n*r[1]+s*r[4]+c*r[7],i[2]=n*r[2]+s*r[5]+c*r[8],i},a.transformMat4=ks,a.transformMat4$1=za,a.transformQuat=xp,a.translate=zs,a.transpose=function(i,e){if(i===e){var r=e[1],n=e[2],s=e[5];i[1]=e[3],i[2]=e[6],i[3]=r,i[5]=e[7],i[6]=n,i[7]=s}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},a.triggerPluginCompletionEvent=Ss,a.uniqueId=gt,a.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFilter=i=>Kr(xn(i)),a.validateFog=i=>Kr(Wc(i)),a.validateLayer=i=>Kr(jc(i)),a.validateLight=i=>Kr(Zc(i)),a.validateSource=i=>Kr($c(i)),a.validateStyle=xs,a.validateTerrain=i=>Kr(qc(i)),a.values=Ft,a.vectorTile=Ps,a.version=Ie,a.warnOnce=Lt,a.window=_e,a.wrap=vt}),J(["./shared"],function(a){function Ie($){if(typeof $=="number"||typeof $=="boolean"||typeof $=="string"||$==null)return JSON.stringify($);if(Array.isArray($)){let k="[";for(const N of $)k+=`${Ie(N)},`;return`${k}]`}let M="{";for(const k of Object.keys($).sort())M+=`${k}:${Ie($[k])},`;return`${M}}`}function ge($){let M="";for(const k of a.refProperties)M+=`/${Ie($[k])}`;return M}class le{constructor(M){this.keyCache={},M&&this.replace(M)}replace(M){this._layerConfigs={},this._layers={},this.update(M,[])}update(M,k){for(const Y of M)this._layerConfigs[Y.id]=Y,(this._layers[Y.id]=a.createStyleLayer(Y)).compileFilter(),this.keyCache[Y.id]&&delete this.keyCache[Y.id];for(const Y of k)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const N=function(Y,ie){const ue={};for(let ne=0;ne<Y.length;ne++){const pe=ie&&ie[Y[ne].id]||ge(Y[ne]);ie&&(ie[Y[ne].id]=pe);let Ae=ue[pe];Ae||(Ae=ue[pe]=[]),Ae.push(Y[ne])}const ce=[];for(const ne in ue)ce.push(ue[ne]);return ce}(a.values(this._layerConfigs),this.keyCache);for(const Y of N){const ie=Y.map(je=>this._layers[je.id]),ue=ie[0];if(ue.visibility==="none")continue;const ce=ue.source||"";let ne=this.familiesBySource[ce];ne||(ne=this.familiesBySource[ce]={});const pe=ue.sourceLayer||"_geojsonTileLayer";let Ae=ne[pe];Ae||(Ae=ne[pe]=[]),Ae.push(ie)}}}class H{loadTile(M,k){const{uid:N,encoding:Y,rawImageData:ie,padding:ue,buildQuadTree:ce}=M,ne=a.window.ImageBitmap&&ie instanceof a.window.ImageBitmap?this.getImageData(ie,ue):ie;k(null,new a.DEMData(N,ne,Y,ue<1,ce))}getImageData(M,k){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(M.width,M.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=M.width,this.offscreenCanvas.height=M.height,this.offscreenCanvasContext.drawImage(M,0,0,M.width,M.height);const N=this.offscreenCanvasContext.getImageData(-k,-k,M.width+2*k,M.height+2*k);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),N}}var me=function $(M,k){var N,Y=M&&M.type;if(Y==="FeatureCollection")for(N=0;N<M.features.length;N++)$(M.features[N],k);else if(Y==="GeometryCollection")for(N=0;N<M.geometries.length;N++)$(M.geometries[N],k);else if(Y==="Feature")$(M.geometry,k);else if(Y==="Polygon")_e(M.coordinates,k);else if(Y==="MultiPolygon")for(N=0;N<M.coordinates.length;N++)_e(M.coordinates[N],k);return M};function _e($,M){if($.length!==0){Be($[0],M);for(var k=1;k<$.length;k++)Be($[k],!M)}}function Be($,M){for(var k=0,N=0,Y=0,ie=$.length,ue=ie-1;Y<ie;ue=Y++){var ce=($[Y][0]-$[ue][0])*($[ue][1]+$[Y][1]),ne=k+ce;N+=Math.abs(k)>=Math.abs(ce)?k-ne+ce:ce-ne+k,k=ne}k+N>=0!=!!M&&$.reverse()}const mt=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ue{constructor(M){this._feature=M,this.extent=a.EXTENT,this.type=M.type,this.properties=M.tags,"id"in M&&!isNaN(M.id)&&(this.id=parseInt(M.id,10))}loadGeometry(){if(this._feature.type===1){const M=[];for(const k of this._feature.geometry)M.push([new a.pointGeometry(k[0],k[1])]);return M}{const M=[];for(const k of this._feature.geometry){const N=[];for(const Y of k)N.push(new a.pointGeometry(Y[0],Y[1]));M.push(N)}return M}}toGeoJSON(M,k,N){return mt.call(this,M,k,N)}}class pt{constructor(M){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=M.length,this._features=M}feature(M){return new Ue(this._features[M])}}var ut=a.vectorTile.VectorTileFeature,_t=rt;function rt($,M){this.options=M||{},this.features=$,this.length=$.length}function ft($,M){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=M||4096}rt.prototype.feature=function($){return new ft(this.features[$],this.options.extent)},ft.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var M=0;M<$.length;M++){for(var k=$[M],N=[],Y=0;Y<k.length;Y++)N.push(new a.pointGeometry(k[Y][0],k[Y][1]));this.geometry.push(N)}return this.geometry},ft.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,M=1/0,k=-1/0,N=1/0,Y=-1/0,ie=0;ie<$.length;ie++)for(var ue=$[ie],ce=0;ce<ue.length;ce++){var ne=ue[ce];M=Math.min(M,ne.x),k=Math.max(k,ne.x),N=Math.min(N,ne.y),Y=Math.max(Y,ne.y)}return[M,N,k,Y]},ft.prototype.toGeoJSON=ut.prototype.toGeoJSON;var qe=vt,kt=_t;function vt($){var M=new a.pbf;return function(k,N){for(var Y in k.layers)N.writeMessage(3,It,k.layers[Y])}($,M),M.finish()}function It($,M){var k;M.writeVarintField(15,$.version||1),M.writeStringField(1,$.name||""),M.writeVarintField(5,$.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(k=0;k<$.length;k++)N.feature=$.feature(k),M.writeMessage(2,Ft,N);var Y=N.keys;for(k=0;k<Y.length;k++)M.writeStringField(3,Y[k]);var ie=N.values;for(k=0;k<ie.length;k++)M.writeMessage(4,ze,ie[k])}function Ft($,M){var k=$.feature;k.id!==void 0&&M.writeVarintField(1,k.id),M.writeMessage(2,tt,$),M.writeVarintField(3,k.type),M.writeMessage(4,et,k)}function tt($,M){var k=$.feature,N=$.keys,Y=$.values,ie=$.keycache,ue=$.valuecache;for(var ce in k.properties){var ne=k.properties[ce],pe=ie[ce];if(ne!==null){pe===void 0&&(N.push(ce),ie[ce]=pe=N.length-1),M.writeVarint(pe);var Ae=typeof ne;Ae!=="string"&&Ae!=="boolean"&&Ae!=="number"&&(ne=JSON.stringify(ne));var je=Ae+":"+ne,ke=ue[je];ke===void 0&&(Y.push(ne),ue[je]=ke=Y.length-1),M.writeVarint(ke)}}}function Ot($,M){return(M<<3)+(7&$)}function gt($){return $<<1^$>>31}function et($,M){for(var k=$.loadGeometry(),N=$.type,Y=0,ie=0,ue=k.length,ce=0;ce<ue;ce++){var ne=k[ce],pe=1;N===1&&(pe=ne.length),M.writeVarint(Ot(1,pe));for(var Ae=N===3?ne.length-1:ne.length,je=0;je<Ae;je++){je===1&&N!==1&&M.writeVarint(Ot(2,Ae-1));var ke=ne[je].x-Y,lt=ne[je].y-ie;M.writeVarint(gt(ke)),M.writeVarint(gt(lt)),Y+=ke,ie+=lt}N===3&&M.writeVarint(Ot(7,1))}}function ze($,M){var k=typeof $;k==="string"?M.writeStringField(1,$):k==="boolean"?M.writeBooleanField(7,$):k==="number"&&($%1!=0?M.writeDoubleField(3,$):$<0?M.writeSVarintField(6,$):M.writeVarintField(5,$))}function St($,M,k,N,Y,ie){if(Y-N<=k)return;const ue=N+Y>>1;si($,M,ue,N,Y,ie%2),St($,M,k,N,ue-1,ie+1),St($,M,k,ue+1,Y,ie+1)}function si($,M,k,N,Y,ie){for(;Y>N;){if(Y-N>600){const pe=Y-N+1,Ae=k-N+1,je=Math.log(pe),ke=.5*Math.exp(2*je/3),lt=.5*Math.sqrt(je*ke*(pe-ke)/pe)*(Ae-pe/2<0?-1:1);si($,M,k,Math.max(N,Math.floor(k-Ae*ke/pe+lt)),Math.min(Y,Math.floor(k+(pe-Ae)*ke/pe+lt)),ie)}const ue=M[2*k+ie];let ce=N,ne=Y;for(ai($,M,N,k),M[2*Y+ie]>ue&&ai($,M,N,Y);ce<ne;){for(ai($,M,ce,ne),ce++,ne--;M[2*ce+ie]<ue;)ce++;for(;M[2*ne+ie]>ue;)ne--}M[2*N+ie]===ue?ai($,M,N,ne):(ne++,ai($,M,ne,Y)),ne<=k&&(N=ne+1),k<=ne&&(Y=ne-1)}}function ai($,M,k,N){vi($,k,N),vi(M,2*k,2*N),vi(M,2*k+1,2*N+1)}function vi($,M,k){const N=$[M];$[M]=$[k],$[k]=N}function Tr($,M,k,N){const Y=$-k,ie=M-N;return Y*Y+ie*ie}qe.fromVectorTileJs=vt,qe.fromGeojsonVt=function($,M){M=M||{};var k={};for(var N in $)k[N]=new _t($[N].features,M),k[N].name=N,k[N].version=M.version,k[N].extent=M.extent;return vt({layers:k})},qe.GeoJSONWrapper=kt;const yi=$=>$[0],cr=$=>$[1];class Lt{constructor(M,k=yi,N=cr,Y=64,ie=Float64Array){this.nodeSize=Y,this.points=M;const ue=M.length<65536?Uint16Array:Uint32Array,ce=this.ids=new ue(M.length),ne=this.coords=new ie(2*M.length);for(let pe=0;pe<M.length;pe++)ce[pe]=pe,ne[2*pe]=k(M[pe]),ne[2*pe+1]=N(M[pe]);St(ce,ne,Y,0,ce.length-1,0)}range(M,k,N,Y){return function(ie,ue,ce,ne,pe,Ae,je){const ke=[0,ie.length-1,0],lt=[];let nt,ot;for(;ke.length;){const ht=ke.pop(),fe=ke.pop(),jt=ke.pop();if(fe-jt<=je){for(let Gt=jt;Gt<=fe;Gt++)nt=ue[2*Gt],ot=ue[2*Gt+1],nt>=ce&&nt<=pe&&ot>=ne&&ot<=Ae&&lt.push(ie[Gt]);continue}const Je=Math.floor((jt+fe)/2);nt=ue[2*Je],ot=ue[2*Je+1],nt>=ce&&nt<=pe&&ot>=ne&&ot<=Ae&&lt.push(ie[Je]);const Ut=(ht+1)%2;(ht===0?ce<=nt:ne<=ot)&&(ke.push(jt),ke.push(Je-1),ke.push(Ut)),(ht===0?pe>=nt:Ae>=ot)&&(ke.push(Je+1),ke.push(fe),ke.push(Ut))}return lt}(this.ids,this.coords,M,k,N,Y,this.nodeSize)}within(M,k,N){return function(Y,ie,ue,ce,ne,pe){const Ae=[0,Y.length-1,0],je=[],ke=ne*ne;for(;Ae.length;){const lt=Ae.pop(),nt=Ae.pop(),ot=Ae.pop();if(nt-ot<=pe){for(let Ut=ot;Ut<=nt;Ut++)Tr(ie[2*Ut],ie[2*Ut+1],ue,ce)<=ke&&je.push(Y[Ut]);continue}const ht=Math.floor((ot+nt)/2),fe=ie[2*ht],jt=ie[2*ht+1];Tr(fe,jt,ue,ce)<=ke&&je.push(Y[ht]);const Je=(lt+1)%2;(lt===0?ue-ne<=fe:ce-ne<=jt)&&(Ae.push(ot),Ae.push(ht-1),Ae.push(Je)),(lt===0?ue+ne>=fe:ce+ne>=jt)&&(Ae.push(ht+1),Ae.push(nt),Ae.push(Je))}return je}(this.ids,this.coords,M,k,N,this.nodeSize)}}const bi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},Ni=Math.fround||(Er=new Float32Array(1),$=>(Er[0]=+$,Er[0]));var Er;class uo{constructor(M){this.options=$i(Object.create(bi),M),this.trees=new Array(this.options.maxZoom+1)}load(M){const{log:k,minZoom:N,maxZoom:Y,nodeSize:ie}=this.options;k&&console.time("total time");const ue=`prepare ${M.length} points`;k&&console.time(ue),this.points=M;let ce=[];for(let ne=0;ne<M.length;ne++)M[ne].geometry&&ce.push(Ko(M[ne],ne));this.trees[Y+1]=new Lt(ce,Rn,Nt,ie,Float32Array),k&&console.timeEnd(ue);for(let ne=Y;ne>=N;ne--){const pe=+Date.now();ce=this._cluster(ce,ne),this.trees[ne]=new Lt(ce,Rn,Nt,ie,Float32Array),k&&console.log("z%d: %d clusters in %dms",ne,ce.length,+Date.now()-pe)}return k&&console.timeEnd("total time"),this}getClusters(M,k){let N=((M[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,M[1]));let ie=M[2]===180?180:((M[2]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,M[3]));if(M[2]-M[0]>=360)N=-180,ie=180;else if(N>ie){const Ae=this.getClusters([N,Y,180,ue],k),je=this.getClusters([-180,Y,ie,ue],k);return Ae.concat(je)}const ce=this.trees[this._limitZoom(k)],ne=ce.range(Bt(N),ln(ue),Bt(ie),ln(Y)),pe=[];for(const Ae of ne){const je=ce.points[Ae];pe.push(je.numPoints?Bn(je):this.points[je.index])}return pe}getChildren(M){const k=this._getOriginId(M),N=this._getOriginZoom(M),Y="No cluster with the specified id.",ie=this.trees[N];if(!ie)throw new Error(Y);const ue=ie.points[k];if(!ue)throw new Error(Y);const ce=this.options.radius/(this.options.extent*Math.pow(2,N-1)),ne=ie.within(ue.x,ue.y,ce),pe=[];for(const Ae of ne){const je=ie.points[Ae];je.parentId===M&&pe.push(je.numPoints?Bn(je):this.points[je.index])}if(pe.length===0)throw new Error(Y);return pe}getLeaves(M,k,N){const Y=[];return this._appendLeaves(Y,M,k=k||10,N=N||0,0),Y}getTile(M,k,N){const Y=this.trees[this._limitZoom(M)],ie=Math.pow(2,M),{extent:ue,radius:ce}=this.options,ne=ce/ue,pe=(N-ne)/ie,Ae=(N+1+ne)/ie,je={features:[]};return this._addTileFeatures(Y.range((k-ne)/ie,pe,(k+1+ne)/ie,Ae),Y.points,k,N,ie,je),k===0&&this._addTileFeatures(Y.range(1-ne/ie,pe,1,Ae),Y.points,ie,N,ie,je),k===ie-1&&this._addTileFeatures(Y.range(0,pe,ne/ie,Ae),Y.points,-1,N,ie,je),je.features.length?je:null}getClusterExpansionZoom(M){let k=this._getOriginZoom(M)-1;for(;k<=this.options.maxZoom;){const N=this.getChildren(M);if(k++,N.length!==1)break;M=N[0].properties.cluster_id}return k}_appendLeaves(M,k,N,Y,ie){const ue=this.getChildren(k);for(const ce of ue){const ne=ce.properties;if(ne&&ne.cluster?ie+ne.point_count<=Y?ie+=ne.point_count:ie=this._appendLeaves(M,ne.cluster_id,N,Y,ie):ie<Y?ie++:M.push(ce),M.length===N)break}return ie}_addTileFeatures(M,k,N,Y,ie,ue){for(const ce of M){const ne=k[ce],pe=ne.numPoints;let Ae,je,ke;if(pe)Ae=Rr(ne),je=ne.x,ke=ne.y;else{const ot=this.points[ne.index];Ae=ot.properties,je=Bt(ot.geometry.coordinates[0]),ke=ln(ot.geometry.coordinates[1])}const lt={type:1,geometry:[[Math.round(this.options.extent*(je*ie-N)),Math.round(this.options.extent*(ke*ie-Y))]],tags:Ae};let nt;pe?nt=ne.id:this.options.generateId?nt=ne.index:this.points[ne.index].id&&(nt=this.points[ne.index].id),nt!==void 0&&(lt.id=nt),ue.features.push(lt)}}_limitZoom(M){return Math.max(this.options.minZoom,Math.min(+M,this.options.maxZoom+1))}_cluster(M,k){const N=[],{radius:Y,extent:ie,reduce:ue,minPoints:ce}=this.options,ne=Y/(ie*Math.pow(2,k));for(let pe=0;pe<M.length;pe++){const Ae=M[pe];if(Ae.zoom<=k)continue;Ae.zoom=k;const je=this.trees[k+1],ke=je.within(Ae.x,Ae.y,ne),lt=Ae.numPoints||1;let nt=lt;for(const ot of ke){const ht=je.points[ot];ht.zoom>k&&(nt+=ht.numPoints||1)}if(nt>lt&&nt>=ce){let ot=Ae.x*lt,ht=Ae.y*lt,fe=ue&&lt>1?this._map(Ae,!0):null;const jt=(pe<<5)+(k+1)+this.points.length;for(const Je of ke){const Ut=je.points[Je];if(Ut.zoom<=k)continue;Ut.zoom=k;const Gt=Ut.numPoints||1;ot+=Ut.x*Gt,ht+=Ut.y*Gt,Ut.parentId=jt,ue&&(fe||(fe=this._map(Ae,!0)),ue(fe,this._map(Ut)))}Ae.parentId=jt,N.push(an(ot/nt,ht/nt,jt,nt,fe))}else if(N.push(Ae),nt>1)for(const ot of ke){const ht=je.points[ot];ht.zoom<=k||(ht.zoom=k,N.push(ht))}}return N}_getOriginId(M){return M-this.points.length>>5}_getOriginZoom(M){return(M-this.points.length)%32}_map(M,k){if(M.numPoints)return k?$i({},M.properties):M.properties;const N=this.points[M.index].properties,Y=this.options.map(N);return k&&Y===N?$i({},Y):Y}}function an($,M,k,N,Y){return{x:Ni($),y:Ni(M),zoom:1/0,id:k,parentId:-1,numPoints:N,properties:Y}}function Ko($,M){const[k,N]=$.geometry.coordinates;return{x:Ni(Bt(k)),y:Ni(ln(N)),zoom:1/0,index:M,parentId:-1}}function Bn($){return{type:"Feature",id:$.id,properties:Rr($),geometry:{type:"Point",coordinates:[(M=$.x,360*(M-.5)),Vs($.y)]}};var M}function Rr($){const M=$.numPoints,k=M>=1e4?`${Math.round(M/1e3)}k`:M>=1e3?Math.round(M/100)/10+"k":M;return $i($i({},$.properties),{cluster:!0,cluster_id:$.id,point_count:M,point_count_abbreviated:k})}function Bt($){return $/360+.5}function ln($){const M=Math.sin($*Math.PI/180),k=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return k<0?0:k>1?1:k}function Vs($){const M=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(M))/Math.PI-90}function $i($,M){for(const k in M)$[k]=M[k];return $}function Rn($){return $.x}function Nt($){return $.y}function cn($,M,k,N){for(var Y,ie=N,ue=k-M>>1,ce=k-M,ne=$[M],pe=$[M+1],Ae=$[k],je=$[k+1],ke=M+3;ke<k;ke+=3){var lt=Fn($[ke],$[ke+1],ne,pe,Ae,je);if(lt>ie)Y=ke,ie=lt;else if(lt===ie){var nt=Math.abs(ke-ue);nt<ce&&(Y=ke,ce=nt)}}ie>N&&(Y-M>3&&cn($,M,Y,N),$[Y+2]=ie,k-Y>3&&cn($,Y,k,N))}function Fn($,M,k,N,Y,ie){var ue=Y-k,ce=ie-N;if(ue!==0||ce!==0){var ne=(($-k)*ue+(M-N)*ce)/(ue*ue+ce*ce);ne>1?(k=Y,N=ie):ne>0&&(k+=ue*ne,N+=ce*ne)}return(ue=$-k)*ue+(ce=M-N)*ce}function ur($,M,k,N){var Y={id:$===void 0?null:$,type:M,geometry:k,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ie){var ue=ie.geometry,ce=ie.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")On(ie,ue);else if(ce==="Polygon"||ce==="MultiLineString")for(var ne=0;ne<ue.length;ne++)On(ie,ue[ne]);else if(ce==="MultiPolygon")for(ne=0;ne<ue.length;ne++)for(var pe=0;pe<ue[ne].length;pe++)On(ie,ue[ne][pe])}(Y),Y}function On($,M){for(var k=0;k<M.length;k+=3)$.minX=Math.min($.minX,M[k]),$.minY=Math.min($.minY,M[k+1]),$.maxX=Math.max($.maxX,M[k]),$.maxY=Math.max($.maxY,M[k+1])}function ho($,M,k,N){if(M.geometry){var Y=M.geometry.coordinates,ie=M.geometry.type,ue=Math.pow(k.tolerance/((1<<k.maxZoom)*k.extent),2),ce=[],ne=M.id;if(k.promoteId?ne=M.properties[k.promoteId]:k.generateId&&(ne=N||0),ie==="Point")Jo(Y,ce);else if(ie==="MultiPoint")for(var pe=0;pe<Y.length;pe++)Jo(Y[pe],ce);else if(ie==="LineString")po(Y,ce,ue,!1);else if(ie==="MultiLineString"){if(k.lineMetrics){for(pe=0;pe<Y.length;pe++)po(Y[pe],ce=[],ue,!1),$.push(ur(ne,"LineString",ce,M.properties));return}Un(Y,ce,ue,!1)}else if(ie==="Polygon")Un(Y,ce,ue,!0);else{if(ie!=="MultiPolygon"){if(ie==="GeometryCollection"){for(pe=0;pe<M.geometry.geometries.length;pe++)ho($,{id:ne,geometry:M.geometry.geometries[pe],properties:M.properties},k,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pe=0;pe<Y.length;pe++){var Ae=[];Un(Y[pe],Ae,ue,!0),ce.push(Ae)}}$.push(ur(ne,ie,ce,M.properties))}}function Jo($,M){M.push(Sr($[0])),M.push(Vn($[1])),M.push(0)}function po($,M,k,N){for(var Y,ie,ue=0,ce=0;ce<$.length;ce++){var ne=Sr($[ce][0]),pe=Vn($[ce][1]);M.push(ne),M.push(pe),M.push(0),ce>0&&(ue+=N?(Y*pe-ne*ie)/2:Math.sqrt(Math.pow(ne-Y,2)+Math.pow(pe-ie,2))),Y=ne,ie=pe}var Ae=M.length-3;M[2]=1,cn(M,0,Ae,k),M[Ae+2]=1,M.size=Math.abs(ue),M.start=0,M.end=M.size}function Un($,M,k,N){for(var Y=0;Y<$.length;Y++){var ie=[];po($[Y],ie,k,N),M.push(ie)}}function Sr($){return $/360+.5}function Vn($){var M=Math.sin($*Math.PI/180),k=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return k<0?0:k>1?1:k}function Ir($,M,k,N,Y,ie,ue,ce){if(N/=M,ie>=(k/=M)&&ue<N)return $;if(ue<k||ie>=N)return null;for(var ne=[],pe=0;pe<$.length;pe++){var Ae=$[pe],je=Ae.geometry,ke=Ae.type,lt=Y===0?Ae.minX:Ae.minY,nt=Y===0?Ae.maxX:Ae.maxY;if(lt>=k&&nt<N)ne.push(Ae);else if(!(nt<k||lt>=N)){var ot=[];if(ke==="Point"||ke==="MultiPoint")Mr(je,ot,k,N,Y);else if(ke==="LineString")un(je,ot,k,N,Y,!1,ce.lineMetrics);else if(ke==="MultiLineString")Nn(je,ot,k,N,Y,!1);else if(ke==="Polygon")Nn(je,ot,k,N,Y,!0);else if(ke==="MultiPolygon")for(var ht=0;ht<je.length;ht++){var fe=[];Nn(je[ht],fe,k,N,Y,!0),fe.length&&ot.push(fe)}if(ot.length){if(ce.lineMetrics&&ke==="LineString"){for(ht=0;ht<ot.length;ht++)ne.push(ur(Ae.id,ke,ot[ht],Ae.tags));continue}ke!=="LineString"&&ke!=="MultiLineString"||(ot.length===1?(ke="LineString",ot=ot[0]):ke="MultiLineString"),ke!=="Point"&&ke!=="MultiPoint"||(ke=ot.length===3?"Point":"MultiPoint"),ne.push(ur(Ae.id,ke,ot,Ae.tags))}}}return ne.length?ne:null}function Mr($,M,k,N,Y){for(var ie=0;ie<$.length;ie+=3){var ue=$[ie+Y];ue>=k&&ue<=N&&(M.push($[ie]),M.push($[ie+1]),M.push($[ie+2]))}}function un($,M,k,N,Y,ie,ue){for(var ce,ne,pe=Qo($),Ae=Y===0?Xa:Ns,je=$.start,ke=0;ke<$.length-3;ke+=3){var lt=$[ke],nt=$[ke+1],ot=$[ke+2],ht=$[ke+3],fe=$[ke+4],jt=Y===0?lt:nt,Je=Y===0?ht:fe,Ut=!1;ue&&(ce=Math.sqrt(Math.pow(lt-ht,2)+Math.pow(nt-fe,2))),jt<k?Je>k&&(ne=Ae(pe,lt,nt,ht,fe,k),ue&&(pe.start=je+ce*ne)):jt>N?Je<N&&(ne=Ae(pe,lt,nt,ht,fe,N),ue&&(pe.start=je+ce*ne)):fo(pe,lt,nt,ot),Je<k&&jt>=k&&(ne=Ae(pe,lt,nt,ht,fe,k),Ut=!0),Je>N&&jt<=N&&(ne=Ae(pe,lt,nt,ht,fe,N),Ut=!0),!ie&&Ut&&(ue&&(pe.end=je+ce*ne),M.push(pe),pe=Qo($)),ue&&(je+=ce)}var Gt=$.length-3;lt=$[Gt],nt=$[Gt+1],ot=$[Gt+2],(jt=Y===0?lt:nt)>=k&&jt<=N&&fo(pe,lt,nt,ot),Gt=pe.length-3,ie&&Gt>=3&&(pe[Gt]!==pe[0]||pe[Gt+1]!==pe[1])&&fo(pe,pe[0],pe[1],pe[2]),pe.length&&M.push(pe)}function Qo($){var M=[];return M.size=$.size,M.start=$.start,M.end=$.end,M}function Nn($,M,k,N,Y,ie){for(var ue=0;ue<$.length;ue++)un($[ue],M,k,N,Y,ie,!1)}function fo($,M,k,N){$.push(M),$.push(k),$.push(N)}function Xa($,M,k,N,Y,ie){var ue=(ie-M)/(N-M);return $.push(ie),$.push(k+(Y-k)*ue),$.push(1),ue}function Ns($,M,k,N,Y,ie){var ue=(ie-k)/(Y-k);return $.push(M+(N-M)*ue),$.push(ie),$.push(1),ue}function js($,M){for(var k=[],N=0;N<$.length;N++){var Y,ie=$[N],ue=ie.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Y=mo(ie.geometry,M);else if(ue==="MultiLineString"||ue==="Polygon"){Y=[];for(var ce=0;ce<ie.geometry.length;ce++)Y.push(mo(ie.geometry[ce],M))}else if(ue==="MultiPolygon")for(Y=[],ce=0;ce<ie.geometry.length;ce++){for(var ne=[],pe=0;pe<ie.geometry[ce].length;pe++)ne.push(mo(ie.geometry[ce][pe],M));Y.push(ne)}k.push(ur(ie.id,ue,Y,ie.tags))}return k}function mo($,M){var k=[];k.size=$.size,$.start!==void 0&&(k.start=$.start,k.end=$.end);for(var N=0;N<$.length;N+=3)k.push($[N]+M,$[N+1],$[N+2]);return k}function Gs($,M){if($.transformed)return $;var k,N,Y,ie=1<<$.z,ue=$.x,ce=$.y;for(k=0;k<$.features.length;k++){var ne=$.features[k],pe=ne.geometry,Ae=ne.type;if(ne.geometry=[],Ae===1)for(N=0;N<pe.length;N+=2)ne.geometry.push(jn(pe[N],pe[N+1],M,ie,ue,ce));else for(N=0;N<pe.length;N++){var je=[];for(Y=0;Y<pe[N].length;Y+=2)je.push(jn(pe[N][Y],pe[N][Y+1],M,ie,ue,ce));ne.geometry.push(je)}}return $.transformed=!0,$}function jn($,M,k,N,Y,ie){return[Math.round(k*($*N-Y)),Math.round(k*(M*N-ie))]}function $s($,M,k,N,Y){for(var ie=M===Y.maxZoom?0:Y.tolerance/((1<<M)*Y.extent),ue={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:k,y:N,z:M,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ce=0;ce<$.length;ce++){ue.numFeatures++,Ar(ue,$[ce],ie,Y);var ne=$[ce].minX,pe=$[ce].minY,Ae=$[ce].maxX,je=$[ce].maxY;ne<ue.minX&&(ue.minX=ne),pe<ue.minY&&(ue.minY=pe),Ae>ue.maxX&&(ue.maxX=Ae),je>ue.maxY&&(ue.maxY=je)}return ue}function Ar($,M,k,N){var Y=M.geometry,ie=M.type,ue=[];if(ie==="Point"||ie==="MultiPoint")for(var ce=0;ce<Y.length;ce+=3)ue.push(Y[ce]),ue.push(Y[ce+1]),$.numPoints++,$.numSimplified++;else if(ie==="LineString")hn(ue,Y,$,k,!1,!1);else if(ie==="MultiLineString"||ie==="Polygon")for(ce=0;ce<Y.length;ce++)hn(ue,Y[ce],$,k,ie==="Polygon",ce===0);else if(ie==="MultiPolygon")for(var ne=0;ne<Y.length;ne++){var pe=Y[ne];for(ce=0;ce<pe.length;ce++)hn(ue,pe[ce],$,k,!0,ce===0)}if(ue.length){var Ae=M.tags||null;if(ie==="LineString"&&N.lineMetrics){for(var je in Ae={},M.tags)Ae[je]=M.tags[je];Ae.mapbox_clip_start=Y.start/Y.size,Ae.mapbox_clip_end=Y.end/Y.size}var ke={geometry:ue,type:ie==="Polygon"||ie==="MultiPolygon"?3:ie==="LineString"||ie==="MultiLineString"?2:1,tags:Ae};M.id!==null&&(ke.id=M.id),$.features.push(ke)}}function hn($,M,k,N,Y,ie){var ue=N*N;if(N>0&&M.size<(Y?ue:N))k.numPoints+=M.length/3;else{for(var ce=[],ne=0;ne<M.length;ne+=3)(N===0||M[ne+2]>ue)&&(k.numSimplified++,ce.push(M[ne]),ce.push(M[ne+1])),k.numPoints++;Y&&function(pe,Ae){for(var je=0,ke=0,lt=pe.length,nt=lt-2;ke<lt;nt=ke,ke+=2)je+=(pe[ke]-pe[nt])*(pe[ke+1]+pe[nt+1]);if(je>0===Ae)for(ke=0,lt=pe.length;ke<lt/2;ke+=2){var ot=pe[ke],ht=pe[ke+1];pe[ke]=pe[lt-2-ke],pe[ke+1]=pe[lt-1-ke],pe[lt-2-ke]=ot,pe[lt-1-ke]=ht}}(ce,ie),$.push(ce)}}function Gn($,M){var k=(M=this.options=function(Y,ie){for(var ue in ie)Y[ue]=ie[ue];return Y}(Object.create(this.options),M)).debug;if(k&&console.time("preprocess data"),M.maxZoom<0||M.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(M.promoteId&&M.generateId)throw new Error("promoteId and generateId cannot be used together.");var N=function(Y,ie){var ue=[];if(Y.type==="FeatureCollection")for(var ce=0;ce<Y.features.length;ce++)ho(ue,Y.features[ce],ie,ce);else ho(ue,Y.type==="Feature"?Y:{geometry:Y},ie);return ue}($,M);this.tiles={},this.tileCoords=[],k&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",M.indexMaxZoom,M.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(N=function(Y,ie){var ue=ie.buffer/ie.extent,ce=Y,ne=Ir(Y,1,-1-ue,ue,0,-1,2,ie),pe=Ir(Y,1,1-ue,2+ue,0,-1,2,ie);return(ne||pe)&&(ce=Ir(Y,1,-ue,1+ue,0,-1,2,ie)||[],ne&&(ce=js(ne,1).concat(ce)),pe&&(ce=ce.concat(js(pe,-1)))),ce}(N,M)).length&&this.splitTile(N,0,0,0),k&&(N.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $n($,M,k){return 32*((1<<$)*k+M)+$}function _o($,M){const k=$.tileID.canonical;if(!this._geoJSONIndex)return M(null,null);const N=this._geoJSONIndex.getTile(k.z,k.x,k.y);if(!N)return M(null,null);const Y=new pt(N.features);let ie=qe(Y);ie.byteOffset===0&&ie.byteLength===ie.buffer.byteLength||(ie=new Uint8Array(ie)),M(null,{vectorTile:Y,rawData:ie.buffer})}Gn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Gn.prototype.splitTile=function($,M,k,N,Y,ie,ue){for(var ce=[$,M,k,N],ne=this.options,pe=ne.debug;ce.length;){N=ce.pop(),k=ce.pop(),M=ce.pop(),$=ce.pop();var Ae=1<<M,je=$n(M,k,N),ke=this.tiles[je];if(!ke&&(pe>1&&console.time("creation"),ke=this.tiles[je]=$s($,M,k,N,ne),this.tileCoords.push({z:M,x:k,y:N}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",M,k,N,ke.numFeatures,ke.numPoints,ke.numSimplified),console.timeEnd("creation"));var lt="z"+M;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(ke.source=$,Y){if(M===ne.maxZoom||M===Y)continue;var nt=1<<Y-M;if(k!==Math.floor(ie/nt)||N!==Math.floor(ue/nt))continue}else if(M===ne.indexMaxZoom||ke.numPoints<=ne.indexMaxPoints)continue;if(ke.source=null,$.length!==0){pe>1&&console.time("clipping");var ot,ht,fe,jt,Je,Ut,Gt=.5*ne.buffer/ne.extent,Zn=.5-Gt,qr=.5+Gt,Ne=1+Gt;ot=ht=fe=jt=null,Je=Ir($,Ae,k-Gt,k+qr,0,ke.minX,ke.maxX,ne),Ut=Ir($,Ae,k+Zn,k+Ne,0,ke.minX,ke.maxX,ne),$=null,Je&&(ot=Ir(Je,Ae,N-Gt,N+qr,1,ke.minY,ke.maxY,ne),ht=Ir(Je,Ae,N+Zn,N+Ne,1,ke.minY,ke.maxY,ne),Je=null),Ut&&(fe=Ir(Ut,Ae,N-Gt,N+qr,1,ke.minY,ke.maxY,ne),jt=Ir(Ut,Ae,N+Zn,N+Ne,1,ke.minY,ke.maxY,ne),Ut=null),pe>1&&console.timeEnd("clipping"),ce.push(ot||[],M+1,2*k,2*N),ce.push(ht||[],M+1,2*k,2*N+1),ce.push(fe||[],M+1,2*k+1,2*N),ce.push(jt||[],M+1,2*k+1,2*N+1)}}},Gn.prototype.getTile=function($,M,k){var N=this.options,Y=N.extent,ie=N.debug;if($<0||$>24)return null;var ue=1<<$,ce=$n($,M=(M%ue+ue)%ue,k);if(this.tiles[ce])return Gs(this.tiles[ce],Y);ie>1&&console.log("drilling down to z%d-%d-%d",$,M,k);for(var ne,pe=$,Ae=M,je=k;!ne&&pe>0;)pe--,Ae=Math.floor(Ae/2),je=Math.floor(je/2),ne=this.tiles[$n(pe,Ae,je)];return ne&&ne.source?(ie>1&&console.log("found parent tile z%d-%d-%d",pe,Ae,je),ie>1&&console.time("drilling down"),this.splitTile(ne.source,pe,Ae,je,$,M,k),ie>1&&console.timeEnd("drilling down"),this.tiles[ce]?Gs(this.tiles[ce],Y):null):null};class es extends a.VectorTileWorkerSource{constructor(M,k,N,Y,ie){super(M,k,N,Y,_o),ie&&(this.loadGeoJSON=ie)}loadData(M,k){const N=M&&M.request,Y=N&&N.collectResourceTiming;this.loadGeoJSON(M,(ie,ue)=>{if(ie||!ue)return k(ie);if(typeof ue!="object")return k(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`));{me(ue,!0);try{if(M.filter){const ne=a.createExpression(M.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(Ae=>`${Ae.key}: ${Ae.message}`).join(", "));const pe=ue.features.filter(Ae=>ne.value.evaluate({zoom:0},Ae));ue={type:"FeatureCollection",features:pe}}this._geoJSONIndex=M.cluster?new uo(function({superclusterOptions:ne,clusterProperties:pe}){if(!pe||!ne)return ne;const Ae={},je={},ke={accumulated:null,zoom:0},lt={properties:null},nt=Object.keys(pe);for(const ot of nt){const[ht,fe]=pe[ot],jt=a.createExpression(fe),Je=a.createExpression(typeof ht=="string"?[ht,["accumulated"],["get",ot]]:ht);Ae[ot]=jt.value,je[ot]=Je.value}return ne.map=ot=>{lt.properties=ot;const ht={};for(const fe of nt)ht[fe]=Ae[fe].evaluate(ke,lt);return ht},ne.reduce=(ot,ht)=>{lt.properties=ht;for(const fe of nt)ke.accumulated=ot[fe],ot[fe]=je[fe].evaluate(ke,lt)},ne}(M)).load(ue.features):function(ne,pe){return new Gn(ne,pe)}(ue,M.geojsonVtOptions)}catch(ne){return k(ne)}this.loaded={};const ce={};if(Y){const ne=a.getPerformanceMeasurement(N);ne&&(ce.resourceTiming={},ce.resourceTiming[M.source]=JSON.parse(JSON.stringify(ne)))}k(null,ce)}})}reloadTile(M,k){const N=this.loaded;return N&&N[M.uid]?super.reloadTile(M,k):this.loadTile(M,k)}loadGeoJSON(M,k){if(M.request)a.getJSON(M.request,k);else{if(typeof M.data!="string")return k(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`));try{return k(null,JSON.parse(M.data))}catch{return k(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(M,k){try{k(null,this._geoJSONIndex.getClusterExpansionZoom(M.clusterId))}catch(N){k(N)}}getClusterChildren(M,k){try{k(null,this._geoJSONIndex.getChildren(M.clusterId))}catch(N){k(N)}}getClusterLeaves(M,k){try{k(null,this._geoJSONIndex.getLeaves(M.clusterId,M.limit,M.offset))}catch(N){k(N)}}}class go{constructor(M){this.self=M,this.actor=new a.Actor(M,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:es},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(k,N)=>{if(this.workerSourceTypes[k])throw new Error(`Worker source with name "${k}" already registered.`);this.workerSourceTypes[k]=N},this.self.registerRTLTextPlugin=k=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=k.applyArabicShaping,a.plugin.processBidirectionalText=k.processBidirectionalText,a.plugin.processStyledBidirectionalText=k.processStyledBidirectionalText}}clearCaches(M,k,N){delete this.layerIndexes[M],delete this.availableImages[M],delete this.workerSources[M],delete this.demWorkerSources[M],N()}checkIfReady(M,k,N){N()}setReferrer(M,k){this.referrer=k}spriteLoaded(M,k){this.isSpriteLoaded[M]=k;for(const N in this.workerSources[M]){const Y=this.workerSources[M][N];for(const ie in Y)Y[ie]instanceof a.VectorTileWorkerSource&&(Y[ie].isSpriteLoaded=k,Y[ie].fire(new a.Event("isSpriteLoaded")))}}setImages(M,k,N){this.availableImages[M]=k;for(const Y in this.workerSources[M]){const ie=this.workerSources[M][Y];for(const ue in ie)ie[ue].availableImages=k}N()}enableTerrain(M,k,N){this.terrain=k,N()}setProjection(M,k){this.projections[M]=a.getProjection(k)}setLayers(M,k,N){this.getLayerIndex(M).replace(k),N()}updateLayers(M,k,N){this.getLayerIndex(M).update(k.layers,k.removedIds),N()}loadTile(M,k,N){const Y=this.enableTerrain?a.extend({enableTerrain:this.terrain},k):k;Y.projection=this.projections[M]||this.defaultProjection,this.getWorkerSource(M,k.type,k.source).loadTile(Y,N)}loadDEMTile(M,k,N){const Y=this.enableTerrain?a.extend({buildQuadTree:this.terrain},k):k;this.getDEMWorkerSource(M,k.source).loadTile(Y,N)}reloadTile(M,k,N){const Y=this.enableTerrain?a.extend({enableTerrain:this.terrain},k):k;Y.projection=this.projections[M]||this.defaultProjection,this.getWorkerSource(M,k.type,k.source).reloadTile(Y,N)}abortTile(M,k,N){this.getWorkerSource(M,k.type,k.source).abortTile(k,N)}removeTile(M,k,N){this.getWorkerSource(M,k.type,k.source).removeTile(k,N)}removeSource(M,k,N){if(!this.workerSources[M]||!this.workerSources[M][k.type]||!this.workerSources[M][k.type][k.source])return;const Y=this.workerSources[M][k.type][k.source];delete this.workerSources[M][k.type][k.source],Y.removeSource!==void 0?Y.removeSource(k,N):N()}loadWorkerSource(M,k,N){try{this.self.importScripts(k.url),N()}catch(Y){N(Y.toString())}}syncRTLPluginState(M,k,N){try{a.plugin.setState(k);const Y=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&Y!=null){this.self.importScripts(Y);const ie=a.plugin.isParsed();N(ie?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),ie)}}catch(Y){N(Y.toString())}}getAvailableImages(M){let k=this.availableImages[M];return k||(k=[]),k}getLayerIndex(M){let k=this.layerIndexes[M];return k||(k=this.layerIndexes[M]=new le),k}getWorkerSource(M,k,N){return this.workerSources[M]||(this.workerSources[M]={}),this.workerSources[M][k]||(this.workerSources[M][k]={}),this.workerSources[M][k][N]||(this.workerSources[M][k][N]=new this.workerSourceTypes[k]({send:(Y,ie,ue,ce,ne,pe)=>{this.actor.send(Y,ie,ue,M,ne,pe)},scheduler:this.actor.scheduler},this.getLayerIndex(M),this.getAvailableImages(M),this.isSpriteLoaded[M])),this.workerSources[M][k][N]}getDEMWorkerSource(M,k){return this.demWorkerSources[M]||(this.demWorkerSources[M]={}),this.demWorkerSources[M][k]||(this.demWorkerSources[M][k]=new H),this.demWorkerSources[M][k]}enforceCacheSizeLimit(M,k){a.enforceCacheSizeLimit(k)}getWorkerPerformanceMetrics(M,k,N){N(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new go(self)),go}),J(["./shared"],function(a){var Ie=ge;function ge(l){return!function(t){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,p,f=new Blob([""],{type:"text/javascript"}),_=URL.createObjectURL(f);try{p=new Worker(_),u=!0}catch{u=!1}return p&&p.terminate(),URL.revokeObjectURL(_),u}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var u=document.createElement("canvas");u.width=u.height=1;var p=u.getContext("2d");if(!p)return!1;var f=p.getImageData(0,0,1,1);return f&&f.width===u.width}()?(le[o=t&&t.failIfMajorPerformanceCaveat]===void 0&&(le[o]=function(u){var p,f=function(_){var y=document.createElement("canvas"),b=Object.create(ge.webGLContextAttributes);return b.failIfMajorPerformanceCaveat=_,y.getContext("webgl",b)||y.getContext("experimental-webgl",b)}(u);if(!f)return!1;try{p=f.createShader(f.VERTEX_SHADER)}catch{return!1}return!(!p||f.isContextLost())&&(f.shaderSource(p,"void main() {}"),f.compileShader(p),f.getShaderParameter(p,f.COMPILE_STATUS)===!0)}(o)),le[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var o}(l)}var le={};function H(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let o=0;o<l.length;o++)if(!H(l[o],t[o]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(const o in l)if(!H(l[o],t[o]))return!1;return!0}return l===t}function me(l,t,o){const u=a.window.document.createElement(l);return t!==void 0&&(u.className=t),o&&o.appendChild(u),u}function _e(l,t,o){const u=a.window.document.createElementNS("http://www.w3.org/2000/svg",l);for(const p of Object.keys(t))u.setAttributeNS(null,p,t[p]);return o&&o.appendChild(u),u}ge.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Be=a.window.document&&a.window.document.documentElement.style,mt=Be&&Be.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ue;function pt(){Be&&mt&&(Ue=Be[mt],Be[mt]="none")}function ut(){Be&&mt&&(Be[mt]=Ue)}function _t(l){l.preventDefault(),l.stopPropagation(),a.window.removeEventListener("click",_t,!0)}function rt(){a.window.addEventListener("click",_t,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",_t,!0)},0)}function ft(l,t){const o=l.getBoundingClientRect();return vt(l,o,t)}function qe(l,t){const o=l.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(vt(l,o,t[p]));return u}function kt(l){return a.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function vt(l,t,o){const u=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new a.pointGeometry((o.clientX-t.left)*u,(o.clientY-t.top)*u)}function It(l,t){var o=t[0],u=t[1],p=t[2],f=t[3],_=o*f-p*u;return _?(l[0]=f*(_=1/_),l[1]=-u*_,l[2]=-p*_,l[3]=o*_,l):null}function Ft(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class tt extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:o,callback:u}of this.requestors)this._notify(o,u);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,o){this._validate(t,o)&&(this.images[t]=o)}_validate(t,o){let u=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,o){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||o<p[1])return!1;u=p[1]}return!0}_validateContent(t,o){return!(t&&(t.length!==4||t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,o){o.version=this.images[t].version+1,this.images[t]=o,this.updatedImages[t]=!0}removeImage(t){const o=this.images[t];delete this.images[t],delete this.patterns[t],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,o){let u=!0;if(!this.isLoaded())for(const p of t)this.images[p]||(u=!1);this.isLoaded()||u?this._notify(t,o):this.requestors.push({ids:t,callback:o})}_notify(t,o){const u={};for(const p of t){this.images[p]||this.fire(new a.Event("styleimagemissing",{id:p}));const f=this.images[p];f?u[p]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:Boolean(f.userImage&&f.userImage.render)}:a.warnOnce(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,u)}getPixelSize(){const{width:t,height:o}=this.atlasImage;return{width:t,height:o}}getPattern(t){const o=this.patterns[t],u=this.getImage(t);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const p={w:u.data.width+2,h:u.data.height+2,x:0,y:0},f=new a.ImagePosition(p,u);this.patterns[t]={bin:p,position:f}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const o=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(t,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const f in this.patterns)t.push(this.patterns[f].bin);const{w:o,h:u}=a.potpack(t),p=this.atlasImage;p.resize({width:o||1,height:u||1});for(const f in this.patterns){const{bin:_}=this.patterns[f],y=_.x+1,b=_.y+1,T=this.images[f].data,E=T.width,A=T.height;a.RGBAImage.copy(T,p,{x:0,y:0},{x:y,y:b},{width:E,height:A}),a.RGBAImage.copy(T,p,{x:0,y:A-1},{x:y,y:b-1},{width:E,height:1}),a.RGBAImage.copy(T,p,{x:0,y:0},{x:y,y:b+A},{width:E,height:1}),a.RGBAImage.copy(T,p,{x:E-1,y:0},{x:y-1,y:b},{width:1,height:A}),a.RGBAImage.copy(T,p,{x:0,y:0},{x:y+E,y:b},{width:1,height:A})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const o of t){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.images[o];Ft(u)&&this.updateImage(o,u)}}}const Ot=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(l,t){return function([o,u,p]){const f=a.degToRad(u+90),_=a.degToRad(p);return{x:o*Math.cos(f)*Math.sin(_),y:o*Math.sin(f)*Math.sin(_),z:o*Math.cos(_),azimuthal:u,polar:p}}(l.expression.evaluate(t))}interpolate(l,t,o){return{x:a.number(l.x,t.x,o),y:a.number(l.y,t.y,o),z:a.number(l.z,t.z,o),azimuthal:a.number(l.azimuthal,t.azimuthal,o),polar:a.number(l.polar,t.polar,o)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),gt="-transition";class et extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(Ot),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o={}){if(!this._validate(a.validateLight,t,o))for(const u in t){const p=t[u];a.endsWith(u,gt)?this._transitionable.setTransition(u.slice(0,-gt.length),p):this._transitionable.setValue(u,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,u){return(!u||u.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const ze=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),St="-transition";class si extends a.Evented{constructor(t,o){super(),this._transitionable=new a.Transitionable(ze),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(t){for(const o in t){const u=t[o];a.endsWith(o,St)?this._transitionable.setTransition(o.slice(0,-St.length),u):this._transitionable.setValue(o,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function ai(l,t,o,u){const p=a.smoothstep(45,65,o),[f,_]=vi(l,u),y=a.length(t);let b=1-Math.min(1,Math.exp((y-f)/(_-f)*-6));return b*=b*b,b=Math.min(1,1.00747*b),b*p*l.alpha}function vi(l,t){const o=.5/Math.tan(.5*t);return[l.range[0]+o,l.range[1]+o]}const Tr=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"])}),yi="-transition";class cr extends a.Evented{constructor(t,o){super(),this._transitionable=new a.Transitionable(Tr),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o={}){if(!this._validate(a.validateFog,t,o))for(const u in t){const p=t[u];a.endsWith(u,yi)?this._transitionable.setTransition(u.slice(0,-yi.length),p):this._transitionable.setValue(u,p)}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return a.smoothstep(45,65,t)*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?function(u,p,f){const _=a.MercatorCoordinate.fromLngLat(p),y=f.elevation?f.elevation.getAtPointOrZero(_):0,b=[_.x,_.y,y];return a.transformMat4(b,b,f.mercatorFogMatrix),ai(u,b,f.pitch,f._fov)}(this.state,t,o):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?vi(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,u){return(!u||u.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Lt{constructor(t,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const u=this.workerPool.acquire(this.id);for(let p=0;p<u.length;p++){const f=new Lt.Actor(u[p],o,this.id);f.name=`Worker ${p}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,o,u){a.asyncAll(this.actors,(p,f)=>{p.send(t,o,f)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function bi(l,t,o){return t*(a.EXTENT/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}Lt.Actor=a.Actor;class Ni{constructor(t,o,u,p){this.screenBounds=t,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(f=>p.pointCoordinate3D(f)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,o){let u,p;if(t instanceof a.pointGeometry||typeof t[0]=="number"){const f=a.pointGeometry.convert(t);u=[a.pointGeometry.convert(t)],p=o.isPointAboveHorizon(f)}else{const f=a.pointGeometry.convert(t[0]),_=a.pointGeometry.convert(t[1]);u=[f,_],p=a.polygonizeBounds(f,_).every(y=>o.isPointAboveHorizon(y))}return new Ni(u,o.getCameraPoint(),p,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const o=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],p=a.polygonizeBounds(o,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(p[3]=this.cameraPoint)),a.bufferConvexPolygon(p,t)}containsTile(t,o,u){const p=t.queryPadding+1,f=t.tileID.wrap,_=u?this._bufferedCameraMercator(p,o).map(R=>a.getTilePoint(t.tileTransform,R,f)):this._bufferedScreenMercator(p,o).map(R=>a.getTilePoint(t.tileTransform,R,f)),y=this.screenGeometryMercator.map(R=>a.getTileVec3(t.tileTransform,R,f)),b=y.map(R=>new a.pointGeometry(R[0],R[1])),T=o.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),E=a.getTileVec3(t.tileTransform,T,f),A=y.map(R=>{const D=a.sub(R,R,E);return a.normalize(D,D),new a.Ray(E,D)}),B=bi(t,1,o.zoom);if(a.polygonIntersectsBox(_,0,0,a.EXTENT,a.EXTENT))return{queryGeometry:this,tilespaceGeometry:b,tilespaceRays:A,bufferedTilespaceGeometry:_,bufferedTilespaceBounds:(O=a.getBounds(_),O.min.x=a.clamp(O.min.x,0,a.EXTENT),O.min.y=a.clamp(O.min.y,0,a.EXTENT),O.max.x=a.clamp(O.max.x,0,a.EXTENT),O.max.y=a.clamp(O.max.y,0,a.EXTENT),O),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:B};var O}_bufferedScreenMercator(t,o){const u=Er(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{const p=this.bufferedScreenGeometry(t).map(f=>o.pointCoordinate3D(f));return this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,o){const u=Er(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{const p=this.bufferedCameraGeometry(t).map(f=>o.pointCoordinate3D(f));return this._cameraRaycastCache[u]=p,p}}}function Er(l){return 100*l|0}function uo(l,t,o){const u=function(p,f){if(p)return o(p);if(f){const _=a.pick(a.extend(f,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(_.vectorLayers=f.vector_layers,_.vectorLayerIds=_.vectorLayers.map(y=>y.id)),_.tiles=t.canonicalizeTileset(_,l.url),o(null,_)}};return l.url?a.getJSON(t.transformRequest(t.normalizeSourceURL(l.url),a.ResourceType.Source),u):a.exported.frame(()=>u(null,l))}class an{constructor(t,o,u){this.bounds=a.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const o=Math.pow(2,t.z),u=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*o),p=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*o),f=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*o),_=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*o);return t.x>=u&&t.x<f&&t.y>=p&&t.y<_}}class Ko{constructor(t,o,u){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(u),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Bn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Rr{constructor(t,o,u,p){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=p,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let u=0;u<this.attributes.length;u++){const p=o.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,o,u){for(let p=0;p<this.attributes.length;p++){const f=this.attributes[p],_=o.attributes[f.name];_!==void 0&&t.vertexAttribPointer(_,f.components,t[Bn[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Bt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ln extends Bt{getDefault(){return a.Color.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Vs extends Bt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class $i extends Bt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Rn extends Bt{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Nt extends Bt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class cn extends Bt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Fn extends Bt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ur extends Bt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class On extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class ho extends Bt{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Jo extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class po extends Bt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Un extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class Sr extends Bt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Vn extends Bt{getDefault(){return a.Color.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ir extends Bt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Mr extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class un extends Bt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Qo extends Bt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Nn extends Bt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class fo extends Bt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Xa extends Bt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ns extends Bt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class js extends Bt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class mo extends Bt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Gs extends Bt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class jn extends Bt{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class $s extends Bt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Ar extends Bt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class hn extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Gn extends Bt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class $n extends Bt{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class _o extends $n{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class es extends $n{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class go extends es{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ${constructor(t,o,u,p){this.context=t,this.width=o,this.height=u;const f=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new _o(t,f),p&&(this.depthAttachment=new es(t,f))}destroy(){const t=this.context.gl,o=this.colorAttachment.get();if(o&&t.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class M{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ln(this),this.clearDepth=new Vs(this),this.clearStencil=new $i(this),this.colorMask=new Rn(this),this.depthMask=new Nt(this),this.stencilMask=new cn(this),this.stencilFunc=new Fn(this),this.stencilOp=new ur(this),this.stencilTest=new On(this),this.depthRange=new ho(this),this.depthTest=new Jo(this),this.depthFunc=new po(this),this.blend=new Un(this),this.blendFunc=new Sr(this),this.blendColor=new Vn(this),this.blendEquation=new Ir(this),this.cullFace=new Mr(this),this.cullFaceSide=new un(this),this.frontFace=new Qo(this),this.program=new Nn(this),this.activeTexture=new fo(this),this.viewport=new Xa(this),this.bindFramebuffer=new Ns(this),this.bindRenderbuffer=new js(this),this.bindTexture=new mo(this),this.bindVertexBuffer=new Gs(this),this.bindElementBuffer=new jn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new $s(this),this.pixelStoreUnpack=new Ar(this),this.pixelStoreUnpackPremultiplyAlpha=new hn(this),this.pixelStoreUnpackFlipY=new Gn(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o){return new Ko(this,t,o)}createVertexBuffer(t,o,u){return new Rr(this,t,o,u)}createRenderbuffer(t,o,u){const p=this.gl,f=p.createRenderbuffer();return this.bindRenderbuffer.set(f),p.renderbufferStorage(p.RENDERBUFFER,t,o,u),this.bindRenderbuffer.set(null),f}createFramebuffer(t,o,u){return new $(this,t,o,u)}clear({color:t,depth:o,stencil:u}){const p=this.gl;let f=0;t&&(f|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(f|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(f|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){H(t.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class k extends a.Evented{constructor(t,o,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},o),a.extend(this,a.pick(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=uo(this._options,this.map._requestManager,(t,o)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):o&&(a.extend(this,o),o.bounds&&(this.tileBounds=new an(o.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(o.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const u=a.exported.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=a.getImage(this.map._requestManager.transformRequest(p,a.ResourceType.Tile),(f,_,y,b)=>(delete t.request,t.aborted?(t.state="unloaded",o(null)):f?(t.state="errored",o(f)):_?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:y,expires:b}),t.setTexture(_,this.map.painter),t.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null)))}static loadTileData(t,o,u){t.setTexture(o,u)}static unloadTileData(t,o){t.texture&&o.saveTileTexture(t.texture)}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o()}unloadTile(t,o){t.texture&&this.map.painter.saveTileTexture(t.texture),o()}hasTransition(){return!1}}let N;function Y(l,t,o,u,p,f,_,y){const b=[l,o,p,t,u,f,1,1,1],T=[_,y,1],E=a.adjoint([],b),[A,B,O]=a.transformMat3(T,T,a.transpose(E,E));return a.multiply(b,[A,0,0,0,B,0,0,0,O],b)}class ie extends a.Evented{constructor(t,o,u,p){super(),this.id=t,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=o}load(t){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(o,u)=>{if(this._loaded=!0,o)this.fire(new a.ErrorEvent(o));else if(u){const{HTMLImageElement:p}=a.window;this.image=u instanceof p?a.exported.getImageData(u):u,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const o=t.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(u){let p=1/0,f=1/0,_=-1/0,y=-1/0;for(const A of u)p=Math.min(p,A.x),f=Math.min(f,A.y),_=Math.max(_,A.x),y=Math.max(y,A.y);const b=Math.max(_-p,y-f),T=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),E=Math.pow(2,T);return new a.CanonicalTileID(T,Math.floor((p+_)/2*E),Math.floor((f+y)/2*E))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const b in this.tiles){const T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}if(this._boundsArray)return;const o=a.tileTransform(this.tileID,this.map.transform.projection),[u,p,f,_]=this.coordinates.map(b=>{const T=o.projection.project(b[0],b[1]);return a.getTilePoint(o,T)._round()});this.perspectiveTransform=function(b,T,E,A,B,O,R,D,X,j){const q=Y(0,0,b,0,0,T,b,T),W=Y(E,A,B,O,R,D,X,j);return a.multiply(W,a.adjoint(q,q),W),[W[6]/W[8]*b/a.EXTENT,W[7]/W[8]*T/a.EXTENT]}(this.width,this.height,u.x,u.y,p.x,p.y,_.x,_.y,f.x,f.y);const y=this._boundsArray=new a.StructArrayLayout4i8;y.emplaceBack(u.x,u.y,0,0),y.emplaceBack(p.x,p.y,a.EXTENT,0),y.emplaceBack(_.x,_.y,0,a.EXTENT),y.emplaceBack(f.x,f.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(y,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,o=t.gl;this.texture?this.texture.update(this.image):(this.texture=new a.Texture(t,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(t,o){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},o(null)):(t.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ue={vector:class extends a.Evented{constructor(l,t,o,u){if(super(),this.id=l,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(t,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=uo(this._options,this.map._requestManager,(l,t)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new a.ErrorEvent(l)):t&&(a.extend(this,t),t.bounds&&(this.tileBounds=new an(t.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l();const t=this.map.style._getSourceCaches(this.id);for(const o of t)o.clearTiles();this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(l,t){const o=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(o,a.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(u.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=t:l.request=l.actor.send("reloadTile",u,p.bind(this));else if(l.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",u,p.bind(this),void 0,!0);else{const f=a.loadVectorTile.call({deduped:this._deduped},u,(_,y)=>{_||!y?p.call(this,_):(u.data={cacheControl:y.cacheControl,expires:y.expires,rawData:y.rawData.slice(0)},l.actor&&l.actor.send("loadTile",u,p.bind(this),void 0,!0))},!0);l.request={cancel:f}}function p(f,_){return delete l.request,l.aborted?t(null):f&&f.status!==404?t(f):(_&&_.resourceTiming&&(l.resourceTiming=_.resourceTiming),this.map._refreshExpiredTiles&&_&&l.setExpiryData(_),l.loadVectorData(_,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:k,"raster-dem":class extends k{constructor(l,t,o,u){super(l,t,o,u),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const o=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,f){p&&(l.state="errored",t(p)),f&&(l.dem=f,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=a.getImage(this.map._requestManager.transformRequest(o,a.ResourceType.Tile),function(p,f,_,y){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(p)l.state="errored",t(p);else if(f){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:_,expires:y});const b=a.window.ImageBitmap&&f instanceof a.window.ImageBitmap&&(N==null&&(N=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),N),T=1-(f.width-a.prevPowerOfTwo(f.width))/2;T<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const E=b?f:a.exported.getImageData(f,T),A={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:E,encoding:this.encoding,padding:T};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",A,u.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){const t=l.canonical,o=Math.pow(2,t.z),u=(t.x-1+o)%o,p=t.x===0?l.wrap-1:l.wrap,f=(t.x+1+o)%o,_=t.x+1===o?l.wrap+1:l.wrap,y={};return y[new a.OverscaledTileID(l.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},y[new a.OverscaledTileID(l.overscaledZ,_,t.z,f,t.y).key]={backfilled:!1},t.y>0&&(y[new a.OverscaledTileID(l.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},y[new a.OverscaledTileID(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},y[new a.OverscaledTileID(l.overscaledZ,_,t.z,f,t.y-1).key]={backfilled:!1}),t.y+1<o&&(y[new a.OverscaledTileID(l.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},y[new a.OverscaledTileID(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},y[new a.OverscaledTileID(l.overscaledZ,_,t.z,f,t.y+1).key]={backfilled:!1}),y}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded"}},geojson:class extends a.Evented{constructor(l,t,o,u){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(u),this._data=t.data,this._options=a.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:a.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},t),this}getClusterLeaves(l,t,o,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:t,offset:o},u),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const l=a.extend({},this.workerOptions),t=this._data;typeof t=="string"?(l.request=this.map._requestManager.transformRequest(a.exported.resolveURL(t),a.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(o,u)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new a.ErrorEvent(o));else{const p={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&u&&u.resourceTiming&&u.resourceTiming[this.id]&&(p.resourceTiming=u.resourceTiming[this.id]),this.fire(new a.Event("data",p)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,t){const o=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(o,{type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(u,p)=>(delete l.request,l.unloadVectorData(),l.aborted?t(null):u?t(u):(l.loadVectorData(p,this.map.painter,o==="reloadTile"),t(null))),void 0,o==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ie{constructor(l,t,o,u){super(l,t,o,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,a.ResourceType.Source).url);a.getVideo(this.urls,(t,o)=>{this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(l,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ie,canvas:class extends ie{constructor(l,t,o,u){super(l,t,o,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(f=>typeof f!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends a.Evented{constructor(l,t,o,u){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new an(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this._map=l,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:o,z:u}=l.canonical;return this._implementation.hasTile({x:t,y:o,z:u})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:o,y:u,z:p}=l.tileID.canonical,f=new a.window.AbortController,_=this._implementation.loadTile({x:o,y:u,z:p},{signal:f.signal});if(!_)return this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null);_.cancel=()=>f.abort(),l.request=_.then(function(y){return delete l.request,l.aborted?(l.state="unloaded",t(null)):y?function(b){return b instanceof a.window.ImageData||b instanceof a.window.ImageBitmap||b instanceof a.window.HTMLCanvasElement}(y)?(this.loadTileData(l,y),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null))}.bind(this)).catch(y=>{y.code!==20&&(l.state="errored",t(y))})}loadTileData(l,t){k.loadTileData(l,t,this._map.painter)}unloadTileData(l){k.unloadTileData(l,this._map.painter)}prepareTile(l){if(!this._implementation.prepareTile)return null;const{x:t,y:o,z:u}=l.tileID.canonical,p=this._implementation.prepareTile({x:t,y:o,z:u});return p?(this.loadTileData(l,p),l.state="loaded",p):null}unloadTile(l,t){if(this.unloadTileData(l),this._implementation.unloadTile){const{x:o,y:u,z:p}=l.tileID.canonical;this._implementation.unloadTile({x:o,y:u,z:p})}t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ce=function(l,t,o,u){const p=new ue[t.type](l,t,o,u);if(p.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${p.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],p),p};function ne(l,t){const o=a.identity([]);return a.scale(o,o,[.5*l.width,.5*-l.height,1]),a.translate(o,o,[1,-1,0]),a.multiply$1(o,o,l.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(o)}function pe(l,t,o,u,p,f,_,y=!1){const b=l.tilesIn(u,_,y);b.sort(je);const T=[];for(const A of b)T.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(t,o,l._state,A,p,f,ne(l.transform,A.tile.tileID),y)});const E=function(A){const B={},O={};for(const R of A){const D=R.queryResults,X=R.wrappedTileID,j=O[X]=O[X]||{};for(const q in D){const W=D[q],K=j[q]=j[q]||{},Z=B[q]=B[q]||[];for(const ee of W)K[ee.featureIndex]||(K[ee.featureIndex]=!0,Z.push(ee))}}return B}(T);for(const A in E)E[A].forEach(B=>{const O=B.feature,R=O.layer;R&&R.type!=="background"&&R.type!=="sky"&&(O.source=R.source,R["source-layer"]&&(O.sourceLayer=R["source-layer"]),O.state=O.id!==void 0?l.getFeatureState(R["source-layer"],O.id):{})});return E}function Ae(l,t){const o=l.getRenderableIds().map(f=>l.getTileByID(f)),u=[],p={};for(let f=0;f<o.length;f++){const _=o[f],y=_.tileID.canonical.key;p[y]||(p[y]=!0,_.querySourceFeatures(u,t))}return u}function je(l,t){const o=l.tileID,u=t.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function ke(){return Po.workerClass!=null?new Po.workerClass:new a.window.Worker(Po.workerUrl)}const lt="mapboxgl_preloaded_worker_pool";class nt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<nt.workerCount;)this.workers.push(new ke);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[lt]}numActive(){return Object.keys(this.active).length}}let ot;function ht(){return ot||(ot=new nt),ot}function fe(l,t){const o={};for(const u in l)u!=="ref"&&(o[u]=l[u]);return a.refProperties.forEach(u=>{u in t&&(o[u]=t[u])}),o}function jt(l){l=l.slice();const t=Object.create(null);for(let o=0;o<l.length;o++)t[l[o].id]=l[o];for(let o=0;o<l.length;o++)"ref"in l[o]&&(l[o]=fe(l[o],t[l[o].ref]));return l}nt.workerCount=2;const Je={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ut(l,t,o){o.push({command:Je.addSource,args:[l,t[l]]})}function Gt(l,t,o){t.push({command:Je.removeSource,args:[l]}),o[l]=!0}function Zn(l,t,o,u){Gt(l,o,u),Ut(l,t,o)}function qr(l,t,o){let u;for(u in l[o])if(l[o].hasOwnProperty(u)&&u!=="data"&&!H(l[o][u],t[o][u]))return!1;for(u in t[o])if(t[o].hasOwnProperty(u)&&u!=="data"&&!H(l[o][u],t[o][u]))return!1;return!0}function Ne(l,t,o,u,p,f){let _;for(_ in t=t||{},l=l||{})l.hasOwnProperty(_)&&(H(l[_],t[_])||o.push({command:f,args:[u,_,t[_],p]}));for(_ in t)t.hasOwnProperty(_)&&!l.hasOwnProperty(_)&&(H(l[_],t[_])||o.push({command:f,args:[u,_,t[_],p]}))}function Pt(l){return l.id}function Mt(l,t){return l[t.id]=t,l}class Fr{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.clamp(t,0,1);let o=1,u=this._distances[o];const p=t*this.paddedLength+this.padding;for(;u<p&&o<this._distances.length;)u=this._distances[++o];const f=o-1,_=this._distances[f],y=u-_,b=y>0?(p-_)/y:0;return this.points[f].mult(1-b).add(this.points[o].mult(b))}}class qn{constructor(t,o,u){const p=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(o/u);for(let _=0;_<this.xCellCount*this.yCellCount;_++)p.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,u,p,f){this._forEachCell(o,u,p,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(f)}insertCircle(t,o,u,p){this._forEachCell(o-p,u-p,o+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,o,u,p,f,_){this.boxCells[f].push(_)}_insertCircleCell(t,o,u,p,f,_){this.circleCells[f].push(_)}_query(t,o,u,p,f,_){if(u<0||t>this.width||p<0||o>this.height)return!f&&[];const y=[];if(t<=0&&o<=0&&this.width<=u&&this.height<=p){if(f)return!0;for(let b=0;b<this.boxKeys.length;b++)y.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const T=this.circles[3*b],E=this.circles[3*b+1],A=this.circles[3*b+2];y.push({key:this.circleKeys[b],x1:T-A,y1:E-A,x2:T+A,y2:E+A})}return _?y.filter(_):y}return this._forEachCell(t,o,u,p,this._queryCell,y,{hitTest:f,seenUids:{box:{},circle:{}}},_),f?y.length>0:y}_queryCircle(t,o,u,p,f){const _=t-u,y=t+u,b=o-u,T=o+u;if(y<0||_>this.width||T<0||b>this.height)return!p&&[];const E=[];return this._forEachCell(_,b,y,T,this._queryCellCircle,E,{hitTest:p,circle:{x:t,y:o,radius:u},seenUids:{box:{},circle:{}}},f),p?E.length>0:E}query(t,o,u,p,f){return this._query(t,o,u,p,!1,f)}hitTest(t,o,u,p,f){return this._query(t,o,u,p,!0,f)}hitTestCircle(t,o,u,p){return this._queryCircle(t,o,u,!0,p)}_queryCell(t,o,u,p,f,_,y,b){const T=y.seenUids,E=this.boxCells[f];if(E!==null){const B=this.bboxes;for(const O of E)if(!T.box[O]){T.box[O]=!0;const R=4*O;if(t<=B[R+2]&&o<=B[R+3]&&u>=B[R+0]&&p>=B[R+1]&&(!b||b(this.boxKeys[O]))){if(y.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[O],x1:B[R],y1:B[R+1],x2:B[R+2],y2:B[R+3]})}}}const A=this.circleCells[f];if(A!==null){const B=this.circles;for(const O of A)if(!T.circle[O]){T.circle[O]=!0;const R=3*O;if(this._circleAndRectCollide(B[R],B[R+1],B[R+2],t,o,u,p)&&(!b||b(this.circleKeys[O]))){if(y.hitTest)return _.push(!0),!0;{const D=B[R],X=B[R+1],j=B[R+2];_.push({key:this.circleKeys[O],x1:D-j,y1:X-j,x2:D+j,y2:X+j})}}}}}_queryCellCircle(t,o,u,p,f,_,y,b){const T=y.circle,E=y.seenUids,A=this.boxCells[f];if(A!==null){const O=this.bboxes;for(const R of A)if(!E.box[R]){E.box[R]=!0;const D=4*R;if(this._circleAndRectCollide(T.x,T.y,T.radius,O[D+0],O[D+1],O[D+2],O[D+3])&&(!b||b(this.boxKeys[R])))return _.push(!0),!0}}const B=this.circleCells[f];if(B!==null){const O=this.circles;for(const R of B)if(!E.circle[R]){E.circle[R]=!0;const D=3*R;if(this._circlesCollide(O[D],O[D+1],O[D+2],T.x,T.y,T.radius)&&(!b||b(this.circleKeys[R])))return _.push(!0),!0}}}_forEachCell(t,o,u,p,f,_,y,b){const T=this._convertToXCellCoord(t),E=this._convertToYCellCoord(o),A=this._convertToXCellCoord(u),B=this._convertToYCellCoord(p);for(let O=T;O<=A;O++)for(let R=E;R<=B;R++)if(f.call(this,t,o,u,p,this.xCellCount*R+O,_,y,b))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,u,p,f,_){const y=p-t,b=f-o,T=u+_;return T*T>y*y+b*b}_circleAndRectCollide(t,o,u,p,f,_,y){const b=(_-p)/2,T=Math.abs(t-(p+b));if(T>b+u)return!1;const E=(y-f)/2,A=Math.abs(o-(f+E));if(A>E+u)return!1;if(T<=b||A<=E)return!0;const B=T-b,O=A-E;return B*B+O*O<=u*u}}const Ct=Math.tan(85*Math.PI/180);function Wn(l,t,o,u,p,f){const _=a.create();if(o){if(p.projection.name==="globe")a.multiply$1(_,_,a.calculateGlobeLabelMatrix(p,t));else{const y=It([],f);_[0]=y[0],_[1]=y[1],_[4]=y[2],_[5]=y[3]}u||a.rotateZ(_,_,p.angle)}else a.multiply$1(_,p.labelPlaneMatrix,l);return _}function yo(l,t,o,u,p,f){if(o){if(p.projection.name==="globe"){const _=Wn(l,t,o,u,p,f);return a.invert(_,_),a.multiply$1(_,l,_),_}{const _=a.clone(l),y=a.identity([]);return y[0]=f[0],y[1]=f[1],y[4]=f[2],y[5]=f[3],a.multiply$1(_,_,y),u||a.rotateZ(_,_,-p.angle),_}}return p.glCoordMatrix}function ji(l,t,o=0){const u=[l.x,l.y,o,1];o?a.transformMat4$1(u,u,t):Ji(u,u,t);const p=u[3];return{point:new a.pointGeometry(u[0]/p,u[1]/p),signedDistanceFromCamera:p}}function hr(l,t){const o=[l[0],l[1],l[2],1];a.transformMat4$1(o,o,t);const u=o[3];return{point:new a.pointGeometry(o[0]/u,o[1]/u),signedDistanceFromCamera:u}}function li(l,t){return Math.min(.5+l/t*.5,1.5)}function oh(l,t){const o=l[0]/l[3],u=l[1]/l[3];return o>=-t[0]&&o<=t[0]&&u>=-t[1]&&u<=t[1]}function ts(l,t,o,u,p,f,_,y,b,T){const E=o.transform,A=u?l.textSizeData:l.iconSizeData,B=a.evaluateSizeForZoom(A,o.transform.zoom),O=[256/o.width*2+1,256/o.height*2+1],R=u?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;R.clear();const D=l.lineVertexArray,X=u?l.text.placedSymbolArray:l.icon.placedSymbolArray,j=o.transform.width/o.transform.height;let q=!1;for(let W=0;W<X.length;W++){const K=X.get(W);if(K.writingMode!==a.WritingMode.vertical||q||W!==0&&X.get(W-1).writingMode===a.WritingMode.horizontal||(q=!0),(K.hidden||K.writingMode===a.WritingMode.vertical)&&!q){Mi(K.numGlyphs,R);continue}q=!1;const Z=new a.pointGeometry(K.tileAnchorX,K.tileAnchorY),ee=b?b(Z):[0,0,0],he=E.projection.projectTilePoint(Z.x,Z.y,T.canonical),xe=[he.x+ee[0],he.y+ee[1],he.z+ee[2]],Te=[...xe,1];if(a.transformMat4$1(Te,Te,t),!oh(Te,O)){Mi(K.numGlyphs,R);continue}const be=li(o.transform.cameraToCenterDistance,Te[3]),Re=a.evaluateSizeForFeature(A,B,K),de=_?Re/be:Re*be,Fe=ji(new a.pointGeometry(xe[0],xe[1]),p,xe[2]);if(Fe.signedDistanceFromCamera<=0){Mi(K.numGlyphs,R);continue}let De={};const Ke=_?null:b,Ee=qs(K,de,!1,y,t,p,f,l.glyphOffsetArray,D,R,Fe.point,Z,De,j,Ke,E.projection,T);q=Ee.useVertical,Ke&&Ee.needsFlipping&&(De={}),(Ee.notEnoughRoom||q||Ee.needsFlipping&&qs(K,de,!0,y,t,p,f,l.glyphOffsetArray,D,R,Fe.point,Z,De,j,Ke,E.projection,T).notEnoughRoom)&&Mi(K.numGlyphs,R)}u?l.text.dynamicLayoutVertexBuffer.updateData(R):l.icon.dynamicLayoutVertexBuffer.updateData(R)}function Zs(l,t,o,u,p,f,_,y,b,T,E,A,B,O,R){const D=y.glyphStartIndex+y.numGlyphs,X=y.lineStartIndex,j=y.lineStartIndex+y.lineLength,q=t.getoffsetX(y.glyphStartIndex),W=t.getoffsetX(D-1),K=vo(l*q,o,u,p,f,_,y.segment,X,j,b,T,E,A,B,!0,O,R);if(!K)return null;const Z=vo(l*W,o,u,p,f,_,y.segment,X,j,b,T,E,A,B,!0,O,R);return Z?{first:K,last:Z}:null}function xo(l,t,o,u){return l.writingMode===a.WritingMode.horizontal&&Math.abs(o.y-t.y)>Math.abs(o.x-t.x)*u?{useVertical:!0}:l.writingMode===a.WritingMode.vertical?t.y<o.y?{needsFlipping:!0}:null:l.flipState!==0&&function(p,f,_){const y=(f.x-p.x)*_;return y===0||Math.abs((f.y-p.y)/y)>Ct}(t,o,u)?l.flipState===1?{needsFlipping:!0}:null:t.x>o.x?{needsFlipping:!0}:null}function qs(l,t,o,u,p,f,_,y,b,T,E,A,B,O,R,D,X){const j=t/24,q=l.lineOffsetX*j,W=l.lineOffsetY*j;let K;if(l.numGlyphs>1){const Z=l.glyphStartIndex+l.numGlyphs,ee=l.lineStartIndex,he=l.lineStartIndex+l.lineLength,xe=Zs(j,y,q,W,o,E,A,l,b,f,B,R,!1,D,X);if(!xe)return{notEnoughRoom:!0};const Te=ji(xe.first.point,_).point,be=ji(xe.last.point,_).point;if(u&&!o){const Re=xo(l,Te,be,O);if(l.flipState=Re&&Re.needsFlipping?1:2,Re)return Re}K=[xe.first];for(let Re=l.glyphStartIndex+1;Re<Z-1;Re++)K.push(vo(j*y.getoffsetX(Re),q,W,o,E,A,l.segment,ee,he,b,f,B,R,!1,!1,D,X));K.push(xe.last)}else{if(u&&!o){const ee=ji(A,p).point,he=l.lineStartIndex+l.segment+1,xe=new a.pointGeometry(b.getx(he),b.gety(he)),Te=ji(xe,p),be=xo(l,ee,Te.signedDistanceFromCamera>0?Te.point:Vt(A,xe,ee,1,p,void 0,D,X.canonical),O);if(l.flipState=be&&be.needsFlipping?1:2,be)return be}const Z=vo(j*y.getoffsetX(l.glyphStartIndex),q,W,o,E,A,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,b,f,B,R,!1,!1,D,X);if(!Z)return{notEnoughRoom:!0};K=[Z]}for(const Z of K)a.addDynamicAttributes(T,Z.point,Z.angle);return{}}function Ha(l,t,o,u,p){const f=u.projectTilePoint(l.x,l.y,t);if(!p)return ji(f,o,f.z);const _=p(l);return ji(new a.pointGeometry(f.x+_[0],f.y+_[1]),o,f.z+_[2])}function Vt(l,t,o,u,p,f,_,y){const b=Ha(l.add(l.sub(t)._unit()),y,p,_,f).point,T=o.sub(b);return o.add(T._mult(u/T.mag()))}function vo(l,t,o,u,p,f,_,y,b,T,E,A,B,O,R,D,X){const j=u?l-t:l+t;let q=j>0?1:-1,W=0;u&&(q*=-1,W=Math.PI),q<0&&(W+=Math.PI);let K=q>0?y+_:y+_+1,Z=p,ee=p,he=0,xe=0;const Te=Math.abs(j),be=[],Re=[];let de=f;const Fe=()=>{const He=K-q;return he===0?f:new a.pointGeometry(T.getx(He),T.gety(He))},De=()=>Vt(Fe(),de,ee,Te-he+1,E,B,D,X.canonical);for(;he+xe<=Te;){if(K+=q,K<y||K>=b)return null;if(ee=Z,be.push(Z),O&&Re.push(de||Fe()),Z=A[K],Z===void 0){de=new a.pointGeometry(T.getx(K),T.gety(K));const He=Ha(de,X.canonical,E,D,B);Z=He.signedDistanceFromCamera>0?A[K]=He.point:De()}else de=null;he+=xe,xe=ee.dist(Z)}R&&B&&(de=de||new a.pointGeometry(T.getx(K),T.gety(K)),A[K]=Z=A[K]===void 0?Z:De(),xe=ee.dist(Z));const Ke=(Te-he)/xe,Ee=Z.sub(ee),Xe=Ee.mult(Ke)._add(ee);o&&Xe._add(Ee._unit()._perp()._mult(o*q));const st=W+Math.atan2(Z.y-ee.y,Z.x-ee.x);return be.push(Xe),O&&(de=de||new a.pointGeometry(T.getx(K),T.gety(K)),Re.push(function(He,Ye,ct){const Tt=1-ct;return new a.pointGeometry(He.x*Tt+Ye.x*ct,He.y*Tt+Ye.y*ct)}(Re.length>0?Re[Re.length-1]:de,de,Ke))),{point:Xe,angle:st,path:be,tilePath:Re}}const Ya=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Mi(l,t){for(let o=0;o<l;o++){const u=t.length;t.resize(u+4),t.float32.set(Ya,3*u)}}function Ji(l,t,o){const u=t[0],p=t[1];return l[0]=o[0]*u+o[4]*p+o[12],l[1]=o[1]*u+o[5]*p+o[13],l[3]=o[3]*u+o[7]*p+o[15],l}const Cr=100;class Ws{constructor(t,o,u=new qn(t.width+200,t.height+200,25),p=new qn(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Cr,this.screenBottomBoundary=t.height+Cr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,u,p,f,_,y){let b=o.projectedAnchorX,T=o.projectedAnchorY,E=o.projectedAnchorZ;const A=o.elevation,B=o.tileID;if(A&&B){const K=this.transform.projection.upVector(B.canonical,o.tileAnchorX,o.tileAnchorY),Z=this.transform.projection.upVectorScale(B.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;b+=K[0]*A*Z,T+=K[1]*A*Z,E+=K[2]*A*Z}const O=this.projectAndGetPerspectiveRatio(_,[b,T,E],o.tileID,this.transform.projection.name==="globe"||!!A||this.transform.pitch>0),R=f*O.perspectiveRatio,D=(o.x1*t+u.x-o.padding)*R+O.point.x,X=(o.y1*t+u.y-o.padding)*R+O.point.y,j=(o.x2*t+u.x+o.padding)*R+O.point.x,q=(o.y2*t+u.y+o.padding)*R+O.point.y,W=O.perspectiveRatio<=.55||O.occluded;return!this.isInsideGrid(D,X,j,q)||!p&&this.grid.hitTest(D,X,j,q,y)||W?{box:[],offscreen:!1,occluded:O.occluded}:{box:[D,X,j,q],offscreen:this.isOffscreen(D,X,j,q),occluded:!1}}placeCollisionCircles(t,o,u,p,f,_,y,b,T,E,A,B,O,R){const D=[],X=this.transform.elevation,j=X?X.getAtTileOffsetFunc(R,this.transform.center.lat,this.transform.worldSize,this.transform.projection):De=>[0,0,0],q=new a.pointGeometry(o.tileAnchorX,o.tileAnchorY),W=this.transform.projection.projectTilePoint(o.tileAnchorX,o.tileAnchorY,R.canonical),K=j(q),Z=[W.x+K[0],W.y+K[1],W.z+K[2]],ee=this.projectAndGetPerspectiveRatio(_,[Z[0],Z[1],Z[2]],R,this.transform.projection.name==="globe"||!!X||this.transform.pitch>0),{perspectiveRatio:he}=ee,xe=(E?f/he:f*he)/a.ONE_EM,Te=ji(new a.pointGeometry(Z[0],Z[1]),y,Z[2]).point,be=ee.signedDistanceFromCamera>0?Zs(xe,p,o.lineOffsetX*xe,o.lineOffsetY*xe,!1,Te,q,o,u,y,{},X&&!E?j:null,E&&!!X,this.transform.projection,R):null;let Re=!1,de=!1,Fe=!0;if(be&&!ee.occluded){const De=.5*B*he+O,Ke=new a.pointGeometry(-100,-100),Ee=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Xe=new Fr,st=be.first,He=be.last;let Ye=[];for(let it=st.path.length-1;it>=1;it--)Ye.push(st.path[it]);for(let it=1;it<He.path.length;it++)Ye.push(He.path[it]);const ct=2.5*De;if(b){const it=Ye.map(X?(dt,Rt)=>{const ci=j(Rt<st.path.length-1?st.tilePath[st.path.length-1-Rt]:He.tilePath[Rt-st.path.length+2]);return ji(dt,b,ci[2])}:dt=>ji(dt,b));Ye=it.some(dt=>dt.signedDistanceFromCamera<=0)?[]:it.map(dt=>dt.point)}let Tt=[];if(Ye.length>0){const it=Ye[0].clone(),dt=Ye[0].clone();for(let Rt=1;Rt<Ye.length;Rt++)it.x=Math.min(it.x,Ye[Rt].x),it.y=Math.min(it.y,Ye[Rt].y),dt.x=Math.max(dt.x,Ye[Rt].x),dt.y=Math.max(dt.y,Ye[Rt].y);Tt=it.x>=Ke.x&&dt.x<=Ee.x&&it.y>=Ke.y&&dt.y<=Ee.y?[Ye]:dt.x<Ke.x||it.x>Ee.x||dt.y<Ke.y||it.y>Ee.y?[]:a.clipLine([Ye],Ke.x,Ke.y,Ee.x,Ee.y)}for(const it of Tt){Xe.reset(it,.25*De);let dt=0;dt=Xe.length<=.5*De?1:Math.ceil(Xe.paddedLength/ct)+1;for(let Rt=0;Rt<dt;Rt++){const ci=Rt/Math.max(dt-1,1),Fi=Xe.lerp(ci),Oi=Fi.x+Cr,rr=Fi.y+Cr;D.push(Oi,rr,De,0);const Pr=Oi-De,Jr=rr-De,bn=Oi+De,Qr=rr+De;if(Fe=Fe&&this.isOffscreen(Pr,Jr,bn,Qr),de=de||this.isInsideGrid(Pr,Jr,bn,Qr),!t&&this.grid.hitTestCircle(Oi,rr,De,A)&&(Re=!0,!T))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!T&&Re||!de?[]:D,offscreen:Fe,collisionDetected:Re,occluded:ee.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,p=1/0,f=-1/0,_=-1/0;for(const E of t){const A=new a.pointGeometry(E.x+Cr,E.y+Cr);u=Math.min(u,A.x),p=Math.min(p,A.y),f=Math.max(f,A.x),_=Math.max(_,A.y),o.push(A)}const y=this.grid.query(u,p,f,_).concat(this.ignoredGrid.query(u,p,f,_)),b={},T={};for(const E of y){const A=E.key;if(b[A.bucketInstanceId]===void 0&&(b[A.bucketInstanceId]={}),b[A.bucketInstanceId][A.featureIndex])continue;const B=[new a.pointGeometry(E.x1,E.y1),new a.pointGeometry(E.x2,E.y1),new a.pointGeometry(E.x2,E.y2),new a.pointGeometry(E.x1,E.y2)];a.polygonIntersectsPolygon(o,B)&&(b[A.bucketInstanceId][A.featureIndex]=!0,T[A.bucketInstanceId]===void 0&&(T[A.bucketInstanceId]=[]),T[A.bucketInstanceId].push(A.featureIndex))}return T}insertCollisionBox(t,o,u,p,f){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:f},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,u,p,f){const _=o?this.ignoredGrid:this.grid,y={bucketInstanceId:u,featureIndex:p,collisionGroupID:f};for(let b=0;b<t.length;b+=4)_.insertCircle(y,t[b],t[b+1],t[b+2])}projectAndGetPerspectiveRatio(t,o,u,p){const f=[o[0],o[1],o[2],1];let _=!1;return o[2]||this.transform.pitch>0?(a.transformMat4$1(f,f,t),this.fogState&&u&&(_=function(y,b,T,E,A,B){const O=B.calculateFogTileMatrix(A),R=[b,T,E];return a.transformMat4(R,R,O),ai(y,R,B.pitch,B._fov)}(this.fogState,o[0],o[1],o[2],u.toUnwrapped(),this.transform)>.9)):Ji(f,f,t),{point:new a.pointGeometry((f[0]/f[3]+1)/2*this.transform.width+Cr,(-f[1]/f[3]+1)/2*this.transform.height+Cr),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/f[3]*.5,1.5),signedDistanceFromCamera:f[3],occluded:p&&f[2]>f[3]||_}}isOffscreen(t,o,u,p){return u<Cr||t>=this.screenRightBoundary||p<Cr||o>this.screenBottomBoundary}isInsideGrid(t,o,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=a.identity([]);return a.translate(t,t,[-100,-100,0]),t}}class wi{constructor(t,o,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Wr{constructor(t,o,u,p,f,_=!1){this.text=new wi(t?t.text:null,o,u,f),this.icon=new wi(t?t.icon:null,o,p,f),this.clipped=_}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xr{constructor(t,o,u,p=!1){this.text=t,this.icon=o,this.skipFade=u,this.clipped=p}}class Bi{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Ka{constructor(t,o,u,p,f){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=f}}class zr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[t]}}function bo(l,t,o,u,p){const{horizontalAlign:f,verticalAlign:_}=a.getAnchorAlignment(l),y=-(f-.5)*t,b=-(_-.5)*o,T=a.evaluateVariableOffset(l,u);return new a.pointGeometry(y+T[0]*p,b+T[1]*p)}function wo(l,t,o,u,p){const f=new a.pointGeometry(l,t);return o&&f._rotate(u?p:-p),f}class sh{constructor(t,o,u,p,f){this.transform=t.clone(),this.collisionIndex=new Ws(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new zr(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,u,p){const f=u.getBucket(o),_=u.latestFeatureIndex;if(!f||!_||o.id!==f.layerIds[0])return;const y=f.layers[0].layout,b=u.collisionBoxArray,T=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),E=u.tileSize/a.EXTENT,A=u.tileID.toUnwrapped(),B=this.transform.calculateProjMatrix(A),O=y.get("text-pitch-alignment")==="map",R=y.get("text-rotation-alignment")==="map";o.compileFilter();const D=o.dynamicFilter(),X=o.dynamicFilterNeedsFeature(),j=this.transform.calculatePixelsToTileUnitsMatrix(u),q=Wn(B,u.tileID.canonical,O,R,this.transform,j);let W=null;if(O){const ee=yo(B,u.tileID.canonical,O,R,this.transform,j);W=a.multiply$1([],this.transform.labelPlaneMatrix,ee)}let K=null;D&&u.latestFeatureIndex&&(K={unwrappedTileID:A,dynamicFilter:D,dynamicFilterNeedsFeature:X,featureIndex:u.latestFeatureIndex}),this.retainedQueryData[f.bucketInstanceId]=new Ka(f.bucketInstanceId,_,f.sourceLayerIndex,f.index,u.tileID);const Z={bucket:f,layout:y,posMatrix:B,textLabelPlaneMatrix:q,labelToScreenMatrix:W,clippingData:K,scale:T,textPixelRatio:E,holdingForFade:u.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(f.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(f.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(p)for(const ee of f.sortKeyRanges){const{sortKey:he,symbolInstanceStart:xe,symbolInstanceEnd:Te}=ee;t.push({sortKey:he,symbolInstanceStart:xe,symbolInstanceEnd:Te,parameters:Z})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:Z})}attemptAnchorPlacement(t,o,u,p,f,_,y,b,T,E,A,B,O,R,D,X,j,q){const W=[B.textOffset0,B.textOffset1],K=bo(t,u,p,W,f),Z=this.collisionIndex.placeCollisionBox(f,o,wo(K.x,K.y,_,y,this.transform.angle),A,b,T,E.predicate);if((!X||this.collisionIndex.placeCollisionBox(R.getSymbolInstanceIconSize(q,this.transform.zoom,O),X,wo(K.x,K.y,_,y,this.transform.angle),A,b,T,E.predicate).box.length!==0)&&Z.box.length>0){let ee;return this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(ee=this.prevPlacement.variableOffsets[B.crossTileID].anchor),this.variableOffsets[B.crossTileID]={textOffset:W,width:u,height:p,anchor:t,textScale:f,prevAnchor:ee},this.markUsedJustification(R,t,B,D),R.allowVerticalPlacement&&(this.markUsedOrientation(R,D,B),this.placedOrientations[B.crossTileID]=D),{shift:K,placedGlyphBoxes:Z}}}placeLayerBucketPart(t,o,u,p){const{bucket:f,layout:_,posMatrix:y,textLabelPlaneMatrix:b,labelToScreenMatrix:T,clippingData:E,textPixelRatio:A,holdingForFade:B,collisionBoxArray:O,partiallyEvaluatedTextSize:R,partiallyEvaluatedIconSize:D,collisionGroup:X}=t.parameters,j=_.get("text-optional"),q=_.get("icon-optional"),W=_.get("text-allow-overlap"),K=_.get("icon-allow-overlap"),Z=_.get("text-rotation-alignment")==="map",ee=_.get("text-pitch-alignment")==="map",he=_.get("icon-text-fit")!=="none",xe=_.get("symbol-z-order")==="viewport-y";let Te=W&&(K||!f.hasIconData()||q),be=K&&(W||!f.hasTextData()||j);!f.collisionArrays&&O&&f.deserializeCollisionBoxes(O),u&&p&&f.updateCollisionDebugBuffers(this.transform.zoom,O);const Re=(de,Fe,De)=>{if(E){const di={zoom:this.transform.zoom,pitch:this.transform.pitch};let mi=null;if(E.dynamicFilterNeedsFeature){const $t=this.retainedQueryData[f.bucketInstanceId];mi=E.featureIndex.loadFeature({featureIndex:de.featureIndex,bucketIndex:$t.bucketIndex,sourceLayerIndex:$t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,E.dynamicFilter)(di,mi,this.retainedQueryData[f.bucketInstanceId].tileID.canonical,new a.pointGeometry(de.tileAnchorX,de.tileAnchorY),this.transform.calculateDistanceTileData(E.unwrappedTileID)))return this.placements[de.crossTileID]=new Xr(!1,!1,!1,!0),void(o[de.crossTileID]=!0)}if(o[de.crossTileID])return;if(B)return void(this.placements[de.crossTileID]=new Xr(!1,!1,!1));let Ke=!1,Ee=!1,Xe=!0,st=!1,He=!1,Ye=null,ct={box:null,offscreen:null,occluded:null},Tt={box:null,offscreen:null,occluded:null},it=null,dt=null,Rt=null,ci=0,Fi=0,Oi=0;De.textFeatureIndex?ci=De.textFeatureIndex:de.useRuntimeCollisionCircles&&(ci=de.featureIndex),De.verticalTextFeatureIndex&&(Fi=De.verticalTextFeatureIndex);const rr=di=>{di.tileID=this.retainedQueryData[f.bucketInstanceId].tileID,(this.transform.elevation||di.elevation)&&(di.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[f.bucketInstanceId].tileID,di.tileAnchorX,di.tileAnchorY):0)},Pr=De.textBox;if(Pr){rr(Pr);const di=$t=>{let Ti=a.WritingMode.horizontal;if(f.allowVerticalPlacement&&!$t&&this.prevPlacement){const nr=this.prevPlacement.placedOrientations[de.crossTileID];nr&&(this.placedOrientations[de.crossTileID]=nr,Ti=nr,this.markUsedOrientation(f,Ti,de))}return Ti},mi=($t,Ti)=>{if(f.allowVerticalPlacement&&de.numVerticalGlyphVertices>0&&De.verticalTextBox){for(const nr of f.writingModes)if(nr===a.WritingMode.vertical?(ct=Ti(),Tt=ct):ct=$t(),ct&&ct.box&&ct.box.length)break}else ct=$t()};if(_.get("text-variable-anchor")){let $t=_.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[de.crossTileID]){const ui=this.prevPlacement.variableOffsets[de.crossTileID];$t.indexOf(ui.anchor)>0&&($t=$t.filter(fr=>fr!==ui.anchor),$t.unshift(ui.anchor))}const Ti=(ui,fr,Ms)=>{const or=f.getSymbolInstanceTextSize(R,de,this.transform.zoom,Fe),eo=(ui.x2-ui.x1)*or+2*ui.padding,hu=(ui.y2-ui.y1)*or+2*ui.padding,Ll=he&&!K?fr:null;Ll&&rr(Ll);let Do={box:[],offscreen:!1,occluded:!1};const Th=W?2*$t.length:$t.length;for(let wn=0;wn<Th;++wn){const Bl=this.attemptAnchorPlacement($t[wn%$t.length],ui,eo,hu,or,Z,ee,A,y,X,wn>=$t.length,de,Fe,f,Ms,Ll,R,D);if(Bl&&(Do=Bl.placedGlyphBoxes,Do&&Do.box&&Do.box.length)){Ke=!0,Ye=Bl.shift;break}}return Do};mi(()=>Ti(Pr,De.iconBox,a.WritingMode.horizontal),()=>{const ui=De.verticalTextBox;return ui&&rr(ui),f.allowVerticalPlacement&&!(ct&&ct.box&&ct.box.length)&&de.numVerticalGlyphVertices>0&&ui?Ti(ui,De.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ct&&(Ke=ct.box,Xe=ct.offscreen,st=ct.occluded);const nr=di(ct&&ct.box);if(!Ke&&this.prevPlacement){const ui=this.prevPlacement.variableOffsets[de.crossTileID];ui&&(this.variableOffsets[de.crossTileID]=ui,this.markUsedJustification(f,ui.anchor,de,nr))}}else{const $t=(Ti,nr)=>{const ui=f.getSymbolInstanceTextSize(R,de,this.transform.zoom,Fe),fr=this.collisionIndex.placeCollisionBox(ui,Ti,new a.pointGeometry(0,0),W,A,y,X.predicate);return fr&&fr.box&&fr.box.length&&(this.markUsedOrientation(f,nr,de),this.placedOrientations[de.crossTileID]=nr),fr};mi(()=>$t(Pr,a.WritingMode.horizontal),()=>{const Ti=De.verticalTextBox;return f.allowVerticalPlacement&&de.numVerticalGlyphVertices>0&&Ti?(rr(Ti),$t(Ti,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),di(ct&&ct.box&&ct.box.length)}}if(it=ct,Ke=it&&it.box&&it.box.length>0,Xe=it&&it.offscreen,st=it&&it.occluded,de.useRuntimeCollisionCircles){const di=f.text.placedSymbolArray.get(de.centerJustifiedTextSymbolIndex>=0?de.centerJustifiedTextSymbolIndex:de.verticalPlacedTextSymbolIndex),mi=a.evaluateSizeForFeature(f.textSizeData,R,di),$t=_.get("text-padding");dt=this.collisionIndex.placeCollisionCircles(W,di,f.lineVertexArray,f.glyphOffsetArray,mi,y,b,T,u,ee,X.predicate,de.collisionCircleDiameter*mi/a.ONE_EM,$t,this.retainedQueryData[f.bucketInstanceId].tileID),Ke=W||dt.circles.length>0&&!dt.collisionDetected,Xe=Xe&&dt.offscreen,st=dt.occluded}if(De.iconFeatureIndex&&(Oi=De.iconFeatureIndex),De.iconBox){const di=mi=>{rr(mi);const $t=he&&Ye?wo(Ye.x,Ye.y,Z,ee,this.transform.angle):new a.pointGeometry(0,0),Ti=f.getSymbolInstanceIconSize(D,this.transform.zoom,Fe);return this.collisionIndex.placeCollisionBox(Ti,mi,$t,K,A,y,X.predicate)};Tt&&Tt.box&&Tt.box.length&&De.verticalIconBox?(Rt=di(De.verticalIconBox),Ee=Rt.box.length>0):(Rt=di(De.iconBox),Ee=Rt.box.length>0),Xe=Xe&&Rt.offscreen,He=Rt.occluded}const Jr=j||de.numHorizontalGlyphVertices===0&&de.numVerticalGlyphVertices===0,bn=q||de.numIconVertices===0;if(Jr||bn?bn?Jr||(Ee=Ee&&Ke):Ke=Ee&&Ke:Ee=Ke=Ee&&Ke,Ke&&it&&it.box&&this.collisionIndex.insertCollisionBox(it.box,_.get("text-ignore-placement"),f.bucketInstanceId,Tt&&Tt.box&&Fi?Fi:ci,X.ID),Ee&&Rt&&this.collisionIndex.insertCollisionBox(Rt.box,_.get("icon-ignore-placement"),f.bucketInstanceId,Oi,X.ID),dt&&(Ke&&this.collisionIndex.insertCollisionCircles(dt.circles,_.get("text-ignore-placement"),f.bucketInstanceId,ci,X.ID),u)){const di=f.bucketInstanceId;let mi=this.collisionCircleArrays[di];mi===void 0&&(mi=this.collisionCircleArrays[di]=new Bi);for(let $t=0;$t<dt.circles.length;$t+=4)mi.circles.push(dt.circles[$t+0]),mi.circles.push(dt.circles[$t+1]),mi.circles.push(dt.circles[$t+2]),mi.circles.push(dt.collisionDetected?1:0)}const Qr=this.transform.projection.name!=="globe";Te=Te&&(Qr||!st),be=be&&(Qr||!He),this.placements[de.crossTileID]=new Xr(Ke||Te,Ee||be,Xe||f.justReloaded),o[de.crossTileID]=!0};if(xe){const de=f.getSortedSymbolIndexes(this.transform.angle);for(let Fe=de.length-1;Fe>=0;--Fe){const De=de[Fe];Re(f.symbolInstances.get(De),De,f.collisionArrays[De])}}else for(let de=t.symbolInstanceStart;de<t.symbolInstanceEnd;de++)Re(f.symbolInstances.get(de),de,f.collisionArrays[de]);if(u&&f.bucketInstanceId in this.collisionCircleArrays){const de=this.collisionCircleArrays[f.bucketInstanceId];a.invert(de.invProjMatrix,y),de.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(t,o,u,p){let f;f=p===a.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(o)];const _=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const y of _)y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=f>=0&&y!==f?0:u.crossTileID)}markUsedOrientation(t,o,u){const p=o===a.WritingMode.horizontal||o===a.WritingMode.horizontalOnly?o:0,f=o===a.WritingMode.vertical?o:0,_=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const y of _)t.text.placedSymbolArray.get(y).placedOrientation=p;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const p=o?o.symbolFadeChange(t):1,f=o?o.opacities:{},_=o?o.variableOffsets:{},y=o?o.placedOrientations:{};for(const b in this.placements){const T=this.placements[b],E=f[b];E?(this.opacities[b]=new Wr(E,p,T.text,T.icon,null,T.clipped),u=u||T.text!==E.text.placed||T.icon!==E.icon.placed):(this.opacities[b]=new Wr(null,p,T.text,T.icon,T.skipFade,T.clipped),u=u||T.text||T.icon)}for(const b in f){const T=f[b];if(!this.opacities[b]){const E=new Wr(T,p,!1,!1);E.isHidden()||(this.opacities[b]=E,u=u||T.text.placed||T.icon.placed)}}for(const b in _)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=_[b]);for(const b in y)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=y[b]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o){const u={};for(const p of o){const f=p.getBucket(t);f&&p.latestFeatureIndex&&t.id===f.layerIds[0]&&this.updateBucketOpacities(f,u,p.collisionBoxArray)}}updateBucketOpacities(t,o,u){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const p=t.layers[0].layout,f=!!t.layers[0].dynamicFilter(),_=new Wr(null,0,!1,!1,!0),y=p.get("text-allow-overlap"),b=p.get("icon-allow-overlap"),T=p.get("text-variable-anchor"),E=p.get("text-rotation-alignment")==="map",A=p.get("text-pitch-alignment")==="map",B=p.get("icon-text-fit")!=="none",O=new Wr(null,0,y&&(b||!t.hasIconData()||p.get("icon-optional")),b&&(y||!t.hasTextData()||p.get("text-optional")),!0);!t.collisionArrays&&u&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(u);const R=(X,j,q)=>{for(let W=0;W<j/4;W++)X.opacityVertexArray.emplaceBack(q)};let D=0;for(let X=0;X<t.symbolInstances.length;X++){const j=t.symbolInstances.get(X),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:W,crossTileID:K}=j;let Z=this.opacities[K];o[K]?Z=_:Z||(Z=O,this.opacities[K]=Z),o[K]=!0;const ee=q>0||W>0,he=j.numIconVertices>0,xe=this.placedOrientations[j.crossTileID],Te=xe===a.WritingMode.vertical,be=xe===a.WritingMode.horizontal||xe===a.WritingMode.horizontalOnly;if(!ee&&!he||Z.isHidden()||D++,ee){const Re=vc(Z.text);R(t.text,q,Te?Ys:Re),R(t.text,W,be?Ys:Re);const de=Z.text.isHidden();[j.rightJustifiedTextSymbolIndex,j.centerJustifiedTextSymbolIndex,j.leftJustifiedTextSymbolIndex].forEach(Ke=>{Ke>=0&&(t.text.placedSymbolArray.get(Ke).hidden=de||Te?1:0)}),j.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(j.verticalPlacedTextSymbolIndex).hidden=de||be?1:0);const Fe=this.variableOffsets[j.crossTileID];Fe&&this.markUsedJustification(t,Fe.anchor,j,xe);const De=this.placedOrientations[j.crossTileID];De&&(this.markUsedJustification(t,"left",j,De),this.markUsedOrientation(t,De,j))}if(he){const Re=vc(Z.icon);j.placedIconSymbolIndex>=0&&(R(t.icon,j.numIconVertices,Te?Ys:Re),t.icon.placedSymbolArray.get(j.placedIconSymbolIndex).hidden=Z.icon.isHidden()),j.verticalPlacedIconSymbolIndex>=0&&(R(t.icon,j.numVerticalIconVertices,be?Ys:Re),t.icon.placedSymbolArray.get(j.verticalPlacedIconSymbolIndex).hidden=Z.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Re=t.collisionArrays[X];if(Re){let de=new a.pointGeometry(0,0),Fe=!0;if(Re.textBox||Re.verticalTextBox){if(T){const Ke=this.variableOffsets[K];Ke?(de=bo(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textScale),E&&de._rotate(A?this.transform.angle:-this.transform.angle)):Fe=!1}f&&(Fe=!Z.clipped),Re.textBox&&kr(t.textCollisionBox.collisionVertexArray,Z.text.placed,!Fe||Te,de.x,de.y),Re.verticalTextBox&&kr(t.textCollisionBox.collisionVertexArray,Z.text.placed,!Fe||be,de.x,de.y)}const De=Fe&&Boolean(!be&&Re.verticalIconBox);Re.iconBox&&kr(t.iconCollisionBox.collisionVertexArray,Z.icon.placed,De,B?de.x:0,B?de.y:0),Re.verticalIconBox&&kr(t.iconCollisionBox.collisionVertexArray,Z.icon.placed,!De,B?de.x:0,B?de.y:0)}}}if(t.fullyClipped=D===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const X=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=X.invProjMatrix,t.placementViewportMatrix=X.viewportMatrix,t.collisionCircleArray=X.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function kr(l,t,o,u,p){l.emplaceBack(t?1:0,o?1:0,u||0,p||0),l.emplaceBack(t?1:0,o?1:0,u||0,p||0),l.emplaceBack(t?1:0,o?1:0,u||0,p||0),l.emplaceBack(t?1:0,o?1:0,u||0,p||0)}const ah=Math.pow(2,25),xc=Math.pow(2,24),Qi=Math.pow(2,17),Xs=Math.pow(2,16),dn=Math.pow(2,9),Ja=Math.pow(2,8),Hs=Math.pow(2,1);function vc(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,o=Math.floor(127*l.opacity);return o*ah+t*xc+o*Qi+t*Xs+o*dn+t*Ja+o*Hs+t}const Ys=0;class Qa{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,o,u,p,f){const _=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(_,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((y,b)=>y.sortKey-b.sortKey));this._currentPartIndex<_.length;){const y=_[this._currentPartIndex];if(o.placeLayerBucketPart(y,this._seenCrossTileIDs,u,y.symbolInstanceStart===0),this._currentPartIndex++,f())return!0}return!1}}class lh{constructor(t,o,u,p,f,_,y,b){this.placement=new sh(t,f,_,y,b),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,o,u){const p=a.exported.now(),f=()=>{const _=a.exported.now()-p;return!this._forceFullPlacement&&_>2};for(;this._currentPlacementIndex>=0;){const _=o[t[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=y)&&(!_.maxzoom||_.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new Qa(_)),this._inProgressLayer.continuePlacement(u[_.source],this.placement,this._showCollisionBoxes,_,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const bc=512/a.EXTENT/2;class ch{constructor(t,o,u){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(let p=0;p<o.length;p++){const f=o.get(p),_=f.key;this.indexedSymbolInstances[_]||(this.indexedSymbolInstances[_]=[]),this.indexedSymbolInstances[_].push({crossTileID:f.crossTileID,coord:this.getScaledCoordinates(f,t)})}}getScaledCoordinates(t,o){const u=bc/Math.pow(2,o.canonical.z-this.tileID.canonical.z);return{x:Math.floor((o.canonical.x*a.EXTENT+t.tileAnchorX)*u),y:Math.floor((o.canonical.y*a.EXTENT+t.tileAnchorY)*u)}}findMatches(t,o,u){const p=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let f=0;f<t.length;f++){const _=t.get(f);if(_.crossTileID)continue;const y=this.indexedSymbolInstances[_.key];if(!y)continue;const b=this.getScaledCoordinates(_,o);for(const T of y)if(Math.abs(T.coord.x-b.x)<=p&&Math.abs(T.coord.y-b.y)<=p&&!u[T.crossTileID]){u[T.crossTileID]=!0,_.crossTileID=T.crossTileID;break}}}}class wc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class uh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const u in this.indexes){const p=this.indexes[u],f={};for(const _ in p){const y=p[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),f[y.tileID.key]=y}this.indexes[u]=f}this.lng=t}addBucket(t,o,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<o.symbolInstances.length;f++)o.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const _=this.indexes[f];if(Number(f)>t.overscaledZ)for(const y in _){const b=_[y];b.tileID.isChildOf(t)&&b.findMatches(o.symbolInstances,t,p)}else{const y=_[t.scaledTo(Number(f)).key];y&&y.findMatches(o.symbolInstances,t,p)}}for(let f=0;f<o.symbolInstances.length;f++){const _=o.symbolInstances.get(f);_.crossTileID||(_.crossTileID=u.generate(),p[_.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ch(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const u in o.indexedSymbolInstances)for(const p of o.indexedSymbolInstances[u])delete this.usedCrossTileIDs[t][p.crossTileID]}removeStaleBuckets(t){let o=!1;for(const u in this.indexes){const p=this.indexes[u];for(const f in p)t[p[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[f]),delete p[f],o=!0)}return o}}class Ks{constructor(){this.layerIndexes={},this.crossTileIDs=new wc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,u,p){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new uh);let _=!1;const y={};p.name!=="globe"&&f.handleWrapJump(u);for(const b of o){const T=b.getBucket(t);T&&t.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(b.tileID,T,this.crossTileIDs)&&(_=!0),y[T.bucketInstanceId]=!0)}return f.removeStaleBuckets(y)&&(_=!0),_}pruneUnusedLayers(t){const o={};t.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const is=(l,t)=>a.emitValidationErrors(l,t&&t.filter(o=>o.identifier!=="source.canvas")),Tc=a.pick(Je,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ec=a.pick(Je,["setCenter","setZoom","setBearing","setPitch"]),Sc={version:8,layers:[],sources:{}},Xn={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Zi extends a.Evented{constructor(t,o={}){super(),this.map=t,this.dispatcher=new Lt(ht(),this),this.imageManager=new tt,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(t._requestManager,o.localFontFamily?a.LocalGlyphMode.all:o.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.lineAtlas=new a.LineAtlas(256,512),this.crossTileSymbolIndex=new Ks,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const u=this;this._rtlTextPluginCallback=Zi.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(f,_)=>{if(a.triggerPluginCompletionEvent(f),_&&_.every(y=>y))for(const y in u._sourceCaches){const b=u._sourceCaches[y],T=b.getSource().type;T!=="vector"&&T!=="geojson"||b.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const f=this.getSource(p.sourceId);if(f&&f.vectorLayerIds)for(const _ in this._layers){const y=this._layers[_];y.source===f.id&&this._validateLayer(y)}})}loadURL(t,o={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const u=typeof o.validate=="boolean"?o.validate:!a.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,o.accessToken);const p=this.map._requestManager.transformRequest(t,a.ResourceType.Style);this._request=a.getJSON(p,(f,_)=>{this._request=null,f?this.fire(new a.ErrorEvent(f)):_&&this._load(_,u)})}loadJSON(t,o={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(t,o.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Sc,!1)}_updateLayerCount(t,o){const u=o?1:-1;t.is3D()&&(this._num3DLayers+=u),t.type==="circle"&&(this._numCircleLayers+=u),t.type==="symbol"&&(this._numSymbolLayers+=u)}_load(t,o){if(o&&is(this,a.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t,this._updateMapProjection();for(const p in t.sources)this.addSource(p,t.sources[p],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const u=jt(this.stylesheet.layers);this._order=u.map(p=>p.id),this._layers={},this._serializedLayers={};for(let p of u)p=a.createStyleLayer(p),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize(),this._updateLayerCount(p,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new et(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(o,u,p){let f,_,y;const b=a.exported.devicePixelRatio>1?"@2x":"";let T=a.getJSON(u.transformRequest(u.normalizeSpriteURL(o,b,".json"),a.ResourceType.SpriteJSON),(B,O)=>{T=null,y||(y=B,f=O,A())}),E=a.getImage(u.transformRequest(u.normalizeSpriteURL(o,b,".png"),a.ResourceType.SpriteImage),(B,O)=>{E=null,y||(y=B,_=O,A())});function A(){if(y)p(y);else if(f&&_){const B=a.exported.getImageData(_),O={};for(const R in f){const{width:D,height:X,x:j,y:q,sdf:W,pixelRatio:K,stretchX:Z,stretchY:ee,content:he}=f[R],xe=new a.RGBAImage({width:D,height:X});a.RGBAImage.copy(B,xe,{x:j,y:q},{x:0,y:0},{width:D,height:X}),O[R]={data:xe,pixelRatio:K,sdf:W,stretchX:Z,stretchY:ee,content:he}}p(null,O)}}return{cancel(){T&&(T.cancel(),T=null),E&&(E.cancel(),E=null)}}}(t,this.map._requestManager,(o,u)=>{if(this._spriteRequest=null,o)this.fire(new a.ErrorEvent(o));else if(u)for(const p in u)this.imageManager.addImage(p,u[p]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(t){const o=this.getSource(t.source);if(!o)return;const u=t.sourceLayer;u&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(u)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${u}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const o=[];for(const u of t){const p=this._layers[u];p.type!=="custom"&&o.push(p.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Xn[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const o=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(p.length||f.length)&&this._updateWorkerLayers(p,f);for(const _ in this._updatedSources){const y=this._updatedSources[_];y==="reload"?this._reloadSource(_):y==="clear"&&this._clearSource(_)}this._updateTilesForChangedImages();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const u={};for(const p in this._sourceCaches){const f=this._sourceCaches[p];u[p]=f.used,f.used=!1}for(const p of this._order){const f=this._layers[p];if(f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)){const y=this._getLayerSourceCache(f);y&&(y.used=!0)}const _=this.map.painter;if(_){const y=f.getProgramIds();if(!y)continue;const b=f.getProgramConfiguration(t.zoom);for(const T of y)_.useProgram(T,b)}}for(const p in u){const f=this._sourceCaches[p];u[p]!==f.used&&f.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),is(this,a.validateStyle(t)))return!1;(t=a.clone$1(t)).layers=jt(t.layers);const o=function(p,f){if(!p)return[{command:Je.setStyle,args:[f]}];let _=[];try{if(!H(p.version,f.version))return[{command:Je.setStyle,args:[f]}];H(p.center,f.center)||_.push({command:Je.setCenter,args:[f.center]}),H(p.zoom,f.zoom)||_.push({command:Je.setZoom,args:[f.zoom]}),H(p.bearing,f.bearing)||_.push({command:Je.setBearing,args:[f.bearing]}),H(p.pitch,f.pitch)||_.push({command:Je.setPitch,args:[f.pitch]}),H(p.sprite,f.sprite)||_.push({command:Je.setSprite,args:[f.sprite]}),H(p.glyphs,f.glyphs)||_.push({command:Je.setGlyphs,args:[f.glyphs]}),H(p.transition,f.transition)||_.push({command:Je.setTransition,args:[f.transition]}),H(p.light,f.light)||_.push({command:Je.setLight,args:[f.light]}),H(p.fog,f.fog)||_.push({command:Je.setFog,args:[f.fog]}),H(p.projection,f.projection)||_.push({command:Je.setProjection,args:[f.projection]});const y={},b=[];(function(A,B,O,R){let D;for(D in B=B||{},A=A||{})A.hasOwnProperty(D)&&(B.hasOwnProperty(D)||Gt(D,O,R));for(D in B)B.hasOwnProperty(D)&&(A.hasOwnProperty(D)?H(A[D],B[D])||(A[D].type==="geojson"&&B[D].type==="geojson"&&qr(A,B,D)?O.push({command:Je.setGeoJSONSourceData,args:[D,B[D].data]}):Zn(D,B,O,R)):Ut(D,B,O))})(p.sources,f.sources,b,y);const T=[];p.layers&&p.layers.forEach(A=>{A.source&&y[A.source]?_.push({command:Je.removeLayer,args:[A.id]}):T.push(A)});let E=p.terrain;E&&y[E.source]&&(_.push({command:Je.setTerrain,args:[void 0]}),E=void 0),_=_.concat(b),H(E,f.terrain)||_.push({command:Je.setTerrain,args:[f.terrain]}),function(A,B,O){B=B||[];const R=(A=A||[]).map(Pt),D=B.map(Pt),X=A.reduce(Mt,{}),j=B.reduce(Mt,{}),q=R.slice(),W=Object.create(null);let K,Z,ee,he,xe,Te,be;for(K=0,Z=0;K<R.length;K++)ee=R[K],j.hasOwnProperty(ee)?Z++:(O.push({command:Je.removeLayer,args:[ee]}),q.splice(q.indexOf(ee,Z),1));for(K=0,Z=0;K<D.length;K++)ee=D[D.length-1-K],q[q.length-1-K]!==ee&&(X.hasOwnProperty(ee)?(O.push({command:Je.removeLayer,args:[ee]}),q.splice(q.lastIndexOf(ee,q.length-Z),1)):Z++,Te=q[q.length-K],O.push({command:Je.addLayer,args:[j[ee],Te]}),q.splice(q.length-K,0,ee),W[ee]=!0);for(K=0;K<D.length;K++)if(ee=D[K],he=X[ee],xe=j[ee],!W[ee]&&!H(he,xe))if(H(he.source,xe.source)&&H(he["source-layer"],xe["source-layer"])&&H(he.type,xe.type)){for(be in Ne(he.layout,xe.layout,O,ee,null,Je.setLayoutProperty),Ne(he.paint,xe.paint,O,ee,null,Je.setPaintProperty),H(he.filter,xe.filter)||O.push({command:Je.setFilter,args:[ee,xe.filter]}),H(he.minzoom,xe.minzoom)&&H(he.maxzoom,xe.maxzoom)||O.push({command:Je.setLayerZoomRange,args:[ee,xe.minzoom,xe.maxzoom]}),he)he.hasOwnProperty(be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Ne(he[be],xe[be],O,ee,be.slice(6),Je.setPaintProperty):H(he[be],xe[be])||O.push({command:Je.setLayerProperty,args:[ee,be,xe[be]]}));for(be in xe)xe.hasOwnProperty(be)&&!he.hasOwnProperty(be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Ne(he[be],xe[be],O,ee,be.slice(6),Je.setPaintProperty):H(he[be],xe[be])||O.push({command:Je.setLayerProperty,args:[ee,be,xe[be]]}))}else O.push({command:Je.removeLayer,args:[ee]}),Te=q[q.lastIndexOf(ee)+1],O.push({command:Je.addLayer,args:[xe,Te]})}(T,f.layers,_)}catch(y){console.warn("Unable to compute style diff:",y),_=[{command:Je.setStyle,args:[f]}]}return _}(this.serialize(),t).filter(p=>!(p.command in Ec));if(o.length===0)return!1;const u=o.filter(p=>!(p.command in Tc));if(u.length>0)throw new Error(`Unimplemented: ${u.map(p=>p.command).join(", ")}.`);return o.forEach(p=>{p.command!=="setTransition"&&this[p.command].apply(this,p.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,o){return this.getImage(t)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,o),this._afterImageUpdated(t),this)}updateImage(t,o){this.imageManager.updateImage(t,o)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,o,u={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(a.validateSource,`sources.${t}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const p=ce(t,o,this.dispatcher,this);p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:p.serialize(),sourceId:t}));const f=_=>{const y=(_?"symbol:":"other:")+t,b=this._sourceCaches[y]=new a.SourceCache(y,p,_);(_?this._symbolSourceCaches:this._otherSourceCaches)[t]=b,b.style=this,b.onAdd(this.map)};f(!1),o.type!=="vector"&&o.type!=="geojson"||f(!0),p.onAdd&&p.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const o=this.getSource(t);if(!o)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const u=this._getSourceCaches(t);for(const p of u)delete this._sourceCaches[p.id],delete this._updatedSources[p.id],p.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getSource(t).setData(o),this._changed=!0}getSource(t){const o=this._getSourceCache(t);return o&&o.getSource()}addLayer(t,o,u={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${p}" already exists on this map`)));let f;if(t.type==="custom"){if(is(this,a.validateCustomStyleLayer(t)))return;f=a.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=a.clone$1(t),t=a.extend(t,{source:p})),this._validate(a.validateLayer,`layers.${p}`,t,{arrayIndex:-1},u))return;f=a.createStyleLayer(t),this._validateLayer(f),f.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[f.id]=f.serialize(),this._updateLayerCount(f,!0)}const _=o?this._order.indexOf(o):this._order.length;if(o&&_===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(_,0,p),this._layerOrderChanged=!0,this._layers[p]=f;const y=this._getLayerSourceCache(f);if(this._removedLayers[p]&&f.source&&y&&f.type!=="custom"){const b=this._removedLayers[p];delete this._removedLayers[p],b.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",y.pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,o){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===o)return;const u=this._order.indexOf(t);this._order.splice(u,1);const p=o?this._order.indexOf(o):this._order.length;o&&p===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const o=this._layers[t];if(!o)return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=o,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,u){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===o&&p.maxzoom===u||(o!=null&&(p.minzoom=o),u!=null&&(p.maxzoom=u),this._updateLayer(p)):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,o,u={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!H(p.filter,o))return o==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(a.validateFilter,`layers.${p.id}.filter`,o,{layerType:p.type},u)||(p.filter=a.clone$1(o),this._updateLayer(p)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const o=this.getLayer(t);return o&&a.clone$1(o.filter)}setLayoutProperty(t,o,u,p={}){this._checkLoaded();const f=this.getLayer(t);f?H(f.getLayoutProperty(o),u)||(f.setLayoutProperty(o,u,p),this._updateLayer(f)):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,o){const u=this.getLayer(t);if(u)return u.getLayoutProperty(o);this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,o,u,p={}){this._checkLoaded();const f=this.getLayer(t);f?H(f.getPaintProperty(o),u)||(f.setPaintProperty(o,u,p)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,o){const u=this.getLayer(t);return u&&u.getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();const u=t.source,p=t.sourceLayer,f=this.getSource(u);if(!f)return void this.fire(new a.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const _=f.type;if(_==="geojson"&&p)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(_==="vector"&&!p)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const y=this._getSourceCaches(u);for(const b of y)b.setFeatureState(p,t.id,o)}removeFeatureState(t,o){this._checkLoaded();const u=t.source,p=this.getSource(u);if(!p)return void this.fire(new a.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const f=p.type,_=f==="vector"?t.sourceLayer:void 0;if(f==="vector"&&!_)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const y=this._getSourceCaches(u);for(const b of y)b.removeFeatureState(_,t.id,o)}getFeatureState(t){this._checkLoaded();const o=t.source,u=t.sourceLayer,p=this.getSource(o);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(u,t.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const o in this._sourceCaches){const u=this._sourceCaches[o].getSource();t[u.id]||(t[u.id]=u.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const o=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&o&&o.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",o.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const o=_=>this._layers[_].type==="fill-extrusion",u={},p=[];for(let _=this._order.length-1;_>=0;_--){const y=this._order[_];if(o(y)){u[y]=_;for(const b of t){const T=b[y];if(T)for(const E of T)p.push(E)}}}p.sort((_,y)=>y.intersectionZ-_.intersectionZ);const f=[];for(let _=this._order.length-1;_>=0;_--){const y=this._order[_];if(o(y))for(let b=p.length-1;b>=0;b--){const T=p[b].feature;if(u[T.layer.id]<_)break;f.push(T),p.pop()}else for(const b of t){const T=b[y];if(T)for(const E of T)f.push(E.feature)}}return f}queryRenderedFeatures(t,o,u){o&&o.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",o.filter,null,o);const p={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const b of o.layers){const T=this._layers[b];if(!T)return this.fire(new a.ErrorEvent(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];p[T.source]=!0}}const f=[];o.availableImages=this._availableImages;const _=o&&o.layers?o.layers.some(b=>{const T=this.getLayer(b);return T&&T.is3D()}):this.has3DLayers(),y=Ni.createFromScreenPoints(t,u);for(const b in this._sourceCaches){const T=this._sourceCaches[b].getSource().id;o.layers&&!p[T]||f.push(pe(this._sourceCaches[b],this._layers,this._serializedLayers,y,o,u,_,!!this.map._showQueryGeometry))}return this.placement&&f.push(function(b,T,E,A,B,O,R){const D={},X=O.queryRenderedSymbols(A),j=[];for(const q of Object.keys(X).map(Number))j.push(R[q]);j.sort(je);for(const q of j){const W=q.featureIndex.lookupSymbolFeatures(X[q.bucketInstanceId],T,q.bucketIndex,q.sourceLayerIndex,B.filter,B.layers,B.availableImages,b);for(const K in W){const Z=D[K]=D[K]||[],ee=W[K];ee.sort((he,xe)=>{const Te=q.featureSortOrder;if(Te){const be=Te.indexOf(he.featureIndex);return Te.indexOf(xe.featureIndex)-be}return xe.featureIndex-he.featureIndex});for(const he of ee)Z.push(he)}}for(const q in D)D[q].forEach(W=>{const K=W.feature,Z=E(b[q]).getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=Z});return D}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),y.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(t,o){o&&o.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",o.filter,null,o);const u=this._getSourceCaches(t);let p=[];for(const f of u)p=p.concat(Ae(f,o));return p}addSourceType(t,o,u){return Zi.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(Zi.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(t,o={}){this._checkLoaded();const u=this.light.getLight();let p=!1;for(const _ in t)if(!H(t[_],u[_])){p=!0;break}if(!p)return;const f={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,o),this.light.updateTransitions(f)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,o=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(o===1){if(typeof t.source=="object"){const u="terrain-dem-src";this.addSource(u,t.source),t=a.clone$1(t),t=a.extend(t,{source:u})}if(this._validate(a.validateTerrain,"terrain",t))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode)this._createTerrain(t,o);else{const u=this.terrain,p=u.get();for(const f in t)if(!H(t[f],p[f])){u.set(t),this.stylesheet.terrain=t;const _={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(_);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const o=this.fog=new cr(t,this.map.transform);this.stylesheet.fog=t;const u={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};o.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,u=o.get();for(const p in t)if(!H(t[p],u[p])){o.set(t),this.stylesheet.fog=t;const f={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};o.updateTransitions(f);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(u=>this.isLayerDraped(this._layers[u])),o=this._order.filter(u=>!this.isLayerDraped(this._layers[u]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){const u=this.terrain=new si(t,o);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const p={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,u,p,f={}){return(!f||f.validate!==!1)&&is(this,t.call(a.validateStyle,a.extend({key:o,style:this.serialize(),value:u,styleSpec:a.spec},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const o=this._getSourceCaches(t);for(const u of o)u.clearTiles()}_reloadSource(t){const o=this._getSourceCaches(t);for(const u of o)u.resume(),u.reload()}_updateSources(t){for(const o in this._sourceCaches)this._sourceCaches[o].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,u,p,f=!1){let _=!1,y=!1;const b={};for(const T of this._order){const E=this._layers[T];if(E.type!=="symbol")continue;if(!b[E.source]){const B=this._getLayerSourceCache(E);if(!B)continue;b[E.source]=B.getRenderableIds(!0).map(O=>B.getTileByID(O)).sort((O,R)=>R.tileID.overscaledZ-O.tileID.overscaledZ||(O.tileID.isLessThan(R.tileID)?-1:1))}const A=this.crossTileSymbolIndex.addLayer(E,b[E.source],t.center.lng,t.projection);_=_||A}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),f=f||this._layerOrderChanged||u===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(f||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),t.zoom))&&(this.pauseablePlacement=new lh(t,this._order,f,o,u,p,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,b),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),y=!0),_&&this.pauseablePlacement.placement.setStale()),y||_)for(const T of this._order){const E=this._layers[T];E.type==="symbol"&&this.placement.updateLayerOpacities(E,b[E.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,o,u){this.imageManager.getImages(o.icons,u),this._updateTilesForChangedImages();const p=f=>{f&&f.setDependencies(o.tileID.key,o.type,o.icons)};p(this._otherSourceCaches[o.source]),p(this._symbolSourceCaches[o.source])}getGlyphs(t,o,u){this.glyphManager.getGlyphs(o.stacks,u)}getResource(t,o,u){return a.makeRequest(o,u)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){const o=this._getSourceCaches(t);return o.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):o.every(u=>u.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Zi.getSourceType=function(l){return ue[l]},Zi.setSourceType=function(l,t){ue[l]=t},Zi.registerForPluginStateChange=a.registerForPluginStateChange;var rs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,ns="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Hn={},pn={};Hn=at("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),pn=at(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Js=at(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),os=rs;var ss={background:at(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:at(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:at(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:at("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:at(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:at(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:at("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:at("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:at("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:at(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:at(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:at(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:at(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:at(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:at(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:at(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:at(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:at(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:at(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:at(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:at(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:at(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:at(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:at(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:at(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:at(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ns),skyboxGradient:at(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ns),skyboxCapture:at(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:at(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:at(`uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)
discard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function at(l,t,o){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,f=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_=l.match(p),y=t.match(p),b=rs.match(p);let T=y?y.concat(_):_;o||(Hn.staticUniforms&&(T=Hn.staticUniforms.concat(T)),pn.staticUniforms&&(T=pn.staticUniforms.concat(T))),T&&(T=T.concat(b));const E={};return{fragmentSource:l=l.replace(u,(A,B,O,R,D)=>(E[D]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${D}
varying ${O} ${R} ${D};
#else
uniform ${O} ${R} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${O} ${R} ${D} = u_${D};
#endif
`)),vertexSource:t=t.replace(u,(A,B,O,R,D)=>{const X=R==="float"?"vec2":"vec4",j=D.match(/color/)?"color":X;return E[D]?B==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${O} ${X} a_${D};
varying ${O} ${R} ${D};
#else
uniform ${O} ${R} u_${D};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${O} ${R} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${j}(a_${D}, u_${D}_t);
#else
    ${O} ${R} ${D} = u_${D};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${O} ${X} a_${D};
#else
uniform ${O} ${R} u_${D};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${O} ${R} ${D} = a_${D};
#else
    ${O} ${R} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${O} ${R} ${D} = unpack_mix_${j}(a_${D}, u_${D}_t);
#else
    ${O} ${R} ${D} = u_${D};
#endif
`}),staticAttributes:f,staticUniforms:T}}class Qs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,o,u,p,f,_,y,b){this.context=t;let T=this.boundPaintVertexBuffers.length!==p.length;for(let E=0;!T&&E<p.length;E++)this.boundPaintVertexBuffers[E]!==p[E]&&(T=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===o&&this.boundLayoutVertexBuffer===u&&!T&&this.boundIndexBuffer===f&&this.boundVertexOffset===_&&this.boundDynamicVertexBuffer===y&&this.boundDynamicVertexBuffer2===b?(t.bindVertexArrayOES.set(this.vao),y&&y.bind(),f&&f.dynamicDraw&&f.bind(),b&&b.bind()):this.freshBind(o,u,p,f,_,y,b)}freshBind(t,o,u,p,f,_,y){let b;const T=t.numAttributes,E=this.context,A=E.gl;if(E.extVertexArrayObject)this.vao&&this.destroy(),this.vao=E.extVertexArrayObject.createVertexArrayOES(),E.bindVertexArrayOES.set(this.vao),b=0,this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=y;else{b=E.currentNumAttributes||0;for(let B=T;B<b;B++)A.disableVertexAttribArray(B)}o.enableAttributes(A,t);for(const B of u)B.enableAttributes(A,t);_&&_.enableAttributes(A,t),y&&y.enableAttributes(A,t),o.bind(),o.setVertexAttribPointers(A,t,f);for(const B of u)B.bind(),B.setVertexAttribPointers(A,t,f);_&&(_.bind(),_.setVertexAttribPointers(A,t,f)),p&&p.bind(),y&&(y.bind(),y.setVertexAttribPointers(A,t,f)),E.currentNumAttributes=T}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ic(l,t){const o=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new a.MercatorCoordinate(0,u/o).toLngLat().lat,new a.MercatorCoordinate(0,(u+1)/o).toLngLat().lat]}function Mc(l,t,o,u,p,f,_){const y=l.context,b=y.gl,T=o.fbo;if(!T)return;l.prepareDrawTile();const E=l.useProgram("hillshade");y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,T.colorAttachment.get());const A=((D,X,j,q)=>{const W=j.paint.get("hillshade-shadow-color"),K=j.paint.get("hillshade-highlight-color"),Z=j.paint.get("hillshade-accent-color");let ee=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(ee-=D.transform.angle);const he=!D.options.moving;return{u_matrix:q||D.transform.calculateProjMatrix(X.tileID.toUnwrapped(),he),u_image:0,u_latrange:Ic(0,X.tileID),u_light:[j.paint.get("hillshade-exaggeration"),ee],u_shadow:W,u_highlight:K,u_accent:Z}})(l,o,u,l.terrain?t.projMatrix:null);l.prepareDrawProgram(y,E,t.toUnwrapped());const{tileBoundsBuffer:B,tileBoundsIndexBuffer:O,tileBoundsSegments:R}=l.getTileBoundsBuffers(o);E.draw(y,b.TRIANGLES,p,f,_,a.CullFaceMode.disabled,A,u.id,B,O,R)}function el(l,t,o){if(!t.needsDEMTextureUpload)return;const u=l.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(o.stride);const f=o.getPixels();t.demTexture?t.demTexture.update(f,{premultiply:!1}):t.demTexture=new a.Texture(u,f,p.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function tl(l,t,o,u,p,f){const _=l.context,y=_.gl;if(!t.dem)return;const b=t.dem;if(_.activeTexture.set(y.TEXTURE1),el(l,t,b),!t.demTexture)return;t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const T=b.dim;_.activeTexture.set(y.TEXTURE0);let E=t.fbo;if(!E){const R=new a.Texture(_,{width:T,height:T,data:null},y.RGBA);R.bind(y.LINEAR,y.CLAMP_TO_EDGE),E=t.fbo=_.createFramebuffer(T,T,!0),E.colorAttachment.set(R.texture)}_.bindFramebuffer.set(E.framebuffer),_.viewport.set([0,0,T,T]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:B,tileBoundsSegments:O}=l.getMercatorTileBoundsBuffers();l.useProgram("hillshadePrepare").draw(_,y.TRIANGLES,u,p,f,a.CullFaceMode.disabled,((R,D)=>{const X=D.stride,j=a.create();return a.ortho(j,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(j,j,[0,-a.EXTENT,0]),{u_matrix:j,u_image:1,u_dimension:[X,X],u_zoom:R.overscaledZ,u_unpack:D.unpackVector}})(t.tileID,b),o.id,A,B,O),t.needsHillshadePrepare=!1}const il=(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_image0:new a.Uniform1i(l,t.u_image0),u_skirt_height:new a.Uniform1f(l,t.u_skirt_height)}),Ac=(l,t)=>({u_matrix:l,u_image0:0,u_skirt_height:t}),Cc=(l,t,o,u,p,f)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_merc_matrix:o,u_zoom_transition:u,u_merc_center:p,u_image0:0,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9)});function ea(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const fn=new class{constructor(){this.operations={}}newMorphing(l,t,o,u,p){if(l in this.operations){const f=this.operations[l];f.to.tileID.key!==o.tileID.key&&(f.queued=o)}else this.operations[l]={startTime:u,phase:0,duration:p,from:t,to:o,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const o=this.operations[t];for(o.phase=(l-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},To={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function rl(l,t){const o=1<<l.z;return!t&&(l.x===0||l.x===o-1)||l.y===0||l.y===o-1}const ta=l=>({u_matrix:l});function nl(l,t,o,u,p){if(p>0){const f=a.exported.now(),_=(f-l.timeAdded)/p,y=t?(f-t.timeAdded)/p:-1,b=o.getSource(),T=u.coveringZoomLevel({tileSize:b.tileSize,roundZoom:b.roundZoom}),E=!t||Math.abs(t.tileID.overscaledZ-T)>Math.abs(l.tileID.overscaledZ-T),A=E&&l.refreshedUponExpiration?1:a.clamp(E?_:1-y,0,1);return l.refreshedUponExpiration&&_>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-A}:{opacity:A,mix:0}}return{opacity:1,mix:0}}const hh=2*a.mercatorZfromAltitude(1,0)*a.GLOBE_RADIUS*Math.PI;class as extends a.SourceCache{constructor(t){const o={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new Lt(ht(),null),p=ce("mock-dem",o,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class ls extends a.SourceCache{constructor(t){const o=ce("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Lt(ht(),null),t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((f,_)=>{if(f[_.key]="",!this._tiles[_.key]){const y=new a.Tile(_,this._source.tileSize*_.overscaleFactor(),t.tileZoom);y.state="loaded",this._tiles[_.key]=y}return f},{});for(const f in this._tiles)f in p||(this.freeFBO(f),this._tiles[f].unloadVectorData(),delete this._tiles[f])}freeFBO(t){const o=this.proxyCachedFBO[t];if(o!==void 0){const u=Object.values(o);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ol extends a.OverscaledTileID{constructor(t,o,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=u}}class er extends a.Elevation{constructor(t,o){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,f]=function(b){const T=new a.StructArrayLayout4i8,E=new a.StructArrayLayout3ui6,A=131;T.reserve(17161),E.reserve(33800);const B=a.EXTENT/128,O=a.EXTENT+B/2,R=O+B;for(let X=-B;X<R;X+=B)for(let j=-B;j<R;j+=B){const q=j<0||j>O||X<0||X>O?24575:0,W=a.clamp(Math.round(j),0,a.EXTENT),K=a.clamp(Math.round(X),0,a.EXTENT);T.emplaceBack(W+q,K,W,K)}const D=(X,j)=>{const q=j*A+X;E.emplaceBack(q+1,q,q+A),E.emplaceBack(q+A,q+A+1,q+1)};for(let X=1;X<129;X++)for(let j=1;j<129;j++)D(j,X);return[0,129].forEach(X=>{for(let j=0;j<130;j++)D(j,X),D(X,j)}),[T,E,32768]}(),_=t.context;this.gridBuffer=_.createVertexBuffer(u,a.boundsAttributes.members),this.gridIndexBuffer=_.createIndexBuffer(p),this.gridSegments=a.SegmentVector.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,u.length,f),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ls(o.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,0,a.EXTENT,0,a.EXTENT,0,1);const y=_.gl;this._overlapStencilMode=new a.StencilMode({func:y.GEQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new as(o.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,o,u){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const p=t.terrain.properties;this.sourceCache=t.terrain.drapeRenderMode===0?this._mockSourceCache:t._getSourceCache(p.get("source")),this._exaggeration=p.get("exaggeration");const f=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const _=this.getScaledDemTileSize();this.sourceCache.update(o,_,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,f(),this._initializing=!0),f(),o.updateElevation(!u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=o.getIds().map(b=>{const T=o.getTileByID(b).tileID;return T.projMatrix=u.calculateProjMatrix(T.toUnwrapped()),T});(function(b,T){const E=T.transform.pointCoordinate(T.transform.getCameraPoint()),A=new a.pointGeometry(E.x,E.y);b.sort((B,O)=>{if(O.overscaledZ-B.overscaledZ)return O.overscaledZ-B.overscaledZ;const R=new a.pointGeometry(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),D=new a.pointGeometry(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),X=A.mult(1<<B.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(R)-X.distSqr(D)})})(p,this.painter),this._previousZoom=u.zoom;const f=this.proxyToSource||{};this.proxyToSource={},p.forEach(b=>{this.proxyToSource[b.key]={}}),this.terrainTileForTile={};const _=this._style._sourceCaches;for(const b in _){const T=_[b];if(!T.used||(T!==this.sourceCache&&this.resetTileLookupCache(T.id),this._setupProxiedCoordsForOrtho(T,t[b],f),T.usedForTerrain))continue;const E=t[b];T.getSource().reparseOverscaled&&this._assignTerrainTiles(E)}this.proxiedCoords[o.id]=p.map(b=>new ol(b,b.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(f),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const y={};this._visibleDemTiles=[];for(const b of this.proxyCoords){const T=this.terrainTileForTile[b.key];if(!T)continue;const E=T.tileID.key;E in y||(this._visibleDemTiles.push(T),y[E]=E)}}_assignTerrainTiles(t){this._initializing||t.forEach(o=>{if(this.terrainTileForTile[o.key])return;const u=this._findTileCoveringTileID(o,this.sourceCache);u&&(this.terrainTileForTile[o.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,o=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],f=p.dem;!f||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),el(this.painter,p,f))}}_prepareDemTileUniforms(t,o,u,p){if(!o||o.demTexture==null)return!1;const f=t.tileID.canonical,_=Math.pow(2,o.tileID.canonical.z-f.z),y=p||"";return u[`u_dem_tl${y}`]=[f.x*_%1,f.y*_%1],u[`u_dem_scale${y}`]=_,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,o=t.gl;if(!this._emptyDepthBufferTexture){const u=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(t,u,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const o=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const f=p.dem.tree.minimums[0];return f>0&&t++,u+f},0);return t?o/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(u,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let f=this._emptyDEMTexture;return f?f.update(p,{premultiply:!1}):f=this._emptyDEMTexture=new a.Texture(t,p,o.RGBA,{premultiply:!1}),f}setupElevationDraw(t,o,u){const p=this.painter.context,f=p.gl,_=(y=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(y),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var y;_.u_dem_size=this.sourceCache.getSource().tileSize,_.u_exaggeration=this.exaggeration();const b=this.painter.transform,T=b.projection,E=t.tileID.canonical;_.u_tile_tl_up=T.upVector(E,0,0),_.u_tile_tr_up=T.upVector(E,a.EXTENT,0),_.u_tile_br_up=T.upVector(E,a.EXTENT,a.EXTENT),_.u_tile_bl_up=T.upVector(E,0,a.EXTENT),_.u_tile_up_scale=u&&u.useDenormalizedUpVectorScale?hh:T.upVectorScale(E,b.center.lat,b.worldSize).metersToTile;let A=null,B=null,O=1;if(u&&u.morphing&&this._useVertexMorphing){const R=u.morphing.srcDemTile,D=u.morphing.dstDemTile;O=u.morphing.phase,R&&D&&(this._prepareDemTileUniforms(t,R,_,"_prev")&&(B=R),this._prepareDemTileUniforms(t,D,_)&&(A=D))}if(B&&A?(p.activeTexture.set(f.TEXTURE2),A.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE,f.NEAREST),p.activeTexture.set(f.TEXTURE4),B.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE,f.NEAREST),_.u_dem_lerp=O):(A=this.terrainTileForTile[t.tileID.key],p.activeTexture.set(f.TEXTURE2),(this._prepareDemTileUniforms(t,A,_)?A.demTexture:this.emptyDEMTexture).bind(f.NEAREST,f.CLAMP_TO_EDGE)),p.activeTexture.set(f.TEXTURE3),u&&u.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),this._depthFBO&&(_.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),_.u_depth_size_inv=[1,1]),u&&u.useMeterToDem&&A){const R=(1<<A.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;_.u_meter_to_dem=R}u&&u.labelPlaneMatrixInv&&(_.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),o.setTerrainUniformValues(p,_)}renderToBackBuffer(t){const o=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),this.renderingToTexture=!1,function(p,f,_,y,b){if(p.transform.projection.name==="globe")(function(T,E,A,B,O){const R=T.context,D=R.gl;let X,j;const q=T.options.showTerrainWireframe?2:0,W=(be,Re)=>{if(j===be)return;const de=[To[be],"PROJECTION_GLOBE_VIEW"];Re&&de.push(To[q]),X=T.useProgram("globeRaster",null,de),j=be},K=T.colorModeForRenderPass(),Z=new a.DepthMode(D.LEQUAL,a.DepthMode.ReadWrite,T.depthRangeFor3D);fn.update(O);const ee=T.transform,he=a.calculateGlobeMercatorMatrix(ee),xe=[a.mercatorXfromLng(ee.center.lng),a.mercatorYfromLat(ee.center.lat)],Te=T.globeSharedBuffers;if((q?[!1,!0]:[!1]).forEach(be=>{j=-1;const Re=be?D.LINES:D.TRIANGLES;for(const de of B){const Fe=A.getTile(de),De=a.StencilMode.disabled,Ke=E.prevTerrainTileForTile[de.key],Ee=E.terrainTileForTile[de.key];ea(Ke,Ee)&&fn.newMorphing(de.key,Ke,Ee,O,250),R.activeTexture.set(D.TEXTURE0),Fe.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const Xe=fn.getMorphValuesForProxy(de.key),st=Xe?1:0,He={useDenormalizedUpVectorScale:!0};Xe&&a.extend$1(He,{morphing:{srcDemTile:Xe.from,dstDemTile:Xe.to,phase:a.easeCubicInOut(Xe.phase)}});const Ye=Float32Array.from(ee.globeMatrix),ct=a.globeTileLatLngCorners(de.canonical),Tt=a.getGridMatrix(de.canonical,ct),it=Cc(ee.projMatrix,Ye,he,a.globeToMercatorTransition(ee.zoom),xe,Tt);if(W(st,be),E.setupElevationDraw(Fe,X,He),T.prepareDrawProgram(R,X,de.toUnwrapped()),Te){const[dt,Rt,ci]=be?Te.getWirefameBuffers(T.context):Te.getGridBuffers();X.draw(R,Re,Z,De,K,a.CullFaceMode.backCCW,it,"globe_raster",dt,Rt,ci)}}}),Te){X=T.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const be of B){const{x:Re,y:de,z:Fe}=be.canonical,De=de===0,Ke=de===(1<<Fe)-1,[Ee,Xe,st,He]=Te.getPoleBuffers(Fe);if(He&&(De||Ke)){const Ye=A.getTile(be);R.activeTexture.set(D.TEXTURE0),Ye.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);let ct=a.globePoleMatrixForTile(Fe,Re,ee);const Tt=(it,dt)=>it.draw(R,D.TRIANGLES,Z,a.StencilMode.disabled,K,a.CullFaceMode.disabled,Cc(ee.projMatrix,ct,ct,0,xe),"globe_pole_raster",dt,st,He);E.setupElevationDraw(Ye,X,{}),T.prepareDrawProgram(R,X,be.toUnwrapped()),De&&Tt(X,Ee),Ke&&(ct=a.scale(a.create(),ct,[1,-1,1]),Tt(X,Xe))}}}})(p,f,_,y,b);else{const T=p.context,E=T.gl;let A,B;const O=p.options.showTerrainWireframe?2:0,R=(W,K)=>{if(B===W)return;const Z=[To[W]];K&&Z.push(To[O]),A=p.useProgram("terrainRaster",null,Z),B=W},D=p.colorModeForRenderPass(),X=new a.DepthMode(E.LEQUAL,a.DepthMode.ReadWrite,p.depthRangeFor3D);fn.update(b);const j=p.transform,q=6*Math.pow(1.5,22-j.zoom)*f.exaggeration();(O?[!1,!0]:[!1]).forEach(W=>{B=-1;const K=W?E.LINES:E.TRIANGLES,[Z,ee]=W?f.getWirefameBuffer():[f.gridIndexBuffer,f.gridSegments];for(const he of y){const xe=_.getTile(he),Te=a.StencilMode.disabled,be=f.prevTerrainTileForTile[he.key],Re=f.terrainTileForTile[he.key];ea(be,Re)&&fn.newMorphing(he.key,be,Re,b,250),T.activeTexture.set(E.TEXTURE0),xe.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST);const de=fn.getMorphValuesForProxy(he.key),Fe=de?1:0;let De;de&&(De={morphing:{srcDemTile:de.from,dstDemTile:de.to,phase:a.easeCubicInOut(de.phase)}});const Ke=Ac(he.projMatrix,rl(he.canonical,j.renderWorldCopies)?q/10:q);R(Fe,W),f.setupElevationDraw(xe,A,De),p.prepareDrawProgram(T,A,he.toUnwrapped()),A.draw(T,K,X,Te,D,a.CullFaceMode.backCCW,Ke,"terrain_raster",f.gridBuffer,Z,ee)}})}}(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const o=this.painter,u=this.painter.context,p=this.proxySourceCache,f=this.proxiedCoords[p.id],_=this._drapedRenderBatches.shift(),y=[],b=o.style.order;let T=0;for(const E of f){const A=p.getTileByID(E.proxyTileKey),B=p.proxyCachedFBO[E.key]?p.proxyCachedFBO[E.key][t]:void 0,O=B!==void 0?p.renderCache[B]:this.pool[T++],R=B!==void 0;if(A.texture=O.tex,R&&!O.dirty){y.push(A.tileID);continue}let D;u.bindFramebuffer.set(O.fb.framebuffer),this.renderedToTile=!1,O.dirty&&(u.clear({color:a.Color.transparent,stencil:0}),O.dirty=!1);for(let X=_.start;X<=_.end;++X){const j=o.style._layers[b[X]];if(j.isHidden(o.transform.zoom))continue;const q=o.style._getLayerSourceCache(j),W=q?this.proxyToSource[E.key][q.id]:[E];if(!W)continue;const K=W;u.viewport.set([0,0,O.fb.width,O.fb.height]),D!==(q?q.id:null)&&(this._setupStencil(O,W,j,q),D=q?q.id:null),o.renderLayer(o,q,j,K)}this.renderedToTile?(O.dirty=!0,y.push(A.tileID)):R||--T,T===5&&(T=0,this.renderToBackBuffer(y))}return this.renderToBackBuffer(y),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),_.end+1}postRender(){}renderCacheEfficiency(t){const o=t.order.length;if(o===0)return{efficiency:100};let u,p=0,f=0,_=!1;for(let y=0;y<o;++y){const b=t._layers[t.order[y]];this._style.isLayerDraped(b)?(_&&++p,++f):_||(_=!0,u=b.id)}return f===0?{efficiency:100}:{efficiency:100*(1-p/f),firstUndrapedLayer:u}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{t=Math.min(t,o.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,o,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(f=>f.dem).map(f=>{const _=f.tileID,y=Math.pow(2,_.overscaledZ),{x:b,y:T}=_.canonical,E=b/y,A=(b+1)/y,B=T/y,O=(T+1)/y;return{minx:E,miny:B,maxx:A,maxy:O,t:f.dem.tree.raycastRoot(E,B,A,O,t,o,u),tile:f}});p.sort((f,_)=>(f.t!==null?f.t:Number.MAX_VALUE)-(_.t!==null?_.t:Number.MAX_VALUE));for(const f of p){if(f.t==null)return null;const _=f.tile.dem.tree.raycast(f.minx,f.miny,f.maxx,f.maxy,t,o,u);if(_!=null)return _}return null}_createFBO(){const t=this.painter.context,o=t.gl,u=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);const p=new a.Texture(t,{width:u[0],height:u[1],data:null},o.RGBA);p.bind(o.LINEAR,o.CLAMP_TO_EDGE);const f=t.createFramebuffer(u[0],u[1],!1);return f.colorAttachment.set(p.texture),f.depthAttachment=new go(t,f.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,f.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):f.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:f,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const o=this._style._layers[t],u=o.isHidden(this.painter.transform.zoom),p=o.getCrossfadeParameters(),f=!!p&&p.t!==1,_=o.hasTransition();return o.type!=="custom"&&!u&&(f||_)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o]._source instanceof k){t=!0;break}if(t)for(let o=0;o<this._style.order.length;++o){const u=this._style._layers[this._style.order[o]],p=u.isHidden(this.painter.transform.zoom),f=this._style._getLayerSourceCache(u);if(u.type!=="raster"||p||!f)continue;const _=u.paint.get("raster-fade-duration");for(const y of this.proxyCoords){const b=this.proxyToSource[y.key][f.id];if(b)for(const T of b){const E=nl(f.getTile(T),f.findLoadedParent(T,0),f,this.painter.transform,_);(E.opacity!==1||E.mix!==0)&&this._clearRenderCacheForTile(f.id,T)}}}}_setupDrapedRenderBatches(){const t=this._style.order,o=t.length;if(o===0)return;const u=[];let p,f=0,_=this._style._layers[t[f]];for(;!this._style.isLayerDraped(_)&&_.isHidden(this.painter.transform.zoom)&&++f<o;)_=this._style._layers[t[f]];for(;f<o;++f){const y=this._style._layers[t[f]];y.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(y)?p===void 0&&(p=f):p!==void 0&&(u.push({start:p,end:f-1}),p=void 0))}p!==void 0&&u.push({start:p,end:f-1}),this._drapedRenderBatches=u}_setupRenderCache(t){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const _=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let y=0;y<_.length;++y){const b=Object.values(_[y]);o.renderCachePool.push(...b)}}return}this._clearRasterFadeFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let _=u.length-1;_>=0;_--){const y=u[_];if(o.getTileByID(y.key),o.proxyCachedFBO[y.key]!==void 0){const b=t[y.key],T=this.proxyToSource[y.key];let E=0;for(const A in T){const B=T[A],O=b[A];if(!O||O.length!==B.length||B.some((R,D)=>R!==O[D]||p[A]&&p[A].hasOwnProperty(R.key))){E=-1;break}++E}for(const A in o.proxyCachedFBO[y.key])o.renderCache[o.proxyCachedFBO[y.key][A]].dirty=E<0||E!==Object.values(b).length}}const f=[...this._drapedRenderBatches];f.sort((_,y)=>y.end-y.start-(_.end-_.start));for(const _ of f)for(const y of u){if(o.proxyCachedFBO[y.key])continue;let b=o.renderCachePool.pop();b===void 0&&o.renderCache.length<50&&(b=o.renderCache.length,o.renderCache.push(this._createFBO())),b!==void 0&&(o.proxyCachedFBO[y.key]={},o.proxyCachedFBO[y.key][_.start]=b,o.renderCache[b].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const f=this.painter.context,_=f.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let y;if(u.isTileClipped())y=o.length,this._overlapStencilMode.test={func:_.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);y=1,this._overlapStencilMode.test={func:_.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+y>255&&(f.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=y,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(t.key)||0),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(t,o){const u=this.painter,p=this.painter.context,f=p.gl;u._tileClippingMaskIDs.clear(),p.setColorMode(a.ColorMode.disabled),p.setDepthMode(a.DepthMode.disabled);const _=u.useProgram("clippingMask");for(const y of t){const b=--o;u._tileClippingMaskIDs.set(y.key,b),_.draw(p,f.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:f.ALWAYS,mask:0},b,255,f.KEEP,f.KEEP,f.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,ta(y.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;const u=[t.x,t.y,1,1];a.transformMat4$1(u,u,o.pixelMatrixInverse),a.scale$1(u,u,1/u[3]),u[0]/=o.worldSize,u[1]/=o.worldSize;const p=o._camera.position,f=a.mercatorZfromAltitude(1,o.center.lat),_=[p[0],p[1],p[2]/f,0],y=a.subtract([],u.slice(0,3),_);a.normalize(y,y);const b=this.raycast(_,y,this._exaggeration);return b!==null&&b?(a.scaleAndAdd(_,_,y,b),_[3]=_[2],_[2]*=f,_):null}drawDepth(){const t=this.painter,o=t.context,u=this.proxySourceCache,p=Math.ceil(t.width),f=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===p&&this._depthFBO.height===f||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const _=o.gl,y=o.createFramebuffer(p,f,!0);o.activeTexture.set(_.TEXTURE0);const b=new a.Texture(o,{width:p,height:f,data:null},_.RGBA);b.bind(_.NEAREST,_.CLAMP_TO_EDGE),y.colorAttachment.set(b.texture);const T=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,p,f);y.depthAttachment.set(T),this._depthFBO=y,this._depthTexture=b}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,p,f]),function(_,y,b,T){if(_.transform.projection.name==="globe")return;const E=_.context,A=E.gl;E.clear({depth:1});const B=_.useProgram("terrainDepth"),O=new a.DepthMode(A.LESS,a.DepthMode.ReadWrite,_.depthRangeFor3D);for(const R of T){const D=b.getTile(R),X=Ac(R.projMatrix,0);y.setupElevationDraw(D,B),B.draw(E,A.TRIANGLES,O,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,X,"terrain_depth",y.gridBuffer,y.gridIndexBuffer,y.gridNoSkirtSegments)}}(t,this,u,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,o,u){if(t.getSource()instanceof ie)return this._setupProxiedCoordsForImageSource(t,o,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],f=this.proxyCoords;for(let y=0;y<f.length;y++){const b=f[y],T=this._findTileCoveringTileID(b,t);if(T){const E=this._createProxiedId(b,T,u[b.key]&&u[b.key][t.id]);p.push(E),this.proxyToSource[b.key][t.id]=[E]}}let _=!1;for(let y=0;y<o.length;y++){const b=t.getTile(o[y]);if(!b||!b.hasData())continue;const T=this._findTileCoveringTileID(b.tileID,this.proxySourceCache);if(T&&T.tileID.canonical.z!==b.tileID.canonical.z){const E=this.proxyToSource[T.tileID.key][t.id],A=this._createProxiedId(T.tileID,b,u[T.tileID.key]&&u[T.tileID.key][t.id]);E?E.splice(E.length-1,0,A):this.proxyToSource[T.tileID.key][t.id]=[A],p.push(A),_=!0}}this._sourceTilesOverlap[t.id]=_}_setupProxiedCoordsForImageSource(t,o,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],f=this.proxyCoords,_=t.getSource(),y=new a.pointGeometry(_.tileID.x,_.tileID.y)._div(1<<_.tileID.z),b=_.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((E,A)=>(E.min.x=Math.min(E.min.x,A.x-y.x),E.min.y=Math.min(E.min.y,A.y-y.y),E.max.x=Math.max(E.max.x,A.x-y.x),E.max.y=Math.max(E.max.y,A.y-y.y),E),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),T=(E,A)=>{const B=E.wrap+E.canonical.x/(1<<E.canonical.z),O=E.canonical.y/(1<<E.canonical.z),R=a.EXTENT/(1<<E.canonical.z),D=A.wrap+A.canonical.x/(1<<A.canonical.z),X=A.canonical.y/(1<<A.canonical.z);return B+R<D+b.min.x||B>D+b.max.x||O+R<X+b.min.y||O>X+b.max.y};for(let E=0;E<f.length;E++){const A=f[E];for(let B=0;B<o.length;B++){const O=t.getTile(o[B]);if(!O||!O.hasData()||T(A,O.tileID))continue;const R=this._createProxiedId(A,O,u[A.key]&&u[A.key][t.id]),D=this.proxyToSource[A.key][t.id];D?D.push(R):this.proxyToSource[A.key][t.id]=[R],p.push(R)}}}_createProxiedId(t,o,u){let p=this.orthoMatrix;if(u){const f=u.find(_=>_.key===o.tileID.key);if(f)return f}if(o.tileID.key!==t.key){const f=t.canonical.z-o.tileID.canonical.z;let _,y,b;p=a.create();const T=o.tileID.wrap-t.wrap<<t.overscaledZ;f>0?(_=a.EXTENT>>f,y=_*((o.tileID.canonical.x<<f)-t.canonical.x+T),b=_*((o.tileID.canonical.y<<f)-t.canonical.y)):(_=a.EXTENT<<-f,y=a.EXTENT*(o.tileID.canonical.x-(t.canonical.x+T<<-f)),b=a.EXTENT*(o.tileID.canonical.y-(t.canonical.y<<-f))),a.ortho(p,0,_,0,_,0,1),a.translate(p,p,[y,b,0])}return new ol(o.tileID,t.key,p)}_findTileCoveringTileID(t,o){let u=o.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[o.id],f=p[t.key];if(u=f?o.getTileByID(f):null,u&&u.hasData()||f===null)return u;let _=u?u.tileID:t,y=_.overscaledZ;const b=o.getSource().minzoom,T=[];if(!f){const A=o.getSource().maxzoom;if(t.canonical.z>=A){const B=t.canonical.z-A;o.getSource().reparseOverscaled?(y=Math.max(t.canonical.z+2,o.transform.tileZoom),_=new a.OverscaledTileID(y,t.wrap,A,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(y=A,_=new a.OverscaledTileID(y,t.wrap,A,t.canonical.x>>B,t.canonical.y>>B))}_.key!==t.key&&(T.push(_.key),u=o.getTile(_))}const E=A=>{T.forEach(B=>{p[B]=A}),T.length=0};for(y-=1;y>=b&&(!u||!u.hasData());y--){u&&E(u.tileID.key);const A=_.calculateScaledKey(y);if(u=o.getTileByID(A),u&&u.hasData())break;const B=p[A];if(B===null)break;B===void 0?T.push(A):u=o.getTileByID(B)}return E(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(o){let u=0;const p=new a.StructArrayLayout2ui4,f=131;for(let _=1;_<129;_++){for(let y=1;y<129;y++)u=_*f+y,p.emplaceBack(u,u+1),p.emplaceBack(u,u+f),p.emplaceBack(u+1,u+f),_===128&&p.emplaceBack(u+f,u+f+1);p.emplaceBack(u+1,u+1+f)}return p}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function ia(l){const t=[];for(let o=0;o<l.length;o++){if(l[o]===null)continue;const u=l[o].split(" ");t.push(u.pop())}return t}class cs{static cacheKey(t,o,u){let p=`${t}${u?u.cacheKey:""}`;for(const f of o)p+=`/${f}`;return p}constructor(t,o,u,p,f,_){const y=t.gl;this.program=y.createProgram();const b=ia(u.staticAttributes),T=p?p.getBinderAttributes():[],E=b.concat(T),A=u.staticUniforms?ia(u.staticUniforms):[],B=p?p.getBinderUniforms():[],O=A.concat(B),R=[];for(const Z of O)R.indexOf(Z)<0&&R.push(Z);let D=p?p.defines():[];D=D.concat(_.map(Z=>`#define ${Z}`));const X=D.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,os,Js.fragmentSource,pn.fragmentSource,u.fragmentSource).join(`
`),j=D.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,os,Js.vertexSource,pn.vertexSource,Hn.vertexSource,u.vertexSource).join(`
`),q=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(q,X),y.compileShader(q),y.attachShader(this.program,q);const W=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(W,j),y.compileShader(W),y.attachShader(this.program,W),this.attributes={};const K={};this.numAttributes=E.length;for(let Z=0;Z<this.numAttributes;Z++)E[Z]&&(y.bindAttribLocation(this.program,Z,E[Z]),this.attributes[E[Z]]=Z);y.linkProgram(this.program),y.deleteShader(W),y.deleteShader(q);for(let Z=0;Z<R.length;Z++){const ee=R[Z];if(ee&&!K[ee]){const he=y.getUniformLocation(this.program,ee);he&&(K[ee]=he)}}this.fixedUniforms=f(t,K),this.binderUniforms=p?p.getUniforms(t,K):[],_.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((Z,ee)=>({u_dem:new a.Uniform1i(Z,ee.u_dem),u_dem_prev:new a.Uniform1i(Z,ee.u_dem_prev),u_dem_unpack:new a.Uniform4f(Z,ee.u_dem_unpack),u_dem_tl:new a.Uniform2f(Z,ee.u_dem_tl),u_dem_scale:new a.Uniform1f(Z,ee.u_dem_scale),u_dem_tl_prev:new a.Uniform2f(Z,ee.u_dem_tl_prev),u_dem_scale_prev:new a.Uniform1f(Z,ee.u_dem_scale_prev),u_dem_size:new a.Uniform1f(Z,ee.u_dem_size),u_dem_lerp:new a.Uniform1f(Z,ee.u_dem_lerp),u_exaggeration:new a.Uniform1f(Z,ee.u_exaggeration),u_depth:new a.Uniform1i(Z,ee.u_depth),u_depth_size_inv:new a.Uniform2f(Z,ee.u_depth_size_inv),u_meter_to_dem:new a.Uniform1f(Z,ee.u_meter_to_dem),u_label_plane_matrix_inv:new a.UniformMatrix4f(Z,ee.u_label_plane_matrix_inv),u_tile_tl_up:new a.Uniform3f(Z,ee.u_tile_tl_up),u_tile_tr_up:new a.Uniform3f(Z,ee.u_tile_tr_up),u_tile_br_up:new a.Uniform3f(Z,ee.u_tile_br_up),u_tile_bl_up:new a.Uniform3f(Z,ee.u_tile_bl_up),u_tile_up_scale:new a.Uniform1f(Z,ee.u_tile_up_scale)}))(t,K)),_.indexOf("FOG")!==-1&&(this.fogUniforms=((Z,ee)=>({u_fog_matrix:new a.UniformMatrix4f(Z,ee.u_fog_matrix),u_fog_range:new a.Uniform2f(Z,ee.u_fog_range),u_fog_color:new a.Uniform4f(Z,ee.u_fog_color),u_fog_horizon_blend:new a.Uniform1f(Z,ee.u_fog_horizon_blend),u_fog_temporal_offset:new a.Uniform1f(Z,ee.u_fog_temporal_offset)}))(t,K))}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in o)u[p].set(o[p])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in o)u[p].location&&u[p].set(o[p])}}draw(t,o,u,p,f,_,y,b,T,E,A,B,O,R,D,X){const j=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(p),t.setColorMode(f),t.setCullFace(_);for(const W of Object.keys(this.fixedUniforms))this.fixedUniforms[W].set(y[W]);R&&R.setUniforms(t,this.binderUniforms,B,{zoom:O});const q={[j.LINES]:2,[j.TRIANGLES]:3,[j.LINE_STRIP]:1}[o];for(const W of A.get()){const K=W.vaos||(W.vaos={});(K[b]||(K[b]=new Qs)).bind(t,this,T,R?R.getPaintVertexBuffers():[],E,W.vertexOffset,D,X),j.drawElements(o,W.primitiveLength*q,j.UNSIGNED_SHORT,W.primitiveOffset*q*2)}}}function us(l,t,o){const u=1/bi(o,1,t.transform.tileZoom),p=Math.pow(2,o.tileID.overscaledZ),f=o.tileSize*Math.pow(2,t.transform.tileZoom)/p,_=f*(o.tileID.canonical.x+o.tileID.wrap*p),y=f*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[_>>16,y>>16],u_pixel_coord_lower:[65535&_,65535&y]}}const sl=a.create(),ra=(l,t,o,u,p,f,_,y,b)=>{const T=t.style.light,E=T.properties.get("position"),A=[E.x,E.y,E.z],B=a.create$1();T.properties.get("anchor")==="viewport"&&(a.fromRotation(B,-t.transform.angle),a.transformMat3(A,A,B));const O=T.properties.get("color"),R=t.transform,D={u_matrix:l,u_lightpos:A,u_lightintensity:T.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+o,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sl,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return R.projection.name==="globe"&&(D.u_tile_id=[p.canonical.x,p.canonical.y,1<<p.canonical.z],D.u_zoom_transition=_,D.u_inv_rot_matrix=b,D.u_merc_center=y,D.u_up_dir=R.projection.upVector(new a.CanonicalTileID(0,0,0),y[0]*a.EXTENT,y[1]*a.EXTENT),D.u_height_lift=f),D},na=(l,t,o,u,p,f,_,y,b,T,E)=>{const A=ra(l,t,o,u,p,y,b,T,E),B={u_height_factor:-Math.pow(2,p.overscaledZ)/_.tileSize/8};return a.extend(A,us(f,t,_),B)},oa=l=>({u_matrix:l}),sa=(l,t,o,u)=>a.extend(oa(l),us(o,t,u)),aa=(l,t)=>({u_matrix:l,u_world:t}),zc=(l,t,o,u,p)=>a.extend(sa(l,t,o,u),{u_world:p}),kc=a.create(),Eo=(l,t,o,u,p,f)=>{const _=l.transform,y=_.projection.name==="globe";let b;if(f.paint.get("circle-pitch-alignment")==="map")if(y){const E=a.globePixelsToTileUnits(_.zoom,t.canonical);b=Float32Array.from([E,0,0,E])}else b=_.calculatePixelsToTileUnitsMatrix(o);else b=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:_.cameraToCenterDistance,u_matrix:l.translatePosMatrix(t.projMatrix,o,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:kc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return y&&(T.u_inv_rot_matrix=u,T.u_merc_center=p,T.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],T.u_zoom_transition=a.globeToMercatorTransition(_.zoom),T.u_up_dir=_.projection.upVector(t.canonical,p[0],p[1])),T},dh=l=>{const t=[];return l.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},ph=(l,t,o)=>{const u=a.EXTENT/o.tileSize;return{u_matrix:l,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/u,t.pixelsToGLUnits[1]/u]}},Pc=(l,t,o=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:o}),fh=a.create(),mh=(l,t,o,u,p,f,_)=>{const y=l.transform,b=y.projection.name==="globe",T=b?a.globePixelsToTileUnits(y.zoom,t.canonical):bi(o,1,f),E={u_matrix:t.projMatrix,u_extrude_scale:T,u_intensity:_,u_inv_rot_matrix:fh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return b&&(E.u_inv_rot_matrix=u,E.u_merc_center=p,E.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],E.u_zoom_transition=a.globeToMercatorTransition(y.zoom),E.u_up_dir=y.projection.upVector(t.canonical,p[0],p[1])),E},_h=(l,t,o,u,p,f,_)=>{const y=l.transform,b=y.calculatePixelsToTileUnitsMatrix(t),T={u_matrix:Yn(l,t,o,p),u_pixels_to_tile_units:b,u_device_pixel_ratio:_,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(ll(o)){const E=la(t,l.transform);T.u_texsize=t.lineAtlasTexture.size,T.u_scale=[E,u.fromScale,u.toScale],T.u_mix=u.t}return T},al=(l,t,o,u,p,f)=>{const _=l.transform,y=la(t,_);return{u_matrix:Yn(l,t,o,p),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:f,u_image:0,u_scale:[y,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function la(l,t){return 1/bi(l,1,t.tileZoom)}function Yn(l,t,o,u){return l.translatePosMatrix(u||t.tileID.projMatrix,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function ll(l){const t=l.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const Dc=(l,t,o,u,p,f)=>{return{u_matrix:l,u_tl_parent:t,u_scale_parent:o,u_fade_t:u.mix,u_opacity:u.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(y=p.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(_=p.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:cl(p.paint.get("raster-hue-rotate")),u_perspective_transform:f};var _,y};function cl(l){l*=Math.PI/180;const t=Math.sin(l),o=Math.cos(l);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const mn=a.create(),ul=(l,t,o,u,p,f,_,y,b,T,E,A,B,O)=>{const R=p.transform,D={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:R.cameraToCenterDistance,u_rotate_symbol:+o,u_aspect_ratio:R.width/R.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:_,u_coord_matrix:y,u_is_text:+b,u_pitch_with_map:+u,u_texsize:T,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:mn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:mn};return R.projection.name==="globe"&&(D.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],D.u_zoom_transition=A,D.u_inv_rot_matrix=O,D.u_merc_center=B,D.u_camera_forward=R._camera.forward(),D.u_ecef_origin=a.globeECEFOrigin(R.globeMatrix,E.toUnwrapped()),D.u_tile_matrix=Float32Array.from(R.globeMatrix)),D},Kn=(l,t,o,u,p,f,_,y,b,T,E,A,B,O,R)=>{const{cameraToCenterDistance:D,_pitch:X}=p.transform;return a.extend(ul(l,t,o,u,p,f,_,y,b,T,A,B,O,R),{u_gamma_scale:u?D*Math.cos(p.terrain?0:X):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+E})},So=(l,t,o,u,p,f,_,y,b,T,E,A,B,O)=>a.extend(Kn(l,t,o,u,p,f,_,y,!0,b,!0,E,A,B,O),{u_texsize_icon:T,u_texture_icon:1}),Lc=(l,t,o)=>({u_matrix:l,u_opacity:t,u_color:o}),hl=(l,t,o,u,p,f)=>a.extend(function(_,y,b,T){const E=b.imageManager.getPattern(_.from.toString()),A=b.imageManager.getPattern(_.to.toString()),{width:B,height:O}=b.imageManager.getPixelSize(),R=Math.pow(2,T.tileID.overscaledZ),D=T.tileSize*Math.pow(2,b.transform.tileZoom)/R,X=D*(T.tileID.canonical.x+T.tileID.wrap*R),j=D*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[B,O],u_mix:y.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/bi(T,1,b.transform.tileZoom),u_pixel_coord_upper:[X>>16,j>>16],u_pixel_coord_lower:[65535&X,65535&j]}}(u,f,o,p),{u_matrix:l,u_opacity:t}),Wt={fillExtrusion:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_lightpos:new a.Uniform3f(l,t.u_lightpos),u_lightintensity:new a.Uniform1f(l,t.u_lightintensity),u_lightcolor:new a.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(l,t.u_vertical_gradient),u_opacity:new a.Uniform1f(l,t.u_opacity),u_tile_id:new a.Uniform3f(l,t.u_tile_id),u_zoom_transition:new a.Uniform1f(l,t.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(l,t.u_merc_center),u_up_dir:new a.Uniform3f(l,t.u_up_dir),u_height_lift:new a.Uniform1f(l,t.u_height_lift)}),fillExtrusionPattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_lightpos:new a.Uniform3f(l,t.u_lightpos),u_lightintensity:new a.Uniform1f(l,t.u_lightintensity),u_lightcolor:new a.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(l,t.u_vertical_gradient),u_height_factor:new a.Uniform1f(l,t.u_height_factor),u_tile_id:new a.Uniform3f(l,t.u_tile_id),u_zoom_transition:new a.Uniform1f(l,t.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(l,t.u_merc_center),u_up_dir:new a.Uniform3f(l,t.u_up_dir),u_height_lift:new a.Uniform1f(l,t.u_height_lift),u_image:new a.Uniform1i(l,t.u_image),u_texsize:new a.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade),u_opacity:new a.Uniform1f(l,t.u_opacity)}),fill:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),fillPattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_image:new a.Uniform1i(l,t.u_image),u_texsize:new a.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade)}),fillOutline:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_world:new a.Uniform2f(l,t.u_world)}),fillOutlinePattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_world:new a.Uniform2f(l,t.u_world),u_image:new a.Uniform1i(l,t.u_image),u_texsize:new a.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade)}),circle:(l,t)=>({u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_extrude_scale:new a.UniformMatrix2f(l,t.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_inv_rot_matrix:new a.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(l,t.u_merc_center),u_tile_id:new a.Uniform3f(l,t.u_tile_id),u_zoom_transition:new a.Uniform1f(l,t.u_zoom_transition),u_up_dir:new a.Uniform3f(l,t.u_up_dir)}),collisionBox:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_extrude_scale:new a.Uniform2f(l,t.u_extrude_scale)}),collisionCircle:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_inv_matrix:new a.UniformMatrix4f(l,t.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(l,t.u_viewport_size)}),debug:(l,t)=>({u_color:new a.UniformColor(l,t.u_color),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_overlay:new a.Uniform1i(l,t.u_overlay),u_overlay_scale:new a.Uniform1f(l,t.u_overlay_scale)}),clippingMask:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix)}),heatmap:(l,t)=>({u_extrude_scale:new a.Uniform1f(l,t.u_extrude_scale),u_intensity:new a.Uniform1f(l,t.u_intensity),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_inv_rot_matrix:new a.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(l,t.u_merc_center),u_tile_id:new a.Uniform3f(l,t.u_tile_id),u_zoom_transition:new a.Uniform1f(l,t.u_zoom_transition),u_up_dir:new a.Uniform3f(l,t.u_up_dir)}),heatmapTexture:(l,t)=>({u_image:new a.Uniform1i(l,t.u_image),u_color_ramp:new a.Uniform1i(l,t.u_color_ramp),u_opacity:new a.Uniform1f(l,t.u_opacity)}),hillshade:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_image:new a.Uniform1i(l,t.u_image),u_latrange:new a.Uniform2f(l,t.u_latrange),u_light:new a.Uniform2f(l,t.u_light),u_shadow:new a.UniformColor(l,t.u_shadow),u_highlight:new a.UniformColor(l,t.u_highlight),u_accent:new a.UniformColor(l,t.u_accent)}),hillshadePrepare:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_image:new a.Uniform1i(l,t.u_image),u_dimension:new a.Uniform2f(l,t.u_dimension),u_zoom:new a.Uniform1f(l,t.u_zoom),u_unpack:new a.Uniform4f(l,t.u_unpack)}),line:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_pixels_to_tile_units:new a.UniformMatrix2f(l,t.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(l,t.u_units_to_pixels),u_dash_image:new a.Uniform1i(l,t.u_dash_image),u_gradient_image:new a.Uniform1i(l,t.u_gradient_image),u_image_height:new a.Uniform1f(l,t.u_image_height),u_texsize:new a.Uniform2f(l,t.u_texsize),u_scale:new a.Uniform3f(l,t.u_scale),u_mix:new a.Uniform1f(l,t.u_mix),u_alpha_discard_threshold:new a.Uniform1f(l,t.u_alpha_discard_threshold)}),linePattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_texsize:new a.Uniform2f(l,t.u_texsize),u_pixels_to_tile_units:new a.UniformMatrix2f(l,t.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_image:new a.Uniform1i(l,t.u_image),u_units_to_pixels:new a.Uniform2f(l,t.u_units_to_pixels),u_scale:new a.Uniform3f(l,t.u_scale),u_fade:new a.Uniform1f(l,t.u_fade),u_alpha_discard_threshold:new a.Uniform1f(l,t.u_alpha_discard_threshold)}),raster:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_tl_parent:new a.Uniform2f(l,t.u_tl_parent),u_scale_parent:new a.Uniform1f(l,t.u_scale_parent),u_fade_t:new a.Uniform1f(l,t.u_fade_t),u_opacity:new a.Uniform1f(l,t.u_opacity),u_image0:new a.Uniform1i(l,t.u_image0),u_image1:new a.Uniform1i(l,t.u_image1),u_brightness_low:new a.Uniform1f(l,t.u_brightness_low),u_brightness_high:new a.Uniform1f(l,t.u_brightness_high),u_saturation_factor:new a.Uniform1f(l,t.u_saturation_factor),u_contrast_factor:new a.Uniform1f(l,t.u_contrast_factor),u_spin_weights:new a.Uniform3f(l,t.u_spin_weights),u_perspective_transform:new a.Uniform2f(l,t.u_perspective_transform)}),symbolIcon:(l,t)=>({u_is_size_zoom_constant:new a.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(l,t.u_size_t),u_size:new a.Uniform1f(l,t.u_size),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_rotate_symbol:new a.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(l,t.u_fade_change),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new a.Uniform1i(l,t.u_is_text),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_texsize:new a.Uniform2f(l,t.u_texsize),u_tile_id:new a.Uniform3f(l,t.u_tile_id),u_zoom_transition:new a.Uniform1f(l,t.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(l,t.u_merc_center),u_camera_forward:new a.Uniform3f(l,t.u_camera_forward),u_tile_matrix:new a.UniformMatrix4f(l,t.u_tile_matrix),u_ecef_origin:new a.Uniform3f(l,t.u_ecef_origin),u_texture:new a.Uniform1i(l,t.u_texture)}),symbolSDF:(l,t)=>({u_is_size_zoom_constant:new a.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(l,t.u_size_t),u_size:new a.Uniform1f(l,t.u_size),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_rotate_symbol:new a.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(l,t.u_fade_change),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new a.Uniform1i(l,t.u_is_text),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_texsize:new a.Uniform2f(l,t.u_texsize),u_texture:new a.Uniform1i(l,t.u_texture),u_gamma_scale:new a.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_tile_id:new a.Uniform3f(l,t.u_tile_id),u_zoom_transition:new a.Uniform1f(l,t.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(l,t.u_merc_center),u_camera_forward:new a.Uniform3f(l,t.u_camera_forward),u_tile_matrix:new a.UniformMatrix4f(l,t.u_tile_matrix),u_ecef_origin:new a.Uniform3f(l,t.u_ecef_origin),u_is_halo:new a.Uniform1i(l,t.u_is_halo)}),symbolTextAndIcon:(l,t)=>({u_is_size_zoom_constant:new a.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(l,t.u_size_t),u_size:new a.Uniform1f(l,t.u_size),u_camera_to_center_distance:new a.Uniform1f(l,t.u_camera_to_center_distance),u_rotate_symbol:new a.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(l,t.u_fade_change),u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new a.Uniform1i(l,t.u_is_text),u_pitch_with_map:new a.Uniform1i(l,t.u_pitch_with_map),u_texsize:new a.Uniform2f(l,t.u_texsize),u_texsize_icon:new a.Uniform2f(l,t.u_texsize_icon),u_texture:new a.Uniform1i(l,t.u_texture),u_texture_icon:new a.Uniform1i(l,t.u_texture_icon),u_gamma_scale:new a.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(l,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(l,t.u_is_halo)}),background:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_opacity:new a.Uniform1f(l,t.u_opacity),u_color:new a.UniformColor(l,t.u_color)}),backgroundPattern:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_opacity:new a.Uniform1f(l,t.u_opacity),u_image:new a.Uniform1i(l,t.u_image),u_pattern_tl_a:new a.Uniform2f(l,t.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(l,t.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(l,t.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(l,t.u_pattern_br_b),u_texsize:new a.Uniform2f(l,t.u_texsize),u_mix:new a.Uniform1f(l,t.u_mix),u_pattern_size_a:new a.Uniform2f(l,t.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(l,t.u_pattern_size_b),u_scale_a:new a.Uniform1f(l,t.u_scale_a),u_scale_b:new a.Uniform1f(l,t.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(l,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(l,t.u_tile_units_to_pixels)}),terrainRaster:il,terrainDepth:il,skybox:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_sun_direction:new a.Uniform3f(l,t.u_sun_direction),u_cubemap:new a.Uniform1i(l,t.u_cubemap),u_opacity:new a.Uniform1f(l,t.u_opacity),u_temporal_offset:new a.Uniform1f(l,t.u_temporal_offset)}),skyboxGradient:(l,t)=>({u_matrix:new a.UniformMatrix4f(l,t.u_matrix),u_color_ramp:new a.Uniform1i(l,t.u_color_ramp),u_center_direction:new a.Uniform3f(l,t.u_center_direction),u_radius:new a.Uniform1f(l,t.u_radius),u_opacity:new a.Uniform1f(l,t.u_opacity),u_temporal_offset:new a.Uniform1f(l,t.u_temporal_offset)}),skyboxCapture:(l,t)=>({u_matrix_3f:new a.UniformMatrix3f(l,t.u_matrix_3f),u_sun_direction:new a.Uniform3f(l,t.u_sun_direction),u_sun_intensity:new a.Uniform1f(l,t.u_sun_intensity),u_color_tint_r:new a.Uniform4f(l,t.u_color_tint_r),u_color_tint_m:new a.Uniform4f(l,t.u_color_tint_m),u_luminance:new a.Uniform1f(l,t.u_luminance)}),globeRaster:(l,t)=>({u_proj_matrix:new a.UniformMatrix4f(l,t.u_proj_matrix),u_globe_matrix:new a.UniformMatrix4f(l,t.u_globe_matrix),u_merc_matrix:new a.UniformMatrix4f(l,t.u_merc_matrix),u_zoom_transition:new a.Uniform1f(l,t.u_zoom_transition),u_merc_center:new a.Uniform2f(l,t.u_merc_center),u_image0:new a.Uniform1i(l,t.u_image0),u_grid_matrix:new a.UniformMatrix3f(l,t.u_grid_matrix)}),globeAtmosphere:(l,t)=>({u_frustum_tl:new a.Uniform3f(l,t.u_frustum_tl),u_frustum_tr:new a.Uniform3f(l,t.u_frustum_tr),u_frustum_br:new a.Uniform3f(l,t.u_frustum_br),u_frustum_bl:new a.Uniform3f(l,t.u_frustum_bl),u_globe_pos:new a.Uniform3f(l,t.u_globe_pos),u_globe_radius:new a.Uniform1f(l,t.u_globe_radius),u_opacity:new a.Uniform1f(l,t.u_opacity),u_fadeout_range:new a.Uniform1f(l,t.u_fadeout_range),u_start_color:new a.Uniform3f(l,t.u_start_color),u_end_color:new a.Uniform3f(l,t.u_end_color)})};let Jn;function Bc(l,t,o,u,p,f,_){const y=l.context,b=y.gl,T=l.useProgram("collisionBox"),E=[];let A=0,B=0;for(let W=0;W<u.length;W++){const K=u[W],Z=t.getTile(K),ee=Z.getBucket(o);if(!ee)continue;let he=K.projMatrix;p[0]===0&&p[1]===0||(he=l.translatePosMatrix(K.projMatrix,Z,p,f));const xe=_?ee.textCollisionBox:ee.iconCollisionBox,Te=ee.collisionCircleArray;if(Te.length>0){const be=a.create(),Re=he;a.mul(be,ee.placementInvProjMatrix,l.transform.glCoordMatrix),a.mul(be,be,ee.placementViewportMatrix),E.push({circleArray:Te,circleOffset:B,transform:Re,invTransform:be}),A+=Te.length/4,B=A}xe&&(l.terrain&&l.terrain.setupElevationDraw(Z,T),T.draw(y,b.LINES,a.DepthMode.disabled,a.StencilMode.disabled,l.colorModeForRenderPass(),a.CullFaceMode.disabled,ph(he,l.transform,Z),o.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,l.transform.zoom,null,xe.collisionVertexBuffer,xe.collisionVertexBufferExt))}if(!_||!E.length)return;const O=l.useProgram("collisionCircle"),R=new a.StructArrayLayout2f1f2i16;R.resize(4*A),R._trim();let D=0;for(const W of E)for(let K=0;K<W.circleArray.length/4;K++){const Z=4*K,ee=W.circleArray[Z+0],he=W.circleArray[Z+1],xe=W.circleArray[Z+2],Te=W.circleArray[Z+3];R.emplace(D++,ee,he,xe,Te,0),R.emplace(D++,ee,he,xe,Te,1),R.emplace(D++,ee,he,xe,Te,2),R.emplace(D++,ee,he,xe,Te,3)}(!Jn||Jn.length<2*A)&&(Jn=function(W){const K=2*W,Z=new a.StructArrayLayout3ui6;Z.resize(K),Z._trim();for(let ee=0;ee<K;ee++){const he=6*ee;Z.uint16[he+0]=4*ee+0,Z.uint16[he+1]=4*ee+1,Z.uint16[he+2]=4*ee+2,Z.uint16[he+3]=4*ee+2,Z.uint16[he+4]=4*ee+3,Z.uint16[he+5]=4*ee+0}return Z}(A));const X=y.createIndexBuffer(Jn,!0),j=y.createVertexBuffer(R,a.collisionCircleLayout.members,!0);for(const W of E){const K={u_matrix:W.transform,u_inv_matrix:W.invTransform,u_camera_to_center_distance:(q=l.transform).cameraToCenterDistance,u_viewport_size:[q.width,q.height]};O.draw(y,b.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,l.colorModeForRenderPass(),a.CullFaceMode.disabled,K,o.id,j,X,a.SegmentVector.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,l.transform.zoom,null,null,null)}var q;j.destroy(),X.destroy()}const dl=a.create();function hs(l,t,o,u,p,f){const{horizontalAlign:_,verticalAlign:y}=a.getAnchorAlignment(l),b=-(_-.5)*t,T=-(y-.5)*o,E=a.evaluateVariableOffset(l,u);return new a.pointGeometry((b/p+E[0])*f,(T/p+E[1])*f)}function gh(l,t,o,u,p,f,_,y,b,T,E,A){const B=l.text.placedSymbolArray,O=l.text.dynamicLayoutVertexArray,R=l.icon.dynamicLayoutVertexArray,D={},X=y.projMatrix,j=f.elevation,q=A.upVectorScale(y.canonical,f.center.lat,f.worldSize);O.clear();for(let W=0;W<B.length;W++){const K=B.get(W),Z=l.allowVerticalPlacement&&!K.placedOrientation,ee=K.hidden||!K.crossTileID||Z?null:u[K.crossTileID];if(ee){const he=new a.pointGeometry(K.tileAnchorX,K.tileAnchorY),xe=A.upVector(y.canonical,he.x,he.y),Te=j?j.getAtTileOffset(y,he.x,he.y):0,be=hr([K.projectedAnchorX+Te*xe[0]*q.metersToTile,K.projectedAnchorY+Te*xe[1]*q.metersToTile,K.projectedAnchorZ+Te*xe[2]*q.metersToTile],o?X:_),Re=li(f.cameraToCenterDistance,be.signedDistanceFromCamera);let de=p.evaluateSizeForFeature(l.textSizeData,T,K)*Re/a.ONE_EM;o&&(de*=l.tilePixelRatio/b);const{width:Fe,height:De,anchor:Ke,textOffset:Ee,textScale:Xe}=ee,st=hs(Ke,Fe,De,Ee,Xe,de),He=o?ji(he.add(st),_,Te*q.metersToLabelSpace).point:be.point.add(t?st.rotate(-f.angle):st),Ye=l.allowVerticalPlacement&&K.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let ct=0;ct<K.numGlyphs;ct++)a.addDynamicAttributes(O,He,Ye);E&&K.associatedIconIndex>=0&&(D[K.associatedIconIndex]={shiftedAnchor:He,angle:Ye})}else Mi(K.numGlyphs,O)}if(E){R.clear();const W=l.icon.placedSymbolArray;for(let K=0;K<W.length;K++){const Z=W.get(K);if(Z.hidden)Mi(Z.numGlyphs,R);else{const ee=D[K];if(ee)for(let he=0;he<Z.numGlyphs;he++)a.addDynamicAttributes(R,ee.shiftedAnchor,ee.angle);else Mi(Z.numGlyphs,R)}}l.icon.dynamicLayoutVertexBuffer.updateData(R)}l.text.dynamicLayoutVertexBuffer.updateData(O)}function yh(l,t,o){return o.iconsInText&&t?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function pl(l,t,o,u,p,f,_,y,b,T,E,A){const B=l.context,O=B.gl,R=l.transform,D=y==="map",X=b==="map",j=D&&o.layout.get("symbol-placement")!=="point",q=D&&!X&&!j,W=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let K=!1;const Z=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),ee=[a.mercatorXfromLng(R.center.lng),a.mercatorYfromLat(R.center.lat)],he=o.layout.get("text-variable-anchor"),xe=R.projection.name==="globe",Te=xe?a.globeToMercatorTransition(R.zoom):0,be=[],Re=[];l.terrain&&X&&Re.push("PITCH_WITH_MAP_TERRAIN"),xe&&Re.push("PROJECTION_GLOBE_VIEW");for(const de of u){const Fe=t.getTile(de),De=Fe.getBucket(o);if(!De||De.projection!==R.projection.name)continue;const Ke=p?De.text:De.icon;if(!Ke||De.fullyClipped||!Ke.segments.get().length)continue;const Ee=Ke.programConfigurations.get(o.id),Xe=p||De.sdfIcons,st=p?De.textSizeData:De.iconSizeData,He=X||R.pitch!==0,Ye=a.evaluateSizeForZoom(st,R.zoom);let ct,Tt,it,dt,Rt=[0,0],ci=null;if(p){if(Tt=Fe.glyphAtlasTexture,it=O.LINEAR,ct=Fe.glyphAtlasTexture.size,De.iconsInText){Rt=Fe.imageAtlasTexture.size,ci=Fe.imageAtlasTexture;const or=st.kind==="composite"||st.kind==="camera";dt=He||l.options.rotating||l.options.zooming||or?O.LINEAR:O.NEAREST}}else{const or=o.layout.get("icon-size").constantOr(0)!==1||De.iconsNeedLinear;Tt=Fe.imageAtlasTexture,it=Xe||l.options.rotating||l.options.zooming||or||He?O.LINEAR:O.NEAREST,ct=Fe.imageAtlasTexture.size}const Fi=l.transform.calculatePixelsToTileUnitsMatrix(Fe),Oi=Wn(de.projMatrix,Fe.tileID.canonical,X,D,l.transform,Fi),rr=l.terrain&&X&&j?a.invert(a.create(),Oi):dl,Pr=yo(de.projMatrix,Fe.tileID.canonical,X,D,l.transform,Fi),Jr=he&&De.hasTextData(),bn=o.layout.get("icon-text-fit")!=="none"&&Jr&&De.hasIconData();if(j){const or=R.elevation,eo=or?or.getAtTileOffsetFunc(de,R.center.lat,R.worldSize,R.projection):hu=>[0,0,0];ts(De,de.projMatrix,l,p,Oi,Pr,X,T,eo,de)}const Qr=j||p&&he||bn,di=l.translatePosMatrix(de.projMatrix,Fe,f,_),mi=Qr?dl:Oi,$t=l.translatePosMatrix(Pr,Fe,f,_,!0),Ti=R.projection.createInversionMatrix(R,de.canonical),nr=Qr?Re.concat(["PROJECTED_POS_ON_VIEWPORT"]):Re,ui=Xe&&o.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let fr;fr=Xe?De.iconsInText?So(st.kind,Ye,q,X,l,di,mi,$t,ct,Rt,de,Te,ee,Ti):Kn(st.kind,Ye,q,X,l,di,mi,$t,p,ct,!0,de,Te,ee,Ti):ul(st.kind,Ye,q,X,l,di,mi,$t,p,ct,de,Te,ee,Ti);const Ms={program:l.useProgram(yh(Xe,p,De),Ee,nr),buffers:Ke,uniformValues:fr,atlasTexture:Tt,atlasTextureIcon:ci,atlasInterpolation:it,atlasInterpolationIcon:dt,isSDF:Xe,hasHalo:ui,tile:Fe,labelPlaneMatrixInv:rr};if(W&&De.canOverlap){K=!0;const or=Ke.segments.get();for(const eo of or)be.push({segments:new a.SegmentVector([eo]),sortKey:eo.sortKey,state:Ms})}else be.push({segments:Ke.segments,sortKey:0,state:Ms})}K&&be.sort((de,Fe)=>de.sortKey-Fe.sortKey);for(const de of be){const Fe=de.state;if(l.terrain&&l.terrain.setupElevationDraw(Fe.tile,Fe.program,{useDepthForOcclusion:!xe,labelPlaneMatrixInv:Fe.labelPlaneMatrixInv}),B.activeTexture.set(O.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,O.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(B.activeTexture.set(O.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,O.CLAMP_TO_EDGE)),Fe.isSDF){const De=Fe.uniformValues;Fe.hasHalo&&(De.u_is_halo=1,Rc(Fe.buffers,de.segments,o,l,Fe.program,Z,E,A,De)),De.u_is_halo=0}Rc(Fe.buffers,de.segments,o,l,Fe.program,Z,E,A,Fe.uniformValues)}}function Rc(l,t,o,u,p,f,_,y,b){const T=u.context;p.draw(T,T.gl.TRIANGLES,f,_,y,a.CullFaceMode.disabled,b,o.id,l.layoutVertexBuffer,l.indexBuffer,t,o.paint,u.transform.zoom,l.programConfigurations.get(o.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function ca(l,t,o,u,p,f,_){const y=l.context.gl,b=o.paint.get("fill-pattern"),T=b&&b.constantOr(1),E=o.getCrossfadeParameters();let A,B,O,R,D;_?(B=T&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",A=y.LINES):(B=T?"fillPattern":"fill",A=y.TRIANGLES);for(const X of u){const j=t.getTile(X);if(T&&!j.patternsLoaded())continue;const q=j.getBucket(o);if(!q)continue;l.prepareDrawTile();const W=q.programConfigurations.get(o.id),K=l.useProgram(B,W);T&&(l.context.activeTexture.set(y.TEXTURE0),j.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),W.updatePaintBuffers(E));const Z=b.constantOr(null);if(Z&&j.imageAtlas){const he=j.imageAtlas,xe=he.patternPositions[Z.to.toString()],Te=he.patternPositions[Z.from.toString()];xe&&Te&&W.setConstantPatternPositions(xe,Te)}const ee=l.translatePosMatrix(X.projMatrix,j,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(_){R=q.indexBuffer2,D=q.segments2;const he=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[y.drawingBufferWidth,y.drawingBufferHeight];O=B==="fillOutlinePattern"&&T?zc(ee,l,E,j,he):aa(ee,he)}else R=q.indexBuffer,D=q.segments,O=T?sa(ee,l,E,j):oa(ee);l.prepareDrawProgram(l.context,K,X.toUnwrapped()),K.draw(l.context,A,p,l.stencilModeForClipping(X),f,a.CullFaceMode.disabled,O,o.id,q.layoutVertexBuffer,R,D,o.paint,l.transform.zoom,W)}}function Io(l,t,o,u,p,f,_){const y=l.context,b=y.gl,T=l.transform,E=o.paint.get("fill-extrusion-pattern"),A=E.constantOr(1),B=o.getCrossfadeParameters(),O=o.paint.get("fill-extrusion-opacity"),R=function(W){if(W.projection.name!=="globe")return 0;const K=Math.PI/32,Z=Math.tan(K),ee=a.earthRadius;return ee*Math.sqrt(1+2*Z*Z)-ee}(T),D=T.projection.name==="globe",X=D?a.globeToMercatorTransition(T.zoom):0,j=[a.mercatorXfromLng(T.center.lng),a.mercatorYfromLat(T.center.lat)],q=[];D&&q.push("PROJECTION_GLOBE_VIEW");for(const W of u){const K=t.getTile(W),Z=K.getBucket(o);if(!Z||Z.projection!==T.projection.name)continue;const ee=Z.programConfigurations.get(o.id),he=l.useProgram(A?"fillExtrusionPattern":"fillExtrusion",ee,q);if(l.terrain){const Fe=l.terrain;if(l.style.terrainSetForDrapingOnly())Fe.setupElevationDraw(K,he,{useMeterToDem:!0});else{if(!Z.enableTerrain)continue;if(Fe.setupElevationDraw(K,he,{useMeterToDem:!0}),ds(y,t,W,Z,o,Fe),!Z.centroidVertexBuffer){const De=he.attributes.a_centroid_pos;De!==void 0&&b.vertexAttrib2f(De,0,0)}}}A&&(l.context.activeTexture.set(b.TEXTURE0),K.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),ee.updatePaintBuffers(B));const xe=E.constantOr(null);if(xe&&K.imageAtlas){const Fe=K.imageAtlas,De=Fe.patternPositions[xe.to.toString()],Ke=Fe.patternPositions[xe.from.toString()];De&&Ke&&ee.setConstantPatternPositions(De,Ke)}const Te=l.translatePosMatrix(W.projMatrix,K,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),be=T.projection.createInversionMatrix(T,W.canonical),Re=o.paint.get("fill-extrusion-vertical-gradient"),de=A?na(Te,l,Re,O,W,B,K,R,X,j,be):ra(Te,l,Re,O,W,R,X,j,be);l.prepareDrawProgram(y,he,W.toUnwrapped()),he.draw(y,y.gl.TRIANGLES,p,f,_,a.CullFaceMode.backCCW,de,o.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,o.paint,l.transform.zoom,ee,l.terrain?Z.centroidVertexBuffer:null,D?Z.layoutVertexExtBuffer:null)}}function ds(l,t,o,u,p,f){const _=[j=>{let q=j.canonical.x-1,W=j.wrap;return q<0&&(q=(1<<j.canonical.z)-1,W--),new a.OverscaledTileID(j.overscaledZ,W,j.canonical.z,q,j.canonical.y)},j=>{let q=j.canonical.x+1,W=j.wrap;return q===1<<j.canonical.z&&(q=0,W++),new a.OverscaledTileID(j.overscaledZ,W,j.canonical.z,q,j.canonical.y)},j=>new a.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,(j.canonical.y===0?1<<j.canonical.z:j.canonical.y)-1),j=>new a.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y===(1<<j.canonical.z)-1?0:j.canonical.y+1)],y=j=>{const q=t.getSource().minzoom,W=Z=>{const ee=t.getTileByID(Z);if(ee&&ee.hasData())return ee.getBucket(p)},K=[0,-1,1];for(const Z of K){if(j.overscaledZ+Z<q)continue;const ee=W(j.calculateScaledKey(j.overscaledZ+Z));if(ee)return ee}},b=[0,0,0],T=(j,q)=>(b[0]=Math.min(j.min.y,q.min.y),b[1]=Math.max(j.max.y,q.max.y),b[2]=a.EXTENT-q.min.x>j.max.x?q.min.x-a.EXTENT:j.max.x,b),E=(j,q)=>(b[0]=Math.min(j.min.x,q.min.x),b[1]=Math.max(j.max.x,q.max.x),b[2]=a.EXTENT-q.min.y>j.max.y?q.min.y-a.EXTENT:j.max.y,b),A=[(j,q)=>T(j,q),(j,q)=>T(q,j),(j,q)=>E(j,q),(j,q)=>E(q,j)],B=new a.pointGeometry(0,0);let O,R,D;const X=(j,q,W,K,Z)=>{const ee=[[K?W:j,K?j:W,0],[K?W:q,K?q:W,0]],he=Z<0?a.EXTENT+Z:Z,xe=[K?he:(j+q)/2,K?(j+q)/2:he,0];return W===0&&Z<0||W!==0&&Z>0?f.getForTilePoints(D,[xe],!0,R):ee.push(xe),f.getForTilePoints(o,ee,!0,O),Math.max(ee[0][2],ee[1][2],xe[2])/f.exaggeration()};for(let j=0;j<4;j++){const q=(j<2?1:5)-j,W=u.borders[j];if(W.length===0)continue;const K=D=_[j](o),Z=y(K);if(!(Z&&Z instanceof a.FillExtrusionBucket&&Z.enableTerrain)||u.borderDoneWithNeighborZ[j]===Z.canonical.z&&Z.borderDoneWithNeighborZ[q]===u.canonical.z||(R=f.findDEMTileFor(K),!R||!R.dem))continue;if(!O){const Te=f.findDEMTileFor(o);if(!Te||!Te.dem)return;O=Te}const ee=Z.borders[q];let he=0;const xe=Z.borderDoneWithNeighborZ[q]!==u.canonical.z;if(u.canonical.z===Z.canonical.z){for(let Te=0;Te<W.length;Te++){const be=u.featuresOnBorder[W[Te]],Re=be.borders[j];let de;for(;he<ee.length&&(de=Z.featuresOnBorder[ee[he]],!(de.borders[q][1]>Re[0]+3));)xe&&Z.encodeCentroid(void 0,de,!1),he++;if(de&&he<ee.length){const Fe=he;let De=0;for(;!(de.borders[q][0]>Re[1]-3)&&(De++,++he!==ee.length);)de=Z.featuresOnBorder[ee[he]];if(de=Z.featuresOnBorder[ee[Fe]],be.intersectsCount()>1||de.intersectsCount()>1||De!==1){De!==1&&(he=Fe),u.encodeCentroid(void 0,be,!1),xe&&Z.encodeCentroid(void 0,de,!1);continue}const Ke=A[j](be,de),Ee=j%2?a.EXTENT-1:0;B.x=X(Ke[0],Math.min(a.EXTENT-1,Ke[1]),Ee,j<2,Ke[2]),B.y=0,u.encodeCentroid(B,be,!1),xe&&Z.encodeCentroid(B,de,!1)}else u.encodeCentroid(void 0,be,!1)}u.borderDoneWithNeighborZ[j]=Z.canonical.z,u.needsCentroidUpdate=!0,xe&&(Z.borderDoneWithNeighborZ[q]=u.canonical.z,Z.needsCentroidUpdate=!0)}else{for(const Te of W)u.encodeCentroid(void 0,u.featuresOnBorder[Te],!1);if(xe){for(const Te of ee)Z.encodeCentroid(void 0,Z.featuresOnBorder[Te],!1);Z.borderDoneWithNeighborZ[q]=u.canonical.z,Z.needsCentroidUpdate=!0}u.borderDoneWithNeighborZ[j]=Z.canonical.z,u.needsCentroidUpdate=!0}}(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(l)}const fl=new a.Color(1,0,0,1),ml=new a.Color(0,1,0,1),Fc=new a.Color(0,0,1,1),ua=new a.Color(1,0,1,1),ha=new a.Color(0,1,1,1);function Ge(l,t,o,u){ps(l,0,t+o/2,l.transform.width,o,u)}function dr(l,t,o,u){ps(l,t-o/2,0,o,l.transform.height,u)}function ps(l,t,o,u,p,f){const _=l.context,y=_.gl;y.enable(y.SCISSOR_TEST),y.scissor(t*a.exported.devicePixelRatio,o*a.exported.devicePixelRatio,u*a.exported.devicePixelRatio,p*a.exported.devicePixelRatio),_.clear({color:f}),y.disable(y.SCISSOR_TEST)}function Oc(l,t,o){const u=l.context,p=u.gl,f=l.transform.projection.name==="globe",_=o.projMatrix,y=l.useProgram("debug",null,f?["PROJECTION_GLOBE_VIEW"]:null),b=t.getTileByID(o.key);l.terrain&&l.terrain.setupElevationDraw(b,y);const T=a.DepthMode.disabled,E=a.StencilMode.disabled,A=l.colorModeForRenderPass(),B="$debug";u.activeTexture.set(p.TEXTURE0),l.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),f?b._makeGlobeTileDebugBuffers(l.context,l.transform.projection):b._makeDebugTileBoundsBuffers(l.context,l.transform.projection);const O=b._tileDebugBuffer||l.debugBuffer,R=b._tileDebugIndexBuffer||l.debugIndexBuffer,D=b._tileDebugSegments||l.debugSegments;y.draw(u,p.LINE_STRIP,T,E,A,a.CullFaceMode.disabled,Pc(_,a.Color.red),B,O,R,D,null,null,null,b._globeTileDebugBorderBuffer);const X=b.latestRawTileData,j=Math.floor((X&&X.byteLength||0)/1024),q=t.getTile(o).tileSize,W=512/Math.min(q,512)*(o.overscaledZ/l.transform.zoom)*.5;let K=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(K+=` => ${o.overscaledZ}`),function(xe,Te){xe.initDebugOverlayCanvas();const be=xe.debugOverlayCanvas,Re=xe.context.gl,de=xe.debugOverlayCanvas.getContext("2d");de.clearRect(0,0,be.width,be.height),de.shadowColor="white",de.shadowBlur=2,de.lineWidth=1.5,de.strokeStyle="white",de.textBaseline="top",de.font="bold 36px Open Sans, sans-serif",de.fillText(Te,5,5),de.strokeText(Te,5,5),xe.debugOverlayTexture.update(be),xe.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(l,`${K} ${j}kb`);const Z=b._tileDebugTextBuffer||l.debugBuffer,ee=b._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,he=b._tileDebugTextSegments||l.debugSegments;y.draw(u,p.TRIANGLES,T,E,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,Pc(_,a.Color.transparent,W),B,Z,ee,he,null,null,null,b._globeTileDebugTextBuffer)}const Uc=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Mo}=Uc;function Hr(l,t,o,u){l.emplaceBack(t,o,u)}class fs{constructor(t){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,Hr(this.vertexArray,-1,-1,1),Hr(this.vertexArray,1,-1,1),Hr(this.vertexArray,-1,1,1),Hr(this.vertexArray,1,1,1),Hr(this.vertexArray,-1,-1,-1),Hr(this.vertexArray,1,-1,-1),Hr(this.vertexArray,-1,1,-1),Hr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Mo),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function _n(l,t,o,u,p,f){const _=l.gl,y=t.paint.get("sky-atmosphere-color"),b=t.paint.get("sky-atmosphere-halo-color"),T=t.paint.get("sky-atmosphere-sun-intensity"),E=((A,B,O,R,D)=>({u_matrix_3f:A,u_sun_direction:B,u_sun_intensity:O,u_color_tint_r:[R.r,R.g,R.b,R.a],u_color_tint_m:[D.r,D.g,D.b,D.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),u),p,T,y,b);_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+f,t.skyboxTexture,0),o.draw(l,_.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,E,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}function gn(l,t){return a.transformMat4(l,l,t)}const _l={symbol:function(l,t,o,u,p){if(l.renderPass!=="translucent")return;const f=a.StencilMode.disabled,_=l.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(y,b,T,E,A,B,O){const R=b.transform,D=A==="map",X=B==="map";for(const j of y){const q=E.getTile(j),W=q.getBucket(T);if(!W||W.projection!==R.projection.name||!W.text||!W.text.segments.get().length)continue;const K=a.evaluateSizeForZoom(W.textSizeData,R.zoom),Z=b.transform.calculatePixelsToTileUnitsMatrix(q),ee=Wn(j.projMatrix,q.tileID.canonical,X,D,b.transform,Z),he=T.layout.get("icon-text-fit")!=="none"&&W.hasIconData();if(K){const xe=Math.pow(2,R.zoom-q.tileID.overscaledZ);gh(W,D,X,O,a.symbolSize,R,ee,j,xe,K,he,R.projection)}}}(u,l,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),p),o.paint.get("icon-opacity").constantOr(1)!==0&&pl(l,t,o,u,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),f,_),o.paint.get("text-opacity").constantOr(1)!==0&&pl(l,t,o,u,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),f,_),t.map.showCollisionBoxes&&(Bc(l,t,o,u,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Bc(l,t,o,u,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,o,u){if(l.renderPass!=="translucent")return;const p=o.paint.get("circle-opacity"),f=o.paint.get("circle-stroke-width"),_=o.paint.get("circle-stroke-opacity"),y=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(p.constantOr(1)===0&&(f.constantOr(1)===0||_.constantOr(1)===0))return;const b=l.context,T=b.gl,E=l.transform,A=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),B=a.StencilMode.disabled,O=l.colorModeForRenderPass(),R=E.projection.name==="globe",D=[a.mercatorXfromLng(E.center.lng),a.mercatorYfromLat(E.center.lat)],X=[];for(let q=0;q<u.length;q++){const W=u[q],K=t.getTile(W),Z=K.getBucket(o);if(!Z)continue;const ee=Z.programConfigurations.get(o.id),he=dh(o);R&&he.push("PROJECTION_GLOBE_VIEW");const xe=l.useProgram("circle",ee,he),Te=Z.layoutVertexBuffer,be=Z.globeExtVertexBuffer,Re=Z.indexBuffer,de=E.projection.createInversionMatrix(E,W.canonical),Fe={programConfiguration:ee,program:xe,layoutVertexBuffer:Te,globeExtVertexBuffer:be,indexBuffer:Re,uniformValues:Eo(l,W,K,de,D,o),tile:K};if(y){const De=Z.segments.get();for(const Ke of De)X.push({segments:new a.SegmentVector([Ke]),sortKey:Ke.sortKey,state:Fe})}else X.push({segments:Z.segments,sortKey:0,state:Fe})}y&&X.sort((q,W)=>q.sortKey-W.sortKey);const j={useDepthForOcclusion:!R};for(const q of X){const{programConfiguration:W,program:K,layoutVertexBuffer:Z,globeExtVertexBuffer:ee,indexBuffer:he,uniformValues:xe,tile:Te}=q.state,be=q.segments;l.terrain&&l.terrain.setupElevationDraw(Te,K,j),l.prepareDrawProgram(b,K,Te.tileID.toUnwrapped()),K.draw(b,T.TRIANGLES,A,B,O,a.CullFaceMode.disabled,xe,o.id,Z,he,be,o.paint,E.zoom,W,R?ee:null)}},heatmap:function(l,t,o,u){if(o.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const p=l.context,f=p.gl,_=a.StencilMode.disabled,y=new a.ColorMode([f.ONE,f.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(B,O,R){const D=B.gl;B.activeTexture.set(D.TEXTURE1),B.viewport.set([0,0,O.width/4,O.height/4]);let X=R.heatmapFbo;if(X)D.bindTexture(D.TEXTURE_2D,X.colorAttachment.get()),B.bindFramebuffer.set(X.framebuffer);else{const j=D.createTexture();D.bindTexture(D.TEXTURE_2D,j),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),X=R.heatmapFbo=B.createFramebuffer(O.width/4,O.height/4,!1),function(q,W,K,Z){const ee=q.gl;ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,W.width/4,W.height/4,0,ee.RGBA,q.extRenderToTextureHalfFloat?q.extTextureHalfFloat.HALF_FLOAT_OES:ee.UNSIGNED_BYTE,null),Z.colorAttachment.set(K)}(B,O,j,X)}})(p,l,o),p.clear({color:a.Color.transparent});const b=l.transform,T=b.projection.name==="globe",E=T?["PROJECTION_GLOBE_VIEW"]:null,A=[a.mercatorXfromLng(b.center.lng),a.mercatorYfromLat(b.center.lat)];for(let B=0;B<u.length;B++){const O=u[B];if(t.hasRenderableParent(O))continue;const R=t.getTile(O),D=R.getBucket(o);if(!D)continue;const X=D.programConfigurations.get(o.id),j=l.useProgram("heatmap",X,E),{zoom:q}=l.transform;l.terrain&&l.terrain.setupElevationDraw(R,j),l.prepareDrawProgram(p,j,O.toUnwrapped());const W=b.projection.createInversionMatrix(b,O.canonical);j.draw(p,f.TRIANGLES,a.DepthMode.disabled,_,y,a.CullFaceMode.disabled,mh(l,O,R,W,A,q,o.paint.get("heatmap-intensity")),o.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,o.paint,l.transform.zoom,X,T?D.globeExtVertexBuffer:null)}p.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(p,f){const _=p.context,y=_.gl,b=f.heatmapFbo;if(!b)return;_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,b.colorAttachment.get()),_.activeTexture.set(y.TEXTURE1);let T=f.colorRampTexture;T||(T=f.colorRampTexture=new a.Texture(_,f.colorRamp,y.RGBA)),T.bind(y.LINEAR,y.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(_,y.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,p.colorModeForRenderPass(),a.CullFaceMode.disabled,((E,A,B,O)=>({u_image:0,u_color_ramp:1,u_opacity:A.paint.get("heatmap-opacity")}))(0,f),f.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,f.paint,p.transform.zoom)}(l,o))},line:function(l,t,o,u){if(l.renderPass!=="translucent")return;const p=o.paint.get("line-opacity"),f=o.paint.get("line-width");if(p.constantOr(1)===0||f.constantOr(1)===0)return;const _=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),y=l.colorModeForRenderPass(),b=l.terrain&&l.terrain.renderingToTexture?1:a.exported.devicePixelRatio,T=o.paint.get("line-dasharray"),E=T.constantOr(1),A=o.layout.get("line-cap"),B=o.paint.get("line-pattern"),O=B.constantOr(1),R=o.paint.get("line-gradient"),D=o.getCrossfadeParameters(),X=O?"linePattern":"line",j=l.context,q=j.gl,W=(Z=>{const ee=[];ll(Z)&&ee.push("RENDER_LINE_DASH"),Z.paint.get("line-gradient")&&ee.push("RENDER_LINE_GRADIENT");const he=Z.paint.get("line-pattern").constantOr(1),xe=Z.paint.get("line-opacity").constantOr(1)!==1;return!he&&xe&&ee.push("RENDER_LINE_ALPHA_DISCARD"),ee})(o);let K=W.includes("RENDER_LINE_ALPHA_DISCARD");l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(K=!1);for(const Z of u){const ee=t.getTile(Z);if(O&&!ee.patternsLoaded())continue;const he=ee.getBucket(o);if(!he)continue;l.prepareDrawTile();const xe=he.programConfigurations.get(o.id),Te=l.useProgram(X,xe,W),be=B.constantOr(null);if(be&&ee.imageAtlas){const Ee=ee.imageAtlas,Xe=Ee.patternPositions[be.to.toString()],st=Ee.patternPositions[be.from.toString()];Xe&&st&&xe.setConstantPatternPositions(Xe,st)}const Re=T.constantOr(null),de=A.constantOr(null);if(!O&&Re&&de&&ee.lineAtlas){const Ee=ee.lineAtlas,Xe=Ee.getDash(Re.to,de),st=Ee.getDash(Re.from,de);Xe&&st&&xe.setConstantPatternPositions(Xe,st)}const Fe=l.terrain?Z.projMatrix:null,De=O?al(l,ee,o,D,Fe,b):_h(l,ee,o,D,Fe,he.lineClipsArray.length,b);if(R){const Ee=he.gradients[o.id];let Xe=Ee.texture;if(o.gradientVersion!==Ee.version){let st=256;if(o.stepInterpolant){const He=t.getSource().maxzoom,Ye=Z.canonical.z===He?Math.ceil(1<<l.transform.maxZoom-Z.canonical.z):1;st=a.clamp(a.nextPowerOfTwo(he.maxLineLength/a.EXTENT*1024*Ye),256,j.maxTextureSize)}Ee.gradient=a.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:st,image:Ee.gradient||void 0,clips:he.lineClipsArray}),Ee.texture?Ee.texture.update(Ee.gradient):Ee.texture=new a.Texture(j,Ee.gradient,q.RGBA),Ee.version=o.gradientVersion,Xe=Ee.texture}j.activeTexture.set(q.TEXTURE1),Xe.bind(o.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}E&&(j.activeTexture.set(q.TEXTURE0),ee.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),xe.updatePaintBuffers(D)),O&&(j.activeTexture.set(q.TEXTURE0),ee.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),xe.updatePaintBuffers(D)),l.prepareDrawProgram(j,Te,Z.toUnwrapped());const Ke=Ee=>{Te.draw(j,q.TRIANGLES,_,Ee,y,a.CullFaceMode.disabled,De,o.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,o.paint,l.transform.zoom,xe,he.layoutVertexBuffer2)};if(K){const Ee=l.stencilModeForClipping(Z).ref;Ee===0&&l.terrain&&j.clear({stencil:0});const Xe={func:q.EQUAL,mask:255};De.u_alpha_discard_threshold=.8,Ke(new a.StencilMode(Xe,Ee,255,q.KEEP,q.KEEP,q.INVERT)),De.u_alpha_discard_threshold=0,Ke(new a.StencilMode(Xe,Ee,255,q.KEEP,q.KEEP,q.KEEP))}else Ke(l.stencilModeForClipping(Z))}K&&(l.resetStencilClippingMasks(),l.terrain&&j.clear({stencil:0}))},fill:function(l,t,o,u){const p=o.paint.get("fill-color"),f=o.paint.get("fill-opacity");if(f.constantOr(1)===0)return;const _=l.colorModeForRenderPass(),y=o.paint.get("fill-pattern"),b=l.opaquePassEnabledForLayer()&&!y.constantOr(1)&&p.constantOr(a.Color.transparent).a===1&&f.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===b){const T=l.depthModeForSublayer(1,l.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);ca(l,t,o,u,T,_,!1)}if(l.renderPass==="translucent"&&o.paint.get("fill-antialias")){const T=l.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);ca(l,t,o,u,T,_,!0)}},"fill-extrusion":function(l,t,o,u){const p=o.paint.get("fill-extrusion-opacity");if(p!==0&&l.renderPass==="translucent"){const f=new a.DepthMode(l.context.gl.LEQUAL,a.DepthMode.ReadWrite,l.depthRangeFor3D);if(p!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))Io(l,t,o,u,f,a.StencilMode.disabled,a.ColorMode.disabled),Io(l,t,o,u,f,l.stencilModeFor3D(),l.colorModeForRenderPass()),l.resetStencilClippingMasks();else{const _=l.colorModeForRenderPass();Io(l,t,o,u,f,a.StencilMode.disabled,_)}}},hillshade:function(l,t,o,u){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent")return;const p=l.context,f=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),_=l.colorModeForRenderPass(),y=l.terrain&&l.terrain.renderingToTexture,[b,T]=l.renderPass!=="translucent"||y?[{},u]:l.stencilConfigForOverlap(u);for(const E of T){const A=t.getTile(E);if(A.needsHillshadePrepare&&l.renderPass==="offscreen")tl(l,A,o,f,a.StencilMode.disabled,_);else if(l.renderPass==="translucent"){const B=y&&l.terrain?l.terrain.stencilModeForRTTOverlap(E):b[E.overscaledZ];Mc(l,E,A,o,f,B,_)}}p.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,o,u,p,f){if(l.renderPass!=="translucent"||o.paint.get("raster-opacity")===0||!u.length)return;const _=l.context,y=_.gl,b=t.getSource(),T=l.useProgram("raster"),E=l.colorModeForRenderPass(),A=l.terrain&&l.terrain.renderingToTexture,[B,O]=b instanceof ie||A?[{},u]:l.stencilConfigForOverlap(u),R=O[O.length-1].overscaledZ,D=!l.options.moving;for(const X of O){const j=A?a.DepthMode.disabled:l.depthModeForSublayer(X.overscaledZ-R,o.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,y.LESS),q=X.toUnwrapped(),W=t.getTile(X);if(A&&(!W||!W.hasData()))continue;const K=A?X.projMatrix:l.transform.calculateProjMatrix(q,D),Z=l.terrain&&A?l.terrain.stencilModeForRTTOverlap(X):B[X.overscaledZ],ee=f?0:o.paint.get("raster-fade-duration");W.registerFadeDuration(ee);const he=t.findLoadedParent(X,0),xe=nl(W,he,t,l.transform,ee);let Te,be;l.terrain&&l.terrain.prepareDrawTile();const Re=o.paint.get("raster-resampling")==="nearest"?y.NEAREST:y.LINEAR;_.activeTexture.set(y.TEXTURE0),W.texture.bind(Re,y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE1),he?(he.texture.bind(Re,y.CLAMP_TO_EDGE),Te=Math.pow(2,he.tileID.overscaledZ-W.tileID.overscaledZ),be=[W.tileID.canonical.x*Te%1,W.tileID.canonical.y*Te%1]):W.texture.bind(Re,y.CLAMP_TO_EDGE);const de=Dc(K,be||[0,0],Te||1,xe,o,b instanceof ie?b.perspectiveTransform:[0,0]);if(l.prepareDrawProgram(_,T,q),b instanceof ie)b.boundsBuffer&&b.boundsSegments&&T.draw(_,y.TRIANGLES,j,a.StencilMode.disabled,E,a.CullFaceMode.disabled,de,o.id,b.boundsBuffer,l.quadTriangleIndexBuffer,b.boundsSegments);else{const{tileBoundsBuffer:Fe,tileBoundsIndexBuffer:De,tileBoundsSegments:Ke}=l.getTileBoundsBuffers(W);T.draw(_,y.TRIANGLES,j,Z,E,a.CullFaceMode.disabled,de,o.id,Fe,De,Ke)}}l.resetStencilClippingMasks()},background:function(l,t,o,u){const p=o.paint.get("background-color"),f=o.paint.get("background-opacity");if(f===0)return;const _=l.context,y=_.gl,b=l.transform,T=b.tileSize,E=o.paint.get("background-pattern");if(l.isPatternMissing(E))return;const A=!E&&p.a===1&&f===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==A)return;const B=a.StencilMode.disabled,O=l.depthModeForSublayer(0,A==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),R=l.colorModeForRenderPass(),D=l.useProgram(E?"backgroundPattern":"background");let X,j=u;j||(X=l.getBackgroundTiles(),j=Object.values(X).map(W=>W.tileID)),E&&(_.activeTexture.set(y.TEXTURE0),l.imageManager.bind(l.context));const q=o.getCrossfadeParameters();for(const W of j){const K=W.toUnwrapped(),Z=u?W.projMatrix:l.transform.calculateProjMatrix(K);l.prepareDrawTile();const ee=t?t.getTile(W):X?X[W.key]:new a.Tile(W,T,b.zoom,l),he=E?hl(Z,f,l,E,{tileID:W,tileSize:T},q):Lc(Z,f,p);l.prepareDrawProgram(_,D,K);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Te,tileBoundsSegments:be}=l.getTileBoundsBuffers(ee);D.draw(_,y.TRIANGLES,O,B,R,a.CullFaceMode.disabled,he,o.id,xe,Te,be)}},sky:function(l,t,o){const u=l.transform,p=u.projection.name==="mercator"||u.projection.name==="globe"?1:a.smoothstep(7,8,u.zoom),f=o.paint.get("sky-opacity")*p;if(f===0)return;const _=l.context,y=o.paint.get("sky-type"),b=new a.DepthMode(_.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),T=l.frameCounter/1e3%1;y==="atmosphere"?l.renderPass==="offscreen"?o.needsSkyboxCapture(l)&&(function(E,A,B,O){const R=E.context,D=R.gl;let X=A.skyboxFbo;if(!X){X=A.skyboxFbo=R.createFramebuffer(32,32,!1),A.skyboxGeometry=new fs(R),A.skyboxTexture=R.gl.createTexture(),D.bindTexture(D.TEXTURE_CUBE_MAP,A.skyboxTexture),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_MAG_FILTER,D.LINEAR);for(let K=0;K<6;++K)D.texImage2D(D.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,D.RGBA,32,32,0,D.RGBA,D.UNSIGNED_BYTE,null)}R.bindFramebuffer.set(X.framebuffer),R.viewport.set([0,0,32,32]);const j=A.getCenter(E,!0),q=E.useProgram("skyboxCapture"),W=new Float64Array(16);a.identity(W),a.rotateY(W,W,.5*-Math.PI),_n(R,A,q,W,j,0),a.identity(W),a.rotateY(W,W,.5*Math.PI),_n(R,A,q,W,j,1),a.identity(W),a.rotateX(W,W,.5*-Math.PI),_n(R,A,q,W,j,2),a.identity(W),a.rotateX(W,W,.5*Math.PI),_n(R,A,q,W,j,3),a.identity(W),_n(R,A,q,W,j,4),a.identity(W),a.rotateY(W,W,Math.PI),_n(R,A,q,W,j,5),R.viewport.set([0,0,E.width,E.height])}(l,o),o.markSkyboxValid(l)):l.renderPass==="sky"&&function(E,A,B,O,R){const D=E.context,X=D.gl,j=E.transform,q=E.useProgram("skybox");D.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,A.skyboxTexture);const W=((K,Z,ee,he,xe)=>({u_matrix:K,u_sun_direction:Z,u_cubemap:0,u_opacity:he,u_temporal_offset:xe}))(j.skyboxMatrix,A.getCenter(E,!1),0,O,R);E.prepareDrawProgram(D,q),q.draw(D,X.TRIANGLES,B,a.StencilMode.disabled,E.colorModeForRenderPass(),a.CullFaceMode.backCW,W,"skybox",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)}(l,o,b,f,T):y==="gradient"&&l.renderPass==="sky"&&function(E,A,B,O,R){const D=E.context,X=D.gl,j=E.transform,q=E.useProgram("skyboxGradient");A.skyboxGeometry||(A.skyboxGeometry=new fs(D)),D.activeTexture.set(X.TEXTURE0);let W=A.colorRampTexture;W||(W=A.colorRampTexture=new a.Texture(D,A.colorRamp,X.RGBA)),W.bind(X.LINEAR,X.CLAMP_TO_EDGE);const K=((Z,ee,he,xe,Te)=>({u_matrix:Z,u_color_ramp:0,u_center_direction:ee,u_radius:a.degToRad(he),u_opacity:xe,u_temporal_offset:Te}))(j.skyboxMatrix,A.getCenter(E,!1),A.paint.get("sky-gradient-radius"),O,R);E.prepareDrawProgram(D,q),q.draw(D,X.TRIANGLES,B,a.StencilMode.disabled,E.colorModeForRenderPass(),a.CullFaceMode.backCW,K,"skyboxGradient",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)}(l,o,b,f,T)},debug:function(l,t,o){for(let u=0;u<o.length;u++)Oc(l,t,o[u])},custom:function(l,t,o){const u=l.context,p=o.implementation;if(l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes("custom"))a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(l.renderPass==="offscreen"){const f=p.prerender;f&&(l.setCustomLayerDefaults(),u.setColorMode(l.colorModeForRenderPass()),f.call(p,u.gl,l.transform.customLayerMatrix()),u.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),u.setColorMode(l.colorModeForRenderPass()),u.setStencilMode(a.StencilMode.disabled);const f=p.renderingMode==="3d"?new a.DepthMode(l.context.gl.LEQUAL,a.DepthMode.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,a.DepthMode.ReadOnly);u.setDepthMode(f),p.render(u.gl,l.transform.customLayerMatrix()),u.setDirty(),l.setBaseState(),u.bindFramebuffer.set(null)}}};class Vc{constructor(t,o){this.context=new M(t),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ks,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(t,o){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new er(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,o)}_updateFog(t){const o=t.fog;if(!o||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=o.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const f=u+.78*(p-u);this.transform.fogCullDistSq=f*f}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,o){if(this.width=t*a.exported.devicePixelRatio,this.height=o*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._layers[u].resize()}setup(){const t=this.context,o=new a.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(a.EXTENT,0),o.emplaceBack(0,a.EXTENT),o.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(o,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const u=new a.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(a.EXTENT,0),u.emplaceBack(0,a.EXTENT),u.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=t.createVertexBuffer(u,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const p=new a.StructArrayLayout2i4;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const f=new a.StructArrayLayout4i8;f.emplaceBack(0,0,0,0),f.emplaceBack(a.EXTENT,0,a.EXTENT,0),f.emplaceBack(0,a.EXTENT,0,a.EXTENT),f.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(f,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const _=new a.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_);const y=new a.StructArrayLayout1ui2;for(const T of[0,1,3,2,0])y.emplaceBack(T);this.debugIndexBuffer=t.createIndexBuffer(y),this.emptyTexture=new a.Texture(t,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=a.create();const b=this.context.gl;this.stencilClearMode=new a.StencilMode({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO),this.loadTimeStamps.push(a.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,o=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(t,o.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,ta(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(t,o,u){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!u||u.length===0)return;const p=[];let f=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const E of u)if(this._tileClippingMaskIDs.has(E.key)||(f=!0),this._skippedStencilTileIDs.has(E.key)){if(!o.getTile(E).getBucket(t))continue;this._skippedStencilTileIDs.delete(E.key),p.push(E)}if(!f&&p.length===0)return}const _=this.context,y=_.gl;_.setColorMode(a.ColorMode.disabled),_.setDepthMode(a.DepthMode.disabled);const b=this.useProgram("clippingMask"),T=E=>{const A=o.getTile(E),{tileBoundsBuffer:B,tileBoundsIndexBuffer:O,tileBoundsSegments:R}=this.getTileBoundsBuffers(A);b.draw(_,y.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:y.GREATER,mask:255},this._tileClippingMaskIDs.get(E.key)||0,255,y.KEEP,y.KEEP,y.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,ta(E.projMatrix),"$clipping",B,O,R)};if(!f&&p.length>0)for(const E of p)T(E);else{(this._tileClippingMaskIDs.size===0||this.nextStencilID+u.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const E of u)this._tileClippingMaskIDs.set(E.key,this.nextStencilID++),o.getTile(E).getBucket(t)?T(E):this._skippedStencilTileIDs.add(E.key)}this._skippedStencilTileIDs.size===0&&(this.currentStencilSource=o.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new a.StencilMode({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const o=this.context.gl;return new a.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs.get(t.key)||0,0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,u=t.sort((_,y)=>y.overscaledZ-_.overscaledZ),p=u[u.length-1].overscaledZ,f=u[0].overscaledZ-p+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const _={};for(let y=0;y<f;y++)_[y+p]=new a.StencilMode({func:o.GEQUAL,mask:255},y+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=f,[_,u]}return[{[p]:a.StencilMode.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([t.CONSTANT_COLOR,t.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(t,o,u){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new a.DepthMode(u||this.context.gl.LEQUAL,o,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,o){this.style=t,this.options=o,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const u=this.style.order,p=this.style._sourceCaches;for(const T in p){const E=p[T];E.used&&E.prepare(this.context)}const f={},_={},y={};for(const T in p){const E=p[T];f[T]=E.getVisibleCoordinates(),_[T]=f[T].slice().reverse(),y[T]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<u.length;T++)if(this.style._layers[u[T]].is3D()){this.opaquePassCutoff=T;break}if(this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const T of u){const E=this.style._layers[T],A=t._getLayerSourceCache(E);if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const B=A?_[A.id]:void 0;(E.type==="custom"||E.isSky()||B&&B.length)&&this.renderLayer(this,A,E,B)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let b=a.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(b=this.style.fog.properties.get("color")),this.context.clear({color:o.showOverdrawInspector?a.Color.black:b,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[u[this.currentLayer]],E=t._getLayerSourceCache(T);if(T.isSky())continue;const A=E?_[E.id]:void 0;this._renderTileClippingMasks(T,E,A),this.renderLayer(this,E,T,A)}if(this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const T=this.style._layers[u[this.currentLayer]],E=t._getLayerSourceCache(T);T.isSky()&&this.renderLayer(this,E,T,E?_[E.id]:void 0)}for(this.transform.projection.name==="globe"&&function(T){const E=T.context,A=E.gl,B=T.transform,O=new a.DepthMode(A.LEQUAL,a.DepthMode.ReadOnly,[0,1]),R=T.useProgram("globeAtmosphere"),D=B.centerOffset,X=B._camera.getCameraToClipPerspective(B._fov,B.width/B.height,B._nearZ,B._farZ);X[8]=2*-D.x/B.width,X[9]=2*D.y/B.height;const j=a.invert([],X),q=a.mul([],j,B.projMatrix),W={u_frustum_tl:gn([-1,1,1],j),u_frustum_tr:gn([1,1,1],j),u_frustum_br:gn([1,-1,1],j),u_frustum_bl:gn([-1,-1,1],j),u_globe_pos:gn([B.globeMatrix[12],B.globeMatrix[13],B.globeMatrix[14]],q),u_globe_radius:B.worldSize/2/Math.PI-1,u_opacity:1-a.globeToMercatorTransition(B.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};T.prepareDrawProgram(E,R);const K=T.globeSharedBuffers;K&&R.draw(E,A.TRIANGLES,O,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,W,"skybox",K.atmosphereVertexBuffer,K.atmosphereIndexBuffer,K.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;){const T=this.style._layers[u[this.currentLayer]],E=t._getLayerSourceCache(T);if(T.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(T)){if(T.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const A=E?(T.type==="symbol"?y:_)[E.id]:void 0;this._renderTileClippingMasks(T,E,E?f[E.id]:void 0),this.renderLayer(this,E,T,A),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let T=null;a.values(this.style._layers).forEach(E=>{const A=t._getLayerSourceCache(E);A&&!E.isHidden(this.transform.zoom)&&(!T||T.getSource().maxzoom<A.getSource().maxzoom)&&(T=A)}),T&&this.options.showTileBoundaries&&_l.debug(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const E=T.transform.padding;Ge(T,T.transform.height-(E.top||0),3,fl),Ge(T,E.bottom||0,3,ml),dr(T,E.left||0,3,Fc),dr(T,T.transform.width-(E.right||0),3,ua);const A=T.transform.centerPoint;(function(B,O,R,D){ps(B,O-1,R-10,2,20,D),ps(B,O-10,R-1,20,2,D)})(T,A.x,T.transform.height-A.y,ha)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,o,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)||_l[u.type](t,o,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let u=this.gpuTimers[t.id];u||(u=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),u.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,u.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const o={};for(const u in t){const p=t[u],f=this.context.extTimerQuery,_=f.getQueryObjectEXT(p.query,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(p.query),o[u]=_}return o}translatePosMatrix(t,o,u,p,f){if(!u[0]&&!u[1])return t;const _=f?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(_){const T=Math.sin(_),E=Math.cos(_);u=[u[0]*E-u[1]*T,u[0]*T+u[1]*E]}const y=[f?u[0]:bi(o,u[0],this.transform.zoom),f?u[1]:bi(o,u[1],this.transform.zoom),0],b=new Float32Array(16);return a.translate(b,t,y),b}saveTileTexture(t){const o=this._tileTextures[t.size[0]];o?o.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const o=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!o||!u}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,o=this.style&&this.style.fog,u=[];return this.terrain&&!this.terrain.renderingToTexture&&u.push("TERRAIN"),o&&!t&&o.getOpacity(this.transform.pitch)!==0&&u.push("FOG"),t&&u.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&u.push("OVERDRAW_INSPECTOR"),u}useProgram(t,o,u){this.cache=this.cache||{};const p=u||[],f=this.currentGlobalDefines().concat(p),_=cs.cacheKey(t,f,o);return this.cache[_]||(this.cache[_]=new cs(this.context,t,ss[t],o,Wt[t],f)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,o,u){if(this.terrain&&this.terrain.renderingToTexture)return;const p=this.style.fog;if(p){const f=p.getOpacity(this.transform.pitch);f!==0&&o.setFogUniformValues(t,((_,y,b,T)=>{const E=y.properties.get("color"),A=_.frameCounter/1e3%1,B=[E.r/E.a,E.g/E.a,E.b/E.a,T];return{u_fog_matrix:b?_.transform.calculateFogTileMatrix(b):_.identityMat,u_fog_range:y.getFovAdjustedRange(_.transform._fov),u_fog_color:B,u_fog_horizon_blend:y.properties.get("horizon-blend"),u_fog_temporal_offset:A}})(this,p,u,f))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,o=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)o[p.key]=t[p.key]||new a.Tile(p,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class yn{constructor(t=0,o=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=u,this.right=p}interpolate(t,o,u){return o.top!=null&&t.top!=null&&(this.top=a.number(t.top,o.top,u)),o.bottom!=null&&t.bottom!=null&&(this.bottom=a.number(t.bottom,o.bottom,u)),o.left!=null&&t.left!=null&&(this.left=a.number(t.left,o.left,u)),o.right!=null&&t.right!=null&&(this.right=a.number(t.right,o.right,u)),this}getCenter(t,o){const u=a.clamp((this.left+t-this.right)/2,0,t),p=a.clamp((this.top+o-this.bottom)/2,0,o);return new a.pointGeometry(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new yn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Nc(l,t){const o=a.getColumn(l,3);a.fromQuat(l,t),a.setColumn(l,3,o)}function gl(l,t){const o=a.identity$1([]);return a.rotateZ$1(o,o,-t),a.rotateX$1(o,o,-l),o}function da(l,t){const o=[l[0],l[1],0],u=[t[0],t[1],0];if(a.length(o)>=1e-15){const _=a.normalize([],o);a.scale$2(u,_,a.dot(u,_)),t[0]=u[0],t[1]=u[1]}const p=a.cross([],t,l);if(a.len(p)<1e-15)return null;const f=Math.atan2(-p[1],p[0]);return gl(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),f)}class ms{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){const o=t instanceof a.MercatorCoordinate?t:new a.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=a.wrap(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o){if(this.orientation=null,!this.position)return;const u=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(t)):0,p=this.position,f=a.MercatorCoordinate.fromLngLat(t,u),_=[f.x-p.x,f.y-p.y,f.z-p.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=da(_,o)}setPitchBearing(t,o){this.orientation=gl(a.degToRad(t),a.degToRad(-o))}}class _s{constructor(t,o){this._transform=a.identity([]),this.orientation=o,this.position=t}get mercatorPosition(){const t=this.position;return new a.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=a.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&a.setColumn(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||a.identity$1([]),t&&Nc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=gl(t,o),Nc(this._transform,this._orientation)}forward(){const t=a.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=a.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=a.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){const u=new Float64Array(16);return a.invert(u,this.getWorldToCamera(t,o)),u}getWorldToCameraPosition(t,o,u){const p=this.position;a.scale$2(p,p,-t);const f=new Float64Array(16);return a.fromScaling(f,[u,u,u]),a.translate(f,f,p),f[10]*=o,f}getWorldToCamera(t,o){const u=new Float64Array(16),p=new Float64Array(4),f=this.position;return a.conjugate(p,this._orientation),a.scale$2(f,f,-t),a.fromQuat(u,p),a.translate(u,u,f),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=o,u[9]*=o,u[10]*=o,u[11]*=o,u}getCameraToClipPerspective(t,o,u,p){const f=new Float64Array(16);return a.perspective(f,t,o,u,p),f}getDistanceToElevation(t){const o=t===0?0:a.mercatorZfromAltitude(t,this.position[1]),u=this.forward();return(o-this.position[2])/u[2]}clone(){return new _s([...this.position],[...this.orientation])}}function yl(l,t){const o=gs(l),u=function(f,_,y,b,T){const E=new a.LngLat(y.lng-180*xn,y.lat),A=new a.LngLat(y.lng+180*xn,y.lat),B=f.project(E.lng,E.lat),O=f.project(A.lng,A.lat),R=-Math.atan2(O.y-B.y,O.x-B.x),D=a.MercatorCoordinate.fromLngLat(y);D.y=a.clamp(D.y,-.999975,.999975);const X=D.toLngLat(),j=f.project(X.lng,X.lat),q=a.MercatorCoordinate.fromLngLat(X);q.x+=xn;const W=q.toLngLat(),K=f.project(W.lng,W.lat),Z=bl(K.x-j.x,K.y-j.y,R),ee=a.MercatorCoordinate.fromLngLat(X);ee.y+=xn;const he=ee.toLngLat(),xe=f.project(he.lng,he.lat),Te=bl(xe.x-j.x,xe.y-j.y,R),be=Math.abs(Z.x)/Math.abs(Te.y),Re=a.identity([]);a.rotateZ(Re,Re,-R*(1-(T?0:b)));const de=a.identity([]);return a.scale(de,de,[1,1-(1-be)*b,1]),de[4]=-Te.x/Te.y*b,a.rotateZ(de,de,R),a.multiply$1(de,Re,de),de}(l.projection,0,l.center,o,t),p=xl(l);return a.scale(u,u,[p,p,1]),u}function xl(l){const t=l.projection,o=gs(l),u=vl(t,l.center),p=vl(t,a.LngLat.convert(t.center));return Math.pow(2,u*o+(1-o)*p)}function gs(l){const t=l.projection.range;if(!t)return 0;const o=Math.max(l.width,l.height),u=Math.log(o/1024)/Math.LN2;return a.smoothstep(t[0]+u,t[1]+u,l.zoom)}const xn=1/4e4;function vl(l,t){const o=a.clamp(t.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),u=new a.LngLat(t.lng-180*xn,o),p=new a.LngLat(t.lng+180*xn,o),f=l.project(u.lng,o),_=l.project(p.lng,o),y=a.MercatorCoordinate.fromLngLat(u),b=a.MercatorCoordinate.fromLngLat(p),T=_.x-f.x,E=_.y-f.y,A=b.x-y.x,B=b.y-y.y,O=Math.sqrt((A*A+B*B)/(T*T+E*E));return Math.log(O)/Math.LN2}function bl(l,t,o){const u=Math.cos(o),p=Math.sin(o);return{x:l*u-t*p,y:l*p+t*u}}class pa{constructor(t,o,u,p,f,_,y){this.tileSize=512,this._renderWorldCopies=f===void 0||f,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=u==null?0:u,this._maxPitch=p==null?60:p,this.setProjection(_),this.setMaxBounds(y),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new yn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new _s,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const t=new pa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const o=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||o)&&this._updateCameraOnTerrain(),(t||o)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(t){t==null&&(t={name:"mercator"}),this.projectionOptions=t;const o=this.projection?this.getProjection():void 0;this.projection=a.getProjection(t);const u=this.getProjection();return H(o,u)?null:(this._calcMatrices(),u)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const o=-t*Math.PI/180;var u;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(u=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u),function(p,f,_){var y=f[0],b=f[1],T=f[2],E=f[3],A=Math.sin(_),B=Math.cos(_);p[0]=y*B+T*A,p[1]=b*B+E*A,p[2]=y*-A+T*B,p[3]=b*-A+E*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=a.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,f=0;for(let _=0;_<o.length;_++){const y=new a.pointGeometry(o[_][0]*this.width,u+o[_][1]*(this.height-u)),b=t.pointCoordinate(y);if(!b)continue;const T=1/Math.hypot(b[0]-this._camera.position[0],b[1]-this._camera.position[1]);p+=b[3]*T,f+=T}return f===0?NaN:p/f}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*o,p=this._mercatorZfromZoom(t),f=this._mercatorZfromZoom(this._maxZoom),_=Math.max(p-u,f);this._setZoom(this._zoomFromMercatorZ(_))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];const p=a.length(a.sub([],this._camera.position,u));return a.clamp(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!a.exactEquals(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];a.exactEquals$1(u,this._camera.position)||(this._setCameraPosition(u),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,o=new ms;return o.position=new a.MercatorCoordinate(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!a.length$1(t))return!1;a.normalize$1(t,t);const o=a.transformQuat([],[0,0,-1],t),u=a.transformQuat([],[0,-1,0],t);if(u[2]<0)return!1;const p=da(o,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const o=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=a.clamp(t[2],p/u,p/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,u){this._unmodified=!1,this._edgeInsets.interpolate(t,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new a.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new a.pointGeometry(0,0)),p=this.pointCoordinate(new a.pointGeometry(this.width,0)),f=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),_=this.pointCoordinate(new a.pointGeometry(0,this.height)),y=Math.floor(Math.min(u.x,p.x,f.x,_.x)),b=Math.floor(Math.max(u.x,p.x,f.x,_.x)),T=1;for(let E=y-T;E<=b+T;E++)E!==0&&o.push(new a.UnwrappedTileID(E,t))}return o}coveringTiles(t){let o=this.coveringZoomLevel(t);const u=o,p=this.elevation&&!t.isTerrainDEM,f=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);const _=this.locationCoordinate(this.center),y=this.center.lat,b=1<<o,T=[b*_.x,b*_.y,0],E=this.projection.name==="globe",A=!E,B=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,A),O=E?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),R=b*a.mercatorZfromAltitude(1,this.center.lat),D=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),X=[b*O.x,b*O.y,D*(A?1:R)],j=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,W=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,K=t.isTerrainDEM?-W:this._elevation?this._elevation.getMinElevationBelowMSL():0,Z=this.projection.isReprojectedInTileSpace?xl(this):1,ee=Ee=>{const st=new a.MercatorCoordinate(Ee.x+25e-6,Ee.y,Ee.z),He=new a.MercatorCoordinate(Ee.x,Ee.y+25e-6,Ee.z),Ye=Ee.toLngLat(),ct=st.toLngLat(),Tt=He.toLngLat(),it=this.locationCoordinate(Ye),dt=this.locationCoordinate(ct),Rt=this.locationCoordinate(Tt),ci=Math.hypot(dt.x-it.x,dt.y-it.y),Fi=Math.hypot(Rt.x-it.x,Rt.y-it.y);return Math.sqrt(ci*Fi)*Z/25e-6},he=Ee=>{const Xe=W,st=K;return{aabb:a.tileAABB(this,b,0,0,0,Ee,st,Xe,this.projection),zoom:0,x:0,y:0,minZ:st,maxZ:Xe,wrap:Ee,fullyVisible:!1}},xe=[];let Te=[];const be=o,Re=t.reparseOverscaled?u:o,de=Ee=>Ee*Ee,Fe=de((D-this._centerAltitude)*R),De=Ee=>{if(!this._elevation||!Ee.tileID||!f)return;const Xe=this._elevation.getMinMaxForTile(Ee.tileID),st=Ee.aabb;Xe?(st.min[2]=Xe.min,st.max[2]=Xe.max,st.center[2]=(st.min[2]+st.max[2])/2):(Ee.shouldSplit=Ke(Ee),Ee.shouldSplit||(st.min[2]=st.max[2]=st.center[2]=this._centerAltitude))},Ke=Ee=>{if(Ee.zoom<q)return!0;if(Ee.zoom===be)return!1;if(Ee.shouldSplit!=null)return Ee.shouldSplit;const Xe=Ee.aabb.distanceX(X),st=Ee.aabb.distanceY(X);let He=Fe,Ye=1;if(E){He=de(Ee.aabb.distanceZ(X));const Tt=Math.pow(2,Ee.zoom),it=a.latFromMercatorY((Ee.y+1)/Tt),dt=a.latFromMercatorY(Ee.y/Tt),Rt=Math.min(Math.max(y,it),dt),ci=a.circumferenceAtLatitude(Rt)/a.circumferenceAtLatitude(y);Ye=Math.min(ci,1)}else if(p&&(He=de(Ee.aabb.distanceZ(X)*R)),this.projection.isReprojectedInTileSpace&&u<=5){const Tt=Math.pow(2,Ee.zoom),it=ee(new a.MercatorCoordinate((Ee.x+.5)/Tt,(Ee.y+.5)/Tt));Ye=it>.85?1:it}const ct=Xe*Xe+st*st+He;return ct<de((1<<be-Ee.zoom)*j*Ye*((Tt,it)=>{if(it*de(.707)<Tt)return 1;const dt=Math.sqrt(it/Tt);return dt/(1.4144271570014144+(Math.pow(1.1,dt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(He,Fe),ct))};if(this.renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)xe.push(he(-Ee)),xe.push(he(Ee));for(xe.push(he(0));xe.length>0;){const Ee=xe.pop(),Xe=Ee.x,st=Ee.y;let He=Ee.fullyVisible;if(!He){const Ye=Ee.aabb.intersects(B);if(Ye===0)continue;He=Ye===2}if(Ee.zoom!==be&&Ke(Ee))for(let Ye=0;Ye<4;Ye++){const ct=(Xe<<1)+Ye%2,Tt=(st<<1)+(Ye>>1),it={aabb:f?Ee.aabb.quadrant(Ye):a.tileAABB(this,b,Ee.zoom+1,ct,Tt,Ee.wrap,Ee.minZ,Ee.maxZ,this.projection),zoom:Ee.zoom+1,x:ct,y:Tt,wrap:Ee.wrap,fullyVisible:He,tileID:void 0,shouldSplit:void 0,minZ:Ee.minZ,maxZ:Ee.maxZ};p&&!E&&(it.tileID=new a.OverscaledTileID(Ee.zoom+1===be?Re:Ee.zoom+1,Ee.wrap,Ee.zoom+1,ct,Tt),De(it)),xe.push(it)}else{const Ye=Ee.zoom===be?Re:Ee.zoom;if(t.minzoom&&t.minzoom>Ye)continue;const ct=T[0]-(.5+Xe+(Ee.wrap<<Ee.zoom))*(1<<o-Ee.zoom),Tt=T[1]-.5-st,it=Ee.tileID?Ee.tileID:new a.OverscaledTileID(Ye,Ee.wrap,Ee.zoom,Xe,st);Te.push({tileID:it,distanceSq:ct*ct+Tt*Tt})}}if(this.fogCullDistSq){const Ee=this.fogCullDistSq,Xe=this.horizonLineFromTop();Te=Te.filter(st=>{const He=[0,0,0,1],Ye=[a.EXTENT,a.EXTENT,0,1],ct=this.calculateFogTileMatrix(st.tileID.toUnwrapped());a.transformMat4$1(He,He,ct),a.transformMat4$1(Ye,Ye,ct);const Tt=a.getAABBPointSquareDist(He,Ye);if(Tt===0)return!0;let it=!1;const dt=this._elevation;if(dt&&Tt>Ee&&Xe!==0){const Rt=this.calculateProjMatrix(st.tileID.toUnwrapped());let ci;t.isTerrainDEM||(ci=dt.getMinMaxForTile(st.tileID)),ci||(ci={min:K,max:W});const Fi=a.furthestTileCorner(this.rotation),Oi=[Fi[0]*a.EXTENT,Fi[1]*a.EXTENT,ci.max];a.transformMat4(Oi,Oi,Rt),it=(1-Oi[1])*this.height*.5<Xe}return Tt<Ee||it})}return Te.sort((Ee,Xe)=>Ee.distanceSq-Xe.distanceSq).map(Ee=>Ee.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const o=a.clamp(t.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),u=this.projection.project(t.lng,o);return new a.pointGeometry(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,o){let u,p;const f=this.centerPoint;if(this.projection.name==="globe"){const y=this.worldSize;u=(o.x-f.x)/y,p=(o.y-f.y)/y}else{const y=this.pointCoordinate(o),b=this.pointCoordinate(f);u=y.x-b.x,p=y.y-b.y}const _=this.locationCoordinate(t);this.setLocation(new a.MercatorCoordinate(_.x-u,_.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,o){const u=o?a.mercatorZfromAltitude(o,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new a.MercatorCoordinate(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){const u=o!=null?o:this._centerAltitude,p=[t.x,t.y,0,1],f=[t.x,t.y,1,1];a.transformMat4$1(p,p,this.pixelMatrixInverse),a.transformMat4$1(f,f,this.pixelMatrixInverse);const _=f[3];a.scale$1(p,p,1/p[3]),a.scale$1(f,f,1/_);const y=p[2],b=f[2];return{p0:p,p1:f,t:y===b?0:(u-y)/(b-y)}}screenPointToMercatorRay(t){const o=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return a.transformMat4$1(o,o,this.pixelMatrixInverse),a.transformMat4$1(u,u,this.pixelMatrixInverse),a.scale$1(o,o,1/o[3]),a.scale$1(u,u,1/u[3]),o[2]=a.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,u[2]=a.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,a.scale$1(o,o,1/this.worldSize),a.scale$1(u,u,1/this.worldSize),new a.Ray([o[0],o[1],o[2]],a.normalize([],a.sub([],u,o)))}rayIntersectionCoordinate(t){const{p0:o,p1:u,t:p}=t,f=a.mercatorZfromAltitude(o[2],this._center.lat),_=a.mercatorZfromAltitude(u[2],this._center.lat);return new a.MercatorCoordinate(a.number(o[0],u[0],p)/this.worldSize,a.number(o[1],u[1],p)/this.worldSize,a.number(f,_,p))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const o=this.elevation;let u=this.elevation.pointCoordinate(t);if(u)return new a.MercatorCoordinate(u[0],u[1],u[2]);let p=0,f=this.horizonLineFromTop();if(t.y>f)return this.pointCoordinate(t);const _=.02*f,y=t.clone();for(let b=0;b<10&&f-p>_;b++){y.y=a.number(p,f,.66);const T=o.pointCoordinate(y);T?(f=y.y,u=T):p=y.y}return u?new a.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const o=this.horizonLineFromTop();return t.y<o}}_coordinatePoint(t,o){const u=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return a.transformMat4$1(p,p,this.pixelMatrix),p[3]>0?new a.pointGeometry(p[0]/p[3],p[1]/p[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,o){const u=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),p=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),f=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),_=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let y=this.pointCoordinate(u,t),b=this.pointCoordinate(p,t);const T=this.pointCoordinate(f,o),E=this.pointCoordinate(_,o),A=(B,O)=>(O.y-B.y)/(O.x-B.x);return y.y>1&&b.y>=0?y=new a.MercatorCoordinate((1-E.y)/A(E,y)+E.x,1):y.y<0&&b.y<=1&&(y=new a.MercatorCoordinate(-E.y/A(E,y)+E.x,0)),b.y>1&&y.y>=0?b=new a.MercatorCoordinate((1-T.y)/A(T,b)+T.x,1):b.y<0&&y.y<=1&&(b=new a.MercatorCoordinate(-T.y/A(T,b)+T.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(y)).extend(this.coordinateLocation(b)).extend(this.coordinateLocation(E)).extend(this.coordinateLocation(T))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const o=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const f=p.dem.tree;u.min=Math.min(u.min,f.minimums[0]),u.max=Math.max(u.max,f.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBounds(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,u=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){const o=t.key,u=this._distanceTileDataCache;if(u[o])return u[o];const p=t.canonical,f=1/this.height,_=this.cameraWorldSize/this.zoomScale(p.z),y=(p.x+Math.pow(2,p.z)*t.wrap)*_,b=p.y*_,T=this.point,E=this.angle,A=Math.sin(-E),B=-Math.cos(-E);return u[o]={bearing:[A,B],center:[(T.x-y)*f,(T.y-b)*f],scale:_/a.EXTENT*f},u[o]}calculateFogTileMatrix(t){const o=t.key,u=this._fogTileMatrixCache;if(u[o])return u[o];const p=this.calculatePosMatrix(t,this.cameraWorldSize);return a.multiply$1(p,this.worldToFogMatrix,p),u[o]=new Float32Array(p),u[o]}calculateProjMatrix(t,o=!1){const u=t.key,p=o?this._alignedProjMatrixCache:this._projMatrixCache;if(p[u])return p[u];const f=this.calculatePosMatrix(t,this.worldSize);return a.multiply$1(f,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,f),p[u]=new Float32Array(f),p[u]}calculatePixelsToTileUnitsMatrix(t){const o=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[o])return u[o];const p=function(f,_){const{scale:y}=f.tileTransform,b=y*a.EXTENT/(f.tileSize*Math.pow(2,_.zoom-f.tileID.overscaledZ+f.tileID.canonical.z));return T=new Float32Array(4),B=(E=_.inverseAdjustmentMatrix)[1],O=E[2],R=E[3],X=(A=[b,b])[1],T[0]=E[0]*(D=A[0]),T[1]=B*D,T[2]=O*X,T[3]=R*X,T;var T,E,A,B,O,R,D,X}(t,this);return u[o]=p,u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const o=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(o),p=this._camera.forward(),f=a.mercatorZfromAltitude(1,this._center.lat);u[2]/=f,p[2]/=f,a.normalize(p,p);const _=t.raycast(u,p,t.exaggeration());if(_){const y=a.scaleAndAdd([],u,p,_),b=new a.MercatorCoordinate(y[0],y[1],a.mercatorZfromAltitude(y[2],a.latFromMercatorY(y[1]))),T=(b.z+a.length([b.x-u[0],b.y-u[1],b.z-u[2]*f]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(T),this._centerAltitude=b.toAltitude(),this._center=this.coordinateLocation(b),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const o=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(o),p=t.getAtPointOrZero(new a.MercatorCoordinate(...u)),f=this._minimumHeightOverTerrain()*Math.cos(a.degToRad(this._maxPitch)),_=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*p;if(_<f){const y=this.locationCoordinate(this._center,this._centerAltitude),b=[y.x-u[0],y.y-u[1],y.z-u[2]],T=a.length(b);b[2]-=(f-_)/this._projectionScaler;const E=a.length(b);if(E===0)return;a.scale$2(b,b,T/E*this._projectionScaler),this._camera.position=[y.x-b[0],y.y-b[1],y.z*this._projectionScaler-b[2]],this._camera.orientation=da(b,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const A=this.center;return A.lat=a.clamp(A.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(A.lng=a.clamp(A.lng,this.minLng,this.maxLng)),this.center=A,void(this._constraining=!1)}const t=this._unmodified,{x:o,y:u}=this.point;let p=0,f=o,_=u;const y=this.width/2,b=this.height/2,T=this.worldMinY*this.scale,E=this.worldMaxY*this.scale;if(u-b<T&&(_=T+b),u+b>E&&(_=E-b),E-T<this.height&&(p=Math.max(p,this.height/(E-T)),_=(E+T)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const A=this.worldMinX*this.scale,B=this.worldMaxX*this.scale,O=this.worldSize/2-(A+B)/2;f=(o+O+this.worldSize)%this.worldSize-O,f-y<A&&(f=A+y),f+y>B&&(f=B-y),B-A<this.width&&(p=Math.max(p,this.width/(B-A)),f=(B+A)/2)}f===o&&_===u||(this.center=this.unproject(new a.pointGeometry(f,_))),p&&(this.zoom+=this.scaleZoom(p)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this._fov/2,o=this.centerOffset,u=this.pixelsPerMeter;this._projectionScaler=u/(a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(t)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const p=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?u:1),f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);f[8]=2*-o.x/this.width,f[9]=2*o.y/this.height;let _=a.mul([],f,p);if(this.projection.isReprojectedInTileSpace){const K=this.locationCoordinate(this.center),Z=a.identity([]);a.translate(Z,Z,[K.x*this.worldSize,K.y*this.worldSize,0]),a.multiply$1(Z,Z,yl(this)),a.translate(Z,Z,[-K.x*this.worldSize,-K.y*this.worldSize,0]),a.multiply$1(_,_,Z),this.inverseAdjustmentMatrix=function(ee){const he=yl(ee,!0);return It([],[he[0],he[1],he[4],he[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],_,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=_,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const y=new Float32Array(16);a.identity(y),a.scale(y,y,[1,-1,1]),a.rotateX(y,y,this._pitch),a.rotateZ(y,y,this.angle);const b=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),T=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;b[8]=2*-o.x/this.width,b[9]=2*(o.y+T)/this.height,this.skyboxMatrix=a.multiply$1(y,b,y);const E=this.point,A=E.x,B=E.y,O=this.width%2/2,R=this.height%2/2,D=Math.cos(this.angle),X=Math.sin(this.angle),j=A-Math.round(A)+D*O+X*R,q=B-Math.round(B)+D*R+X*O,W=new Float64Array(_);if(a.translate(W,W,[j>.5?j-1:j,q>.5?q-1:q,0]),this.alignedProjMatrix=W,_=a.create(),a.scale(_,_,[this.width/2,-this.height/2,1]),a.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=a.create(),a.scale(_,_,[1,-1,1]),a.translate(_,_,[-1,-1,0]),a.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.pixelMatrix=a.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},_=a.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this.globeMatrix=this.projection.name==="globe"?a.calculateGlobeMatrix(this):_,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,o=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height,f=[t,t,o];a.scale$2(f,f,p),a.scale$2(u,u,-1),a.multiply$2(u,u,f);const _=a.create();a.translate(_,_,u),a.scale(_,_,f),this.mercatorFogMatrix=_,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,p)}_computeCameraPosition(t){const o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,f=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*f,p.y/this.worldSize-u[1]*f,t/this.worldSize*this._centerAltitude-u[2]*f]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=t[2];let p=1;u>0&&(p=Math.min((o-this._camera.position[2])/u,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,t,p),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,o=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),f=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,_=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),y=Math.max((t[2]-f)/Math.cos(u),_),b=this._zoomFromMercatorZ(y);a.scaleAndAdd(t,t,o,y),this._pitch=a.clamp(u,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(p,-Math.PI,Math.PI),this._setZoom(a.clamp(b,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(t,o){const u=Math.min(t.x,o.x),p=Math.max(t.x,o.x),f=Math.min(t.y,o.y),_=Math.max(t.y,o.y);if(f<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const y=[new a.pointGeometry(u,f),new a.pointGeometry(p,_),new a.pointGeometry(u,_),new a.pointGeometry(p,f)],b=this.renderWorldCopies?-3:0,T=this.renderWorldCopies?4:1;for(const E of y){const A=this.pointRayIntersection(E);if(A.t<0)return!0;const B=this.rayIntersectionCoordinate(A);if(B.x<b||B.y<0||B.x>T||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,o){const u=a.length(a.sub([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+o;return u-this._mercatorZfromZoom(p)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,t))}}function wl(l,t){let o=!1,u=null;const p=()=>{u=null,o&&(l(),u=setTimeout(p,t),o=!1)};return()=>(o=!0,u||p(),u)}class jc{constructor(t){this._hashName=t&&encodeURIComponent(t),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=wl(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,a.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const o=this._map;if(!o)return"";const u=o.getCenter(),p=Math.round(100*o.getZoom())/100,f=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,f),y=Math.round(u.lng*_)/_,b=Math.round(u.lat*_)/_,T=o.getBearing(),E=o.getPitch();let A="";if(A+=t?`/${y}/${b}/${p}`:`${p}/${b}/${y}`,(T||E)&&(A+="/"+Math.round(10*T)/10),E&&(A+=`/${Math.round(E)}`),this._hashName){const B=this._hashName;let O=!1;const R=a.window.location.hash.slice(1).split("&").map(D=>{const X=D.split("=")[0];return X===B?(O=!0,`${X}=${A}`):D}).filter(D=>D);return O||R.push(`${B}=${A}`),`#${R.join("&")}`}return`#${A}`}_getCurrentHash(){const t=a.window.location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(o=u)}),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,t)}}const Yr={linearity:.3,easing:a.bezier(0,0,.3,1)},Gc=a.extend({deceleration:2500,maxSpeed:1400},Yr),$c=a.extend({deceleration:20,maxSpeed:1400},Yr),Zc=a.extend({deceleration:1e3,maxSpeed:360},Yr),qc=a.extend({deceleration:1e3,maxSpeed:90},Yr);class Wc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=a.exported.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)o.zoom+=f.zoomDelta||0,o.bearing+=f.bearingDelta||0,o.pitch+=f.pitchDelta||0,f.panDelta&&o.pan._add(f.panDelta),f.around&&(o.around=f.around),f.pinchAround&&(o.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(o.pan.mag()){const f=ki(o.pan.mag(),u,a.extend({},Gc,t||{}));p.offset=o.pan.mult(f.amount/o.pan.mag()),p.center=this._map.transform.center,ys(p,f)}if(o.zoom){const f=ki(o.zoom,u,$c);p.zoom=this._map.transform.zoom+f.amount,ys(p,f)}if(o.bearing){const f=ki(o.bearing,u,Zc);p.bearing=this._map.transform.bearing+a.clamp(f.amount,-179,179),ys(p,f)}if(o.pitch){const f=ki(o.pitch,u,qc);p.pitch=this._map.transform.pitch+f.amount,ys(p,f)}if(p.zoom||p.bearing){const f=o.pinchAround===void 0?o.around:o.pinchAround;p.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function ys(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function ki(l,t,o){const{maxSpeed:u,linearity:p,deceleration:f}=o,_=a.clamp(l*p/(t/1e3),-u,u),y=Math.abs(_)/(f*p);return{easing:o.easing,duration:1e3*y,amount:_*(y/2)}}class tr extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,u,p={}){const f=ft(o.getCanvasContainer(),u),_=o.unproject(f);super(t,a.extend({point:f,lngLat:_,originalEvent:u},p)),this._defaultPrevented=!1,this.target=o}}class xs extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,u){const p=t==="touchend"?u.changedTouches:u.touches,f=qe(o.getCanvasContainer(),p),_=f.map(b=>o.unproject(b)),y=f.reduce((b,T,E,A)=>b.add(T.div(A.length)),new a.pointGeometry(0,0));super(t,{points:f,point:y,lngLats:_,lngLat:o.unproject(y),originalEvent:u}),this._defaultPrevented=!1}}class xh extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class vh{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new xh(t.type,this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new tr(t.type,this._map,t))}mouseup(t){this._map.fire(new tr(t.type,this._map,t))}preclick(t){const o=a.extend({},t);o.type="preclick",this._map.fire(new tr(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new tr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new tr(t.type,this._map,t))}mouseover(t){this._map.fire(new tr(t.type,this._map,t))}mouseout(t){this._map.fire(new tr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new xs(t.type,this._map,t))}touchmove(t){this._map.fire(new xs(t.type,this._map,t))}touchend(t){this._map.fire(new xs(t.type,this._map,t))}touchcancel(t){this._map.fire(new xs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new tr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new tr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xc{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(pt(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=u,this._box||(this._box=me("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const f=Math.min(p.x,u.x),_=Math.max(p.x,u.x),y=Math.min(p.y,u.y),b=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${f}px,${y}px)`,this._box.style.width=_-f+"px",this._box.style.height=b-y+"px")})}mouseupWindow(t,o){if(!this._active||t.button!==0)return;const u=this._startPos,p=o;if(this.reset(),rt(),u.x!==p.x||u.y!==p.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ut(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new a.Event(t,{originalEvent:o}))}}function vn(l,t){const o={};for(let u=0;u<l.length;u++)o[l[u].identifier]=t[u];return o}class Or{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const f=new a.pointGeometry(0,0);for(const _ of p)f._add(_);return f.div(p.length)}(o),this.touches=vn(u,o)))}touchmove(t,o,u){if(this.aborted||!this.centroid)return;const p=vn(u,o);for(const f in this.touches){const _=this.touches[f],y=p[f];(!y||y.dist(_)>30)&&(this.aborted=!0)}}touchend(t,o,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Ao{constructor(t){this.singleTap=new Or(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,u){this.singleTap.touchstart(t,o,u)}touchmove(t,o,u){this.singleTap.touchmove(t,o,u)}touchend(t,o,u){const p=this.singleTap.touchend(t,o,u);if(p){const f=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(p)<30;if(f&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Ze{constructor(){this._zoomIn=new Ao({numTouches:1,numTaps:2}),this._zoomOut=new Ao({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,u){this._zoomIn.touchstart(t,o,u),this._zoomOut.touchstart(t,o,u)}touchmove(t,o,u){this._zoomIn.touchmove(t,o,u),this._zoomOut.touchmove(t,o,u)}touchend(t,o,u){const p=this._zoomIn.touchend(t,o,u),f=this._zoomOut.touchend(t,o,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()+1,around:_.unproject(p)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()-1,around:_.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Hc={0:1,2:2};class fa{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;const u=kt(t);this._correctButton(t,u)&&(this._lastPoint=o,this._eventButton=u)}mousemoveWindow(t,o){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,f){const _=Hc[f];return p.buttons===void 0||(p.buttons&_)!==_}(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(u,o)}}mouseupWindow(t){this._lastPoint&&kt(t)===this._eventButton&&(this._moved&&rt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vs extends fa{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class Co extends fa{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){const u=.8*(o.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){t.preventDefault()}}class Tl extends fa{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){const u=-.5*(o.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){t.preventDefault()}}class Yc{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(t,o,u){return this._calculateTransform(t,o,u)}touchmove(t,o,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,o,u)}}touchend(t,o,u){this._calculateTransform(t,o,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,u){u.length>0&&(this._active=!0);const p=vn(u,o),f=new a.pointGeometry(0,0),_=new a.pointGeometry(0,0);let y=0;for(const T in p){const E=p[T],A=this._touches[T];A&&(f._add(E),_._add(E.sub(A)),y++,p[T]=E)}if(this._touches=p,y<this._minTouches||!_.mag())return;const b=_.div(y);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(y),panDelta:b}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class ma{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,u){return{}}touchstart(t,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[f,_]=p,y=bs(u,o,f),b=bs(u,o,_);if(!y||!b)return;const T=this._aroundCenter?null:y.add(b).div(2);return this._move([y,b],T,t)}touchend(t,o,u){if(!this._firstTwoTouches)return;const[p,f]=this._firstTwoTouches,_=bs(u,o,p),y=bs(u,o,f);_&&y||(this._active&&rt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bs(l,t,o){for(let u=0;u<l.length;u++)if(l[u].identifier===o)return t[u]}function El(l,t){return Math.log(l/t)/Math.LN2}class Kc extends ma{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(El(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:El(this._distance,u),pinchAround:o}}}function Sl(l,t){return 180*l.angleWith(t)/Math.PI}class _a extends ma{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const u=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Sl(this._vector,u),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,u=Sl(t,this._startVector);return Math.abs(u)<o}}function ws(l){return Math.abs(l.y)>Math.abs(l.x)}class ga extends ma{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ws(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,u){const p=this._lastPoints;if(!p)return;const f=t[0].sub(p[0]),_=t[1].sub(p[1]);return this._map._cooperativeGestures&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(f,_,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+_.y)/2*-.5})}gestureBeginsVertically(t,o,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,f=o.mag()>=2;if(!p&&!f)return;if(!p||!f)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const _=t.y>0==o.y>0;return ws(t)&&ws(o)&&_}}const Jc={panStep:100,bearingStep:15,pitchStep:10};class Qc{constructor(){const t=Jc;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,u=0,p=0,f=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:y=>{const b=y.getZoom();y.easeTo({duration:300,easeId:"keyboardHandler",easing:eu,zoom:o?Math.round(b)+o*(t.shiftKey?2:1):b,bearing:y.getBearing()+u*this._bearingStep,pitch:y.getPitch()+p*this._pitchStep,offset:[-f*this._panStep,-_*this._panStep],center:y.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function eu(l){return l*(2-l)}const Il=4.000244140625;class tu{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=a.exported.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Il==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=ft(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>Il?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&T!==0&&(T=1/T);const E=o(),A=Math.pow(2,E),B=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):A;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(B*T))),this._type==="wheel"&&(this._startZoom=o(),this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:o(),p=this._startZoom,f=this._easing;let _,y=!1;if(this._type==="wheel"&&p&&f){const b=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),T=f(b);_=a.number(p,u,T),b<1?this._frameId||(this._frameId=!0):y=!0}else _=u,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!y,zoomDelta:_-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=a.ease;if(this._prevEase){const u=this._prevEase,p=(a.exported.now()-u.start)/u.duration,f=u.easing(p+.01)-u.easing(p),_=.27/Math.sqrt(f*f+1e-4)*.01,y=Math.sqrt(.0729-_*_);o=a.bezier(_,y,.25,1)}return this._prevEase={start:a.exported.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!a.window.document.fullscreenElement||!!a.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class iu{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ru{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ml{constructor(){this._tap=new Ao({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=o[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,o,u))}touchmove(t,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=o[0],f=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,o,u)}touchend(t,o,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,o,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nu{constructor(t,o,u){this._el=t,this._mousePan=o,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ou{constructor(t,o,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class su{constructor(t,o,u,p){this._el=t,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ts=l=>l.zoom||l.drag||l.pitch||l.rotate;class Al extends a.Event{}class au{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){const u=a.sub([],o,t);this.radius=a.length(u[2]<0?a.div([],u,this.constants):[u[0],u[1],0])}projectRay(t){a.div(t,t,this.constants),a.normalize(t,t),a.mul$1(t,t,this.constants);const o=a.scale$2([],t,this.radius);if(o[2]>0){const u=a.scale$2([],[0,0,1],a.dot(o,[0,0,1])),p=a.scale$2([],a.normalize([],[o[0],o[1],0]),this.radius),f=a.add([],o,a.scale$2([],a.sub([],a.add([],p,u),o),2));o[0]=f[0],o[1]=f[1]}return o}}function zo(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class lu{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wc(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new au,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),a.bindAll(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[p,f,_]of this._listeners)p.addEventListener(f,p===a.window.document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[t,o,u]of this._listeners)t.removeEventListener(o,t===a.window.document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new vh(o,t));const p=o.boxZoom=new Xc(o,t);this._add("boxZoom",p);const f=new Ze,_=new ru;o.doubleClickZoom=new iu(_,f),this._add("tapZoom",f),this._add("clickZoom",_);const y=new Ml;this._add("tapDragZoom",y);const b=o.touchPitch=new ga(o);this._add("touchPitch",b);const T=new Co(t),E=new Tl(t);o.dragRotate=new ou(t,T,E),this._add("mouseRotate",T,["mousePitch"]),this._add("mousePitch",E,["mouseRotate"]);const A=new vs(t),B=new Yc(o,t);o.dragPan=new nu(u,A,B),this._add("mousePan",A),this._add("touchPan",B,["touchZoom","touchRotate"]);const O=new _a,R=new Kc;o.touchZoomRotate=new su(u,R,O,y),this._add("touchRotate",O,["touchPan","touchZoom"]),this._add("touchZoom",R,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Kr(o));const D=o.scrollZoom=new tu(o,this);this._add("scrollZoom",D,["mousePan"]);const X=o.keyboard=new Qc;this._add("keyboard",X);for(const j of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[j]&&o[j].enable(t[j])}_add(t,o,u){this._handlers.push({handlerName:t,handler:o,allowed:u}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ts(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,o,u){for(const p in t)if(p!==u&&(!o||o.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const o=[];for(const u of t)this._el.contains(u.target)&&o.push(u);return o}handleEvent(t,o){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,f={needsRenderFrame:!1},_={},y={},b=t.touches?this._getMapTouches(t.touches):void 0,T=b?qe(this._el,b):u?void 0:ft(this._el,t);for(const{handlerName:B,handler:O,allowed:R}of this._handlers){if(!O.isEnabled())continue;let D;this._blockedByActive(y,R,B)?O.reset():O[o||t.type]&&(D=O[o||t.type](t,T,b),this.mergeHandlerResult(f,_,D,B,p),D&&D.needsRenderFrame&&this._triggerRenderFrame()),(D||O.isActive())&&(y[B]=O)}const E={};for(const B in this._previousActiveHandlers)y[B]||(E[B]=p);this._previousActiveHandlers=y,(Object.keys(E).length||zo(f))&&(this._changes.push([f,_,E]),this._triggerRenderFrame()),(Object.keys(y).length||zo(f))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:A}=f;A&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],A(this._map))}mergeHandlerResult(t,o,u,p,f){if(!u)return;a.extend(t,u);const _={handlerName:p,originalEvent:u.originalEvent||f};u.zoomDelta!==void 0&&(o.zoom=_),u.panDelta!==void 0&&(o.drag=_),u.pitchDelta!==void 0&&(o.pitch=_),u.bearingDelta!==void 0&&(o.rotate=_)}_applyChanges(){const t={},o={},u={};for(const[p,f,_]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new a.pointGeometry(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),a.extend(o,f),a.extend(u,_);this._updateMapTransform(t,o,u),this._changes=[]}_updateMapTransform(t,o,u){const p=this._map,f=p.transform,_=q=>[q.x,q.y,q.z];if((q=>{const W=this._eventsInProgress.drag;return W&&!this._handlersById[W.handlerName].isActive()})()&&!zo(t)){const q=f.zoom;f.cameraElevationReference="sea",f.recenterOnTerrain(),f.cameraElevationReference="ground",q!==f.zoom&&this._map._update(!0)}if(!zo(t))return void this._fireEvents(o,u,!0);let{panDelta:y,zoomDelta:b,bearingDelta:T,pitchDelta:E,around:A,aroundCoord:B,pinchAround:O}=t;O!==void 0&&(A=O),(q=>o.drag&&!this._eventsInProgress.drag)()&&A&&(this._dragOrigin=_(f.pointCoordinate3D(A)),this._trackingEllipsoid.setup(f._camera.position,this._dragOrigin)),f.cameraElevationReference="sea",p._stop(!0),A=A||p.transform.centerPoint,T&&(f.bearing+=T),E&&(f.pitch+=E),f._updateCameraState();const R=[0,0,0];if(y){const q=f.pointCoordinate(A);if(f.projection.name==="globe"){const W=a.latFromMercatorY(q.y),K=f.center.lat,Z=Math.min(a.mercatorZfromAltitude(1,W)/a.mercatorZfromAltitude(1,K),2);y=y.rotate(-f.angle),R[0]=-y.x/f.worldSize*Z,R[1]=-y.y/f.worldSize*Z}else{const W=f.pointCoordinate(A.sub(y));q&&W&&(R[0]=W.x-q.x,R[1]=W.y-q.y)}}const D=f.zoom,X=[0,0,0];if(b){const q=_(B||f.pointCoordinate3D(A)),W={dir:a.normalize([],a.sub([],q,f._camera.position))};if(W.dir[2]<0){const K=f.zoomDeltaToMovement(q,b);a.scale$2(X,W.dir,K)}}const j=a.add(R,R,X);f._translateCameraConstrained(j),b&&Math.abs(f.zoom-D)>1e-4&&f.recenterOnTerrain(),f.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,u,!0)}_fireEvents(t,o,u){const p=Ts(this._eventsInProgress),f=Ts(t),_={};for(const E in t){const{originalEvent:A}=t[E];this._eventsInProgress[E]||(_[`${E}start`]=A),this._eventsInProgress[E]=t[E]}!p&&f&&this._fireEvent("movestart",f.originalEvent);for(const E in _)this._fireEvent(E,_[E]);f&&this._fireEvent("move",f.originalEvent);for(const E in t){const{originalEvent:A}=t[E];this._fireEvent(E,A)}const y={};let b;for(const E in this._eventsInProgress){const{handlerName:A,originalEvent:B}=this._eventsInProgress[E];this._handlersById[A].isActive()||(delete this._eventsInProgress[E],b=o[A]||B,y[`${E}end`]=b)}for(const E in y)this._fireEvent(E,y[E]);const T=Ts(this._eventsInProgress);if(u&&(p||f)&&!T){this._updatingCamera=!0;const E=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;E?(A(E.bearing||this._map.getBearing())&&(E.bearing=0),this._map.easeTo(E,{originalEvent:b})):(this._map.fire(new a.Event("moveend",{originalEvent:b})),A(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new a.Event(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Al("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ya="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Cl extends a.Evented{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,u){return t=a.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,a.extend({offset:t},o),u)}panTo(t,o,u){return this.easeTo(a.extend({center:t},o),u)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,u){return this.easeTo(a.extend({zoom:t},o),u)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,u){return this.easeTo(a.extend({bearing:t},o),u)}resetNorth(t,o){return this.rotateTo(0,a.extend({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=a.LngLatBounds.convert(t);const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,o)}_extendCameraOptions(t){const o={top:0,bottom:0,right:0,left:0};if(typeof(t=a.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const u=t.padding;t.padding={top:u,bottom:u,right:u,left:u}}return t.padding=a.extend(o,t.padding),t}_cameraForBoxAndBearing(t,o,u,p){const f=this._extendCameraOptions(p),_=this.transform,y=_.padding,b=_.project(a.LngLat.convert(t)),T=_.project(a.LngLat.convert(o)),E=new a.pointGeometry(b.x,T.y),A=new a.pointGeometry(T.x,b.y),B=-a.degToRad(u),O=b.rotate(B),R=T.rotate(B),D=E.rotate(B),X=A.rotate(B),j=new a.pointGeometry(Math.max(O.x,R.x,D.x,X.x),Math.max(O.y,R.y,D.y,X.y)),q=new a.pointGeometry(Math.min(O.x,R.x,D.x,X.x),Math.min(O.y,R.y,D.y,X.y)),W=j.sub(q),K=(_.width-((y.left||0)+(y.right||0)+f.padding.left+f.padding.right))/W.x,Z=(_.height-((y.top||0)+(y.bottom||0)+f.padding.top+f.padding.bottom))/W.y;if(Z<0||K<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ee=Math.min(_.scaleZoom(_.scale*Math.min(K,Z)),f.maxZoom),he=typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new a.pointGeometry(f.offset.x,f.offset.y):a.pointGeometry.convert(f.offset),xe=new a.pointGeometry((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(u*Math.PI/180),Te=he.add(xe).mult(_.scale/_.zoomScale(ee));return{center:_.unproject(b.add(T).div(2).sub(Te)),zoom:ee,bearing:u}}_cameraForBox(t,o,u,p,f){const _=this._extendCameraOptions(f);u=u||0,p=p||0,t=a.LngLat.convert(t),o=a.LngLat.convert(o);const y=this.transform.clone();y.padding=_.padding;const b=this.getFreeCameraOptions(),T=new a.LngLat(.5*(t.lng+o.lng),.5*(t.lat+o.lat)),E=.5*(u+p);if(y._camera.position[2]<a.mercatorZfromAltitude(E,T.lat))return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");b.lookAtPoint(T),y.setFreeCameraOptions(b);const A=a.MercatorCoordinate.fromLngLat(t),B=a.MercatorCoordinate.fromLngLat(o),O=y.pointRayIntersection(y.centerPoint,E),R=[(D=y.rayIntersectionCoordinate(O)).x,D.y,D.z];var D;const X=y.screenPointToMercatorRay(y.centerPoint),j=y.projection.name!=="globe";let q,W=0;do{const K=Math.floor(y.zoom),Z=1<<K,ee=Math.min(Z*A.x,Z*B.x),he=Math.min(Z*A.y,Z*B.y),xe=Math.max(Z*A.x,Z*B.x),Te=Math.max(Z*A.y,Z*B.y),be=new a.Aabb([ee,he,u],[xe,Te,p]),Re=a.Frustum.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,K,j);if(be.intersects(Re)!==2){q&&(y._camera.position=a.scaleAndAdd([],y._camera.position,X.dir,-q),y._updateStateFromCamera());break}const de=a.sub([],y._camera.position,R);q=.5*a.length(de),y._camera.position=a.scaleAndAdd([],y._camera.position,X.dir,q);try{y._updateStateFromCamera()}catch{return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++W<10);return{center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}}fitBounds(t,o,u){return this._fitInternal(this.cameraForBounds(t,o),o,u)}_raycastElevationBox(t,o){const u=this.transform.elevation;if(!u)return;const p=new a.pointGeometry(t.x,o.y),f=new a.pointGeometry(o.x,t.y),_=u.pointCoordinate(t);if(!_)return;const y=u.pointCoordinate(o);if(!y)return;const b=u.pointCoordinate(p);if(!b)return;const T=u.pointCoordinate(f);if(!T)return;const E=new a.MercatorCoordinate(_[0],_[1]).toLngLat(),A=new a.MercatorCoordinate(y[0],y[1]).toLngLat(),B=new a.MercatorCoordinate(b[0],b[1]).toLngLat(),O=new a.MercatorCoordinate(T[0],T[1]).toLngLat(),R=Math.min(E.lng,Math.min(A.lng,Math.min(B.lng,O.lng))),D=Math.min(E.lat,Math.min(A.lat,Math.min(B.lat,O.lat))),X=Math.max(E.lng,Math.max(A.lng,Math.max(B.lng,O.lng))),j=Math.max(E.lat,Math.max(A.lat,Math.max(B.lat,O.lat))),q=Math.min(_[3],Math.min(y[3],Math.min(b[3],T[3]))),W=Math.max(_[3],Math.max(y[3],Math.max(b[3],T[3])));return{minLngLat:new a.LngLat(R,D),maxLngLat:new a.LngLat(X,j),minAltitude:q,maxAltitude:W}}fitScreenCoordinates(t,o,u,p,f){let _,y,b,T;const E=a.pointGeometry.convert(t),A=a.pointGeometry.convert(o),B=this._raycastElevationBox(E,A);if(B)_=B.minLngLat,y=B.maxLngLat,b=B.minAltitude,T=B.maxAltitude;else{if(this.transform.anyCornerOffEdge(E,A))return this;_=this.transform.pointLocation(E),y=this.transform.pointLocation(A)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(t)),this.transform.pointLocation(a.pointGeometry.convert(o)),u,p):this._cameraForBox(_,y,b,T,p),p,f)}_fitInternal(t,o,u){return t?(delete(o=a.extend(t,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(t,o){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,f=!1,_=!1;return"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=a.LngLat.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(f=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(_=!0,u.pitch=+t.pitch),t.padding==null||u.isPaddingEqual(t.padding)||(u.padding=t.padding),t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new a.Event("movestart",o)).fire(new a.Event("move",o)),p&&this.fire(new a.Event("zoomstart",o)).fire(new a.Event("zoom",o)).fire(new a.Event("zoomend",o)),f&&this.fire(new a.Event("rotatestart",o)).fire(new a.Event("rotate",o)).fire(new a.Event("rotateend",o)),_&&this.fire(new a.Event("pitchstart",o)).fire(new a.Event("pitch",o)).fire(new a.Event("pitchend",o)),this.fire(new a.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(ya),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){const u=this.transform;if(!u.projection.supportsFreeCamera)return a.warnOnce(ya),this;this.stop();const p=u.zoom,f=u.pitch,_=u.bearing;u.setFreeCameraOptions(t);const y=p!==u.zoom,b=f!==u.pitch,T=_!==u.bearing;return this.fire(new a.Event("movestart",o)).fire(new a.Event("move",o)),y&&this.fire(new a.Event("zoomstart",o)).fire(new a.Event("zoom",o)).fire(new a.Event("zoomend",o)),T&&this.fire(new a.Event("rotatestart",o)).fire(new a.Event("rotate",o)).fire(new a.Event("rotateend",o)),b&&this.fire(new a.Event("pitchstart",o)).fire(new a.Event("pitch",o)).fire(new a.Event("pitchend",o)),this.fire(new a.Event("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=a.extend({offset:[0,0],duration:500,easing:a.ease},t)).animate===!1||!t.essential&&a.exported.prefersReducedMotion)&&(t.duration=0);const u=this.transform,p=this.getZoom(),f=this.getBearing(),_=this.getPitch(),y=this.getPadding(),b="zoom"in t?+t.zoom:p,T="bearing"in t?this._normalizeBearing(t.bearing,f):f,E="pitch"in t?+t.pitch:_,A="padding"in t?t.padding:u.padding,B=a.pointGeometry.convert(t.offset);let O,R,D;if(u.projection.name==="globe"){const Te=a.MercatorCoordinate.fromLngLat(u.center),be=B.rotate(-u.angle);Te.x+=be.x/u.worldSize,Te.y+=be.y/u.worldSize;const Re=Te.toLngLat(),de=a.LngLat.convert(t.center||Re);this._normalizeCenter(de),O=u.centerPoint.add(be),R=new a.pointGeometry(Te.x,Te.y).mult(u.worldSize),D=new a.pointGeometry(a.mercatorXfromLng(de.lng),a.mercatorYfromLat(de.lat)).mult(u.worldSize).sub(R)}else{O=u.centerPoint.add(B);const Te=u.pointLocation(O),be=a.LngLat.convert(t.center||Te);this._normalizeCenter(be),R=u.project(Te),D=u.project(be).sub(R)}const X=u.zoomScale(b-p);let j,q;t.around&&(j=a.LngLat.convert(t.around),q=u.locationPoint(j));const W=this._zooming||b!==p,K=this._rotating||f!==T,Z=this._pitching||E!==_,ee=!u.isPaddingEqual(A),he=Te=>be=>{if(W&&(Te.zoom=a.number(p,b,be)),K&&(Te.bearing=a.number(f,T,be)),Z&&(Te.pitch=a.number(_,E,be)),ee&&(Te.interpolatePadding(y,A,be),O=Te.centerPoint.add(B)),j)Te.setLocationAtPoint(j,q);else{const Re=Te.zoomScale(Te.zoom-p),de=b>p?Math.min(2,X):Math.max(.5,X),Fe=Math.pow(de,1-be),De=Te.unproject(R.add(D.mult(be*Fe)).mult(Re));Te.setLocationAtPoint(Te.renderWorldCopies?De.wrap():De,O)}return t.preloadOnly||this._fireMoveEvents(o),Te};if(t.preloadOnly){const Te=this._emulate(he,t.duration,u);return this._preloadTiles(Te),this}const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=W,this._rotating=K,this._pitching=Z,this._padding=ee,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,xe),this._ease(he(u),Te=>{u.recenterOnTerrain(),this._afterEase(o,Te)},t),this}_prepareEase(t,o,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||u.moving||this.fire(new a.Event("movestart",t)),this._zooming&&!u.zooming&&this.fire(new a.Event("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new a.Event("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new a.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.Event("move",t)),this._zooming&&this.fire(new a.Event("zoom",t)),this._rotating&&this.fire(new a.Event("rotate",t)),this._pitching&&this.fire(new a.Event("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new a.Event("zoomend",t)),p&&this.fire(new a.Event("rotateend",t)),f&&this.fire(new a.Event("pitchend",t)),this.fire(new a.Event("moveend",t))}flyTo(t,o){if(!t.essential&&a.exported.prefersReducedMotion){const He=a.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(He,o)}this.stop(),t=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},t);const u=this.transform,p=this.getZoom(),f=this.getBearing(),_=this.getPitch(),y=this.getPadding(),b="zoom"in t?a.clamp(+t.zoom,u.minZoom,u.maxZoom):p,T="bearing"in t?this._normalizeBearing(t.bearing,f):f,E="pitch"in t?+t.pitch:_,A="padding"in t?t.padding:u.padding,B=u.zoomScale(b-p),O=a.pointGeometry.convert(t.offset);let R=u.centerPoint.add(O);const D=u.pointLocation(R),X=a.LngLat.convert(t.center||D);this._normalizeCenter(X);const j=u.project(D),q=u.project(X).sub(j);let W=t.curve;const K=Math.max(u.width,u.height),Z=K/B,ee=q.mag();if("minZoom"in t){const He=a.clamp(Math.min(t.minZoom,p,b),u.minZoom,u.maxZoom),Ye=K/u.zoomScale(He-p);W=Math.sqrt(Ye/ee*2)}const he=W*W;function xe(He){const Ye=(Z*Z-K*K+(He?-1:1)*he*he*ee*ee)/(2*(He?Z:K)*he*ee);return Math.log(Math.sqrt(Ye*Ye+1)-Ye)}function Te(He){return(Math.exp(He)-Math.exp(-He))/2}function be(He){return(Math.exp(He)+Math.exp(-He))/2}const Re=xe(0);let de=function(He){return be(Re)/be(Re+W*He)},Fe=function(He){return K*((be(Re)*(Te(Ye=Re+W*He)/be(Ye))-Te(Re))/he)/ee;var Ye},De=(xe(1)-Re)/W;if(Math.abs(ee)<1e-6||!isFinite(De)){if(Math.abs(K-Z)<1e-6)return this.easeTo(t,o);const He=Z<K?-1:1;De=Math.abs(Math.log(Z/K))/W,Fe=function(){return 0},de=function(Ye){return Math.exp(He*W*Ye)}}t.duration="duration"in t?+t.duration:1e3*De/("screenSpeed"in t?+t.screenSpeed/W:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Ke=f!==T,Ee=E!==_,Xe=!u.isPaddingEqual(A),st=He=>Ye=>{const ct=Ye*De,Tt=1/de(ct);He.zoom=Ye===1?b:p+He.scaleZoom(Tt),Ke&&(He.bearing=a.number(f,T,Ye)),Ee&&(He.pitch=a.number(_,E,Ye)),Xe&&(He.interpolatePadding(y,A,Ye),R=He.centerPoint.add(O));const it=Ye===1?X:He.unproject(j.add(q.mult(Fe(ct))).mult(Tt));return He.setLocationAtPoint(He.renderWorldCopies?it.wrap():it,R),He._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),He};if(t.preloadOnly){const He=this._emulate(st,t.duration,u);return this._preloadTiles(He),this}return this._zooming=!0,this._rotating=Ke,this._pitching=Ee,this._padding=Xe,this._prepareEase(o,!1),this._ease(st(u),()=>this._afterEase(o),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,o)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,o,u){u.animate===!1||u.duration===0?(t(1),o()):(this._easeStart=a.exported.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=a.wrap(t,-180,180);const u=Math.abs(t-o);return Math.abs(t-360-o)<u&&(t-=360),Math.abs(t+360-o)<u&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const u=t.lng-o.center.lng;t.lng+=u>180?-360:u<-180?360:0}_emulate(t,o,u){const p=Math.ceil(15*o/1e3),f=[],_=t(u.clone());for(let y=0;y<=p;y++){const b=_(y/p);f.push(b.clone())}return f}}class xa{constructor(t={}){this.options=t,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const o=this.options&&this.options.compact;return this._map=t,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=me("button","mapboxgl-ctrl-attrib-button",this._container),me("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=me("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,o){const u=this._map._getUIString(`AttributionControl.${o}`);t.setAttribute("aria-label",u),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",u)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(t){const u=o.reduce((p,f,_)=>(f.value&&(p+=`${f.key}=${f.value}${_<o.length-1?"&":""}`),p),"?");t.href=`${a.config.FEEDBACK_URL}/${u}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const o=this._map.style._sourceCaches;for(const p in o){const f=o[p];if(f.used){const _=f.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t.sort((p,f)=>p.length-f.length),t=t.filter((p,f)=>{for(let _=f+1;_<t.length;_++)if(t[_].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class cu{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=me("div","mapboxgl-ctrl");const o=me("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const o in t){const u=t[o].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class uu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function va(l,t,o){if(l=new a.LngLat(l.lng,l.lat),t){const u=new a.LngLat(l.lng-360,l.lat),p=new a.LngLat(l.lng+360,l.lat),f=360*Math.ceil(Math.abs(l.lng-o.center.lng)/360),_=o.locationPoint(l).distSqr(t),y=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint(u).distSqr(t)<_&&(y||Math.abs(u.lng-o.center.lng)<f)?l=u:o.locationPoint(p).distSqr(t)<_&&(y||Math.abs(p.lng-o.center.lng)<f)&&(l=p)}for(;Math.abs(l.lng-o.center.lng)>180;){const u=o.locationPoint(l);if(u.x>=0&&u.y>=0&&u.x<=o.width&&u.y<=o.height)break;l.lng>o.center.lng?l.lng-=360:l.lng+=360}return l}const ba={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class wa extends a.Evented{constructor(t,o){if(super(),(t instanceof a.window.HTMLElement||o)&&(t=a.extend({element:t},o)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=a.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=me("div");const p=41,f=27,_=_e("svg",{display:"block",height:p*this._scale+"px",width:f*this._scale+"px",viewBox:`0 0 ${f} ${p}`},this._element),y=_e("radialGradient",{id:"shadowGradient"},_e("defs",{},_));_e("stop",{offset:"10%","stop-opacity":.4},y),_e("stop",{offset:"100%","stop-opacity":.05},y),_e("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},_),_e("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},_),_e("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},_),_e("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},_),this._offset=a.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()});const u=this._element.classList;for(const p in ba)u.remove(`mapboxgl-marker-anchor-${p}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const o=t.code,u=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const o=t.originalEvent.target,u=this._element;this._popup&&(o===u||u.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const t=this._map;if(!t)return;const o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(o);let p=!1;if(t.transform._terrainEnabled()&&t.getTerrain()){const _=t.getFreeCameraOptions();if(_.position){const y=_.position.toLngLat();p=y.distanceTo(u)<.9*y.distanceTo(this._lngLat)}}const f=(1-t._queryFogOpacity(u))*(p?.2:1);this._element.style.opacity=`${f}`,this._popup&&this._popup._setOpacity(`${f}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t)return;const o=this._offset.mult(this._scale),u=this._calculatePitch(),p=this._calculateRotation();this._element.style.transform=`
            translate(${t.x}px, ${t.y}px) ${ba[this._anchor]}
            rotateX(${u}deg) rotateZ(${p}deg)
            translate(${o.x}px, ${o.y}px)
        `}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._map&&this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._map&&this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(t){a.window.cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=va(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),t===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!o.getTerrain()&&!o.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=a.pointGeometry.convert(t),this._update(),this}_onMove(t){const o=this._map;if(o){if(!this._isDragging){const u=this._clickTolerance||o._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(t){const o=this._map;o&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class bh{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const o=a.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,u){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+u}}const wh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},zl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Es(l){l.parentNode&&l.parentNode.removeChild(l)}const kl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pl{constructor(t,o,u=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Co({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new Tl({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),pt()}move(t,o){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,o),f=p&&p.bearingDelta;if(f&&u.setBearing(u.getBearing()+f),this.mousePitch){const _=this.mousePitch.mousemoveWindow(t,o),y=_&&_.pitchDelta;y&&u.setPitch(u.getPitch()+y)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ut(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(a.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ft(this.element,t)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,ft(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=qe(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=qe(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const qi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let ir,Ss=0,Qn=!1;const Dl={maxWidth:100,unit:"metric"};function Ta(l,t,o){const u=o&&o.maxWidth||100,p=l._containerHeight/2,f=l._containerWidth/2-u/2,_=l.unproject([f,p]),y=l.unproject([f+u,p]),b=_.distanceTo(y);if(o&&o.unit==="imperial"){const T=3.2808*b;T>5280?ko(t,u,T/5280,l._getUIString("ScaleControl.Miles"),l):ko(t,u,T,l._getUIString("ScaleControl.Feet"),l)}else o&&o.unit==="nautical"?ko(t,u,b/1852,l._getUIString("ScaleControl.NauticalMiles"),l):b>=1e3?ko(t,u,b/1e3,l._getUIString("ScaleControl.Kilometers"),l):ko(t,u,b,l._getUIString("ScaleControl.Meters"),l)}function ko(l,t,o,u,p){const f=function(y){const b=Math.pow(10,`${Math.floor(y)}`.length-1);let T=y/b;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(E){const A=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*A)/A}(T),b*T}(o),_=f/o;p._requestDomTask(()=>{l.style.width=t*_+"px",l.innerHTML=`${f}&nbsp;${u}`})}const pr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ti=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Is(l=new a.pointGeometry(0,0),t="bottom"){if(typeof l=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new a.pointGeometry(0,l);case"top-left":return new a.pointGeometry(o,o);case"top-right":return new a.pointGeometry(-o,o);case"bottom":return new a.pointGeometry(0,-l);case"bottom-left":return new a.pointGeometry(o,-o);case"bottom-right":return new a.pointGeometry(-o,-o);case"left":return new a.pointGeometry(l,0);case"right":return new a.pointGeometry(-l,0)}return new a.pointGeometry(0,0)}return l instanceof a.pointGeometry||Array.isArray(l)?a.pointGeometry.convert(l):a.pointGeometry.convert(l[t]||[0,0])}const Po={version:a.version,supported:Ie,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Cl{constructor(l){if((l=a.extend({},zl,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(l.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new pa(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=l.collectResourceTiming,this._optimizeForTerrain=l.optimizeForTerrain,this._renderTaskQueue=new uu,this._domRenderTaskQueue=new uu,this._controls=[],this._markers=[],this._mapId=a.uniqueId(),this._locale=a.extend({},wh,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bh(0),this._explicitProjection=null,this._requestManager=new a.RequestManager(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,typeof l.container=="string"){if(this._container=a.window.document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new lu(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this._hash=l.hash&&new jc(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,a.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),l.attributionControl&&this.addControl(new xa({customAttribution:l.customAttribution})),this._logoControl=new cu,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new a.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new a.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=l.onAdd(this);this._controls.push(l);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),this.fire(new a.Event("resize",l)),t&&this.fire(new a.Event("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(a.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l==null?-2:l)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l==null?22:l)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l==null?0:l)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l==null?85:l)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._updateProjection(l)}_updateProjection(l){l===null&&(this._explicitProjection=null);const t=l||this.getProjection(),o=this.transform.setProjection(t);if(l&&(this._explicitProjection=this.transform.getProjection()),o){this.painter.clearBackgroundTiles();for(const u in this.style._sourceCaches)this.style._sourceCaches[u].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(l){return this.transform.locationPoint3D(a.LngLat.convert(l))}unproject(l){return this.transform.pointLocation3D(a.pointGeometry.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(l,t,o){if(l==="mouseenter"||l==="mouseover"){let u=!1;const p=_=>{const y=t.filter(T=>this.getLayer(T)),b=y.length?this.queryRenderedFeatures(_.point,{layers:y}):[];b.length?u||(u=!0,o.call(this,new tr(l,this,_.originalEvent,{features:b}))):u=!1},f=()=>{u=!1};return{layers:new Set(t),listener:o,delegates:{mousemove:p,mouseout:f}}}if(l==="mouseleave"||l==="mouseout"){let u=!1;const p=_=>{const y=t.filter(b=>this.getLayer(b));(y.length?this.queryRenderedFeatures(_.point,{layers:y}):[]).length?u=!0:u&&(u=!1,o.call(this,new tr(l,this,_.originalEvent)))},f=_=>{u&&(u=!1,o.call(this,new tr(l,this,_.originalEvent)))};return{layers:new Set(t),listener:o,delegates:{mousemove:p,mouseout:f}}}{const u=p=>{const f=t.filter(y=>this.getLayer(y)),_=f.length?this.queryRenderedFeatures(p.point,{layers:f}):[];_.length&&(p.features=_,o.call(this,p),delete p.features)};return{layers:new Set(t),listener:o,delegates:{[l]:u}}}}on(l,t,o){if(o===void 0)return super.on(l,t);Array.isArray(t)||(t=[t]);const u=this._createDelegatedListener(l,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(l,t,o){if(o===void 0)return super.once(l,t);Array.isArray(t)||(t=[t]);const u=this._createDelegatedListener(l,t,o);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(l,t,o){if(o===void 0)return super.off(l,t);t=new Set(Array.isArray(t)?t:[t]);const u=(f,_)=>{if(f.size!==_.size)return!1;for(const y of f)if(!_.has(y))return!1;return!0},p=this._delegatedListeners?this._delegatedListeners[l]:void 0;return p&&(f=>{for(let _=0;_<f.length;_++){const y=f[_];if(y.listener===o&&u(y.layers,t)){for(const b in y.delegates)this.off(b,y.delegates[b]);return f.splice(_,1),this}}})(p),this}queryRenderedFeatures(l,t){return this.style?(t!==void 0||l===void 0||l instanceof a.pointGeometry||Array.isArray(l)||(t=l,l=void 0),this.style.queryRenderedFeatures(l=l||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(l,t){return this.style.querySourceFeatures(l,t)}queryTerrainElevation(l,t){const o=this.transform.elevation;return o?(t=a.extend({},{exaggerated:!0},t),o.getAtPoint(a.MercatorCoordinate.fromLngLat(l),null,t.exaggerated)):null}setStyle(l,t){return(t=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&l?(this._diffStyle(l,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l&&(this.style=new Zi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof l=="string"?this.style.loadURL(l):this.style.loadJSON(l)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Zi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,t){if(typeof l=="string"){const o=this._requestManager.normalizeStyleURL(l),u=this._requestManager.transformRequest(o,a.ResourceType.Style);a.getJSON(u,(p,f)=>{p?this.fire(new a.ErrorEvent(p)):f&&this._updateDiff(f,t)})}else typeof l=="object"&&this._updateDiff(l,t)}_updateDiff(l,t){try{this.style.setState(l)&&this._update(!0)}catch(o){a.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(l,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(l,t){return this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)}isSourceLoaded(l){return!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){const l=this.style&&this.style._sourceCaches;for(const t in l){const o=l[t]._tiles;for(const u in o){const p=o[u];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(l,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,o)}removeSource(l){return this.style.removeSource(l),this._updateTerrain(),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,t,{pixelRatio:o=1,sdf:u=!1,stretchX:p,stretchY:f,content:_}={}){if(this._lazyInitEmptyStyle(),t instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&t instanceof a.window.ImageBitmap){const{width:y,height:b,data:T}=a.exported.getImageData(t);this.style.addImage(l,{data:new a.RGBAImage({width:y,height:b},T),pixelRatio:o,stretchX:p,stretchY:f,content:_,sdf:u,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:y,height:b}=t,T=t;this.style.addImage(l,{data:new a.RGBAImage({width:y,height:b},new Uint8Array(T.data)),pixelRatio:o,stretchX:p,stretchY:f,content:_,sdf:u,version:0,userImage:T}),T.onAdd&&T.onAdd(this,l)}}updateImage(l,t){const o=this.style.getImage(l);if(!o)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&t instanceof a.window.ImageBitmap?a.exported.getImageData(t):t,{width:p,height:f}=u;p!==void 0&&f!==void 0?p===o.data.width&&f===o.data.height?(o.data.replace(u.data,!(t instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&t instanceof a.window.ImageBitmap)),this.style.updateImage(l,o)):this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,t){a.getImage(this._requestManager.transformRequest(l,a.ResourceType.Image),(o,u)=>{t(o,u instanceof a.window.HTMLImageElement?a.exported.getImageData(u):u)})}listImages(){return this.style.listImages()}addLayer(l,t){return this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)}moveLayer(l,t){return this.style.moveLayer(l,t),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,t,o){return this.style.setLayerZoomRange(l,t,o),this._update(!0)}setFilter(l,t,o={}){return this.style.setFilter(l,t,o),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,t,o,u={}){return this.style.setPaintProperty(l,t,o,u),this._update(!0)}getPaintProperty(l,t){return this.style.getPaintProperty(l,t)}setLayoutProperty(l,t,o,u={}){return this.style.setLayoutProperty(l,t,o,u),this._update(!0)}getLayoutProperty(l,t){return this.style.getLayoutProperty(l,t)}setLight(l,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(l),this.transform):0}setFeatureState(l,t){return this.style.setFeatureState(l,t),this._update()}removeFeatureState(l,t){return this.style.removeFeatureState(l,t),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let o,u,p,f=this._container;for(;f&&(!u||!p);){const _=a.window.getComputedStyle(f).transform;_&&_!=="none"&&(o=_.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(u=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(p=o[3])),f=f.parentElement}this._containerWidth=u?Math.abs(l/u):l,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=me("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=me("div","mapboxgl-canvas-container",l);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=me("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=me("div","mapboxgl-control-container",l),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(p=>{u[p]=me("div",`mapboxgl-ctrl-${p}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const o=a.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(l),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const l=a.extend({},Ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);t?(a.storeAuthState(t,!0),this.painter=new Vc(t,this.transform),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(t)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;const o=this.painter.context.extTimerQuery,u=a.exported.now();if(this.listens("gpu-timing-frame")&&(t=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;let p=!1;const f=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const b=this.transform.zoom,T=this.transform.pitch,E=a.exported.now();this.style.zoomHistory.update(b,E);const A=new a.EvaluationParameters(b,{now:E,fadeDuration:f,pitch:T,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),B=A.crossFadingFactor();B===1&&B===this._crossFadingFactor||(p=!0,this._crossFadingFactor=B),this.style.update(A)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(u),this.style._updateSources(this.transform),this._forceMarkerUpdate()):_=this._updateAverageElevation(u),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,f,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:f,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||p)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const b=a.exported.now()-u;o.endQueryEXT(o.TIME_ELAPSED_EXT,t),setTimeout(()=>{const T=o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(t),this.fire(new a.Event("gpu-timing-frame",{cpuTime:b,gpuTime:T}))},50)}if(this.listens("gpu-timing-layer")){const b=this.painter.collectGpuTimers();setTimeout(()=>{const T=this.painter.queryGpuTimers(b);this.fire(new a.Event("gpu-timing-layer",{layerTimes:T}))},50)}const y=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(y||this._repaint)this.triggerRepaint();else{const b=!this.isMoving()&&this.loaded();if(b&&(_=this._updateAverageElevation(u,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),b&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const T=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:T})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const l of this._markers)l._update()}_updateAverageElevation(l,t=!1){const o=u=>(this.transform.averageElevation=u,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);if((t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const u=this.transform.averageElevation;let p=this.transform.sampleAverageElevation(),f=!1;this.transform.elevation&&(f=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(p)?p=0:this._averageElevationLastSampledAt=l;const _=Math.abs(u-p);if(_>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(p),o(p);this._averageElevation.easeTo(p,l,300)}else if(_>1e-4)return this._averageElevation.jumpTo(p),o(p)}return!!this._averageElevation.isEasing(l)&&o(this._averageElevation.getValue(l))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===a.AUTH_ERR_MSG||l.status===401)){const t=this.painter.context.gl;a.storeAuthState(t,!1),this._logoControl instanceof cu&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const o=this.painter.context.gl,u=o.createFramebuffer();function p(f){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,f,0);const _=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,_),_}return o.bindFramebuffer(o.FRAMEBUFFER,u),this._canvasPixelComparison(p(l),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(l,t,o){let u=o[1]-o[0];const p=l.length/4;for(let f=0;f<t.length;f++){const _=t[f];let y=0;for(let b=0;b<_.length;b+=4)_[b]===l[b]&&_[b+1]===l[b+1]&&_[b+2]===l[b+2]&&_[b+3]===l[b+3]&&(y+=1);u+=(o[f+2]-o[f+1])*(1-y/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),Es(this._canvasContainer),Es(this._controlContainer),Es(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=a.exported.frame(t=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)}))}_preloadTiles(l){const t=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(t,(o,u)=>o._preloadTiles(l,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}_setCacheLimits(l,t){a.setCacheLimits(l,t)}get version(){return a.version}},NavigationControl:class{constructor(l){this.options=a.extend({},kl,l),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),me("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),me("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))}),this._compassIcon=me("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),o=t===l.getMaxZoom(),u=t===l.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pl(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const o=me("button",l,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(l,t){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",o),l.firstElementChild&&l.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends a.Evented{constructor(l){super(),this.options=a.extend({},qi,l),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=wl(this._updateMarkerRotation,20)}onAdd(l){var t;return this._map=l,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,ir!==void 0?t(ir):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(o=>{ir=o.state!=="denied",t(ir)}):(ir=!!a.window.navigator.geolocation,t(ir)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Ss=0,Qn=!1}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),o=l.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",l)),this._finish()}}_updateCamera(l){const t=new a.LngLat(l.coords.longitude,l.coords.latitude),o=l.coords.accuracy,u=this._map.getBearing(),p=a.extend({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),p,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new a.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map._containerHeight/2,t=this._map.unproject([0,l]),o=this._map.unproject([100,l]),u=t.distanceTo(o)/100,p=Math.ceil(2*this._accuracy/u);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Qn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=me("button","mapboxgl-ctrl-geolocate",this._container),me("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me("div","mapboxgl-user-location"),this._dotElement.appendChild(me("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(me("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new wa({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=me("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ss--,Qn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ss++,Ss>1?(l={maximumAge:6e5,timeout:0},Qn=!0):(l=this.options.positionOptions,Qn=!1),this._geolocationWatchID=a.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else a.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&l()}).catch(console.error):l()}_clearWatch(){a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:xa,ScaleControl:class{constructor(l){this.options=a.extend({},Dl,l),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ta(this._map,this._container,this.options)}onAdd(l){return this._map=l,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(l){this.options.unit=l,Ta(this._map,this._container,this.options)}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof a.window.HTMLElement?this._container=l.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=me("button","mapboxgl-ctrl-fullscreen",this._controlContainer);me("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(l){super(),this.options=a.extend(Object.create(pr),l),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=a.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(a.window.document.createTextNode(l))}setHTML(l){const t=a.window.document.createDocumentFragment(),o=a.window.document.createElement("body");let u;for(o.innerHTML=l;u=o.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=me("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const o=this._closeButton=me("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,o=this._container,u=this._pos;if(!t||!o||!u)return"bottom";const p=o.offsetWidth,f=o.offsetHeight,_=u.x<p/2,y=u.x>t.transform.width-p/2;if(u.y+l<f)return _?"top-left":y?"top-right":"top";if(u.y>t.transform.height-f){if(_)return"bottom-left";if(y)return"bottom-right"}return _?"left":y?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let u=this._container;if(u||(u=this._container=me("div","mapboxgl-popup",t.getContainer()),this._tip=me("div","mapboxgl-popup-tip",u),u.appendChild(o)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=va(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const p=this._pos=this._trackPointer&&l?l:t.project(this._lngLat),f=Is(this.options.offset),_=this._anchor=this._getAnchor(f.y),y=Is(this.options.offset,_),b=p.add(y).round();t._requestDomTask(()=>{this._container&&_&&(this._container.style.transform=`${ba[_]} translate(${b.x}px,${b.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(ti);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._content&&(this._content.style.opacity=l),this._tip&&(this._tip.style.opacity=l)}},Marker:wa,Style:Zi,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:ms,Evented:a.Evented,config:a.config,prewarm:function(){ht().acquire(lt)},clearPrewarmedResources:function(){const l=ot;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(lt),ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(l){a.config.ACCESS_TOKEN=l},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(l){a.config.API_URL=l},get workerCount(){return nt.workerCount},set workerCount(l){nt.workerCount=l},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){a.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){a.clearTileCache(l)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return Po});var te=V;return te})})(Zm);var dm=Zm.exports;function ox(C){let I,U,P,V,J,te,a,Ie;return{c(){I=Kt("link"),U=Hu(),P=Kt("div"),V=Hu(),J=Kt("button"),te=Vm("fly"),this.h()},l(ge){const le=Bm('[data-svelte="svelte-1eqgqk6"]',document.head);I=Jt(le,"LINK",{rel:!0,href:!0}),le.forEach(bt),U=Yu(ge),P=Jt(ge,"DIV",{class:!0}),sn(P).forEach(bt),V=Yu(ge),J=Jt(ge,"BUTTON",{});var H=sn(J);te=Nm(H,"fly"),H.forEach(bt),this.h()},h(){We(I,"rel","stylesheet"),We(I,"href","https://unpkg.com/mapbox-gl/dist/mapbox-gl.css"),We(P,"class","svelte-1nv9rtq")},m(ge,le){oi(document.head,I),Ki(ge,U,le),Ki(ge,P,le),C[3](P),Ki(ge,V,le),Ki(ge,J,le),oi(J,te),a||(Ie=[om(I,"load",C[1]),om(J,"click",C[2])],a=!0)},p:lo,i:lo,o:lo,d(ge){bt(I),ge&&bt(U),ge&&bt(P),C[3](null),ge&&bt(V),ge&&bt(J),a=!1,ky(Ie)}}}function sx(C,I,U){let P,V;const J=()=>{V=new dm.Map({container:P,style:"mapbox://styles/dock4242/cl12rp23h001i15l6gy75w6e4",center:[10,10],zoom:3})},te=()=>{V.flyTo({center:[-122.257426,37.829682],zoom:10,essential:!0})};jm(()=>{dm.accessToken="pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ",J()});function a(Ie){Py[Ie?"unshift":"push"](()=>{P=Ie,U(0,P)})}return[P,J,te,a]}class ax extends Pn{constructor(I){super(),Dn(this,I,sx,ox,Ln,{})}}function lx(C){let I,U;const P=C[1].default,V=Rm(P,C,C[0],null);return{c(){I=Kt("div"),V&&V.c(),this.h()},l(J){I=Jt(J,"DIV",{class:!0});var te=sn(I);V&&V.l(te),te.forEach(bt),this.h()},h(){We(I,"class","w-full flex justify-center mb-6 items-center h-96 bg-slate-50 border-2 border-slate-500")},m(J,te){Ki(J,I,te),V&&V.m(I,null),U=!0},p(J,[te]){V&&V.p&&(!U||te&1)&&Fm(V,P,J,J[0],U?Um(P,J[0],te,null):Om(J[0]),null)},i(J){U||(Br(V,J),U=!0)},o(J){$r(V,J),U=!1},d(J){J&&bt(I),V&&V.d(J)}}}function cx(C,I,U){let{$$slots:P={},$$scope:V}=I;return C.$$set=J=>{"$$scope"in J&&U(0,V=J.$$scope)},[V,P]}class ux extends Pn{constructor(I){super(),Dn(this,I,cx,lx,Ln,{})}}class Fs{constructor(){this._partials=new Float64Array(32),this._n=0}add(I){const U=this._partials;let P=0;for(let V=0;V<this._n&&V<32;V++){const J=U[V],te=I+J,a=Math.abs(I)<Math.abs(J)?I-(te-J):J-(te-I);a&&(U[P++]=a),I=te}return U[P]=I,this._n=P+1,this}valueOf(){const I=this._partials;let U=this._n,P,V,J,te=0;if(U>0){for(te=I[--U];U>0&&(P=te,V=I[--U],te=P+V,J=V-(te-P),!J););U>0&&(J<0&&I[U-1]<0||J>0&&I[U-1]>0)&&(V=J*2,P=te+V,V==P-te&&(te=P))}return te}}function*hx(C){for(const I of C)yield*I}function Wm(C){return Array.from(hx(C))}var hi=1e-6,dx=1e-12,Xt=Math.PI,jr=Xt/2,pm=Xt/4,Zr=Xt*2,nn=180/Xt,lr=Xt/180,xi=Math.abs,px=Math.atan,Za=Math.atan2,Ii=Math.cos,fi=Math.sin,Wu=Math.sign||function(C){return C>0?1:C<0?-1:0},co=Math.sqrt;function fx(C){return C>1?0:C<-1?Xt:Math.acos(C)}function Os(C){return C>1?jr:C<-1?-jr:Math.asin(C)}function Gr(){}function Ku(C,I){C&&mm.hasOwnProperty(C.type)&&mm[C.type](C,I)}var fm={Feature:function(C,I){Ku(C.geometry,I)},FeatureCollection:function(C,I){for(var U=C.features,P=-1,V=U.length;++P<V;)Ku(U[P].geometry,I)}},mm={Sphere:function(C,I){I.sphere()},Point:function(C,I){C=C.coordinates,I.point(C[0],C[1],C[2])},MultiPoint:function(C,I){for(var U=C.coordinates,P=-1,V=U.length;++P<V;)C=U[P],I.point(C[0],C[1],C[2])},LineString:function(C,I){Dd(C.coordinates,I,0)},MultiLineString:function(C,I){for(var U=C.coordinates,P=-1,V=U.length;++P<V;)Dd(U[P],I,0)},Polygon:function(C,I){_m(C.coordinates,I)},MultiPolygon:function(C,I){for(var U=C.coordinates,P=-1,V=U.length;++P<V;)_m(U[P],I)},GeometryCollection:function(C,I){for(var U=C.geometries,P=-1,V=U.length;++P<V;)Ku(U[P],I)}};function Dd(C,I,U){var P=-1,V=C.length-U,J;for(I.lineStart();++P<V;)J=C[P],I.point(J[0],J[1],J[2]);I.lineEnd()}function _m(C,I){var U=-1,P=C.length;for(I.polygonStart();++U<P;)Dd(C[U],I,1);I.polygonEnd()}function ja(C,I){C&&fm.hasOwnProperty(C.type)?fm[C.type](C,I):Ku(C,I)}function Ld(C){return[Za(C[1],C[0]),Os(C[2])]}function qa(C){var I=C[0],U=C[1],P=Ii(U);return[P*Ii(I),P*fi(I),fi(U)]}function Gu(C,I){return C[0]*I[0]+C[1]*I[1]+C[2]*I[2]}function Ju(C,I){return[C[1]*I[2]-C[2]*I[1],C[2]*I[0]-C[0]*I[2],C[0]*I[1]-C[1]*I[0]]}function Ad(C,I){C[0]+=I[0],C[1]+=I[1],C[2]+=I[2]}function $u(C,I){return[C[0]*I,C[1]*I,C[2]*I]}function Bd(C){var I=co(C[0]*C[0]+C[1]*C[1]+C[2]*C[2]);C[0]/=I,C[1]/=I,C[2]/=I}function Rd(C,I){function U(P,V){return P=C(P,V),I(P[0],P[1])}return C.invert&&I.invert&&(U.invert=function(P,V){return P=I.invert(P,V),P&&C.invert(P[0],P[1])}),U}function Fd(C,I){return[xi(C)>Xt?C+Math.round(-C/Zr)*Zr:C,I]}Fd.invert=Fd;function mx(C,I,U){return(C%=Zr)?I||U?Rd(ym(C),xm(I,U)):ym(C):I||U?xm(I,U):Fd}function gm(C){return function(I,U){return I+=C,[I>Xt?I-Zr:I<-Xt?I+Zr:I,U]}}function ym(C){var I=gm(C);return I.invert=gm(-C),I}function xm(C,I){var U=Ii(C),P=fi(C),V=Ii(I),J=fi(I);function te(a,Ie){var ge=Ii(Ie),le=Ii(a)*ge,H=fi(a)*ge,me=fi(Ie),_e=me*U+le*P;return[Za(H*V-_e*J,le*U-me*P),Os(_e*V+H*J)]}return te.invert=function(a,Ie){var ge=Ii(Ie),le=Ii(a)*ge,H=fi(a)*ge,me=fi(Ie),_e=me*V-H*J;return[Za(H*V+me*J,le*U+_e*P),Os(_e*U-le*P)]},te}function _x(C,I,U,P,V,J){if(!!U){var te=Ii(I),a=fi(I),Ie=P*U;V==null?(V=I+P*Zr,J=I-Ie/2):(V=vm(te,V),J=vm(te,J),(P>0?V<J:V>J)&&(V+=P*Zr));for(var ge,le=V;P>0?le>J:le<J;le-=Ie)ge=Ld([te,-a*Ii(le),-a*fi(le)]),C.point(ge[0],ge[1])}}function vm(C,I){I=qa(I),I[0]-=C,Bd(I);var U=fx(-I[1]);return((-I[2]<0?-U:U)+Zr-hi)%Zr}function Xm(){var C=[],I;return{point:function(U,P,V){I.push([U,P,V])},lineStart:function(){C.push(I=[])},lineEnd:Gr,rejoin:function(){C.length>1&&C.push(C.pop().concat(C.shift()))},result:function(){var U=C;return C=[],I=null,U}}}function Xu(C,I){return xi(C[0]-I[0])<hi&&xi(C[1]-I[1])<hi}function Zu(C,I,U,P){this.x=C,this.z=I,this.o=U,this.e=P,this.v=!1,this.n=this.p=null}function Hm(C,I,U,P,V){var J=[],te=[],a,Ie;if(C.forEach(function(Be){if(!((mt=Be.length-1)<=0)){var mt,Ue=Be[0],pt=Be[mt],ut;if(Xu(Ue,pt)){if(!Ue[2]&&!pt[2]){for(V.lineStart(),a=0;a<mt;++a)V.point((Ue=Be[a])[0],Ue[1]);V.lineEnd();return}pt[0]+=2*hi}J.push(ut=new Zu(Ue,Be,null,!0)),te.push(ut.o=new Zu(Ue,null,ut,!1)),J.push(ut=new Zu(pt,Be,null,!1)),te.push(ut.o=new Zu(pt,null,ut,!0))}}),!!J.length){for(te.sort(I),bm(J),bm(te),a=0,Ie=te.length;a<Ie;++a)te[a].e=U=!U;for(var ge=J[0],le,H;;){for(var me=ge,_e=!0;me.v;)if((me=me.n)===ge)return;le=me.z,V.lineStart();do{if(me.v=me.o.v=!0,me.e){if(_e)for(a=0,Ie=le.length;a<Ie;++a)V.point((H=le[a])[0],H[1]);else P(me.x,me.n.x,1,V);me=me.n}else{if(_e)for(le=me.p.z,a=le.length-1;a>=0;--a)V.point((H=le[a])[0],H[1]);else P(me.x,me.p.x,-1,V);me=me.p}me=me.o,le=me.z,_e=!_e}while(!me.v);V.lineEnd()}}}function bm(C){if(!!(I=C.length)){for(var I,U=0,P=C[0],V;++U<I;)P.n=V=C[U],V.p=P,P=V;P.n=V=C[0],V.p=P}}function Cd(C){return xi(C[0])<=Xt?C[0]:Wu(C[0])*((xi(C[0])+Xt)%Zr-Xt)}function gx(C,I){var U=Cd(I),P=I[1],V=fi(P),J=[fi(U),-Ii(U),0],te=0,a=0,Ie=new Fs;V===1?P=jr+hi:V===-1&&(P=-jr-hi);for(var ge=0,le=C.length;ge<le;++ge)if(!!(me=(H=C[ge]).length))for(var H,me,_e=H[me-1],Be=Cd(_e),mt=_e[1]/2+pm,Ue=fi(mt),pt=Ii(mt),ut=0;ut<me;++ut,Be=rt,Ue=qe,pt=kt,_e=_t){var _t=H[ut],rt=Cd(_t),ft=_t[1]/2+pm,qe=fi(ft),kt=Ii(ft),vt=rt-Be,It=vt>=0?1:-1,Ft=It*vt,tt=Ft>Xt,Ot=Ue*qe;if(Ie.add(Za(Ot*It*fi(Ft),pt*kt+Ot*Ii(Ft))),te+=tt?vt+It*Zr:vt,tt^Be>=U^rt>=U){var gt=Ju(qa(_e),qa(_t));Bd(gt);var et=Ju(J,gt);Bd(et);var ze=(tt^vt>=0?-1:1)*Os(et[2]);(P>ze||P===ze&&(gt[0]||gt[1]))&&(a+=tt^vt>=0?1:-1)}}return(te<-hi||te<hi&&Ie<-dx)^a&1}function Ym(C,I,U,P){return function(V){var J=I(V),te=Xm(),a=I(te),Ie=!1,ge,le,H,me={point:_e,lineStart:mt,lineEnd:Ue,polygonStart:function(){me.point=pt,me.lineStart=ut,me.lineEnd=_t,le=[],ge=[]},polygonEnd:function(){me.point=_e,me.lineStart=mt,me.lineEnd=Ue,le=Wm(le);var rt=gx(ge,P);le.length?(Ie||(V.polygonStart(),Ie=!0),Hm(le,xx,rt,U,V)):rt&&(Ie||(V.polygonStart(),Ie=!0),V.lineStart(),U(null,null,1,V),V.lineEnd()),Ie&&(V.polygonEnd(),Ie=!1),le=ge=null},sphere:function(){V.polygonStart(),V.lineStart(),U(null,null,1,V),V.lineEnd(),V.polygonEnd()}};function _e(rt,ft){C(rt,ft)&&V.point(rt,ft)}function Be(rt,ft){J.point(rt,ft)}function mt(){me.point=Be,J.lineStart()}function Ue(){me.point=_e,J.lineEnd()}function pt(rt,ft){H.push([rt,ft]),a.point(rt,ft)}function ut(){a.lineStart(),H=[]}function _t(){pt(H[0][0],H[0][1]),a.lineEnd();var rt=a.clean(),ft=te.result(),qe,kt=ft.length,vt,It,Ft;if(H.pop(),ge.push(H),H=null,!!kt){if(rt&1){if(It=ft[0],(vt=It.length-1)>0){for(Ie||(V.polygonStart(),Ie=!0),V.lineStart(),qe=0;qe<vt;++qe)V.point((Ft=It[qe])[0],Ft[1]);V.lineEnd()}return}kt>1&&rt&2&&ft.push(ft.pop().concat(ft.shift())),le.push(ft.filter(yx))}}return me}}function yx(C){return C.length>1}function xx(C,I){return((C=C.x)[0]<0?C[1]-jr-hi:jr-C[1])-((I=I.x)[0]<0?I[1]-jr-hi:jr-I[1])}var wm=Ym(function(){return!0},vx,wx,[-Xt,-jr]);function vx(C){var I=NaN,U=NaN,P=NaN,V;return{lineStart:function(){C.lineStart(),V=1},point:function(J,te){var a=J>0?Xt:-Xt,Ie=xi(J-I);xi(Ie-Xt)<hi?(C.point(I,U=(U+te)/2>0?jr:-jr),C.point(P,U),C.lineEnd(),C.lineStart(),C.point(a,U),C.point(J,U),V=0):P!==a&&Ie>=Xt&&(xi(I-P)<hi&&(I-=P*hi),xi(J-a)<hi&&(J-=a*hi),U=bx(I,U,J,te),C.point(P,U),C.lineEnd(),C.lineStart(),C.point(a,U),V=0),C.point(I=J,U=te),P=a},lineEnd:function(){C.lineEnd(),I=U=NaN},clean:function(){return 2-V}}}function bx(C,I,U,P){var V,J,te=fi(C-U);return xi(te)>hi?px((fi(I)*(J=Ii(P))*fi(U)-fi(P)*(V=Ii(I))*fi(C))/(V*J*te)):(I+P)/2}function wx(C,I,U,P){var V;if(C==null)V=U*jr,P.point(-Xt,V),P.point(0,V),P.point(Xt,V),P.point(Xt,0),P.point(Xt,-V),P.point(0,-V),P.point(-Xt,-V),P.point(-Xt,0),P.point(-Xt,V);else if(xi(C[0]-I[0])>hi){var J=C[0]<I[0]?Xt:-Xt;V=U*J/2,P.point(-J,V),P.point(0,V),P.point(J,V)}else P.point(I[0],I[1])}function Tx(C){var I=Ii(C),U=6*lr,P=I>0,V=xi(I)>hi;function J(le,H,me,_e){_x(_e,C,U,me,le,H)}function te(le,H){return Ii(le)*Ii(H)>I}function a(le){var H,me,_e,Be,mt;return{lineStart:function(){Be=_e=!1,mt=1},point:function(Ue,pt){var ut=[Ue,pt],_t,rt=te(Ue,pt),ft=P?rt?0:ge(Ue,pt):rt?ge(Ue+(Ue<0?Xt:-Xt),pt):0;if(!H&&(Be=_e=rt)&&le.lineStart(),rt!==_e&&(_t=Ie(H,ut),(!_t||Xu(H,_t)||Xu(ut,_t))&&(ut[2]=1)),rt!==_e)mt=0,rt?(le.lineStart(),_t=Ie(ut,H),le.point(_t[0],_t[1])):(_t=Ie(H,ut),le.point(_t[0],_t[1],2),le.lineEnd()),H=_t;else if(V&&H&&P^rt){var qe;!(ft&me)&&(qe=Ie(ut,H,!0))&&(mt=0,P?(le.lineStart(),le.point(qe[0][0],qe[0][1]),le.point(qe[1][0],qe[1][1]),le.lineEnd()):(le.point(qe[1][0],qe[1][1]),le.lineEnd(),le.lineStart(),le.point(qe[0][0],qe[0][1],3)))}rt&&(!H||!Xu(H,ut))&&le.point(ut[0],ut[1]),H=ut,_e=rt,me=ft},lineEnd:function(){_e&&le.lineEnd(),H=null},clean:function(){return mt|(Be&&_e)<<1}}}function Ie(le,H,me){var _e=qa(le),Be=qa(H),mt=[1,0,0],Ue=Ju(_e,Be),pt=Gu(Ue,Ue),ut=Ue[0],_t=pt-ut*ut;if(!_t)return!me&&le;var rt=I*pt/_t,ft=-I*ut/_t,qe=Ju(mt,Ue),kt=$u(mt,rt),vt=$u(Ue,ft);Ad(kt,vt);var It=qe,Ft=Gu(kt,It),tt=Gu(It,It),Ot=Ft*Ft-tt*(Gu(kt,kt)-1);if(!(Ot<0)){var gt=co(Ot),et=$u(It,(-Ft-gt)/tt);if(Ad(et,kt),et=Ld(et),!me)return et;var ze=le[0],St=H[0],si=le[1],ai=H[1],vi;St<ze&&(vi=ze,ze=St,St=vi);var Tr=St-ze,yi=xi(Tr-Xt)<hi,cr=yi||Tr<hi;if(!yi&&ai<si&&(vi=si,si=ai,ai=vi),cr?yi?si+ai>0^et[1]<(xi(et[0]-ze)<hi?si:ai):si<=et[1]&&et[1]<=ai:Tr>Xt^(ze<=et[0]&&et[0]<=St)){var Lt=$u(It,(-Ft+gt)/tt);return Ad(Lt,kt),[et,Ld(Lt)]}}}function ge(le,H){var me=P?C:Xt-C,_e=0;return le<-me?_e|=1:le>me&&(_e|=2),H<-me?_e|=4:H>me&&(_e|=8),_e}return Ym(te,a,J,P?[0,-C]:[-Xt,C-Xt])}function Ex(C,I,U,P,V,J){var te=C[0],a=C[1],Ie=I[0],ge=I[1],le=0,H=1,me=Ie-te,_e=ge-a,Be;if(Be=U-te,!(!me&&Be>0)){if(Be/=me,me<0){if(Be<le)return;Be<H&&(H=Be)}else if(me>0){if(Be>H)return;Be>le&&(le=Be)}if(Be=V-te,!(!me&&Be<0)){if(Be/=me,me<0){if(Be>H)return;Be>le&&(le=Be)}else if(me>0){if(Be<le)return;Be<H&&(H=Be)}if(Be=P-a,!(!_e&&Be>0)){if(Be/=_e,_e<0){if(Be<le)return;Be<H&&(H=Be)}else if(_e>0){if(Be>H)return;Be>le&&(le=Be)}if(Be=J-a,!(!_e&&Be<0)){if(Be/=_e,_e<0){if(Be>H)return;Be>le&&(le=Be)}else if(_e>0){if(Be<le)return;Be<H&&(H=Be)}return le>0&&(C[0]=te+le*me,C[1]=a+le*_e),H<1&&(I[0]=te+H*me,I[1]=a+H*_e),!0}}}}}var dc=1e9,qu=-dc;function Sx(C,I,U,P){function V(ge,le){return C<=ge&&ge<=U&&I<=le&&le<=P}function J(ge,le,H,me){var _e=0,Be=0;if(ge==null||(_e=te(ge,H))!==(Be=te(le,H))||Ie(ge,le)<0^H>0)do me.point(_e===0||_e===3?C:U,_e>1?P:I);while((_e=(_e+H+4)%4)!==Be);else me.point(le[0],le[1])}function te(ge,le){return xi(ge[0]-C)<hi?le>0?0:3:xi(ge[0]-U)<hi?le>0?2:1:xi(ge[1]-I)<hi?le>0?1:0:le>0?3:2}function a(ge,le){return Ie(ge.x,le.x)}function Ie(ge,le){var H=te(ge,1),me=te(le,1);return H!==me?H-me:H===0?le[1]-ge[1]:H===1?ge[0]-le[0]:H===2?ge[1]-le[1]:le[0]-ge[0]}return function(ge){var le=ge,H=Xm(),me,_e,Be,mt,Ue,pt,ut,_t,rt,ft,qe,kt={point:vt,lineStart:Ot,lineEnd:gt,polygonStart:Ft,polygonEnd:tt};function vt(ze,St){V(ze,St)&&le.point(ze,St)}function It(){for(var ze=0,St=0,si=_e.length;St<si;++St)for(var ai=_e[St],vi=1,Tr=ai.length,yi=ai[0],cr,Lt,bi=yi[0],Ni=yi[1];vi<Tr;++vi)cr=bi,Lt=Ni,yi=ai[vi],bi=yi[0],Ni=yi[1],Lt<=P?Ni>P&&(bi-cr)*(P-Lt)>(Ni-Lt)*(C-cr)&&++ze:Ni<=P&&(bi-cr)*(P-Lt)<(Ni-Lt)*(C-cr)&&--ze;return ze}function Ft(){le=H,me=[],_e=[],qe=!0}function tt(){var ze=It(),St=qe&&ze,si=(me=Wm(me)).length;(St||si)&&(ge.polygonStart(),St&&(ge.lineStart(),J(null,null,1,ge),ge.lineEnd()),si&&Hm(me,a,ze,J,ge),ge.polygonEnd()),le=ge,me=_e=Be=null}function Ot(){kt.point=et,_e&&_e.push(Be=[]),ft=!0,rt=!1,ut=_t=NaN}function gt(){me&&(et(mt,Ue),pt&&rt&&H.rejoin(),me.push(H.result())),kt.point=vt,rt&&le.lineEnd()}function et(ze,St){var si=V(ze,St);if(_e&&Be.push([ze,St]),ft)mt=ze,Ue=St,pt=si,ft=!1,si&&(le.lineStart(),le.point(ze,St));else if(si&&rt)le.point(ze,St);else{var ai=[ut=Math.max(qu,Math.min(dc,ut)),_t=Math.max(qu,Math.min(dc,_t))],vi=[ze=Math.max(qu,Math.min(dc,ze)),St=Math.max(qu,Math.min(dc,St))];Ex(ai,vi,C,I,U,P)?(rt||(le.lineStart(),le.point(ai[0],ai[1])),le.point(vi[0],vi[1]),si||le.lineEnd(),qe=!1):si&&(le.lineStart(),le.point(ze,St),qe=!1)}ut=ze,_t=St,rt=si}return kt}}var Od=C=>C,zd=new Fs,Ud=new Fs,Km,Jm,Vd,Nd,Wo={point:Gr,lineStart:Gr,lineEnd:Gr,polygonStart:function(){Wo.lineStart=Ix,Wo.lineEnd=Ax},polygonEnd:function(){Wo.lineStart=Wo.lineEnd=Wo.point=Gr,zd.add(xi(Ud)),Ud=new Fs},result:function(){var C=zd/2;return zd=new Fs,C}};function Ix(){Wo.point=Mx}function Mx(C,I){Wo.point=Qm,Km=Vd=C,Jm=Nd=I}function Qm(C,I){Ud.add(Nd*C-Vd*I),Vd=C,Nd=I}function Ax(){Qm(Km,Jm)}var Tm=Wo,Wa=1/0,Qu=Wa,yc=-Wa,eh=yc,Cx={point:zx,lineStart:Gr,lineEnd:Gr,polygonStart:Gr,polygonEnd:Gr,result:function(){var C=[[Wa,Qu],[yc,eh]];return yc=eh=-(Qu=Wa=1/0),C}};function zx(C,I){C<Wa&&(Wa=C),C>yc&&(yc=C),I<Qu&&(Qu=I),I>eh&&(eh=I)}var th=Cx,jd=0,Gd=0,pc=0,ih=0,rh=0,Ga=0,$d=0,Zd=0,fc=0,e_,t_,zn,kn,on={point:Us,lineStart:Em,lineEnd:Sm,polygonStart:function(){on.lineStart=Dx,on.lineEnd=Lx},polygonEnd:function(){on.point=Us,on.lineStart=Em,on.lineEnd=Sm},result:function(){var C=fc?[$d/fc,Zd/fc]:Ga?[ih/Ga,rh/Ga]:pc?[jd/pc,Gd/pc]:[NaN,NaN];return jd=Gd=pc=ih=rh=Ga=$d=Zd=fc=0,C}};function Us(C,I){jd+=C,Gd+=I,++pc}function Em(){on.point=kx}function kx(C,I){on.point=Px,Us(zn=C,kn=I)}function Px(C,I){var U=C-zn,P=I-kn,V=co(U*U+P*P);ih+=V*(zn+C)/2,rh+=V*(kn+I)/2,Ga+=V,Us(zn=C,kn=I)}function Sm(){on.point=Us}function Dx(){on.point=Bx}function Lx(){i_(e_,t_)}function Bx(C,I){on.point=i_,Us(e_=zn=C,t_=kn=I)}function i_(C,I){var U=C-zn,P=I-kn,V=co(U*U+P*P);ih+=V*(zn+C)/2,rh+=V*(kn+I)/2,Ga+=V,V=kn*C-zn*I,$d+=V*(zn+C),Zd+=V*(kn+I),fc+=V*3,Us(zn=C,kn=I)}var Im=on;function r_(C){this._context=C}r_.prototype={_radius:4.5,pointRadius:function(C){return this._radius=C,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(C,I){switch(this._point){case 0:{this._context.moveTo(C,I),this._point=1;break}case 1:{this._context.lineTo(C,I);break}default:{this._context.moveTo(C+this._radius,I),this._context.arc(C,I,this._radius,0,Zr);break}}},result:Gr};var qd=new Fs,kd,n_,o_,mc,_c,nh={point:Gr,lineStart:function(){nh.point=Rx},lineEnd:function(){kd&&s_(n_,o_),nh.point=Gr},polygonStart:function(){kd=!0},polygonEnd:function(){kd=null},result:function(){var C=+qd;return qd=new Fs,C}};function Rx(C,I){nh.point=s_,n_=mc=C,o_=_c=I}function s_(C,I){mc-=C,_c-=I,qd.add(co(mc*mc+_c*_c)),mc=C,_c=I}var Mm=nh;function a_(){this._string=[]}a_.prototype={_radius:4.5,_circle:Am(4.5),pointRadius:function(C){return(C=+C)!==this._radius&&(this._radius=C,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(C,I){switch(this._point){case 0:{this._string.push("M",C,",",I),this._point=1;break}case 1:{this._string.push("L",C,",",I);break}default:{this._circle==null&&(this._circle=Am(this._radius)),this._string.push("M",C,",",I,this._circle);break}}},result:function(){if(this._string.length){var C=this._string.join("");return this._string=[],C}else return null}};function Am(C){return"m0,"+C+"a"+C+","+C+" 0 1,1 0,"+-2*C+"a"+C+","+C+" 0 1,1 0,"+2*C+"z"}function Fx(C,I){var U=4.5,P,V;function J(te){return te&&(typeof U=="function"&&V.pointRadius(+U.apply(this,arguments)),ja(te,P(V))),V.result()}return J.area=function(te){return ja(te,P(Tm)),Tm.result()},J.measure=function(te){return ja(te,P(Mm)),Mm.result()},J.bounds=function(te){return ja(te,P(th)),th.result()},J.centroid=function(te){return ja(te,P(Im)),Im.result()},J.projection=function(te){return arguments.length?(P=te==null?(C=null,Od):(C=te).stream,J):C},J.context=function(te){return arguments.length?(V=te==null?(I=null,new a_):new r_(I=te),typeof U!="function"&&V.pointRadius(U),J):I},J.pointRadius=function(te){return arguments.length?(U=typeof te=="function"?te:(V.pointRadius(+te),+te),J):U},J.projection(C).context(I)}function Yd(C){return function(I){var U=new Wd;for(var P in C)U[P]=C[P];return U.stream=I,U}}function Wd(){}Wd.prototype={constructor:Wd,point:function(C,I){this.stream.point(C,I)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Kd(C,I,U){var P=C.clipExtent&&C.clipExtent();return C.scale(150).translate([0,0]),P!=null&&C.clipExtent(null),ja(U,C.stream(th)),I(th.result()),P!=null&&C.clipExtent(P),C}function l_(C,I,U){return Kd(C,function(P){var V=I[1][0]-I[0][0],J=I[1][1]-I[0][1],te=Math.min(V/(P[1][0]-P[0][0]),J/(P[1][1]-P[0][1])),a=+I[0][0]+(V-te*(P[1][0]+P[0][0]))/2,Ie=+I[0][1]+(J-te*(P[1][1]+P[0][1]))/2;C.scale(150*te).translate([a,Ie])},U)}function Ox(C,I,U){return l_(C,[[0,0],I],U)}function Ux(C,I,U){return Kd(C,function(P){var V=+I,J=V/(P[1][0]-P[0][0]),te=(V-J*(P[1][0]+P[0][0]))/2,a=-J*P[0][1];C.scale(150*J).translate([te,a])},U)}function Vx(C,I,U){return Kd(C,function(P){var V=+I,J=V/(P[1][1]-P[0][1]),te=-J*P[0][0],a=(V-J*(P[1][1]+P[0][1]))/2;C.scale(150*J).translate([te,a])},U)}var Cm=16,Nx=Ii(30*lr);function zm(C,I){return+I?Gx(C,I):jx(C)}function jx(C){return Yd({point:function(I,U){I=C(I,U),this.stream.point(I[0],I[1])}})}function Gx(C,I){function U(P,V,J,te,a,Ie,ge,le,H,me,_e,Be,mt,Ue){var pt=ge-P,ut=le-V,_t=pt*pt+ut*ut;if(_t>4*I&&mt--){var rt=te+me,ft=a+_e,qe=Ie+Be,kt=co(rt*rt+ft*ft+qe*qe),vt=Os(qe/=kt),It=xi(xi(qe)-1)<hi||xi(J-H)<hi?(J+H)/2:Za(ft,rt),Ft=C(It,vt),tt=Ft[0],Ot=Ft[1],gt=tt-P,et=Ot-V,ze=ut*gt-pt*et;(ze*ze/_t>I||xi((pt*gt+ut*et)/_t-.5)>.3||te*me+a*_e+Ie*Be<Nx)&&(U(P,V,J,te,a,Ie,tt,Ot,It,rt/=kt,ft/=kt,qe,mt,Ue),Ue.point(tt,Ot),U(tt,Ot,It,rt,ft,qe,ge,le,H,me,_e,Be,mt,Ue))}}return function(P){var V,J,te,a,Ie,ge,le,H,me,_e,Be,mt,Ue={point:pt,lineStart:ut,lineEnd:rt,polygonStart:function(){P.polygonStart(),Ue.lineStart=ft},polygonEnd:function(){P.polygonEnd(),Ue.lineStart=ut}};function pt(vt,It){vt=C(vt,It),P.point(vt[0],vt[1])}function ut(){H=NaN,Ue.point=_t,P.lineStart()}function _t(vt,It){var Ft=qa([vt,It]),tt=C(vt,It);U(H,me,le,_e,Be,mt,H=tt[0],me=tt[1],le=vt,_e=Ft[0],Be=Ft[1],mt=Ft[2],Cm,P),P.point(H,me)}function rt(){Ue.point=pt,P.lineEnd()}function ft(){ut(),Ue.point=qe,Ue.lineEnd=kt}function qe(vt,It){_t(V=vt,It),J=H,te=me,a=_e,Ie=Be,ge=mt,Ue.point=_t}function kt(){U(H,me,le,_e,Be,mt,J,te,V,a,Ie,ge,Cm,P),Ue.lineEnd=rt,rt()}return Ue}}var $x=Yd({point:function(C,I){this.stream.point(C*lr,I*lr)}});function Zx(C){return Yd({point:function(I,U){var P=C(I,U);return this.stream.point(P[0],P[1])}})}function qx(C,I,U,P,V){function J(te,a){return te*=P,a*=V,[I+C*te,U-C*a]}return J.invert=function(te,a){return[(te-I)/C*P,(U-a)/C*V]},J}function km(C,I,U,P,V,J){if(!J)return qx(C,I,U,P,V);var te=Ii(J),a=fi(J),Ie=te*C,ge=a*C,le=te/C,H=a/C,me=(a*U-te*I)/C,_e=(a*I+te*U)/C;function Be(mt,Ue){return mt*=P,Ue*=V,[Ie*mt-ge*Ue+I,U-ge*mt-Ie*Ue]}return Be.invert=function(mt,Ue){return[P*(le*mt-H*Ue+me),V*(_e-H*mt-le*Ue)]},Be}function Wx(C){var I,U=150,P=480,V=250,J=0,te=0,a=0,Ie=0,ge=0,le,H=0,me=1,_e=1,Be=null,mt=wm,Ue=null,pt,ut,_t,rt=Od,ft=.5,qe,kt,vt,It,Ft;function tt(ze){return vt(ze[0]*lr,ze[1]*lr)}function Ot(ze){return ze=vt.invert(ze[0],ze[1]),ze&&[ze[0]*nn,ze[1]*nn]}tt.stream=function(ze){return It&&Ft===ze?It:It=$x(Zx(le)(mt(qe(rt(Ft=ze)))))},tt.preclip=function(ze){return arguments.length?(mt=ze,Be=void 0,et()):mt},tt.postclip=function(ze){return arguments.length?(rt=ze,Ue=pt=ut=_t=null,et()):rt},tt.clipAngle=function(ze){return arguments.length?(mt=+ze?Tx(Be=ze*lr):(Be=null,wm),et()):Be*nn},tt.clipExtent=function(ze){return arguments.length?(rt=ze==null?(Ue=pt=ut=_t=null,Od):Sx(Ue=+ze[0][0],pt=+ze[0][1],ut=+ze[1][0],_t=+ze[1][1]),et()):Ue==null?null:[[Ue,pt],[ut,_t]]},tt.scale=function(ze){return arguments.length?(U=+ze,gt()):U},tt.translate=function(ze){return arguments.length?(P=+ze[0],V=+ze[1],gt()):[P,V]},tt.center=function(ze){return arguments.length?(J=ze[0]%360*lr,te=ze[1]%360*lr,gt()):[J*nn,te*nn]},tt.rotate=function(ze){return arguments.length?(a=ze[0]%360*lr,Ie=ze[1]%360*lr,ge=ze.length>2?ze[2]%360*lr:0,gt()):[a*nn,Ie*nn,ge*nn]},tt.angle=function(ze){return arguments.length?(H=ze%360*lr,gt()):H*nn},tt.reflectX=function(ze){return arguments.length?(me=ze?-1:1,gt()):me<0},tt.reflectY=function(ze){return arguments.length?(_e=ze?-1:1,gt()):_e<0},tt.precision=function(ze){return arguments.length?(qe=zm(kt,ft=ze*ze),et()):co(ft)},tt.fitExtent=function(ze,St){return l_(tt,ze,St)},tt.fitSize=function(ze,St){return Ox(tt,ze,St)},tt.fitWidth=function(ze,St){return Ux(tt,ze,St)},tt.fitHeight=function(ze,St){return Vx(tt,ze,St)};function gt(){var ze=km(U,0,0,me,_e,H).apply(null,I(J,te)),St=km(U,P-ze[0],V-ze[1],me,_e,H);return le=mx(a,Ie,ge),kt=Rd(I,St),vt=Rd(le,kt),qe=zm(kt,ft),et()}function et(){return It=Ft=null,tt}return function(){return I=C.apply(this,arguments),tt.invert=I.invert&&Ot,gt()}}function Xx(C){var I=0,U=Xt/3,P=Wx(C),V=P(I,U);return V.parallels=function(J){return arguments.length?P(I=J[0]*lr,U=J[1]*lr):[I*nn,U*nn]},V}function Hx(C){var I=Ii(C);function U(P,V){return[P*I,fi(V)/I]}return U.invert=function(P,V){return[P/I,Os(V*I)]},U}function Yx(C,I){var U=fi(C),P=(U+fi(I))/2;if(xi(P)<hi)return Hx(C);var V=1+U*(2*P-U),J=co(V)/P;function te(a,Ie){var ge=co(V-2*P*fi(Ie))/P;return[ge*fi(a*=P),J-ge*Ii(a)]}return te.invert=function(a,Ie){var ge=J-Ie,le=Za(a,xi(ge))*Wu(ge);return ge*P<0&&(le-=Xt*Wu(a)*Wu(ge)),[le/P,Os((V-(a*a+ge*ge)*P*P)/(2*P))]},te}function Kx(){return Xx(Yx).scale(155.424).center([0,33.6442])}function Jx(){return Kx().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Qx(C){return C}function e0(C){if(C==null)return Qx;var I,U,P=C.scale[0],V=C.scale[1],J=C.translate[0],te=C.translate[1];return function(a,Ie){Ie||(I=U=0);var ge=2,le=a.length,H=new Array(le);for(H[0]=(I+=a[0])*P+J,H[1]=(U+=a[1])*V+te;ge<le;)H[ge]=a[ge],++ge;return H}}function t0(C,I){for(var U,P=C.length,V=P-I;V<--P;)U=C[V],C[V++]=C[P],C[P]=U}function i0(C,I){return typeof I=="string"&&(I=C.objects[I]),I.type==="GeometryCollection"?{type:"FeatureCollection",features:I.geometries.map(function(U){return Pm(C,U)})}:Pm(C,I)}function Pm(C,I){var U=I.id,P=I.bbox,V=I.properties==null?{}:I.properties,J=r0(C,I);return U==null&&P==null?{type:"Feature",properties:V,geometry:J}:P==null?{type:"Feature",id:U,properties:V,geometry:J}:{type:"Feature",id:U,bbox:P,properties:V,geometry:J}}function r0(C,I){var U=e0(C.transform),P=C.arcs;function V(le,H){H.length&&H.pop();for(var me=P[le<0?~le:le],_e=0,Be=me.length;_e<Be;++_e)H.push(U(me[_e],_e));le<0&&t0(H,Be)}function J(le){return U(le)}function te(le){for(var H=[],me=0,_e=le.length;me<_e;++me)V(le[me],H);return H.length<2&&H.push(H[0]),H}function a(le){for(var H=te(le);H.length<4;)H.push(H[0]);return H}function Ie(le){return le.map(a)}function ge(le){var H=le.type,me;switch(H){case"GeometryCollection":return{type:H,geometries:le.geometries.map(ge)};case"Point":me=J(le.coordinates);break;case"MultiPoint":me=le.coordinates.map(J);break;case"LineString":me=te(le.arcs);break;case"MultiLineString":me=le.arcs.map(te);break;case"Polygon":me=Ie(le.arcs);break;case"MultiPolygon":me=le.arcs.map(Ie);break;default:return null}return{type:H,coordinates:me}}return ge(I)}function n0(C){let I,U,P;return{c(){I=Kt("div"),U=sm("svg"),P=sm("path"),this.h()},l(V){I=Jt(V,"DIV",{id:!0,class:!0});var J=sn(I);U=am(J,"svg",{width:!0,height:!0,class:!0});var te=sn(U);P=am(te,"path",{d:!0,class:!0}),sn(P).forEach(bt),te.forEach(bt),J.forEach(bt),this.h()},h(){We(P,"d",C[1]),We(P,"class","border svelte-1v8w411"),We(U,"width","960"),We(U,"height","500"),We(U,"class","svelte-1v8w411"),We(I,"id",C[0]),We(I,"class","w-full mb-4 mx-auto flex justify-center")},m(V,J){Ki(V,I,J),oi(I,U),oi(U,P)},p(V,[J]){J&2&&We(P,"d",V[1]),J&1&&We(I,"id",V[0])},i:lo,o:lo,d(V){V&&bt(I)}}}function o0(C,I,U){let P;const V=Jx(),J=Fx().projection(V);jm(async()=>{const Ie=await(await fetch("https://gist.githubusercontent.com/rveciana/a2a1c21ca1c71cd3ec116cc911e5fce9/raw/79564dfa2c56745ebd62f5655a6cc19d2cffa1ea/us.json")).json(),ge=i0(Ie,Ie.objects.land);U(1,P=J(ge))});let{id:te}=I;return C.$$set=a=>{"id"in a&&U(0,te=a.id)},[te,P]}class s0 extends Pn{constructor(I){super(),Dn(this,I,o0,n0,Ln,{id:0})}}function Dm(C,I,U){const P=C.slice();return P[1]=I[U],P[3]=U,P}function a0(C){let I,U=gc.title+"",P;return{c(){I=Kt("h1"),P=Vm(U),this.h()},l(V){I=Jt(V,"H1",{class:!0});var J=sn(I);P=Nm(J,U),J.forEach(bt),this.h()},h(){We(I,"class","text-3xl font-bold underline")},m(V,J){Ki(V,I,J),oi(I,P)},p:lo,d(V){V&&bt(I)}}}function Lm(C){var a,Ie;let I,U,P;const V=[{id:(a=C[1].id)!=null?a:`graf-${C[3]}`},C[1]];var J=(Ie=C[0][C[1].block])!=null?Ie:Pd;function te(ge){let le={};for(let H=0;H<V.length;H+=1)le=By(le,V[H]);return{props:le}}return J&&(I=new J(te())),{c(){I&&Xo(I.$$.fragment),U=$a()},l(ge){I&&Rs(I.$$.fragment,ge),U=$a()},m(ge,le){I&&Ho(I,ge,le),Ki(ge,U,le),P=!0},p(ge,le){var me,_e;const H=le&0?Dy(V,[{id:(me=ge[1].id)!=null?me:`graf-${ge[3]}`},Ly(ge[1])]):{};if(J!==(J=(_e=ge[0][ge[1].block])!=null?_e:Pd)){if(I){Gm();const Be=I;$r(Be.$$.fragment,1,0,()=>{Yo(Be,1)}),$m()}J?(I=new J(te()),Xo(I.$$.fragment),Br(I.$$.fragment,1),Ho(I,U.parentNode,U)):I=null}else J&&I.$set(H)},i(ge){P||(I&&Br(I.$$.fragment,ge),P=!0)},o(ge){I&&$r(I.$$.fragment,ge),P=!1},d(ge){ge&&bt(U),I&&Yo(I,ge)}}}function l0(C){let I,U,P,V;U=new ux({props:{$$slots:{default:[a0]},$$scope:{ctx:C}}});let J=gc.blocks,te=[];for(let Ie=0;Ie<J.length;Ie+=1)te[Ie]=Lm(Dm(C,J,Ie));const a=Ie=>$r(te[Ie],1,1,()=>{te[Ie]=null});return{c(){I=Kt("article"),Xo(U.$$.fragment),P=Hu();for(let Ie=0;Ie<te.length;Ie+=1)te[Ie].c();this.h()},l(Ie){I=Jt(Ie,"ARTICLE",{class:!0});var ge=sn(I);Rs(U.$$.fragment,ge),P=Yu(ge);for(let le=0;le<te.length;le+=1)te[le].l(ge);ge.forEach(bt),this.h()},h(){We(I,"class","px-4")},m(Ie,ge){Ki(Ie,I,ge),Ho(U,I,null),oi(I,P);for(let le=0;le<te.length;le+=1)te[le].m(I,null);V=!0},p(Ie,[ge]){const le={};if(ge&16&&(le.$$scope={dirty:ge,ctx:Ie}),U.$set(le),ge&1){J=gc.blocks;let H;for(H=0;H<J.length;H+=1){const me=Dm(Ie,J,H);te[H]?(te[H].p(me,ge),Br(te[H],1)):(te[H]=Lm(me),te[H].c(),Br(te[H],1),te[H].m(I,null))}for(Gm(),H=J.length;H<te.length;H+=1)a(H);$m()}},i(Ie){if(!V){Br(U.$$.fragment,Ie);for(let ge=0;ge<J.length;ge+=1)Br(te[ge]);V=!0}},o(Ie){$r(U.$$.fragment,Ie),te=te.filter(Boolean);for(let ge=0;ge<te.length;ge+=1)$r(te[ge]);V=!1},d(Ie){Ie&&bt(I),Yo(U),Xd(te,Ie)}}}function c0(C){return[{text:Pd,image:rx,subhead:Qy,mapbox:ax,map:s0}]}class u0 extends Pn{constructor(I){super(),Dn(this,I,c0,l0,Ln,{})}}function h0(C){let I,U,P,V;return I=new Uy({props:{title:C[0]}}),P=new u0({}),{c(){Xo(I.$$.fragment),U=Hu(),Xo(P.$$.fragment)},l(J){Rs(I.$$.fragment,J),U=Yu(J),Rs(P.$$.fragment,J)},m(J,te){Ho(I,J,te),Ki(J,U,te),Ho(P,J,te),V=!0},p:lo,i(J){V||(Br(I.$$.fragment,J),Br(P.$$.fragment,J),V=!0)},o(J){$r(I.$$.fragment,J),$r(P.$$.fragment,J),V=!1},d(J){Yo(I,J),J&&bt(U),Yo(P,J)}}}const f0=!0;function d0(C){const{title:I}=gc;return Ry("copy",gc),[I]}class m0 extends Pn{constructor(I){super(),Dn(this,I,d0,h0,Ln,{})}}export{m0 as default,f0 as prerender};
